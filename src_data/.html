<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>DeepSeek-V3 Technical Report</title>
<!--Generated on Fri Dec 27 03:48:31 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2412.19437v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S1" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Architecture</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS1" title="In 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>Basic Architecture</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS1.SSS1" title="In 2.1 Basic Architecture ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1.1 </span>Multi-Head Latent Attention</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS1.SSS2" title="In 2.1 Basic Architecture ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1.2 </span>DeepSeekMoE with Auxiliary-Loss-Free Load Balancing</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS1.SSS2.Px1" title="In 2.1.2 DeepSeekMoE with Auxiliary-Loss-Free Load Balancing ‣ 2.1 Basic Architecture ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Basic Architecture of DeepSeekMoE.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS1.SSS2.Px2" title="In 2.1.2 DeepSeekMoE with Auxiliary-Loss-Free Load Balancing ‣ 2.1 Basic Architecture ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Auxiliary-Loss-Free Load Balancing.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS1.SSS2.Px3" title="In 2.1.2 DeepSeekMoE with Auxiliary-Loss-Free Load Balancing ‣ 2.1 Basic Architecture ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Complementary Sequence-Wise Auxiliary Loss.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS1.SSS2.Px4" title="In 2.1.2 DeepSeekMoE with Auxiliary-Loss-Free Load Balancing ‣ 2.1 Basic Architecture ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Node-Limited Routing.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS1.SSS2.Px5" title="In 2.1.2 DeepSeekMoE with Auxiliary-Loss-Free Load Balancing ‣ 2.1 Basic Architecture ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">No Token-Dropping.</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS2" title="In 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>Multi-Token Prediction</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS2.SSS0.Px1" title="In 2.2 Multi-Token Prediction ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">MTP Modules.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS2.SSS0.Px2" title="In 2.2 Multi-Token Prediction ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">MTP Training Objective.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS2.SSS0.Px3" title="In 2.2 Multi-Token Prediction ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">MTP in Inference.</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Infrastructures</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS1" title="In 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Compute Clusters</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS2" title="In 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Training Framework</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS2.SSS1" title="In 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2.1 </span>DualPipe and Computation-Communication Overlap</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS2.SSS2" title="In 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2.2 </span>Efficient Implementation of Cross-Node All-to-All Communication</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS2.SSS3" title="In 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2.3 </span>Extremely Memory Saving with Minimal Overhead</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS2.SSS3.Px1" title="In 3.2.3 Extremely Memory Saving with Minimal Overhead ‣ 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Recomputation of RMSNorm and MLA Up-Projection.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS2.SSS3.Px2" title="In 3.2.3 Extremely Memory Saving with Minimal Overhead ‣ 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Exponential Moving Average in CPU.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS2.SSS3.Px3" title="In 3.2.3 Extremely Memory Saving with Minimal Overhead ‣ 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Shared Embedding and Output Head for Multi-Token Prediction.</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3" title="In 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>FP8 Training</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS1" title="In 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3.1 </span>Mixed Precision Framework</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS2" title="In 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3.2 </span>Improved Precision from Quantization and Multiplication</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS2.Px1" title="In 3.3.2 Improved Precision from Quantization and Multiplication ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Fine-Grained Quantization.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS2.Px2" title="In 3.3.2 Improved Precision from Quantization and Multiplication ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Increasing Accumulation Precision.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS2.Px3" title="In 3.3.2 Improved Precision from Quantization and Multiplication ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Mantissa over Exponents.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS2.Px4" title="In 3.3.2 Improved Precision from Quantization and Multiplication ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Online Quantization.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS3" title="In 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3.3 </span>Low-Precision Storage and Communication</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS3.Px1" title="In 3.3.3 Low-Precision Storage and Communication ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Low-Precision Optimizer States.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS3.Px2" title="In 3.3.3 Low-Precision Storage and Communication ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Low-Precision Activation.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS3.Px3" title="In 3.3.3 Low-Precision Storage and Communication ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Low-Precision Communication.</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS4" title="In 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4 </span>Inference and Deployment</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS4.SSS1" title="In 3.4 Inference and Deployment ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4.1 </span>Prefilling</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS4.SSS2" title="In 3.4 Inference and Deployment ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4.2 </span>Decoding</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS5" title="In 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.5 </span>Suggestions on Hardware Design</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS5.SSS1" title="In 3.5 Suggestions on Hardware Design ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.5.1 </span>Communication Hardware</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS5.SSS2" title="In 3.5 Suggestions on Hardware Design ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.5.2 </span>Compute Hardware</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS5.SSS2.Px1" title="In 3.5.2 Compute Hardware ‣ 3.5 Suggestions on Hardware Design ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Higher FP8 GEMM Accumulation Precision in Tensor Cores.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS5.SSS2.Px2" title="In 3.5.2 Compute Hardware ‣ 3.5 Suggestions on Hardware Design ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Support for Tile- and Block-Wise Quantization.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS5.SSS2.Px3" title="In 3.5.2 Compute Hardware ‣ 3.5 Suggestions on Hardware Design ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Support for Online Quantization.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS5.SSS2.Px4" title="In 3.5.2 Compute Hardware ‣ 3.5 Suggestions on Hardware Design ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Support for Transposed GEMM Operations.</span></a></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Pre-Training</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS1" title="In 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Data Construction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS2" title="In 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Hyper-Parameters</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS2.SSS0.Px1" title="In 4.2 Hyper-Parameters ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Model Hyper-Parameters.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS2.SSS0.Px2" title="In 4.2 Hyper-Parameters ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Training Hyper-Parameters.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS3" title="In 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>Long Context Extension</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS4" title="In 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4 </span>Evaluations</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS4.SSS1" title="In 4.4 Evaluations ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4.1 </span>Evaluation Benchmarks</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS4.SSS2" title="In 4.4 Evaluations ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4.2 </span>Evaluation Results</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS5" title="In 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.5 </span>Discussion</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS5.SSS1" title="In 4.5 Discussion ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.5.1 </span>Ablation Studies for Multi-Token Prediction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS5.SSS2" title="In 4.5 Discussion ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.5.2 </span>Ablation Studies for the Auxiliary-Loss-Free Balancing Strategy</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS5.SSS3" title="In 4.5 Discussion ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.5.3 </span>Batch-Wise Load Balance VS. Sequence-Wise Load Balance</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Post-Training</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS1" title="In 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.1 </span>Supervised Fine-Tuning</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS1.SSS0.Px1" title="In 5.1 Supervised Fine-Tuning ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Reasoning Data.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS1.SSS0.Px2" title="In 5.1 Supervised Fine-Tuning ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Non-Reasoning Data.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS1.SSS0.Px3" title="In 5.1 Supervised Fine-Tuning ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">SFT Settings.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS2" title="In 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2 </span>Reinforcement Learning</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS2.SSS1" title="In 5.2 Reinforcement Learning ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2.1 </span>Reward Model</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS2.SSS1.Px1" title="In 5.2.1 Reward Model ‣ 5.2 Reinforcement Learning ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Rule-Based RM.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS2.SSS1.Px2" title="In 5.2.1 Reward Model ‣ 5.2 Reinforcement Learning ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Model-Based RM.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS2.SSS2" title="In 5.2 Reinforcement Learning ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2.2 </span>Group Relative Policy Optimization</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3" title="In 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3 </span>Evaluations</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS1" title="In 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3.1 </span>Evaluation Settings</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS1.Px1" title="In 5.3.1 Evaluation Settings ‣ 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Evaluation Benchmarks.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS1.Px2" title="In 5.3.1 Evaluation Settings ‣ 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Compared Baselines.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS1.Px3" title="In 5.3.1 Evaluation Settings ‣ 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Detailed Evaluation Configurations.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS2" title="In 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3.2 </span>Standard Evaluation</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS2.Px1" title="In 5.3.2 Standard Evaluation ‣ 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">English Benchmarks.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS2.Px2" title="In 5.3.2 Standard Evaluation ‣ 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Code and Math Benchmarks.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS2.Px3" title="In 5.3.2 Standard Evaluation ‣ 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title">Chinese Benchmarks.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS3" title="In 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3.3 </span>Open-Ended Evaluation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS4" title="In 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3.4 </span>DeepSeek-V3 as a Generative Reward Model</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS4" title="In 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.4 </span>Discussion</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS4.SSS1" title="In 5.4 Discussion ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.4.1 </span>Distillation from DeepSeek-R1</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS4.SSS2" title="In 5.4 Discussion ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.4.2 </span>Self-Rewarding</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS4.SSS3" title="In 5.4 Discussion ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.4.3 </span>Multi-Token Prediction Evaluation</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S6" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Conclusion, Limitations, and Future Directions</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A1" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Contributions and Acknowledgments</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A2" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B </span>Ablation Studies for Low-Precision Training</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A2.SS1" title="In Appendix B Ablation Studies for Low-Precision Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B.1 </span>FP8 v.s. BF16 Training</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A2.SS2" title="In Appendix B Ablation Studies for Low-Precision Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B.2 </span>Discussion About Block-Wise Quantization</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A3" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">C </span>Expert Specialization Patterns of the 16B Aux-Loss-Based and Aux-Loss-Free Models</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<div class="ltx_para" id="p1">
<span class="ltx_ERROR undefined" id="p1.1">\reportnumber</span>
<p class="ltx_p" id="p1.2">001 




























































































































































































 







































</p>
</div>
<h1 class="ltx_title ltx_title_document">DeepSeek-V3 Technical Report</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
DeepSeek-AI

<br class="ltx_break"/><span class="ltx_text ltx_font_typewriter" id="id1.1.id1" style="font-size:90%;">research@deepseek.com<span class="ltx_text ltx_font_serif" id="id1.1.id1.1">
</span></span>
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation">
</span></span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id2.id1">We present DeepSeek-V3, a strong Mixture-of-Experts (MoE) language model with 671B total parameters with 37B activated for each token.
To achieve efficient inference and cost-effective training, DeepSeek-V3 adopts Multi-head Latent Attention (MLA) and DeepSeekMoE architectures, which were thoroughly validated in DeepSeek-V2.
Furthermore, DeepSeek-V3 pioneers an auxiliary-loss-free strategy for load balancing and sets a multi-token prediction training objective for stronger performance.
We pre-train DeepSeek-V3 on 14.8 trillion diverse and high-quality tokens, followed by Supervised Fine-Tuning and Reinforcement Learning stages to fully harness its capabilities.
Comprehensive evaluations reveal that DeepSeek-V3 outperforms other open-source models and achieves performance comparable to leading closed-source models.
Despite its excellent performance, DeepSeek-V3 requires only 2.788M H800 GPU hours for its full training.
In addition, its training process is remarkably stable.
Throughout the entire training process, we did not experience any irrecoverable loss spikes or perform any rollbacks.
The model checkpoints are available at <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/deepseek-ai/DeepSeek-V3" title="">https://github.com/deepseek-ai/DeepSeek-V3</a>.</p>
</div>
<div class="ltx_para" id="p2">
<span class="ltx_ERROR undefined" id="p2.1" lang="en">{CJK*}</span>
<p class="ltx_p" id="p2.2"><span class="ltx_text" id="p2.2.1" lang="en">UTF8gbsn</span></p>
</div>
<figure class="ltx_figure" id="S0.F1" lang="en"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="485" id="S0.F1.g1" src="x1.png" width="830"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 1: </span>
Benchmark performance of DeepSeek-V3 and its counterparts.
</figcaption>
</figure>
<div class="ltx_pagination ltx_role_newpage"></div>
<nav class="ltx_TOC ltx_list_toc ltx_toc_toc" lang="en"><h6 class="ltx_title ltx_title_contents">Contents</h6>
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S1" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Architecture</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS1" title="In 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>Basic Architecture</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS1.SSS1" title="In 2.1 Basic Architecture ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1.1 </span>Multi-Head Latent Attention</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS1.SSS2" title="In 2.1 Basic Architecture ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1.2 </span>DeepSeekMoE with Auxiliary-Loss-Free Load Balancing</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.SS2" title="In 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>Multi-Token Prediction</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Infrastructures</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS1" title="In 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Compute Clusters</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS2" title="In 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Training Framework</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS2.SSS1" title="In 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2.1 </span>DualPipe and Computation-Communication Overlap</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS2.SSS2" title="In 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2.2 </span>Efficient Implementation of Cross-Node All-to-All Communication</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS2.SSS3" title="In 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2.3 </span>Extremely Memory Saving with Minimal Overhead</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3" title="In 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>FP8 Training</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS1" title="In 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3.1 </span>Mixed Precision Framework</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS2" title="In 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3.2 </span>Improved Precision from Quantization and Multiplication</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS3.SSS3" title="In 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3.3 </span>Low-Precision Storage and Communication</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS4" title="In 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4 </span>Inference and Deployment</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS4.SSS1" title="In 3.4 Inference and Deployment ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4.1 </span>Prefilling</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS4.SSS2" title="In 3.4 Inference and Deployment ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4.2 </span>Decoding</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS5" title="In 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.5 </span>Suggestions on Hardware Design</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS5.SSS1" title="In 3.5 Suggestions on Hardware Design ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.5.1 </span>Communication Hardware</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS5.SSS2" title="In 3.5 Suggestions on Hardware Design ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.5.2 </span>Compute Hardware</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Pre-Training</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS1" title="In 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Data Construction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS2" title="In 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Hyper-Parameters</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS3" title="In 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>Long Context Extension</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS4" title="In 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4 </span>Evaluations</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS4.SSS1" title="In 4.4 Evaluations ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4.1 </span>Evaluation Benchmarks</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS4.SSS2" title="In 4.4 Evaluations ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4.2 </span>Evaluation Results</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS5" title="In 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.5 </span>Discussion</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS5.SSS1" title="In 4.5 Discussion ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.5.1 </span>Ablation Studies for Multi-Token Prediction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS5.SSS2" title="In 4.5 Discussion ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.5.2 </span>Ablation Studies for the Auxiliary-Loss-Free Balancing Strategy</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.SS5.SSS3" title="In 4.5 Discussion ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.5.3 </span>Batch-Wise Load Balance VS. Sequence-Wise Load Balance</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Post-Training</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS1" title="In 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.1 </span>Supervised Fine-Tuning</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS2" title="In 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2 </span>Reinforcement Learning</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS2.SSS1" title="In 5.2 Reinforcement Learning ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2.1 </span>Reward Model</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS2.SSS2" title="In 5.2 Reinforcement Learning ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2.2 </span>Group Relative Policy Optimization</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3" title="In 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3 </span>Evaluations</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS1" title="In 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3.1 </span>Evaluation Settings</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS2" title="In 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3.2 </span>Standard Evaluation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS3" title="In 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3.3 </span>Open-Ended Evaluation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS3.SSS4" title="In 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3.4 </span>DeepSeek-V3 as a Generative Reward Model</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS4" title="In 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.4 </span>Discussion</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS4.SSS1" title="In 5.4 Discussion ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.4.1 </span>Distillation from DeepSeek-R1</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS4.SSS2" title="In 5.4 Discussion ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.4.2 </span>Self-Rewarding</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.SS4.SSS3" title="In 5.4 Discussion ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.4.3 </span>Multi-Token Prediction Evaluation</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S6" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Conclusion, Limitations, and Future Directions</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A1" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Contributions and Acknowledgments</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A2" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B </span>Ablation Studies for Low-Precision Training</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A2.SS1" title="In Appendix B Ablation Studies for Low-Precision Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B.1 </span>FP8 v.s. BF16 Training</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A2.SS2" title="In Appendix B Ablation Studies for Low-Precision Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B.2 </span>Discussion About Block-Wise Quantization</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A3" title="In DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">C </span>Expert Specialization Patterns of the 16B Aux-Loss-Based and Aux-Loss-Free Models</span></a></li>
</ol></nav>
<div class="ltx_pagination ltx_role_newpage"></div>
<section class="ltx_section" id="S1" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">In recent years, Large Language Models (LLMs) have been undergoing rapid iteration and evolution <cite class="ltx_cite ltx_citemacro_citep">(OpenAI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib64" title="">2024a</a>; Anthropic, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib3" title="">2024</a>; Google, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib27" title="">2024</a>)</cite>, progressively diminishing the gap towards Artificial General Intelligence (AGI).
Beyond closed-source models, open-source models, including DeepSeek series <cite class="ltx_cite ltx_citemacro_citep">(DeepSeek-AI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib15" title="">2024b</a>, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib16" title="">c</a>; Guo et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib30" title="">2024</a>; DeepSeek-AI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib14" title="">2024a</a>)</cite>, LLaMA series <cite class="ltx_cite ltx_citemacro_citep">(Touvron et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib90" title="">2023a</a>, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib91" title="">b</a>; AI@Meta, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib1" title="">2024a</a>, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib2" title="">b</a>)</cite>, Qwen series <cite class="ltx_cite ltx_citemacro_citep">(Qwen, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib72" title="">2023</a>, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib73" title="">2024a</a>, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib74" title="">2024b</a>)</cite>, and Mistral series <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib38" title="">2023</a>; Mistral, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib58" title="">2024</a>)</cite>, are also making significant strides, endeavoring to close the gap with their closed-source counterparts.
To further push the boundaries of open-source model capabilities, we scale up our models and introduce DeepSeek-V3, a large Mixture-of-Experts (MoE) model with 671B parameters, of which 37B are activated for each token.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">With a forward-looking perspective, we consistently strive for strong model performance and economical costs.
Therefore, in terms of architecture, DeepSeek-V3 still adopts Multi-head Latent Attention (MLA) <cite class="ltx_cite ltx_citemacro_citep">(DeepSeek-AI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib16" title="">2024c</a>)</cite> for efficient inference and DeepSeekMoE <cite class="ltx_cite ltx_citemacro_citep">(Dai et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib13" title="">2024</a>)</cite> for cost-effective training.
These two architectures have been validated in DeepSeek-V2 <cite class="ltx_cite ltx_citemacro_citep">(DeepSeek-AI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib16" title="">2024c</a>)</cite>, demonstrating their capability to maintain robust model performance while achieving efficient training and inference.
Beyond the basic architecture, we implement two additional strategies to further enhance the model capabilities.
Firstly, DeepSeek-V3 pioneers an auxiliary-loss-free strategy <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib93" title="">2024a</a>)</cite> for load balancing, with the aim of minimizing the adverse impact on model performance that arises from the effort to encourage load balancing.
Secondly, DeepSeek-V3 employs a multi-token prediction training objective, which we have observed to enhance the overall performance on evaluation benchmarks.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">In order to achieve efficient training, we support the FP8 mixed precision training and implement comprehensive optimizations for the training framework.
Low-precision training has emerged as a promising solution for efficient training <cite class="ltx_cite ltx_citemacro_citep">(Kalamkar et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib40" title="">2019</a>; Narang et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib59" title="">2017</a>; Peng et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib69" title="">2023b</a>; Dettmers et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib17" title="">2022</a>)</cite>, its evolution being closely tied to advancements in hardware capabilities <cite class="ltx_cite ltx_citemacro_citep">(Micikevicius et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib57" title="">2022</a>; Luo et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib55" title="">2024</a>; Rouhani et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib77" title="">2023a</a>)</cite>.
In this work, we introduce an FP8 mixed precision training framework and, for the first time, validate its effectiveness on an extremely large-scale model.
Through the support for FP8 computation and storage, we achieve both accelerated training and reduced GPU memory usage.
As for the training framework, we design the DualPipe algorithm for efficient pipeline parallelism, which has fewer pipeline bubbles and hides most of the communication during training through computation-communication overlap.
This overlap ensures that, as the model further scales up, as long as we maintain a constant computation-to-communication ratio, we can still employ fine-grained experts across nodes while achieving a near-zero all-to-all communication overhead.
In addition, we also develop efficient cross-node all-to-all communication kernels to fully utilize InfiniBand (IB) and NVLink bandwidths.
Furthermore, we meticulously optimize the memory footprint, making it possible to train DeepSeek-V3 without using costly tensor parallelism.
Combining these efforts, we achieve high training efficiency.</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">During pre-training, we train DeepSeek-V3 on 14.8T high-quality and diverse tokens.
The pre-training process is remarkably stable.
Throughout the entire training process, we did not encounter any irrecoverable loss spikes or have to roll back.
Next, we conduct a two-stage context length extension for DeepSeek-V3. In the first stage, the maximum context length is extended to 32K, and in the second stage, it is further extended to 128K.
Following this, we conduct post-training, including Supervised Fine-Tuning (SFT) and Reinforcement Learning (RL) on the base model of DeepSeek-V3, to align it with human preferences and further unlock its potential.
During the post-training stage, we distill the reasoning capability from the DeepSeek-R1 series of models, and meanwhile carefully maintain the balance between model accuracy and generation length.</p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">We evaluate DeepSeek-V3 on a comprehensive array of benchmarks.
Despite its economical training costs, comprehensive evaluations reveal that DeepSeek-V3-Base has emerged as the strongest open-source base model currently available, especially in code and math.
Its chat version also outperforms other open-source models and achieves performance comparable to leading closed-source models, including GPT-4o and Claude-3.5-Sonnet, on a series of standard and open-ended benchmarks.</p>
</div>
<figure class="ltx_table" id="S1.T1">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S1.T1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S1.T1.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="S1.T1.1.1.1.1"><span class="ltx_text ltx_font_bold" id="S1.T1.1.1.1.1.1">Training Costs</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S1.T1.1.1.1.2"><span class="ltx_text ltx_font_bold" id="S1.T1.1.1.1.2.1">Pre-Training</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S1.T1.1.1.1.3"><span class="ltx_text ltx_font_bold" id="S1.T1.1.1.1.3.1">Context Extension</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="S1.T1.1.1.1.4"><span class="ltx_text ltx_font_bold" id="S1.T1.1.1.1.4.1">Post-Training</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S1.T1.1.1.1.5"><span class="ltx_text ltx_font_bold" id="S1.T1.1.1.1.5.1">Total</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S1.T1.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S1.T1.1.2.1.1">in H800 GPU Hours</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S1.T1.1.2.1.2">2664K</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S1.T1.1.2.1.3">119K</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S1.T1.1.2.1.4">5K</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S1.T1.1.2.1.5">2788K</td>
</tr>
<tr class="ltx_tr" id="S1.T1.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="S1.T1.1.3.2.1">in USD</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S1.T1.1.3.2.2">$5.328M</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S1.T1.1.3.2.3">$0.238M</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S1.T1.1.3.2.4">$0.01M</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S1.T1.1.3.2.5">$5.576M</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1: </span>
Training costs of DeepSeek-V3, assuming the rental price of H800 is $2 per GPU hour.
</figcaption>
</figure>
<div class="ltx_para" id="S1.p6">
<p class="ltx_p" id="S1.p6.1">Lastly, we emphasize again the economical training costs of DeepSeek-V3, summarized in Table <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S1.T1" title="Table 1 ‣ 1 Introduction ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">1</span></a>, achieved through our optimized co-design of algorithms, frameworks, and hardware.
During the pre-training stage, training DeepSeek-V3 on each trillion tokens requires only 180K H800 GPU hours, i.e., 3.7 days on our cluster with 2048 H800 GPUs.
Consequently, our pre-training stage is completed in less than two months and costs 2664K GPU hours.
Combined with 119K GPU hours for the context length extension and 5K GPU hours for post-training, DeepSeek-V3 costs only 2.788M GPU hours for its full training.
Assuming the rental price of the H800 GPU is $2 per GPU hour, our total training costs amount to only $5.576M.
Note that the aforementioned costs include only the official training of DeepSeek-V3, excluding the costs associated with prior research and ablation experiments on architectures, algorithms, or data.</p>
</div>
<div class="ltx_para" id="S1.p7">
<p class="ltx_p" id="S1.p7.1">Our main contribution includes:</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p8">
<p class="ltx_p" id="S1.p8.1"><span class="ltx_text ltx_font_bold" id="S1.p8.1.1">Architecture: Innovative Load Balancing Strategy and Training Objective</span></p>
<ul class="ltx_itemize" id="S1.I1">
<li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i1.p1">
<p class="ltx_p" id="S1.I1.i1.p1.1">On top of the efficient architecture of DeepSeek-V2, we pioneer an auxiliary-loss-free strategy for load balancing, which minimizes the performance degradation that arises from encouraging load balancing.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i2.p1">
<p class="ltx_p" id="S1.I1.i2.p1.1">We investigate a Multi-Token Prediction (MTP) objective and prove it beneficial to model performance.
It can also be used for speculative decoding for inference acceleration.</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para ltx_noindent" id="S1.p9">
<p class="ltx_p" id="S1.p9.1"><span class="ltx_text ltx_font_bold" id="S1.p9.1.1">Pre-Training: Towards Ultimate Training Efficiency</span></p>
<ul class="ltx_itemize" id="S1.I2">
<li class="ltx_item" id="S1.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I2.i1.p1">
<p class="ltx_p" id="S1.I2.i1.p1.1">We design an FP8 mixed precision training framework and, for the first time, validate the feasibility and effectiveness of FP8 training on an extremely large-scale model.</p>
</div>
</li>
<li class="ltx_item" id="S1.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I2.i2.p1">
<p class="ltx_p" id="S1.I2.i2.p1.1">Through the co-design of algorithms, frameworks, and hardware, we overcome the communication bottleneck in cross-node MoE training, achieving near-full computation-communication overlap.
This significantly enhances our training efficiency and reduces the training costs, enabling us to further scale up the model size without additional overhead.</p>
</div>
</li>
<li class="ltx_item" id="S1.I2.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I2.i3.p1">
<p class="ltx_p" id="S1.I2.i3.p1.1">At an economical cost of only 2.664M H800 GPU hours, we complete the pre-training of DeepSeek-V3 on 14.8T tokens, producing the currently strongest open-source base model.
The subsequent training stages after pre-training require only 0.1M GPU hours.</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para ltx_noindent" id="S1.p10">
<p class="ltx_p" id="S1.p10.1"><span class="ltx_text ltx_font_bold" id="S1.p10.1.1">Post-Training: Knowledge Distillation from DeepSeek-R1</span></p>
<ul class="ltx_itemize" id="S1.I3">
<li class="ltx_item" id="S1.I3.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I3.i1.p1">
<p class="ltx_p" id="S1.I3.i1.p1.1">We introduce an innovative methodology to distill reasoning capabilities from the long-Chain-of-Thought (CoT) model, specifically from one of the DeepSeek R1 series models, into standard LLMs, particularly DeepSeek-V3.
Our pipeline elegantly incorporates the verification and reflection patterns of R1 into DeepSeek-V3 and notably improves its reasoning performance.
Meanwhile, we also maintain control over the output style and length of DeepSeek-V3.</p>
</div>
</li>
</ul>
<p class="ltx_p" id="S1.p10.2"><span class="ltx_text ltx_font_bold" id="S1.p10.2.1">Summary of Core Evaluation Results</span></p>
<ul class="ltx_itemize" id="S1.I4">
<li class="ltx_item" id="S1.I4.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I4.i1.p1">
<p class="ltx_p" id="S1.I4.i1.p1.1"><span class="ltx_text ltx_font_bold" id="S1.I4.i1.p1.1.1">Knowledge</span>:
(1)
On educational benchmarks such as MMLU, MMLU-Pro, and GPQA, DeepSeek-V3 outperforms all other open-source models, achieving 88.5 on MMLU, 75.9 on MMLU-Pro, and 59.1 on GPQA.
Its performance is comparable to leading closed-source models like GPT-4o and Claude-Sonnet-3.5, narrowing the gap between open-source and closed-source models in this domain.
(2)
For factuality benchmarks, DeepSeek-V3 demonstrates superior performance among open-source models on both SimpleQA and Chinese SimpleQA.
While it trails behind GPT-4o and Claude-Sonnet-3.5 in English factual knowledge (SimpleQA), it surpasses these models in Chinese factual knowledge (Chinese SimpleQA), highlighting its strength in Chinese factual knowledge.</p>
</div>
</li>
<li class="ltx_item" id="S1.I4.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I4.i2.p1">
<p class="ltx_p" id="S1.I4.i2.p1.1"><span class="ltx_text ltx_font_bold" id="S1.I4.i2.p1.1.1">Code, Math, and Reasoning</span>:
(1)
DeepSeek-V3 achieves state-of-the-art performance on math-related benchmarks among all non-long-CoT open-source and closed-source models.
Notably, it even outperforms o1-preview on specific benchmarks, such as MATH-500, demonstrating its robust mathematical reasoning capabilities.
(2)
On coding-related tasks, DeepSeek-V3 emerges as the top-performing model for coding competition benchmarks, such as LiveCodeBench, solidifying its position as the leading model in this domain.
For engineering-related tasks, while DeepSeek-V3 performs slightly below Claude-Sonnet-3.5, it still outpaces all other models by a significant margin, demonstrating its competitiveness across diverse technical benchmarks.</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para" id="S1.p11">
<p class="ltx_p" id="S1.p11.1">In the remainder of this paper, we first present a detailed exposition of our DeepSeek-V3 model architecture (Section <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2" title="2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">2</span></a>).
Subsequently, we introduce our infrastructures, encompassing our compute clusters, the training framework, the support for FP8 training, the inference deployment strategy, and our suggestions on future hardware design.
Next, we describe our pre-training process, including the construction of training data, hyper-parameter settings, long-context extension techniques, the associated evaluations, as well as some discussions (Section <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4" title="4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">4</span></a>).
Thereafter, we discuss our efforts on post-training, which include Supervised Fine-Tuning (SFT), Reinforcement Learning (RL), the corresponding evaluations, and discussions (Section <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5" title="5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">5</span></a>).
Lastly, we conclude this work, discuss existing limitations of DeepSeek-V3, and propose potential directions for future research (Section <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S6" title="6 Conclusion, Limitations, and Future Directions ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">6</span></a>).</p>
</div>
</section>
<section class="ltx_section" id="S2" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Architecture</h2>
<div class="ltx_para" id="S2.p1">
<p class="ltx_p" id="S2.p1.1">We first introduce the basic architecture of DeepSeek-V3, featured by Multi-head Latent Attention (MLA) <cite class="ltx_cite ltx_citemacro_citep">(DeepSeek-AI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib16" title="">2024c</a>)</cite> for efficient inference and DeepSeekMoE <cite class="ltx_cite ltx_citemacro_citep">(Dai et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib13" title="">2024</a>)</cite> for economical training.
Then, we present a Multi-Token Prediction (MTP) training objective, which we have observed to enhance the overall performance on evaluation benchmarks.
For other minor details not explicitly mentioned, DeepSeek-V3 adheres to the settings of DeepSeek-V2 <cite class="ltx_cite ltx_citemacro_citep">(DeepSeek-AI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib16" title="">2024c</a>)</cite>.</p>
</div>
<figure class="ltx_figure" id="S2.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="661" id="S2.F2.g1" src="x2.png" width="822"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span>
Illustration of the basic architecture of DeepSeek-V3.
Following DeepSeek-V2, we adopt MLA and DeepSeekMoE for efficient inference and economical training.
</figcaption>
</figure>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1 </span>Basic Architecture</h3>
<div class="ltx_para" id="S2.SS1.p1">
<p class="ltx_p" id="S2.SS1.p1.1">The basic architecture of DeepSeek-V3 is still within the Transformer <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib92" title="">2017</a>)</cite> framework.
For efficient inference and economical training, DeepSeek-V3 also adopts MLA and DeepSeekMoE, which have been thoroughly validated by DeepSeek-V2.
Compared with DeepSeek-V2, an exception is that we additionally introduce an auxiliary-loss-free load balancing strategy <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib93" title="">2024a</a>)</cite> for DeepSeekMoE to mitigate the performance degradation induced by the effort to ensure load balance.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.F2" title="Figure 2 ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">2</span></a> illustrates the basic architecture of DeepSeek-V3, and we will briefly review the details of MLA and DeepSeekMoE in this section.</p>
</div>
<section class="ltx_subsubsection" id="S2.SS1.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">2.1.1 </span>Multi-Head Latent Attention</h4>
<div class="ltx_para" id="S2.SS1.SSS1.p1">
<p class="ltx_p" id="S2.SS1.SSS1.p1.5">For attention, DeepSeek-V3 adopts the MLA architecture.
Let <math alttext="d" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.1.m1.1"><semantics id="S2.SS1.SSS1.p1.1.m1.1a"><mi id="S2.SS1.SSS1.p1.1.m1.1.1" xref="S2.SS1.SSS1.p1.1.m1.1.1.cmml">d</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.1.m1.1b"><ci id="S2.SS1.SSS1.p1.1.m1.1.1.cmml" xref="S2.SS1.SSS1.p1.1.m1.1.1">𝑑</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.1.m1.1c">d</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.1.m1.1d">italic_d</annotation></semantics></math> denote the embedding dimension, <math alttext="n_{h}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.2.m2.1"><semantics id="S2.SS1.SSS1.p1.2.m2.1a"><msub id="S2.SS1.SSS1.p1.2.m2.1.1" xref="S2.SS1.SSS1.p1.2.m2.1.1.cmml"><mi id="S2.SS1.SSS1.p1.2.m2.1.1.2" xref="S2.SS1.SSS1.p1.2.m2.1.1.2.cmml">n</mi><mi id="S2.SS1.SSS1.p1.2.m2.1.1.3" xref="S2.SS1.SSS1.p1.2.m2.1.1.3.cmml">h</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.2.m2.1b"><apply id="S2.SS1.SSS1.p1.2.m2.1.1.cmml" xref="S2.SS1.SSS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.2.m2.1.1.1.cmml" xref="S2.SS1.SSS1.p1.2.m2.1.1">subscript</csymbol><ci id="S2.SS1.SSS1.p1.2.m2.1.1.2.cmml" xref="S2.SS1.SSS1.p1.2.m2.1.1.2">𝑛</ci><ci id="S2.SS1.SSS1.p1.2.m2.1.1.3.cmml" xref="S2.SS1.SSS1.p1.2.m2.1.1.3">ℎ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.2.m2.1c">n_{h}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.2.m2.1d">italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT</annotation></semantics></math> denote the number of attention heads, <math alttext="d_{h}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.3.m3.1"><semantics id="S2.SS1.SSS1.p1.3.m3.1a"><msub id="S2.SS1.SSS1.p1.3.m3.1.1" xref="S2.SS1.SSS1.p1.3.m3.1.1.cmml"><mi id="S2.SS1.SSS1.p1.3.m3.1.1.2" xref="S2.SS1.SSS1.p1.3.m3.1.1.2.cmml">d</mi><mi id="S2.SS1.SSS1.p1.3.m3.1.1.3" xref="S2.SS1.SSS1.p1.3.m3.1.1.3.cmml">h</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.3.m3.1b"><apply id="S2.SS1.SSS1.p1.3.m3.1.1.cmml" xref="S2.SS1.SSS1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.3.m3.1.1.1.cmml" xref="S2.SS1.SSS1.p1.3.m3.1.1">subscript</csymbol><ci id="S2.SS1.SSS1.p1.3.m3.1.1.2.cmml" xref="S2.SS1.SSS1.p1.3.m3.1.1.2">𝑑</ci><ci id="S2.SS1.SSS1.p1.3.m3.1.1.3.cmml" xref="S2.SS1.SSS1.p1.3.m3.1.1.3">ℎ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.3.m3.1c">d_{h}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.3.m3.1d">italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT</annotation></semantics></math> denote the dimension per head, and <math alttext="\mathbf{h}_{t}\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.4.m4.1"><semantics id="S2.SS1.SSS1.p1.4.m4.1a"><mrow id="S2.SS1.SSS1.p1.4.m4.1.1" xref="S2.SS1.SSS1.p1.4.m4.1.1.cmml"><msub id="S2.SS1.SSS1.p1.4.m4.1.1.2" xref="S2.SS1.SSS1.p1.4.m4.1.1.2.cmml"><mi id="S2.SS1.SSS1.p1.4.m4.1.1.2.2" xref="S2.SS1.SSS1.p1.4.m4.1.1.2.2.cmml">𝐡</mi><mi id="S2.SS1.SSS1.p1.4.m4.1.1.2.3" xref="S2.SS1.SSS1.p1.4.m4.1.1.2.3.cmml">t</mi></msub><mo id="S2.SS1.SSS1.p1.4.m4.1.1.1" xref="S2.SS1.SSS1.p1.4.m4.1.1.1.cmml">∈</mo><msup id="S2.SS1.SSS1.p1.4.m4.1.1.3" xref="S2.SS1.SSS1.p1.4.m4.1.1.3.cmml"><mi id="S2.SS1.SSS1.p1.4.m4.1.1.3.2" xref="S2.SS1.SSS1.p1.4.m4.1.1.3.2.cmml">ℝ</mi><mi id="S2.SS1.SSS1.p1.4.m4.1.1.3.3" xref="S2.SS1.SSS1.p1.4.m4.1.1.3.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.4.m4.1b"><apply id="S2.SS1.SSS1.p1.4.m4.1.1.cmml" xref="S2.SS1.SSS1.p1.4.m4.1.1"><in id="S2.SS1.SSS1.p1.4.m4.1.1.1.cmml" xref="S2.SS1.SSS1.p1.4.m4.1.1.1"></in><apply id="S2.SS1.SSS1.p1.4.m4.1.1.2.cmml" xref="S2.SS1.SSS1.p1.4.m4.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.4.m4.1.1.2.1.cmml" xref="S2.SS1.SSS1.p1.4.m4.1.1.2">subscript</csymbol><ci id="S2.SS1.SSS1.p1.4.m4.1.1.2.2.cmml" xref="S2.SS1.SSS1.p1.4.m4.1.1.2.2">𝐡</ci><ci id="S2.SS1.SSS1.p1.4.m4.1.1.2.3.cmml" xref="S2.SS1.SSS1.p1.4.m4.1.1.2.3">𝑡</ci></apply><apply id="S2.SS1.SSS1.p1.4.m4.1.1.3.cmml" xref="S2.SS1.SSS1.p1.4.m4.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.4.m4.1.1.3.1.cmml" xref="S2.SS1.SSS1.p1.4.m4.1.1.3">superscript</csymbol><ci id="S2.SS1.SSS1.p1.4.m4.1.1.3.2.cmml" xref="S2.SS1.SSS1.p1.4.m4.1.1.3.2">ℝ</ci><ci id="S2.SS1.SSS1.p1.4.m4.1.1.3.3.cmml" xref="S2.SS1.SSS1.p1.4.m4.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.4.m4.1c">\mathbf{h}_{t}\in\mathbb{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.4.m4.1d">bold_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> denote the attention input for the <math alttext="t" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.5.m5.1"><semantics id="S2.SS1.SSS1.p1.5.m5.1a"><mi id="S2.SS1.SSS1.p1.5.m5.1.1" xref="S2.SS1.SSS1.p1.5.m5.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.5.m5.1b"><ci id="S2.SS1.SSS1.p1.5.m5.1.1.cmml" xref="S2.SS1.SSS1.p1.5.m5.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.5.m5.1c">t</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.5.m5.1d">italic_t</annotation></semantics></math>-th token at a given attention layer.
The core of MLA is the low-rank joint compression for attention keys and values to reduce Key-Value (KV) cache during inference:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A3.EGx1">
<tbody id="S2.E1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\boxed{\color[rgb]{0,0,1}\definecolor[named]{pgfstrokecolor}{rgb}%
{0,0,1}\mathbf{c}_{t}^{KV}}" class="ltx_Math" display="inline" id="S2.E1.m1.1"><semantics id="S2.E1.m1.1a"><menclose id="S2.E1.m1.1.1" notation="box" xref="S2.E1.m1.1.1.cmml"><msubsup id="S2.E1.m1.1.1a" xref="S2.E1.m1.1.1.cmml"><mi id="S2.E1.m1.1.1.2.2" mathcolor="#0000FF" xref="S2.E1.m1.1.1.2.2.cmml">𝐜</mi><mi id="S2.E1.m1.1.1.2.3" mathcolor="#0000FF" xref="S2.E1.m1.1.1.2.3.cmml">t</mi><mrow id="S2.E1.m1.1.1.3" xref="S2.E1.m1.1.1.3.cmml"><mi id="S2.E1.m1.1.1.3.2" mathcolor="#0000FF" xref="S2.E1.m1.1.1.3.2.cmml">K</mi><mo id="S2.E1.m1.1.1.3.1" xref="S2.E1.m1.1.1.3.1.cmml">⁢</mo><mi id="S2.E1.m1.1.1.3.3" mathcolor="#0000FF" xref="S2.E1.m1.1.1.3.3.cmml">V</mi></mrow></msubsup></menclose><annotation-xml encoding="MathML-Content" id="S2.E1.m1.1b"><apply id="S2.E1.m1.1.1.cmml" xref="S2.E1.m1.1.1"><csymbol cd="ambiguous" id="S2.E1.m1.1.1.1.cmml" xref="S2.E1.m1.1.1">superscript</csymbol><apply id="S2.E1.m1.1.1.2.cmml" xref="S2.E1.m1.1.1"><csymbol cd="ambiguous" id="S2.E1.m1.1.1.2.1.cmml" xref="S2.E1.m1.1.1">subscript</csymbol><ci id="S2.E1.m1.1.1.2.2.cmml" xref="S2.E1.m1.1.1.2.2">𝐜</ci><ci id="S2.E1.m1.1.1.2.3.cmml" xref="S2.E1.m1.1.1.2.3">𝑡</ci></apply><apply id="S2.E1.m1.1.1.3.cmml" xref="S2.E1.m1.1.1.3"><times id="S2.E1.m1.1.1.3.1.cmml" xref="S2.E1.m1.1.1.3.1"></times><ci id="S2.E1.m1.1.1.3.2.cmml" xref="S2.E1.m1.1.1.3.2">𝐾</ci><ci id="S2.E1.m1.1.1.3.3.cmml" xref="S2.E1.m1.1.1.3.3">𝑉</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E1.m1.1c">\displaystyle\boxed{\color[rgb]{0,0,1}\definecolor[named]{pgfstrokecolor}{rgb}%
{0,0,1}\mathbf{c}_{t}^{KV}}</annotation><annotation encoding="application/x-llamapun" id="S2.E1.m1.1d">bold_c start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K italic_V end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=W^{DKV}\mathbf{h}_{t}," class="ltx_Math" display="inline" id="S2.E1.m2.1"><semantics id="S2.E1.m2.1a"><mrow id="S2.E1.m2.1.1.1" xref="S2.E1.m2.1.1.1.1.cmml"><mrow id="S2.E1.m2.1.1.1.1" xref="S2.E1.m2.1.1.1.1.cmml"><mi id="S2.E1.m2.1.1.1.1.2" xref="S2.E1.m2.1.1.1.1.2.cmml"></mi><mo id="S2.E1.m2.1.1.1.1.1" xref="S2.E1.m2.1.1.1.1.1.cmml">=</mo><mrow id="S2.E1.m2.1.1.1.1.3" xref="S2.E1.m2.1.1.1.1.3.cmml"><msup id="S2.E1.m2.1.1.1.1.3.2" xref="S2.E1.m2.1.1.1.1.3.2.cmml"><mi id="S2.E1.m2.1.1.1.1.3.2.2" xref="S2.E1.m2.1.1.1.1.3.2.2.cmml">W</mi><mrow id="S2.E1.m2.1.1.1.1.3.2.3" xref="S2.E1.m2.1.1.1.1.3.2.3.cmml"><mi id="S2.E1.m2.1.1.1.1.3.2.3.2" xref="S2.E1.m2.1.1.1.1.3.2.3.2.cmml">D</mi><mo id="S2.E1.m2.1.1.1.1.3.2.3.1" xref="S2.E1.m2.1.1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S2.E1.m2.1.1.1.1.3.2.3.3" xref="S2.E1.m2.1.1.1.1.3.2.3.3.cmml">K</mi><mo id="S2.E1.m2.1.1.1.1.3.2.3.1a" xref="S2.E1.m2.1.1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S2.E1.m2.1.1.1.1.3.2.3.4" xref="S2.E1.m2.1.1.1.1.3.2.3.4.cmml">V</mi></mrow></msup><mo id="S2.E1.m2.1.1.1.1.3.1" xref="S2.E1.m2.1.1.1.1.3.1.cmml">⁢</mo><msub id="S2.E1.m2.1.1.1.1.3.3" xref="S2.E1.m2.1.1.1.1.3.3.cmml"><mi id="S2.E1.m2.1.1.1.1.3.3.2" xref="S2.E1.m2.1.1.1.1.3.3.2.cmml">𝐡</mi><mi id="S2.E1.m2.1.1.1.1.3.3.3" xref="S2.E1.m2.1.1.1.1.3.3.3.cmml">t</mi></msub></mrow></mrow><mo id="S2.E1.m2.1.1.1.2" xref="S2.E1.m2.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E1.m2.1b"><apply id="S2.E1.m2.1.1.1.1.cmml" xref="S2.E1.m2.1.1.1"><eq id="S2.E1.m2.1.1.1.1.1.cmml" xref="S2.E1.m2.1.1.1.1.1"></eq><csymbol cd="latexml" id="S2.E1.m2.1.1.1.1.2.cmml" xref="S2.E1.m2.1.1.1.1.2">absent</csymbol><apply id="S2.E1.m2.1.1.1.1.3.cmml" xref="S2.E1.m2.1.1.1.1.3"><times id="S2.E1.m2.1.1.1.1.3.1.cmml" xref="S2.E1.m2.1.1.1.1.3.1"></times><apply id="S2.E1.m2.1.1.1.1.3.2.cmml" xref="S2.E1.m2.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S2.E1.m2.1.1.1.1.3.2.1.cmml" xref="S2.E1.m2.1.1.1.1.3.2">superscript</csymbol><ci id="S2.E1.m2.1.1.1.1.3.2.2.cmml" xref="S2.E1.m2.1.1.1.1.3.2.2">𝑊</ci><apply id="S2.E1.m2.1.1.1.1.3.2.3.cmml" xref="S2.E1.m2.1.1.1.1.3.2.3"><times id="S2.E1.m2.1.1.1.1.3.2.3.1.cmml" xref="S2.E1.m2.1.1.1.1.3.2.3.1"></times><ci id="S2.E1.m2.1.1.1.1.3.2.3.2.cmml" xref="S2.E1.m2.1.1.1.1.3.2.3.2">𝐷</ci><ci id="S2.E1.m2.1.1.1.1.3.2.3.3.cmml" xref="S2.E1.m2.1.1.1.1.3.2.3.3">𝐾</ci><ci id="S2.E1.m2.1.1.1.1.3.2.3.4.cmml" xref="S2.E1.m2.1.1.1.1.3.2.3.4">𝑉</ci></apply></apply><apply id="S2.E1.m2.1.1.1.1.3.3.cmml" xref="S2.E1.m2.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S2.E1.m2.1.1.1.1.3.3.1.cmml" xref="S2.E1.m2.1.1.1.1.3.3">subscript</csymbol><ci id="S2.E1.m2.1.1.1.1.3.3.2.cmml" xref="S2.E1.m2.1.1.1.1.3.3.2">𝐡</ci><ci id="S2.E1.m2.1.1.1.1.3.3.3.cmml" xref="S2.E1.m2.1.1.1.1.3.3.3">𝑡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E1.m2.1c">\displaystyle=W^{DKV}\mathbf{h}_{t},</annotation><annotation encoding="application/x-llamapun" id="S2.E1.m2.1d">= italic_W start_POSTSUPERSCRIPT italic_D italic_K italic_V end_POSTSUPERSCRIPT bold_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
<tbody id="S2.E2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle[\mathbf{k}_{t,1}^{C};\mathbf{k}_{t,2}^{C};...;\mathbf{k}_{t,n_{h%
}}^{C}]=\mathbf{k}_{t}^{C}" class="ltx_Math" display="inline" id="S2.E2.m1.10"><semantics id="S2.E2.m1.10a"><mrow id="S2.E2.m1.10.10" xref="S2.E2.m1.10.10.cmml"><mrow id="S2.E2.m1.10.10.3.3" xref="S2.E2.m1.10.10.3.4.cmml"><mo id="S2.E2.m1.10.10.3.3.4" stretchy="false" xref="S2.E2.m1.10.10.3.4.cmml">[</mo><msubsup id="S2.E2.m1.8.8.1.1.1" xref="S2.E2.m1.8.8.1.1.1.cmml"><mi id="S2.E2.m1.8.8.1.1.1.2.2" xref="S2.E2.m1.8.8.1.1.1.2.2.cmml">𝐤</mi><mrow id="S2.E2.m1.2.2.2.4" xref="S2.E2.m1.2.2.2.3.cmml"><mi id="S2.E2.m1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.cmml">t</mi><mo id="S2.E2.m1.2.2.2.4.1" xref="S2.E2.m1.2.2.2.3.cmml">,</mo><mn id="S2.E2.m1.2.2.2.2" xref="S2.E2.m1.2.2.2.2.cmml">1</mn></mrow><mi id="S2.E2.m1.8.8.1.1.1.3" xref="S2.E2.m1.8.8.1.1.1.3.cmml">C</mi></msubsup><mo id="S2.E2.m1.10.10.3.3.5" xref="S2.E2.m1.10.10.3.4.cmml">;</mo><msubsup id="S2.E2.m1.9.9.2.2.2" xref="S2.E2.m1.9.9.2.2.2.cmml"><mi id="S2.E2.m1.9.9.2.2.2.2.2" xref="S2.E2.m1.9.9.2.2.2.2.2.cmml">𝐤</mi><mrow id="S2.E2.m1.4.4.2.4" xref="S2.E2.m1.4.4.2.3.cmml"><mi id="S2.E2.m1.3.3.1.1" xref="S2.E2.m1.3.3.1.1.cmml">t</mi><mo id="S2.E2.m1.4.4.2.4.1" xref="S2.E2.m1.4.4.2.3.cmml">,</mo><mn id="S2.E2.m1.4.4.2.2" xref="S2.E2.m1.4.4.2.2.cmml">2</mn></mrow><mi id="S2.E2.m1.9.9.2.2.2.3" xref="S2.E2.m1.9.9.2.2.2.3.cmml">C</mi></msubsup><mo id="S2.E2.m1.10.10.3.3.6" xref="S2.E2.m1.10.10.3.4.cmml">;</mo><mi id="S2.E2.m1.7.7" mathvariant="normal" xref="S2.E2.m1.7.7.cmml">…</mi><mo id="S2.E2.m1.10.10.3.3.7" xref="S2.E2.m1.10.10.3.4.cmml">;</mo><msubsup id="S2.E2.m1.10.10.3.3.3" xref="S2.E2.m1.10.10.3.3.3.cmml"><mi id="S2.E2.m1.10.10.3.3.3.2.2" xref="S2.E2.m1.10.10.3.3.3.2.2.cmml">𝐤</mi><mrow id="S2.E2.m1.6.6.2.2" xref="S2.E2.m1.6.6.2.3.cmml"><mi id="S2.E2.m1.5.5.1.1" xref="S2.E2.m1.5.5.1.1.cmml">t</mi><mo id="S2.E2.m1.6.6.2.2.2" xref="S2.E2.m1.6.6.2.3.cmml">,</mo><msub id="S2.E2.m1.6.6.2.2.1" xref="S2.E2.m1.6.6.2.2.1.cmml"><mi id="S2.E2.m1.6.6.2.2.1.2" xref="S2.E2.m1.6.6.2.2.1.2.cmml">n</mi><mi id="S2.E2.m1.6.6.2.2.1.3" xref="S2.E2.m1.6.6.2.2.1.3.cmml">h</mi></msub></mrow><mi id="S2.E2.m1.10.10.3.3.3.3" xref="S2.E2.m1.10.10.3.3.3.3.cmml">C</mi></msubsup><mo id="S2.E2.m1.10.10.3.3.8" stretchy="false" xref="S2.E2.m1.10.10.3.4.cmml">]</mo></mrow><mo id="S2.E2.m1.10.10.4" xref="S2.E2.m1.10.10.4.cmml">=</mo><msubsup id="S2.E2.m1.10.10.5" xref="S2.E2.m1.10.10.5.cmml"><mi id="S2.E2.m1.10.10.5.2.2" xref="S2.E2.m1.10.10.5.2.2.cmml">𝐤</mi><mi id="S2.E2.m1.10.10.5.2.3" xref="S2.E2.m1.10.10.5.2.3.cmml">t</mi><mi id="S2.E2.m1.10.10.5.3" xref="S2.E2.m1.10.10.5.3.cmml">C</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S2.E2.m1.10b"><apply id="S2.E2.m1.10.10.cmml" xref="S2.E2.m1.10.10"><eq id="S2.E2.m1.10.10.4.cmml" xref="S2.E2.m1.10.10.4"></eq><list id="S2.E2.m1.10.10.3.4.cmml" xref="S2.E2.m1.10.10.3.3"><apply id="S2.E2.m1.8.8.1.1.1.cmml" xref="S2.E2.m1.8.8.1.1.1"><csymbol cd="ambiguous" id="S2.E2.m1.8.8.1.1.1.1.cmml" xref="S2.E2.m1.8.8.1.1.1">superscript</csymbol><apply id="S2.E2.m1.8.8.1.1.1.2.cmml" xref="S2.E2.m1.8.8.1.1.1"><csymbol cd="ambiguous" id="S2.E2.m1.8.8.1.1.1.2.1.cmml" xref="S2.E2.m1.8.8.1.1.1">subscript</csymbol><ci id="S2.E2.m1.8.8.1.1.1.2.2.cmml" xref="S2.E2.m1.8.8.1.1.1.2.2">𝐤</ci><list id="S2.E2.m1.2.2.2.3.cmml" xref="S2.E2.m1.2.2.2.4"><ci id="S2.E2.m1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1">𝑡</ci><cn id="S2.E2.m1.2.2.2.2.cmml" type="integer" xref="S2.E2.m1.2.2.2.2">1</cn></list></apply><ci id="S2.E2.m1.8.8.1.1.1.3.cmml" xref="S2.E2.m1.8.8.1.1.1.3">𝐶</ci></apply><apply id="S2.E2.m1.9.9.2.2.2.cmml" xref="S2.E2.m1.9.9.2.2.2"><csymbol cd="ambiguous" id="S2.E2.m1.9.9.2.2.2.1.cmml" xref="S2.E2.m1.9.9.2.2.2">superscript</csymbol><apply id="S2.E2.m1.9.9.2.2.2.2.cmml" xref="S2.E2.m1.9.9.2.2.2"><csymbol cd="ambiguous" id="S2.E2.m1.9.9.2.2.2.2.1.cmml" xref="S2.E2.m1.9.9.2.2.2">subscript</csymbol><ci id="S2.E2.m1.9.9.2.2.2.2.2.cmml" xref="S2.E2.m1.9.9.2.2.2.2.2">𝐤</ci><list id="S2.E2.m1.4.4.2.3.cmml" xref="S2.E2.m1.4.4.2.4"><ci id="S2.E2.m1.3.3.1.1.cmml" xref="S2.E2.m1.3.3.1.1">𝑡</ci><cn id="S2.E2.m1.4.4.2.2.cmml" type="integer" xref="S2.E2.m1.4.4.2.2">2</cn></list></apply><ci id="S2.E2.m1.9.9.2.2.2.3.cmml" xref="S2.E2.m1.9.9.2.2.2.3">𝐶</ci></apply><ci id="S2.E2.m1.7.7.cmml" xref="S2.E2.m1.7.7">…</ci><apply id="S2.E2.m1.10.10.3.3.3.cmml" xref="S2.E2.m1.10.10.3.3.3"><csymbol cd="ambiguous" id="S2.E2.m1.10.10.3.3.3.1.cmml" xref="S2.E2.m1.10.10.3.3.3">superscript</csymbol><apply id="S2.E2.m1.10.10.3.3.3.2.cmml" xref="S2.E2.m1.10.10.3.3.3"><csymbol cd="ambiguous" id="S2.E2.m1.10.10.3.3.3.2.1.cmml" xref="S2.E2.m1.10.10.3.3.3">subscript</csymbol><ci id="S2.E2.m1.10.10.3.3.3.2.2.cmml" xref="S2.E2.m1.10.10.3.3.3.2.2">𝐤</ci><list id="S2.E2.m1.6.6.2.3.cmml" xref="S2.E2.m1.6.6.2.2"><ci id="S2.E2.m1.5.5.1.1.cmml" xref="S2.E2.m1.5.5.1.1">𝑡</ci><apply id="S2.E2.m1.6.6.2.2.1.cmml" xref="S2.E2.m1.6.6.2.2.1"><csymbol cd="ambiguous" id="S2.E2.m1.6.6.2.2.1.1.cmml" xref="S2.E2.m1.6.6.2.2.1">subscript</csymbol><ci id="S2.E2.m1.6.6.2.2.1.2.cmml" xref="S2.E2.m1.6.6.2.2.1.2">𝑛</ci><ci id="S2.E2.m1.6.6.2.2.1.3.cmml" xref="S2.E2.m1.6.6.2.2.1.3">ℎ</ci></apply></list></apply><ci id="S2.E2.m1.10.10.3.3.3.3.cmml" xref="S2.E2.m1.10.10.3.3.3.3">𝐶</ci></apply></list><apply id="S2.E2.m1.10.10.5.cmml" xref="S2.E2.m1.10.10.5"><csymbol cd="ambiguous" id="S2.E2.m1.10.10.5.1.cmml" xref="S2.E2.m1.10.10.5">superscript</csymbol><apply id="S2.E2.m1.10.10.5.2.cmml" xref="S2.E2.m1.10.10.5"><csymbol cd="ambiguous" id="S2.E2.m1.10.10.5.2.1.cmml" xref="S2.E2.m1.10.10.5">subscript</csymbol><ci id="S2.E2.m1.10.10.5.2.2.cmml" xref="S2.E2.m1.10.10.5.2.2">𝐤</ci><ci id="S2.E2.m1.10.10.5.2.3.cmml" xref="S2.E2.m1.10.10.5.2.3">𝑡</ci></apply><ci id="S2.E2.m1.10.10.5.3.cmml" xref="S2.E2.m1.10.10.5.3">𝐶</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E2.m1.10c">\displaystyle[\mathbf{k}_{t,1}^{C};\mathbf{k}_{t,2}^{C};...;\mathbf{k}_{t,n_{h%
}}^{C}]=\mathbf{k}_{t}^{C}</annotation><annotation encoding="application/x-llamapun" id="S2.E2.m1.10d">[ bold_k start_POSTSUBSCRIPT italic_t , 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ; bold_k start_POSTSUBSCRIPT italic_t , 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ; … ; bold_k start_POSTSUBSCRIPT italic_t , italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ] = bold_k start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=W^{UK}\mathbf{c}_{t}^{KV}," class="ltx_Math" display="inline" id="S2.E2.m2.1"><semantics id="S2.E2.m2.1a"><mrow id="S2.E2.m2.1.1.1" xref="S2.E2.m2.1.1.1.1.cmml"><mrow id="S2.E2.m2.1.1.1.1" xref="S2.E2.m2.1.1.1.1.cmml"><mi id="S2.E2.m2.1.1.1.1.2" xref="S2.E2.m2.1.1.1.1.2.cmml"></mi><mo id="S2.E2.m2.1.1.1.1.1" xref="S2.E2.m2.1.1.1.1.1.cmml">=</mo><mrow id="S2.E2.m2.1.1.1.1.3" xref="S2.E2.m2.1.1.1.1.3.cmml"><msup id="S2.E2.m2.1.1.1.1.3.2" xref="S2.E2.m2.1.1.1.1.3.2.cmml"><mi id="S2.E2.m2.1.1.1.1.3.2.2" xref="S2.E2.m2.1.1.1.1.3.2.2.cmml">W</mi><mrow id="S2.E2.m2.1.1.1.1.3.2.3" xref="S2.E2.m2.1.1.1.1.3.2.3.cmml"><mi id="S2.E2.m2.1.1.1.1.3.2.3.2" xref="S2.E2.m2.1.1.1.1.3.2.3.2.cmml">U</mi><mo id="S2.E2.m2.1.1.1.1.3.2.3.1" xref="S2.E2.m2.1.1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S2.E2.m2.1.1.1.1.3.2.3.3" xref="S2.E2.m2.1.1.1.1.3.2.3.3.cmml">K</mi></mrow></msup><mo id="S2.E2.m2.1.1.1.1.3.1" xref="S2.E2.m2.1.1.1.1.3.1.cmml">⁢</mo><msubsup id="S2.E2.m2.1.1.1.1.3.3" xref="S2.E2.m2.1.1.1.1.3.3.cmml"><mi id="S2.E2.m2.1.1.1.1.3.3.2.2" xref="S2.E2.m2.1.1.1.1.3.3.2.2.cmml">𝐜</mi><mi id="S2.E2.m2.1.1.1.1.3.3.2.3" xref="S2.E2.m2.1.1.1.1.3.3.2.3.cmml">t</mi><mrow id="S2.E2.m2.1.1.1.1.3.3.3" xref="S2.E2.m2.1.1.1.1.3.3.3.cmml"><mi id="S2.E2.m2.1.1.1.1.3.3.3.2" xref="S2.E2.m2.1.1.1.1.3.3.3.2.cmml">K</mi><mo id="S2.E2.m2.1.1.1.1.3.3.3.1" xref="S2.E2.m2.1.1.1.1.3.3.3.1.cmml">⁢</mo><mi id="S2.E2.m2.1.1.1.1.3.3.3.3" xref="S2.E2.m2.1.1.1.1.3.3.3.3.cmml">V</mi></mrow></msubsup></mrow></mrow><mo id="S2.E2.m2.1.1.1.2" xref="S2.E2.m2.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E2.m2.1b"><apply id="S2.E2.m2.1.1.1.1.cmml" xref="S2.E2.m2.1.1.1"><eq id="S2.E2.m2.1.1.1.1.1.cmml" xref="S2.E2.m2.1.1.1.1.1"></eq><csymbol cd="latexml" id="S2.E2.m2.1.1.1.1.2.cmml" xref="S2.E2.m2.1.1.1.1.2">absent</csymbol><apply id="S2.E2.m2.1.1.1.1.3.cmml" xref="S2.E2.m2.1.1.1.1.3"><times id="S2.E2.m2.1.1.1.1.3.1.cmml" xref="S2.E2.m2.1.1.1.1.3.1"></times><apply id="S2.E2.m2.1.1.1.1.3.2.cmml" xref="S2.E2.m2.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S2.E2.m2.1.1.1.1.3.2.1.cmml" xref="S2.E2.m2.1.1.1.1.3.2">superscript</csymbol><ci id="S2.E2.m2.1.1.1.1.3.2.2.cmml" xref="S2.E2.m2.1.1.1.1.3.2.2">𝑊</ci><apply id="S2.E2.m2.1.1.1.1.3.2.3.cmml" xref="S2.E2.m2.1.1.1.1.3.2.3"><times id="S2.E2.m2.1.1.1.1.3.2.3.1.cmml" xref="S2.E2.m2.1.1.1.1.3.2.3.1"></times><ci id="S2.E2.m2.1.1.1.1.3.2.3.2.cmml" xref="S2.E2.m2.1.1.1.1.3.2.3.2">𝑈</ci><ci id="S2.E2.m2.1.1.1.1.3.2.3.3.cmml" xref="S2.E2.m2.1.1.1.1.3.2.3.3">𝐾</ci></apply></apply><apply id="S2.E2.m2.1.1.1.1.3.3.cmml" xref="S2.E2.m2.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S2.E2.m2.1.1.1.1.3.3.1.cmml" xref="S2.E2.m2.1.1.1.1.3.3">superscript</csymbol><apply id="S2.E2.m2.1.1.1.1.3.3.2.cmml" xref="S2.E2.m2.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S2.E2.m2.1.1.1.1.3.3.2.1.cmml" xref="S2.E2.m2.1.1.1.1.3.3">subscript</csymbol><ci id="S2.E2.m2.1.1.1.1.3.3.2.2.cmml" xref="S2.E2.m2.1.1.1.1.3.3.2.2">𝐜</ci><ci id="S2.E2.m2.1.1.1.1.3.3.2.3.cmml" xref="S2.E2.m2.1.1.1.1.3.3.2.3">𝑡</ci></apply><apply id="S2.E2.m2.1.1.1.1.3.3.3.cmml" xref="S2.E2.m2.1.1.1.1.3.3.3"><times id="S2.E2.m2.1.1.1.1.3.3.3.1.cmml" xref="S2.E2.m2.1.1.1.1.3.3.3.1"></times><ci id="S2.E2.m2.1.1.1.1.3.3.3.2.cmml" xref="S2.E2.m2.1.1.1.1.3.3.3.2">𝐾</ci><ci id="S2.E2.m2.1.1.1.1.3.3.3.3.cmml" xref="S2.E2.m2.1.1.1.1.3.3.3.3">𝑉</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E2.m2.1c">\displaystyle=W^{UK}\mathbf{c}_{t}^{KV},</annotation><annotation encoding="application/x-llamapun" id="S2.E2.m2.1d">= italic_W start_POSTSUPERSCRIPT italic_U italic_K end_POSTSUPERSCRIPT bold_c start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K italic_V end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
<tbody id="S2.E3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\boxed{\color[rgb]{0,0,1}\definecolor[named]{pgfstrokecolor}{rgb}%
{0,0,1}\mathbf{k}_{t}^{R}}" class="ltx_Math" display="inline" id="S2.E3.m1.1"><semantics id="S2.E3.m1.1a"><menclose id="S2.E3.m1.1.1" notation="box" xref="S2.E3.m1.1.1.cmml"><msubsup id="S2.E3.m1.1.1a" xref="S2.E3.m1.1.1.cmml"><mi id="S2.E3.m1.1.1.2.2" mathcolor="#0000FF" xref="S2.E3.m1.1.1.2.2.cmml">𝐤</mi><mi id="S2.E3.m1.1.1.2.3" mathcolor="#0000FF" xref="S2.E3.m1.1.1.2.3.cmml">t</mi><mi id="S2.E3.m1.1.1.3" mathcolor="#0000FF" xref="S2.E3.m1.1.1.3.cmml">R</mi></msubsup></menclose><annotation-xml encoding="MathML-Content" id="S2.E3.m1.1b"><apply id="S2.E3.m1.1.1.cmml" xref="S2.E3.m1.1.1"><csymbol cd="ambiguous" id="S2.E3.m1.1.1.1.cmml" xref="S2.E3.m1.1.1">superscript</csymbol><apply id="S2.E3.m1.1.1.2.cmml" xref="S2.E3.m1.1.1"><csymbol cd="ambiguous" id="S2.E3.m1.1.1.2.1.cmml" xref="S2.E3.m1.1.1">subscript</csymbol><ci id="S2.E3.m1.1.1.2.2.cmml" xref="S2.E3.m1.1.1.2.2">𝐤</ci><ci id="S2.E3.m1.1.1.2.3.cmml" xref="S2.E3.m1.1.1.2.3">𝑡</ci></apply><ci id="S2.E3.m1.1.1.3.cmml" xref="S2.E3.m1.1.1.3">𝑅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E3.m1.1c">\displaystyle\boxed{\color[rgb]{0,0,1}\definecolor[named]{pgfstrokecolor}{rgb}%
{0,0,1}\mathbf{k}_{t}^{R}}</annotation><annotation encoding="application/x-llamapun" id="S2.E3.m1.1d">bold_k start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\operatorname{RoPE}({W^{KR}}\mathbf{h}_{t})," class="ltx_Math" display="inline" id="S2.E3.m2.2"><semantics id="S2.E3.m2.2a"><mrow id="S2.E3.m2.2.2.1" xref="S2.E3.m2.2.2.1.1.cmml"><mrow id="S2.E3.m2.2.2.1.1" xref="S2.E3.m2.2.2.1.1.cmml"><mi id="S2.E3.m2.2.2.1.1.3" xref="S2.E3.m2.2.2.1.1.3.cmml"></mi><mo id="S2.E3.m2.2.2.1.1.2" xref="S2.E3.m2.2.2.1.1.2.cmml">=</mo><mrow id="S2.E3.m2.2.2.1.1.1.1" xref="S2.E3.m2.2.2.1.1.1.2.cmml"><mi id="S2.E3.m2.1.1" xref="S2.E3.m2.1.1.cmml">RoPE</mi><mo id="S2.E3.m2.2.2.1.1.1.1a" xref="S2.E3.m2.2.2.1.1.1.2.cmml">⁡</mo><mrow id="S2.E3.m2.2.2.1.1.1.1.1" xref="S2.E3.m2.2.2.1.1.1.2.cmml"><mo id="S2.E3.m2.2.2.1.1.1.1.1.2" stretchy="false" xref="S2.E3.m2.2.2.1.1.1.2.cmml">(</mo><mrow id="S2.E3.m2.2.2.1.1.1.1.1.1" xref="S2.E3.m2.2.2.1.1.1.1.1.1.cmml"><msup id="S2.E3.m2.2.2.1.1.1.1.1.1.2" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2.cmml"><mi id="S2.E3.m2.2.2.1.1.1.1.1.1.2.2" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2.2.cmml">W</mi><mrow id="S2.E3.m2.2.2.1.1.1.1.1.1.2.3" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.cmml"><mi id="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.2" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.2.cmml">K</mi><mo id="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.1" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.3" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.3.cmml">R</mi></mrow></msup><mo id="S2.E3.m2.2.2.1.1.1.1.1.1.1" xref="S2.E3.m2.2.2.1.1.1.1.1.1.1.cmml">⁢</mo><msub id="S2.E3.m2.2.2.1.1.1.1.1.1.3" xref="S2.E3.m2.2.2.1.1.1.1.1.1.3.cmml"><mi id="S2.E3.m2.2.2.1.1.1.1.1.1.3.2" xref="S2.E3.m2.2.2.1.1.1.1.1.1.3.2.cmml">𝐡</mi><mi id="S2.E3.m2.2.2.1.1.1.1.1.1.3.3" xref="S2.E3.m2.2.2.1.1.1.1.1.1.3.3.cmml">t</mi></msub></mrow><mo id="S2.E3.m2.2.2.1.1.1.1.1.3" stretchy="false" xref="S2.E3.m2.2.2.1.1.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E3.m2.2.2.1.2" xref="S2.E3.m2.2.2.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E3.m2.2b"><apply id="S2.E3.m2.2.2.1.1.cmml" xref="S2.E3.m2.2.2.1"><eq id="S2.E3.m2.2.2.1.1.2.cmml" xref="S2.E3.m2.2.2.1.1.2"></eq><csymbol cd="latexml" id="S2.E3.m2.2.2.1.1.3.cmml" xref="S2.E3.m2.2.2.1.1.3">absent</csymbol><apply id="S2.E3.m2.2.2.1.1.1.2.cmml" xref="S2.E3.m2.2.2.1.1.1.1"><ci id="S2.E3.m2.1.1.cmml" xref="S2.E3.m2.1.1">RoPE</ci><apply id="S2.E3.m2.2.2.1.1.1.1.1.1.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1"><times id="S2.E3.m2.2.2.1.1.1.1.1.1.1.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.1"></times><apply id="S2.E3.m2.2.2.1.1.1.1.1.1.2.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E3.m2.2.2.1.1.1.1.1.1.2.1.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2">superscript</csymbol><ci id="S2.E3.m2.2.2.1.1.1.1.1.1.2.2.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2.2">𝑊</ci><apply id="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2.3"><times id="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.1.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.1"></times><ci id="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.2.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.2">𝐾</ci><ci id="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.3.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.2.3.3">𝑅</ci></apply></apply><apply id="S2.E3.m2.2.2.1.1.1.1.1.1.3.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E3.m2.2.2.1.1.1.1.1.1.3.1.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.3">subscript</csymbol><ci id="S2.E3.m2.2.2.1.1.1.1.1.1.3.2.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.3.2">𝐡</ci><ci id="S2.E3.m2.2.2.1.1.1.1.1.1.3.3.cmml" xref="S2.E3.m2.2.2.1.1.1.1.1.1.3.3">𝑡</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E3.m2.2c">\displaystyle=\operatorname{RoPE}({W^{KR}}\mathbf{h}_{t}),</annotation><annotation encoding="application/x-llamapun" id="S2.E3.m2.2d">= roman_RoPE ( italic_W start_POSTSUPERSCRIPT italic_K italic_R end_POSTSUPERSCRIPT bold_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
<tbody id="S2.E4"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathbf{k}_{t,i}" class="ltx_Math" display="inline" id="S2.E4.m1.2"><semantics id="S2.E4.m1.2a"><msub id="S2.E4.m1.2.3" xref="S2.E4.m1.2.3.cmml"><mi id="S2.E4.m1.2.3.2" xref="S2.E4.m1.2.3.2.cmml">𝐤</mi><mrow id="S2.E4.m1.2.2.2.4" xref="S2.E4.m1.2.2.2.3.cmml"><mi id="S2.E4.m1.1.1.1.1" xref="S2.E4.m1.1.1.1.1.cmml">t</mi><mo id="S2.E4.m1.2.2.2.4.1" xref="S2.E4.m1.2.2.2.3.cmml">,</mo><mi id="S2.E4.m1.2.2.2.2" xref="S2.E4.m1.2.2.2.2.cmml">i</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.E4.m1.2b"><apply id="S2.E4.m1.2.3.cmml" xref="S2.E4.m1.2.3"><csymbol cd="ambiguous" id="S2.E4.m1.2.3.1.cmml" xref="S2.E4.m1.2.3">subscript</csymbol><ci id="S2.E4.m1.2.3.2.cmml" xref="S2.E4.m1.2.3.2">𝐤</ci><list id="S2.E4.m1.2.2.2.3.cmml" xref="S2.E4.m1.2.2.2.4"><ci id="S2.E4.m1.1.1.1.1.cmml" xref="S2.E4.m1.1.1.1.1">𝑡</ci><ci id="S2.E4.m1.2.2.2.2.cmml" xref="S2.E4.m1.2.2.2.2">𝑖</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E4.m1.2c">\displaystyle\mathbf{k}_{t,i}</annotation><annotation encoding="application/x-llamapun" id="S2.E4.m1.2d">bold_k start_POSTSUBSCRIPT italic_t , italic_i end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=[\mathbf{k}_{t,i}^{C};\mathbf{k}_{t}^{R}]," class="ltx_Math" display="inline" id="S2.E4.m2.3"><semantics id="S2.E4.m2.3a"><mrow id="S2.E4.m2.3.3.1" xref="S2.E4.m2.3.3.1.1.cmml"><mrow id="S2.E4.m2.3.3.1.1" xref="S2.E4.m2.3.3.1.1.cmml"><mi id="S2.E4.m2.3.3.1.1.4" xref="S2.E4.m2.3.3.1.1.4.cmml"></mi><mo id="S2.E4.m2.3.3.1.1.3" xref="S2.E4.m2.3.3.1.1.3.cmml">=</mo><mrow id="S2.E4.m2.3.3.1.1.2.2" xref="S2.E4.m2.3.3.1.1.2.3.cmml"><mo id="S2.E4.m2.3.3.1.1.2.2.3" stretchy="false" xref="S2.E4.m2.3.3.1.1.2.3.cmml">[</mo><msubsup id="S2.E4.m2.3.3.1.1.1.1.1" xref="S2.E4.m2.3.3.1.1.1.1.1.cmml"><mi id="S2.E4.m2.3.3.1.1.1.1.1.2.2" xref="S2.E4.m2.3.3.1.1.1.1.1.2.2.cmml">𝐤</mi><mrow id="S2.E4.m2.2.2.2.4" xref="S2.E4.m2.2.2.2.3.cmml"><mi id="S2.E4.m2.1.1.1.1" xref="S2.E4.m2.1.1.1.1.cmml">t</mi><mo id="S2.E4.m2.2.2.2.4.1" xref="S2.E4.m2.2.2.2.3.cmml">,</mo><mi id="S2.E4.m2.2.2.2.2" xref="S2.E4.m2.2.2.2.2.cmml">i</mi></mrow><mi id="S2.E4.m2.3.3.1.1.1.1.1.3" xref="S2.E4.m2.3.3.1.1.1.1.1.3.cmml">C</mi></msubsup><mo id="S2.E4.m2.3.3.1.1.2.2.4" xref="S2.E4.m2.3.3.1.1.2.3.cmml">;</mo><msubsup id="S2.E4.m2.3.3.1.1.2.2.2" xref="S2.E4.m2.3.3.1.1.2.2.2.cmml"><mi id="S2.E4.m2.3.3.1.1.2.2.2.2.2" xref="S2.E4.m2.3.3.1.1.2.2.2.2.2.cmml">𝐤</mi><mi id="S2.E4.m2.3.3.1.1.2.2.2.2.3" xref="S2.E4.m2.3.3.1.1.2.2.2.2.3.cmml">t</mi><mi id="S2.E4.m2.3.3.1.1.2.2.2.3" xref="S2.E4.m2.3.3.1.1.2.2.2.3.cmml">R</mi></msubsup><mo id="S2.E4.m2.3.3.1.1.2.2.5" stretchy="false" xref="S2.E4.m2.3.3.1.1.2.3.cmml">]</mo></mrow></mrow><mo id="S2.E4.m2.3.3.1.2" xref="S2.E4.m2.3.3.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E4.m2.3b"><apply id="S2.E4.m2.3.3.1.1.cmml" xref="S2.E4.m2.3.3.1"><eq id="S2.E4.m2.3.3.1.1.3.cmml" xref="S2.E4.m2.3.3.1.1.3"></eq><csymbol cd="latexml" id="S2.E4.m2.3.3.1.1.4.cmml" xref="S2.E4.m2.3.3.1.1.4">absent</csymbol><list id="S2.E4.m2.3.3.1.1.2.3.cmml" xref="S2.E4.m2.3.3.1.1.2.2"><apply id="S2.E4.m2.3.3.1.1.1.1.1.cmml" xref="S2.E4.m2.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E4.m2.3.3.1.1.1.1.1.1.cmml" xref="S2.E4.m2.3.3.1.1.1.1.1">superscript</csymbol><apply id="S2.E4.m2.3.3.1.1.1.1.1.2.cmml" xref="S2.E4.m2.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E4.m2.3.3.1.1.1.1.1.2.1.cmml" xref="S2.E4.m2.3.3.1.1.1.1.1">subscript</csymbol><ci id="S2.E4.m2.3.3.1.1.1.1.1.2.2.cmml" xref="S2.E4.m2.3.3.1.1.1.1.1.2.2">𝐤</ci><list id="S2.E4.m2.2.2.2.3.cmml" xref="S2.E4.m2.2.2.2.4"><ci id="S2.E4.m2.1.1.1.1.cmml" xref="S2.E4.m2.1.1.1.1">𝑡</ci><ci id="S2.E4.m2.2.2.2.2.cmml" xref="S2.E4.m2.2.2.2.2">𝑖</ci></list></apply><ci id="S2.E4.m2.3.3.1.1.1.1.1.3.cmml" xref="S2.E4.m2.3.3.1.1.1.1.1.3">𝐶</ci></apply><apply id="S2.E4.m2.3.3.1.1.2.2.2.cmml" xref="S2.E4.m2.3.3.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E4.m2.3.3.1.1.2.2.2.1.cmml" xref="S2.E4.m2.3.3.1.1.2.2.2">superscript</csymbol><apply id="S2.E4.m2.3.3.1.1.2.2.2.2.cmml" xref="S2.E4.m2.3.3.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E4.m2.3.3.1.1.2.2.2.2.1.cmml" xref="S2.E4.m2.3.3.1.1.2.2.2">subscript</csymbol><ci id="S2.E4.m2.3.3.1.1.2.2.2.2.2.cmml" xref="S2.E4.m2.3.3.1.1.2.2.2.2.2">𝐤</ci><ci id="S2.E4.m2.3.3.1.1.2.2.2.2.3.cmml" xref="S2.E4.m2.3.3.1.1.2.2.2.2.3">𝑡</ci></apply><ci id="S2.E4.m2.3.3.1.1.2.2.2.3.cmml" xref="S2.E4.m2.3.3.1.1.2.2.2.3">𝑅</ci></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E4.m2.3c">\displaystyle=[\mathbf{k}_{t,i}^{C};\mathbf{k}_{t}^{R}],</annotation><annotation encoding="application/x-llamapun" id="S2.E4.m2.3d">= [ bold_k start_POSTSUBSCRIPT italic_t , italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ; bold_k start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT ] ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
<tbody id="S2.E5"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle[\mathbf{v}_{t,1}^{C};\mathbf{v}_{t,2}^{C};...;\mathbf{v}_{t,n_{h%
}}^{C}]=\mathbf{v}_{t}^{C}" class="ltx_Math" display="inline" id="S2.E5.m1.10"><semantics id="S2.E5.m1.10a"><mrow id="S2.E5.m1.10.10" xref="S2.E5.m1.10.10.cmml"><mrow id="S2.E5.m1.10.10.3.3" xref="S2.E5.m1.10.10.3.4.cmml"><mo id="S2.E5.m1.10.10.3.3.4" stretchy="false" xref="S2.E5.m1.10.10.3.4.cmml">[</mo><msubsup id="S2.E5.m1.8.8.1.1.1" xref="S2.E5.m1.8.8.1.1.1.cmml"><mi id="S2.E5.m1.8.8.1.1.1.2.2" xref="S2.E5.m1.8.8.1.1.1.2.2.cmml">𝐯</mi><mrow id="S2.E5.m1.2.2.2.4" xref="S2.E5.m1.2.2.2.3.cmml"><mi id="S2.E5.m1.1.1.1.1" xref="S2.E5.m1.1.1.1.1.cmml">t</mi><mo id="S2.E5.m1.2.2.2.4.1" xref="S2.E5.m1.2.2.2.3.cmml">,</mo><mn id="S2.E5.m1.2.2.2.2" xref="S2.E5.m1.2.2.2.2.cmml">1</mn></mrow><mi id="S2.E5.m1.8.8.1.1.1.3" xref="S2.E5.m1.8.8.1.1.1.3.cmml">C</mi></msubsup><mo id="S2.E5.m1.10.10.3.3.5" xref="S2.E5.m1.10.10.3.4.cmml">;</mo><msubsup id="S2.E5.m1.9.9.2.2.2" xref="S2.E5.m1.9.9.2.2.2.cmml"><mi id="S2.E5.m1.9.9.2.2.2.2.2" xref="S2.E5.m1.9.9.2.2.2.2.2.cmml">𝐯</mi><mrow id="S2.E5.m1.4.4.2.4" xref="S2.E5.m1.4.4.2.3.cmml"><mi id="S2.E5.m1.3.3.1.1" xref="S2.E5.m1.3.3.1.1.cmml">t</mi><mo id="S2.E5.m1.4.4.2.4.1" xref="S2.E5.m1.4.4.2.3.cmml">,</mo><mn id="S2.E5.m1.4.4.2.2" xref="S2.E5.m1.4.4.2.2.cmml">2</mn></mrow><mi id="S2.E5.m1.9.9.2.2.2.3" xref="S2.E5.m1.9.9.2.2.2.3.cmml">C</mi></msubsup><mo id="S2.E5.m1.10.10.3.3.6" xref="S2.E5.m1.10.10.3.4.cmml">;</mo><mi id="S2.E5.m1.7.7" mathvariant="normal" xref="S2.E5.m1.7.7.cmml">…</mi><mo id="S2.E5.m1.10.10.3.3.7" xref="S2.E5.m1.10.10.3.4.cmml">;</mo><msubsup id="S2.E5.m1.10.10.3.3.3" xref="S2.E5.m1.10.10.3.3.3.cmml"><mi id="S2.E5.m1.10.10.3.3.3.2.2" xref="S2.E5.m1.10.10.3.3.3.2.2.cmml">𝐯</mi><mrow id="S2.E5.m1.6.6.2.2" xref="S2.E5.m1.6.6.2.3.cmml"><mi id="S2.E5.m1.5.5.1.1" xref="S2.E5.m1.5.5.1.1.cmml">t</mi><mo id="S2.E5.m1.6.6.2.2.2" xref="S2.E5.m1.6.6.2.3.cmml">,</mo><msub id="S2.E5.m1.6.6.2.2.1" xref="S2.E5.m1.6.6.2.2.1.cmml"><mi id="S2.E5.m1.6.6.2.2.1.2" xref="S2.E5.m1.6.6.2.2.1.2.cmml">n</mi><mi id="S2.E5.m1.6.6.2.2.1.3" xref="S2.E5.m1.6.6.2.2.1.3.cmml">h</mi></msub></mrow><mi id="S2.E5.m1.10.10.3.3.3.3" xref="S2.E5.m1.10.10.3.3.3.3.cmml">C</mi></msubsup><mo id="S2.E5.m1.10.10.3.3.8" stretchy="false" xref="S2.E5.m1.10.10.3.4.cmml">]</mo></mrow><mo id="S2.E5.m1.10.10.4" xref="S2.E5.m1.10.10.4.cmml">=</mo><msubsup id="S2.E5.m1.10.10.5" xref="S2.E5.m1.10.10.5.cmml"><mi id="S2.E5.m1.10.10.5.2.2" xref="S2.E5.m1.10.10.5.2.2.cmml">𝐯</mi><mi id="S2.E5.m1.10.10.5.2.3" xref="S2.E5.m1.10.10.5.2.3.cmml">t</mi><mi id="S2.E5.m1.10.10.5.3" xref="S2.E5.m1.10.10.5.3.cmml">C</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S2.E5.m1.10b"><apply id="S2.E5.m1.10.10.cmml" xref="S2.E5.m1.10.10"><eq id="S2.E5.m1.10.10.4.cmml" xref="S2.E5.m1.10.10.4"></eq><list id="S2.E5.m1.10.10.3.4.cmml" xref="S2.E5.m1.10.10.3.3"><apply id="S2.E5.m1.8.8.1.1.1.cmml" xref="S2.E5.m1.8.8.1.1.1"><csymbol cd="ambiguous" id="S2.E5.m1.8.8.1.1.1.1.cmml" xref="S2.E5.m1.8.8.1.1.1">superscript</csymbol><apply id="S2.E5.m1.8.8.1.1.1.2.cmml" xref="S2.E5.m1.8.8.1.1.1"><csymbol cd="ambiguous" id="S2.E5.m1.8.8.1.1.1.2.1.cmml" xref="S2.E5.m1.8.8.1.1.1">subscript</csymbol><ci id="S2.E5.m1.8.8.1.1.1.2.2.cmml" xref="S2.E5.m1.8.8.1.1.1.2.2">𝐯</ci><list id="S2.E5.m1.2.2.2.3.cmml" xref="S2.E5.m1.2.2.2.4"><ci id="S2.E5.m1.1.1.1.1.cmml" xref="S2.E5.m1.1.1.1.1">𝑡</ci><cn id="S2.E5.m1.2.2.2.2.cmml" type="integer" xref="S2.E5.m1.2.2.2.2">1</cn></list></apply><ci id="S2.E5.m1.8.8.1.1.1.3.cmml" xref="S2.E5.m1.8.8.1.1.1.3">𝐶</ci></apply><apply id="S2.E5.m1.9.9.2.2.2.cmml" xref="S2.E5.m1.9.9.2.2.2"><csymbol cd="ambiguous" id="S2.E5.m1.9.9.2.2.2.1.cmml" xref="S2.E5.m1.9.9.2.2.2">superscript</csymbol><apply id="S2.E5.m1.9.9.2.2.2.2.cmml" xref="S2.E5.m1.9.9.2.2.2"><csymbol cd="ambiguous" id="S2.E5.m1.9.9.2.2.2.2.1.cmml" xref="S2.E5.m1.9.9.2.2.2">subscript</csymbol><ci id="S2.E5.m1.9.9.2.2.2.2.2.cmml" xref="S2.E5.m1.9.9.2.2.2.2.2">𝐯</ci><list id="S2.E5.m1.4.4.2.3.cmml" xref="S2.E5.m1.4.4.2.4"><ci id="S2.E5.m1.3.3.1.1.cmml" xref="S2.E5.m1.3.3.1.1">𝑡</ci><cn id="S2.E5.m1.4.4.2.2.cmml" type="integer" xref="S2.E5.m1.4.4.2.2">2</cn></list></apply><ci id="S2.E5.m1.9.9.2.2.2.3.cmml" xref="S2.E5.m1.9.9.2.2.2.3">𝐶</ci></apply><ci id="S2.E5.m1.7.7.cmml" xref="S2.E5.m1.7.7">…</ci><apply id="S2.E5.m1.10.10.3.3.3.cmml" xref="S2.E5.m1.10.10.3.3.3"><csymbol cd="ambiguous" id="S2.E5.m1.10.10.3.3.3.1.cmml" xref="S2.E5.m1.10.10.3.3.3">superscript</csymbol><apply id="S2.E5.m1.10.10.3.3.3.2.cmml" xref="S2.E5.m1.10.10.3.3.3"><csymbol cd="ambiguous" id="S2.E5.m1.10.10.3.3.3.2.1.cmml" xref="S2.E5.m1.10.10.3.3.3">subscript</csymbol><ci id="S2.E5.m1.10.10.3.3.3.2.2.cmml" xref="S2.E5.m1.10.10.3.3.3.2.2">𝐯</ci><list id="S2.E5.m1.6.6.2.3.cmml" xref="S2.E5.m1.6.6.2.2"><ci id="S2.E5.m1.5.5.1.1.cmml" xref="S2.E5.m1.5.5.1.1">𝑡</ci><apply id="S2.E5.m1.6.6.2.2.1.cmml" xref="S2.E5.m1.6.6.2.2.1"><csymbol cd="ambiguous" id="S2.E5.m1.6.6.2.2.1.1.cmml" xref="S2.E5.m1.6.6.2.2.1">subscript</csymbol><ci id="S2.E5.m1.6.6.2.2.1.2.cmml" xref="S2.E5.m1.6.6.2.2.1.2">𝑛</ci><ci id="S2.E5.m1.6.6.2.2.1.3.cmml" xref="S2.E5.m1.6.6.2.2.1.3">ℎ</ci></apply></list></apply><ci id="S2.E5.m1.10.10.3.3.3.3.cmml" xref="S2.E5.m1.10.10.3.3.3.3">𝐶</ci></apply></list><apply id="S2.E5.m1.10.10.5.cmml" xref="S2.E5.m1.10.10.5"><csymbol cd="ambiguous" id="S2.E5.m1.10.10.5.1.cmml" xref="S2.E5.m1.10.10.5">superscript</csymbol><apply id="S2.E5.m1.10.10.5.2.cmml" xref="S2.E5.m1.10.10.5"><csymbol cd="ambiguous" id="S2.E5.m1.10.10.5.2.1.cmml" xref="S2.E5.m1.10.10.5">subscript</csymbol><ci id="S2.E5.m1.10.10.5.2.2.cmml" xref="S2.E5.m1.10.10.5.2.2">𝐯</ci><ci id="S2.E5.m1.10.10.5.2.3.cmml" xref="S2.E5.m1.10.10.5.2.3">𝑡</ci></apply><ci id="S2.E5.m1.10.10.5.3.cmml" xref="S2.E5.m1.10.10.5.3">𝐶</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E5.m1.10c">\displaystyle[\mathbf{v}_{t,1}^{C};\mathbf{v}_{t,2}^{C};...;\mathbf{v}_{t,n_{h%
}}^{C}]=\mathbf{v}_{t}^{C}</annotation><annotation encoding="application/x-llamapun" id="S2.E5.m1.10d">[ bold_v start_POSTSUBSCRIPT italic_t , 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ; bold_v start_POSTSUBSCRIPT italic_t , 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ; … ; bold_v start_POSTSUBSCRIPT italic_t , italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ] = bold_v start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=W^{UV}\mathbf{c}_{t}^{KV}," class="ltx_Math" display="inline" id="S2.E5.m2.1"><semantics id="S2.E5.m2.1a"><mrow id="S2.E5.m2.1.1.1" xref="S2.E5.m2.1.1.1.1.cmml"><mrow id="S2.E5.m2.1.1.1.1" xref="S2.E5.m2.1.1.1.1.cmml"><mi id="S2.E5.m2.1.1.1.1.2" xref="S2.E5.m2.1.1.1.1.2.cmml"></mi><mo id="S2.E5.m2.1.1.1.1.1" xref="S2.E5.m2.1.1.1.1.1.cmml">=</mo><mrow id="S2.E5.m2.1.1.1.1.3" xref="S2.E5.m2.1.1.1.1.3.cmml"><msup id="S2.E5.m2.1.1.1.1.3.2" xref="S2.E5.m2.1.1.1.1.3.2.cmml"><mi id="S2.E5.m2.1.1.1.1.3.2.2" xref="S2.E5.m2.1.1.1.1.3.2.2.cmml">W</mi><mrow id="S2.E5.m2.1.1.1.1.3.2.3" xref="S2.E5.m2.1.1.1.1.3.2.3.cmml"><mi id="S2.E5.m2.1.1.1.1.3.2.3.2" xref="S2.E5.m2.1.1.1.1.3.2.3.2.cmml">U</mi><mo id="S2.E5.m2.1.1.1.1.3.2.3.1" xref="S2.E5.m2.1.1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S2.E5.m2.1.1.1.1.3.2.3.3" xref="S2.E5.m2.1.1.1.1.3.2.3.3.cmml">V</mi></mrow></msup><mo id="S2.E5.m2.1.1.1.1.3.1" xref="S2.E5.m2.1.1.1.1.3.1.cmml">⁢</mo><msubsup id="S2.E5.m2.1.1.1.1.3.3" xref="S2.E5.m2.1.1.1.1.3.3.cmml"><mi id="S2.E5.m2.1.1.1.1.3.3.2.2" xref="S2.E5.m2.1.1.1.1.3.3.2.2.cmml">𝐜</mi><mi id="S2.E5.m2.1.1.1.1.3.3.2.3" xref="S2.E5.m2.1.1.1.1.3.3.2.3.cmml">t</mi><mrow id="S2.E5.m2.1.1.1.1.3.3.3" xref="S2.E5.m2.1.1.1.1.3.3.3.cmml"><mi id="S2.E5.m2.1.1.1.1.3.3.3.2" xref="S2.E5.m2.1.1.1.1.3.3.3.2.cmml">K</mi><mo id="S2.E5.m2.1.1.1.1.3.3.3.1" xref="S2.E5.m2.1.1.1.1.3.3.3.1.cmml">⁢</mo><mi id="S2.E5.m2.1.1.1.1.3.3.3.3" xref="S2.E5.m2.1.1.1.1.3.3.3.3.cmml">V</mi></mrow></msubsup></mrow></mrow><mo id="S2.E5.m2.1.1.1.2" xref="S2.E5.m2.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E5.m2.1b"><apply id="S2.E5.m2.1.1.1.1.cmml" xref="S2.E5.m2.1.1.1"><eq id="S2.E5.m2.1.1.1.1.1.cmml" xref="S2.E5.m2.1.1.1.1.1"></eq><csymbol cd="latexml" id="S2.E5.m2.1.1.1.1.2.cmml" xref="S2.E5.m2.1.1.1.1.2">absent</csymbol><apply id="S2.E5.m2.1.1.1.1.3.cmml" xref="S2.E5.m2.1.1.1.1.3"><times id="S2.E5.m2.1.1.1.1.3.1.cmml" xref="S2.E5.m2.1.1.1.1.3.1"></times><apply id="S2.E5.m2.1.1.1.1.3.2.cmml" xref="S2.E5.m2.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S2.E5.m2.1.1.1.1.3.2.1.cmml" xref="S2.E5.m2.1.1.1.1.3.2">superscript</csymbol><ci id="S2.E5.m2.1.1.1.1.3.2.2.cmml" xref="S2.E5.m2.1.1.1.1.3.2.2">𝑊</ci><apply id="S2.E5.m2.1.1.1.1.3.2.3.cmml" xref="S2.E5.m2.1.1.1.1.3.2.3"><times id="S2.E5.m2.1.1.1.1.3.2.3.1.cmml" xref="S2.E5.m2.1.1.1.1.3.2.3.1"></times><ci id="S2.E5.m2.1.1.1.1.3.2.3.2.cmml" xref="S2.E5.m2.1.1.1.1.3.2.3.2">𝑈</ci><ci id="S2.E5.m2.1.1.1.1.3.2.3.3.cmml" xref="S2.E5.m2.1.1.1.1.3.2.3.3">𝑉</ci></apply></apply><apply id="S2.E5.m2.1.1.1.1.3.3.cmml" xref="S2.E5.m2.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S2.E5.m2.1.1.1.1.3.3.1.cmml" xref="S2.E5.m2.1.1.1.1.3.3">superscript</csymbol><apply id="S2.E5.m2.1.1.1.1.3.3.2.cmml" xref="S2.E5.m2.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S2.E5.m2.1.1.1.1.3.3.2.1.cmml" xref="S2.E5.m2.1.1.1.1.3.3">subscript</csymbol><ci id="S2.E5.m2.1.1.1.1.3.3.2.2.cmml" xref="S2.E5.m2.1.1.1.1.3.3.2.2">𝐜</ci><ci id="S2.E5.m2.1.1.1.1.3.3.2.3.cmml" xref="S2.E5.m2.1.1.1.1.3.3.2.3">𝑡</ci></apply><apply id="S2.E5.m2.1.1.1.1.3.3.3.cmml" xref="S2.E5.m2.1.1.1.1.3.3.3"><times id="S2.E5.m2.1.1.1.1.3.3.3.1.cmml" xref="S2.E5.m2.1.1.1.1.3.3.3.1"></times><ci id="S2.E5.m2.1.1.1.1.3.3.3.2.cmml" xref="S2.E5.m2.1.1.1.1.3.3.3.2">𝐾</ci><ci id="S2.E5.m2.1.1.1.1.3.3.3.3.cmml" xref="S2.E5.m2.1.1.1.1.3.3.3.3">𝑉</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E5.m2.1c">\displaystyle=W^{UV}\mathbf{c}_{t}^{KV},</annotation><annotation encoding="application/x-llamapun" id="S2.E5.m2.1d">= italic_W start_POSTSUPERSCRIPT italic_U italic_V end_POSTSUPERSCRIPT bold_c start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K italic_V end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS1.SSS1.p1.14">where <math alttext="\mathbf{c}_{t}^{KV}\in\mathbb{R}^{d_{c}}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.6.m1.1"><semantics id="S2.SS1.SSS1.p1.6.m1.1a"><mrow id="S2.SS1.SSS1.p1.6.m1.1.1" xref="S2.SS1.SSS1.p1.6.m1.1.1.cmml"><msubsup id="S2.SS1.SSS1.p1.6.m1.1.1.2" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.cmml"><mi id="S2.SS1.SSS1.p1.6.m1.1.1.2.2.2" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.2.2.cmml">𝐜</mi><mi id="S2.SS1.SSS1.p1.6.m1.1.1.2.2.3" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.2.3.cmml">t</mi><mrow id="S2.SS1.SSS1.p1.6.m1.1.1.2.3" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.3.cmml"><mi id="S2.SS1.SSS1.p1.6.m1.1.1.2.3.2" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.3.2.cmml">K</mi><mo id="S2.SS1.SSS1.p1.6.m1.1.1.2.3.1" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.3.1.cmml">⁢</mo><mi id="S2.SS1.SSS1.p1.6.m1.1.1.2.3.3" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.3.3.cmml">V</mi></mrow></msubsup><mo id="S2.SS1.SSS1.p1.6.m1.1.1.1" xref="S2.SS1.SSS1.p1.6.m1.1.1.1.cmml">∈</mo><msup id="S2.SS1.SSS1.p1.6.m1.1.1.3" xref="S2.SS1.SSS1.p1.6.m1.1.1.3.cmml"><mi id="S2.SS1.SSS1.p1.6.m1.1.1.3.2" xref="S2.SS1.SSS1.p1.6.m1.1.1.3.2.cmml">ℝ</mi><msub id="S2.SS1.SSS1.p1.6.m1.1.1.3.3" xref="S2.SS1.SSS1.p1.6.m1.1.1.3.3.cmml"><mi id="S2.SS1.SSS1.p1.6.m1.1.1.3.3.2" xref="S2.SS1.SSS1.p1.6.m1.1.1.3.3.2.cmml">d</mi><mi id="S2.SS1.SSS1.p1.6.m1.1.1.3.3.3" xref="S2.SS1.SSS1.p1.6.m1.1.1.3.3.3.cmml">c</mi></msub></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.6.m1.1b"><apply id="S2.SS1.SSS1.p1.6.m1.1.1.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1"><in id="S2.SS1.SSS1.p1.6.m1.1.1.1.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.1"></in><apply id="S2.SS1.SSS1.p1.6.m1.1.1.2.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.6.m1.1.1.2.1.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.2">superscript</csymbol><apply id="S2.SS1.SSS1.p1.6.m1.1.1.2.2.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.6.m1.1.1.2.2.1.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.2">subscript</csymbol><ci id="S2.SS1.SSS1.p1.6.m1.1.1.2.2.2.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.2.2">𝐜</ci><ci id="S2.SS1.SSS1.p1.6.m1.1.1.2.2.3.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.2.3">𝑡</ci></apply><apply id="S2.SS1.SSS1.p1.6.m1.1.1.2.3.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.3"><times id="S2.SS1.SSS1.p1.6.m1.1.1.2.3.1.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.3.1"></times><ci id="S2.SS1.SSS1.p1.6.m1.1.1.2.3.2.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.3.2">𝐾</ci><ci id="S2.SS1.SSS1.p1.6.m1.1.1.2.3.3.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.2.3.3">𝑉</ci></apply></apply><apply id="S2.SS1.SSS1.p1.6.m1.1.1.3.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.6.m1.1.1.3.1.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.3">superscript</csymbol><ci id="S2.SS1.SSS1.p1.6.m1.1.1.3.2.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.3.2">ℝ</ci><apply id="S2.SS1.SSS1.p1.6.m1.1.1.3.3.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.3.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.6.m1.1.1.3.3.1.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.3.3">subscript</csymbol><ci id="S2.SS1.SSS1.p1.6.m1.1.1.3.3.2.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.3.3.2">𝑑</ci><ci id="S2.SS1.SSS1.p1.6.m1.1.1.3.3.3.cmml" xref="S2.SS1.SSS1.p1.6.m1.1.1.3.3.3">𝑐</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.6.m1.1c">\mathbf{c}_{t}^{KV}\in\mathbb{R}^{d_{c}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.6.m1.1d">bold_c start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K italic_V end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> is the compressed latent vector for keys and values;
<math alttext="d_{c}(\ll d_{h}n_{h})" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.7.m2.1"><semantics id="S2.SS1.SSS1.p1.7.m2.1a"><mrow id="S2.SS1.SSS1.p1.7.m2.1.1" xref="S2.SS1.SSS1.p1.7.m2.1.1.cmml"><msub id="S2.SS1.SSS1.p1.7.m2.1.1.3" xref="S2.SS1.SSS1.p1.7.m2.1.1.3.cmml"><mi id="S2.SS1.SSS1.p1.7.m2.1.1.3.2" xref="S2.SS1.SSS1.p1.7.m2.1.1.3.2.cmml">d</mi><mi id="S2.SS1.SSS1.p1.7.m2.1.1.3.3" xref="S2.SS1.SSS1.p1.7.m2.1.1.3.3.cmml">c</mi></msub><mspace id="S2.SS1.SSS1.p1.7.m2.1.1a" width="0.3888888888888889em" xref="S2.SS1.SSS1.p1.7.m2.1.1.cmml"></mspace><mrow id="S2.SS1.SSS1.p1.7.m2.1.1.1.1" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.cmml"><mo id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.2" stretchy="false" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.cmml">(</mo><mrow id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.cmml"><mi id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.2" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.2.cmml"></mi><mo id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.1" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.1.cmml">≪</mo><mrow id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.cmml"><msub id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2.cmml"><mi id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2.2" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2.3" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2.3.cmml">h</mi></msub><mo id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.1" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.1.cmml">⁢</mo><msub id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3.cmml"><mi id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3.2" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3.2.cmml">n</mi><mi id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3.3" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3.3.cmml">h</mi></msub></mrow></mrow><mo id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.3" stretchy="false" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.7.m2.1b"><apply id="S2.SS1.SSS1.p1.7.m2.1.1.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1"><csymbol cd="latexml" id="S2.SS1.SSS1.p1.7.m2.1.1.2.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1">annotated</csymbol><apply id="S2.SS1.SSS1.p1.7.m2.1.1.3.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.7.m2.1.1.3.1.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.3">subscript</csymbol><ci id="S2.SS1.SSS1.p1.7.m2.1.1.3.2.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.3.2">𝑑</ci><ci id="S2.SS1.SSS1.p1.7.m2.1.1.3.3.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.3.3">𝑐</ci></apply><apply id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1"><csymbol cd="latexml" id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.1.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.1">much-less-than</csymbol><csymbol cd="latexml" id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.2.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.2">absent</csymbol><apply id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3"><times id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.1.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.1"></times><apply id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2.1.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2">subscript</csymbol><ci id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2.2.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2.3.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.2.3">ℎ</ci></apply><apply id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3.1.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3">subscript</csymbol><ci id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3.2.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3.2">𝑛</ci><ci id="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3.3.cmml" xref="S2.SS1.SSS1.p1.7.m2.1.1.1.1.1.3.3.3">ℎ</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.7.m2.1c">d_{c}(\ll d_{h}n_{h})</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.7.m2.1d">italic_d start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT ( ≪ italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT )</annotation></semantics></math> indicates the KV compression dimension;
<math alttext="W^{DKV}\in\mathbb{R}^{d_{c}\times d}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.8.m3.1"><semantics id="S2.SS1.SSS1.p1.8.m3.1a"><mrow id="S2.SS1.SSS1.p1.8.m3.1.1" xref="S2.SS1.SSS1.p1.8.m3.1.1.cmml"><msup id="S2.SS1.SSS1.p1.8.m3.1.1.2" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.cmml"><mi id="S2.SS1.SSS1.p1.8.m3.1.1.2.2" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.2.cmml">W</mi><mrow id="S2.SS1.SSS1.p1.8.m3.1.1.2.3" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.3.cmml"><mi id="S2.SS1.SSS1.p1.8.m3.1.1.2.3.2" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.3.2.cmml">D</mi><mo id="S2.SS1.SSS1.p1.8.m3.1.1.2.3.1" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.3.1.cmml">⁢</mo><mi id="S2.SS1.SSS1.p1.8.m3.1.1.2.3.3" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.3.3.cmml">K</mi><mo id="S2.SS1.SSS1.p1.8.m3.1.1.2.3.1a" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.3.1.cmml">⁢</mo><mi id="S2.SS1.SSS1.p1.8.m3.1.1.2.3.4" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.3.4.cmml">V</mi></mrow></msup><mo id="S2.SS1.SSS1.p1.8.m3.1.1.1" xref="S2.SS1.SSS1.p1.8.m3.1.1.1.cmml">∈</mo><msup id="S2.SS1.SSS1.p1.8.m3.1.1.3" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.cmml"><mi id="S2.SS1.SSS1.p1.8.m3.1.1.3.2" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.2.cmml">ℝ</mi><mrow id="S2.SS1.SSS1.p1.8.m3.1.1.3.3" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.cmml"><msub id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2.cmml"><mi id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2.2" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2.3" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2.3.cmml">c</mi></msub><mo id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.1.cmml">×</mo><mi id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.3" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.3.cmml">d</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.8.m3.1b"><apply id="S2.SS1.SSS1.p1.8.m3.1.1.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1"><in id="S2.SS1.SSS1.p1.8.m3.1.1.1.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.1"></in><apply id="S2.SS1.SSS1.p1.8.m3.1.1.2.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.8.m3.1.1.2.1.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.2">superscript</csymbol><ci id="S2.SS1.SSS1.p1.8.m3.1.1.2.2.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.2">𝑊</ci><apply id="S2.SS1.SSS1.p1.8.m3.1.1.2.3.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.3"><times id="S2.SS1.SSS1.p1.8.m3.1.1.2.3.1.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.3.1"></times><ci id="S2.SS1.SSS1.p1.8.m3.1.1.2.3.2.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.3.2">𝐷</ci><ci id="S2.SS1.SSS1.p1.8.m3.1.1.2.3.3.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.3.3">𝐾</ci><ci id="S2.SS1.SSS1.p1.8.m3.1.1.2.3.4.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.2.3.4">𝑉</ci></apply></apply><apply id="S2.SS1.SSS1.p1.8.m3.1.1.3.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.8.m3.1.1.3.1.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.3">superscript</csymbol><ci id="S2.SS1.SSS1.p1.8.m3.1.1.3.2.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.2">ℝ</ci><apply id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3"><times id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.1.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.1"></times><apply id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2.1.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2">subscript</csymbol><ci id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2.2.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2.3.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.2.3">𝑐</ci></apply><ci id="S2.SS1.SSS1.p1.8.m3.1.1.3.3.3.cmml" xref="S2.SS1.SSS1.p1.8.m3.1.1.3.3.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.8.m3.1c">W^{DKV}\in\mathbb{R}^{d_{c}\times d}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.8.m3.1d">italic_W start_POSTSUPERSCRIPT italic_D italic_K italic_V end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT × italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> denotes the down-projection matrix;
<math alttext="W^{UK},W^{UV}\in\mathbb{R}^{d_{h}n_{h}\times d_{c}}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.9.m4.2"><semantics id="S2.SS1.SSS1.p1.9.m4.2a"><mrow id="S2.SS1.SSS1.p1.9.m4.2.2" xref="S2.SS1.SSS1.p1.9.m4.2.2.cmml"><mrow id="S2.SS1.SSS1.p1.9.m4.2.2.2.2" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.3.cmml"><msup id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.cmml"><mi id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.2" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.2.cmml">W</mi><mrow id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.cmml"><mi id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.2" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.2.cmml">U</mi><mo id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.1" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.1.cmml">⁢</mo><mi id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.3" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.3.cmml">K</mi></mrow></msup><mo id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.3" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.3.cmml">,</mo><msup id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.cmml"><mi id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.2" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.2.cmml">W</mi><mrow id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.cmml"><mi id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.2" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.2.cmml">U</mi><mo id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.1" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.1.cmml">⁢</mo><mi id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.3" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.3.cmml">V</mi></mrow></msup></mrow><mo id="S2.SS1.SSS1.p1.9.m4.2.2.3" xref="S2.SS1.SSS1.p1.9.m4.2.2.3.cmml">∈</mo><msup id="S2.SS1.SSS1.p1.9.m4.2.2.4" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.cmml"><mi id="S2.SS1.SSS1.p1.9.m4.2.2.4.2" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.2.cmml">ℝ</mi><mrow id="S2.SS1.SSS1.p1.9.m4.2.2.4.3" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.cmml"><mrow id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.cmml"><msub id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2.cmml"><mi id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2.2" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2.3" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2.3.cmml">h</mi></msub><mo id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.1" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.1.cmml">⁢</mo><msub id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3.cmml"><mi id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3.2" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3.2.cmml">n</mi><mi id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3.3" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3.3.cmml">h</mi></msub></mrow><mo id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.1" lspace="0.222em" rspace="0.222em" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.1.cmml">×</mo><msub id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3.cmml"><mi id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3.2" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3.2.cmml">d</mi><mi id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3.3" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3.3.cmml">c</mi></msub></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.9.m4.2b"><apply id="S2.SS1.SSS1.p1.9.m4.2.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2"><in id="S2.SS1.SSS1.p1.9.m4.2.2.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.3"></in><list id="S2.SS1.SSS1.p1.9.m4.2.2.2.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2"><apply id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.cmml" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.1.cmml" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1">superscript</csymbol><ci id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.2">𝑊</ci><apply id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3"><times id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.1.cmml" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.1"></times><ci id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.2">𝑈</ci><ci id="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.1.1.1.1.1.3.3">𝐾</ci></apply></apply><apply id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.1.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2">superscript</csymbol><ci id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.2">𝑊</ci><apply id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3"><times id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.1.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.1"></times><ci id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.2">𝑈</ci><ci id="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.2.2.2.3.3">𝑉</ci></apply></apply></list><apply id="S2.SS1.SSS1.p1.9.m4.2.2.4.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.9.m4.2.2.4.1.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4">superscript</csymbol><ci id="S2.SS1.SSS1.p1.9.m4.2.2.4.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.2">ℝ</ci><apply id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3"><times id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.1.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.1"></times><apply id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2"><times id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.1.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.1"></times><apply id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2.1.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2">subscript</csymbol><ci id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.2.3">ℎ</ci></apply><apply id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3.1.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3">subscript</csymbol><ci id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3.2">𝑛</ci><ci id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.2.3.3">ℎ</ci></apply></apply><apply id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3.1.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3">subscript</csymbol><ci id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3.2.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3.2">𝑑</ci><ci id="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3.3.cmml" xref="S2.SS1.SSS1.p1.9.m4.2.2.4.3.3.3">𝑐</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.9.m4.2c">W^{UK},W^{UV}\in\mathbb{R}^{d_{h}n_{h}\times d_{c}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.9.m4.2d">italic_W start_POSTSUPERSCRIPT italic_U italic_K end_POSTSUPERSCRIPT , italic_W start_POSTSUPERSCRIPT italic_U italic_V end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT × italic_d start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> are the up-projection matrices for keys and values, respectively;
<math alttext="W^{KR}\in\mathbb{R}^{d_{h}^{R}\times d}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.10.m5.1"><semantics id="S2.SS1.SSS1.p1.10.m5.1a"><mrow id="S2.SS1.SSS1.p1.10.m5.1.1" xref="S2.SS1.SSS1.p1.10.m5.1.1.cmml"><msup id="S2.SS1.SSS1.p1.10.m5.1.1.2" xref="S2.SS1.SSS1.p1.10.m5.1.1.2.cmml"><mi id="S2.SS1.SSS1.p1.10.m5.1.1.2.2" xref="S2.SS1.SSS1.p1.10.m5.1.1.2.2.cmml">W</mi><mrow id="S2.SS1.SSS1.p1.10.m5.1.1.2.3" xref="S2.SS1.SSS1.p1.10.m5.1.1.2.3.cmml"><mi id="S2.SS1.SSS1.p1.10.m5.1.1.2.3.2" xref="S2.SS1.SSS1.p1.10.m5.1.1.2.3.2.cmml">K</mi><mo id="S2.SS1.SSS1.p1.10.m5.1.1.2.3.1" xref="S2.SS1.SSS1.p1.10.m5.1.1.2.3.1.cmml">⁢</mo><mi id="S2.SS1.SSS1.p1.10.m5.1.1.2.3.3" xref="S2.SS1.SSS1.p1.10.m5.1.1.2.3.3.cmml">R</mi></mrow></msup><mo id="S2.SS1.SSS1.p1.10.m5.1.1.1" xref="S2.SS1.SSS1.p1.10.m5.1.1.1.cmml">∈</mo><msup id="S2.SS1.SSS1.p1.10.m5.1.1.3" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.cmml"><mi id="S2.SS1.SSS1.p1.10.m5.1.1.3.2" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.2.cmml">ℝ</mi><mrow id="S2.SS1.SSS1.p1.10.m5.1.1.3.3" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.cmml"><msubsup id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.cmml"><mi id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.2.2" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.2.3" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.2.3.cmml">h</mi><mi id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.3" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.3.cmml">R</mi></msubsup><mo id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.1.cmml">×</mo><mi id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.3" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.3.cmml">d</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.10.m5.1b"><apply id="S2.SS1.SSS1.p1.10.m5.1.1.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1"><in id="S2.SS1.SSS1.p1.10.m5.1.1.1.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.1"></in><apply id="S2.SS1.SSS1.p1.10.m5.1.1.2.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.10.m5.1.1.2.1.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.2">superscript</csymbol><ci id="S2.SS1.SSS1.p1.10.m5.1.1.2.2.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.2.2">𝑊</ci><apply id="S2.SS1.SSS1.p1.10.m5.1.1.2.3.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.2.3"><times id="S2.SS1.SSS1.p1.10.m5.1.1.2.3.1.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.2.3.1"></times><ci id="S2.SS1.SSS1.p1.10.m5.1.1.2.3.2.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.2.3.2">𝐾</ci><ci id="S2.SS1.SSS1.p1.10.m5.1.1.2.3.3.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.2.3.3">𝑅</ci></apply></apply><apply id="S2.SS1.SSS1.p1.10.m5.1.1.3.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.10.m5.1.1.3.1.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3">superscript</csymbol><ci id="S2.SS1.SSS1.p1.10.m5.1.1.3.2.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.2">ℝ</ci><apply id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3"><times id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.1.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.1"></times><apply id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.1.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2">superscript</csymbol><apply id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.2.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.2.1.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2">subscript</csymbol><ci id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.2.2.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.2.3.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.2.3">ℎ</ci></apply><ci id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.3.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.2.3">𝑅</ci></apply><ci id="S2.SS1.SSS1.p1.10.m5.1.1.3.3.3.cmml" xref="S2.SS1.SSS1.p1.10.m5.1.1.3.3.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.10.m5.1c">W^{KR}\in\mathbb{R}^{d_{h}^{R}\times d}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.10.m5.1d">italic_W start_POSTSUPERSCRIPT italic_K italic_R end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT × italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> is the matrix used to produce the decoupled key that carries Rotary Positional Embedding (RoPE) <cite class="ltx_cite ltx_citemacro_citep">(Su et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib84" title="">2024</a>)</cite>;
<math alttext="\operatorname{RoPE}(\cdot)" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.11.m6.2"><semantics id="S2.SS1.SSS1.p1.11.m6.2a"><mrow id="S2.SS1.SSS1.p1.11.m6.2.3.2" xref="S2.SS1.SSS1.p1.11.m6.2.3.1.cmml"><mi id="S2.SS1.SSS1.p1.11.m6.1.1" xref="S2.SS1.SSS1.p1.11.m6.1.1.cmml">RoPE</mi><mo id="S2.SS1.SSS1.p1.11.m6.2.3.2a" xref="S2.SS1.SSS1.p1.11.m6.2.3.1.cmml">⁡</mo><mrow id="S2.SS1.SSS1.p1.11.m6.2.3.2.1" xref="S2.SS1.SSS1.p1.11.m6.2.3.1.cmml"><mo id="S2.SS1.SSS1.p1.11.m6.2.3.2.1.1" stretchy="false" xref="S2.SS1.SSS1.p1.11.m6.2.3.1.cmml">(</mo><mo id="S2.SS1.SSS1.p1.11.m6.2.2" lspace="0em" rspace="0em" xref="S2.SS1.SSS1.p1.11.m6.2.2.cmml">⋅</mo><mo id="S2.SS1.SSS1.p1.11.m6.2.3.2.1.2" stretchy="false" xref="S2.SS1.SSS1.p1.11.m6.2.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.11.m6.2b"><apply id="S2.SS1.SSS1.p1.11.m6.2.3.1.cmml" xref="S2.SS1.SSS1.p1.11.m6.2.3.2"><ci id="S2.SS1.SSS1.p1.11.m6.1.1.cmml" xref="S2.SS1.SSS1.p1.11.m6.1.1">RoPE</ci><ci id="S2.SS1.SSS1.p1.11.m6.2.2.cmml" xref="S2.SS1.SSS1.p1.11.m6.2.2">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.11.m6.2c">\operatorname{RoPE}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.11.m6.2d">roman_RoPE ( ⋅ )</annotation></semantics></math> denotes the operation that applies RoPE matrices;
and <math alttext="[\cdot;\cdot]" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.12.m7.2"><semantics id="S2.SS1.SSS1.p1.12.m7.2a"><mrow id="S2.SS1.SSS1.p1.12.m7.2.3.2" xref="S2.SS1.SSS1.p1.12.m7.2.3.1.cmml"><mo id="S2.SS1.SSS1.p1.12.m7.2.3.2.1" stretchy="false" xref="S2.SS1.SSS1.p1.12.m7.2.3.1.cmml">[</mo><mo id="S2.SS1.SSS1.p1.12.m7.1.1" lspace="0em" rspace="0em" xref="S2.SS1.SSS1.p1.12.m7.1.1.cmml">⋅</mo><mo id="S2.SS1.SSS1.p1.12.m7.2.3.2.2" rspace="0em" xref="S2.SS1.SSS1.p1.12.m7.2.3.1.cmml">;</mo><mo id="S2.SS1.SSS1.p1.12.m7.2.2" lspace="0em" rspace="0em" xref="S2.SS1.SSS1.p1.12.m7.2.2.cmml">⋅</mo><mo id="S2.SS1.SSS1.p1.12.m7.2.3.2.3" stretchy="false" xref="S2.SS1.SSS1.p1.12.m7.2.3.1.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.12.m7.2b"><list id="S2.SS1.SSS1.p1.12.m7.2.3.1.cmml" xref="S2.SS1.SSS1.p1.12.m7.2.3.2"><ci id="S2.SS1.SSS1.p1.12.m7.1.1.cmml" xref="S2.SS1.SSS1.p1.12.m7.1.1">⋅</ci><ci id="S2.SS1.SSS1.p1.12.m7.2.2.cmml" xref="S2.SS1.SSS1.p1.12.m7.2.2">⋅</ci></list></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.12.m7.2c">[\cdot;\cdot]</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.12.m7.2d">[ ⋅ ; ⋅ ]</annotation></semantics></math> denotes concatenation.
Note that for MLA, only the blue-boxed vectors (i.e., <math alttext="\color[rgb]{0,0,1}\definecolor[named]{pgfstrokecolor}{rgb}{0,0,1}\mathbf{c}_{t%
}^{KV}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.13.m8.1"><semantics id="S2.SS1.SSS1.p1.13.m8.1a"><msubsup id="S2.SS1.SSS1.p1.13.m8.1.1" xref="S2.SS1.SSS1.p1.13.m8.1.1.cmml"><mi id="S2.SS1.SSS1.p1.13.m8.1.1.2.2" mathcolor="#0000FF" xref="S2.SS1.SSS1.p1.13.m8.1.1.2.2.cmml">𝐜</mi><mi id="S2.SS1.SSS1.p1.13.m8.1.1.2.3" mathcolor="#0000FF" xref="S2.SS1.SSS1.p1.13.m8.1.1.2.3.cmml">t</mi><mrow id="S2.SS1.SSS1.p1.13.m8.1.1.3" xref="S2.SS1.SSS1.p1.13.m8.1.1.3.cmml"><mi id="S2.SS1.SSS1.p1.13.m8.1.1.3.2" mathcolor="#0000FF" xref="S2.SS1.SSS1.p1.13.m8.1.1.3.2.cmml">K</mi><mo id="S2.SS1.SSS1.p1.13.m8.1.1.3.1" xref="S2.SS1.SSS1.p1.13.m8.1.1.3.1.cmml">⁢</mo><mi id="S2.SS1.SSS1.p1.13.m8.1.1.3.3" mathcolor="#0000FF" xref="S2.SS1.SSS1.p1.13.m8.1.1.3.3.cmml">V</mi></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.13.m8.1b"><apply id="S2.SS1.SSS1.p1.13.m8.1.1.cmml" xref="S2.SS1.SSS1.p1.13.m8.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.13.m8.1.1.1.cmml" xref="S2.SS1.SSS1.p1.13.m8.1.1">superscript</csymbol><apply id="S2.SS1.SSS1.p1.13.m8.1.1.2.cmml" xref="S2.SS1.SSS1.p1.13.m8.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.13.m8.1.1.2.1.cmml" xref="S2.SS1.SSS1.p1.13.m8.1.1">subscript</csymbol><ci id="S2.SS1.SSS1.p1.13.m8.1.1.2.2.cmml" xref="S2.SS1.SSS1.p1.13.m8.1.1.2.2">𝐜</ci><ci id="S2.SS1.SSS1.p1.13.m8.1.1.2.3.cmml" xref="S2.SS1.SSS1.p1.13.m8.1.1.2.3">𝑡</ci></apply><apply id="S2.SS1.SSS1.p1.13.m8.1.1.3.cmml" xref="S2.SS1.SSS1.p1.13.m8.1.1.3"><times id="S2.SS1.SSS1.p1.13.m8.1.1.3.1.cmml" xref="S2.SS1.SSS1.p1.13.m8.1.1.3.1"></times><ci id="S2.SS1.SSS1.p1.13.m8.1.1.3.2.cmml" xref="S2.SS1.SSS1.p1.13.m8.1.1.3.2">𝐾</ci><ci id="S2.SS1.SSS1.p1.13.m8.1.1.3.3.cmml" xref="S2.SS1.SSS1.p1.13.m8.1.1.3.3">𝑉</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.13.m8.1c">\color[rgb]{0,0,1}\definecolor[named]{pgfstrokecolor}{rgb}{0,0,1}\mathbf{c}_{t%
}^{KV}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.13.m8.1d">bold_c start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K italic_V end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="\color[rgb]{0,0,1}\definecolor[named]{pgfstrokecolor}{rgb}{0,0,1}\mathbf{k}_{t%
}^{R}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p1.14.m9.1"><semantics id="S2.SS1.SSS1.p1.14.m9.1a"><msubsup id="S2.SS1.SSS1.p1.14.m9.1.1" xref="S2.SS1.SSS1.p1.14.m9.1.1.cmml"><mi id="S2.SS1.SSS1.p1.14.m9.1.1.2.2" mathcolor="#0000FF" xref="S2.SS1.SSS1.p1.14.m9.1.1.2.2.cmml">𝐤</mi><mi id="S2.SS1.SSS1.p1.14.m9.1.1.2.3" mathcolor="#0000FF" xref="S2.SS1.SSS1.p1.14.m9.1.1.2.3.cmml">t</mi><mi id="S2.SS1.SSS1.p1.14.m9.1.1.3" mathcolor="#0000FF" xref="S2.SS1.SSS1.p1.14.m9.1.1.3.cmml">R</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p1.14.m9.1b"><apply id="S2.SS1.SSS1.p1.14.m9.1.1.cmml" xref="S2.SS1.SSS1.p1.14.m9.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.14.m9.1.1.1.cmml" xref="S2.SS1.SSS1.p1.14.m9.1.1">superscript</csymbol><apply id="S2.SS1.SSS1.p1.14.m9.1.1.2.cmml" xref="S2.SS1.SSS1.p1.14.m9.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p1.14.m9.1.1.2.1.cmml" xref="S2.SS1.SSS1.p1.14.m9.1.1">subscript</csymbol><ci id="S2.SS1.SSS1.p1.14.m9.1.1.2.2.cmml" xref="S2.SS1.SSS1.p1.14.m9.1.1.2.2">𝐤</ci><ci id="S2.SS1.SSS1.p1.14.m9.1.1.2.3.cmml" xref="S2.SS1.SSS1.p1.14.m9.1.1.2.3">𝑡</ci></apply><ci id="S2.SS1.SSS1.p1.14.m9.1.1.3.cmml" xref="S2.SS1.SSS1.p1.14.m9.1.1.3">𝑅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p1.14.m9.1c">\color[rgb]{0,0,1}\definecolor[named]{pgfstrokecolor}{rgb}{0,0,1}\mathbf{k}_{t%
}^{R}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p1.14.m9.1d">bold_k start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT</annotation></semantics></math>) need to be cached during generation, which results in significantly reduced KV cache while maintaining performance comparable to standard Multi-Head Attention (MHA) <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib92" title="">2017</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S2.SS1.SSS1.p2">
<p class="ltx_p" id="S2.SS1.SSS1.p2.5">For the attention queries, we also perform a low-rank compression, which can reduce the activation memory during training:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A3.EGx2">
<tbody id="S2.E6"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathbf{c}_{t}^{Q}" class="ltx_Math" display="inline" id="S2.E6.m1.1"><semantics id="S2.E6.m1.1a"><msubsup id="S2.E6.m1.1.1" xref="S2.E6.m1.1.1.cmml"><mi id="S2.E6.m1.1.1.2.2" xref="S2.E6.m1.1.1.2.2.cmml">𝐜</mi><mi id="S2.E6.m1.1.1.2.3" xref="S2.E6.m1.1.1.2.3.cmml">t</mi><mi id="S2.E6.m1.1.1.3" xref="S2.E6.m1.1.1.3.cmml">Q</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.E6.m1.1b"><apply id="S2.E6.m1.1.1.cmml" xref="S2.E6.m1.1.1"><csymbol cd="ambiguous" id="S2.E6.m1.1.1.1.cmml" xref="S2.E6.m1.1.1">superscript</csymbol><apply id="S2.E6.m1.1.1.2.cmml" xref="S2.E6.m1.1.1"><csymbol cd="ambiguous" id="S2.E6.m1.1.1.2.1.cmml" xref="S2.E6.m1.1.1">subscript</csymbol><ci id="S2.E6.m1.1.1.2.2.cmml" xref="S2.E6.m1.1.1.2.2">𝐜</ci><ci id="S2.E6.m1.1.1.2.3.cmml" xref="S2.E6.m1.1.1.2.3">𝑡</ci></apply><ci id="S2.E6.m1.1.1.3.cmml" xref="S2.E6.m1.1.1.3">𝑄</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E6.m1.1c">\displaystyle\mathbf{c}_{t}^{Q}</annotation><annotation encoding="application/x-llamapun" id="S2.E6.m1.1d">bold_c start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_Q end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=W^{DQ}\mathbf{h}_{t}," class="ltx_Math" display="inline" id="S2.E6.m2.1"><semantics id="S2.E6.m2.1a"><mrow id="S2.E6.m2.1.1.1" xref="S2.E6.m2.1.1.1.1.cmml"><mrow id="S2.E6.m2.1.1.1.1" xref="S2.E6.m2.1.1.1.1.cmml"><mi id="S2.E6.m2.1.1.1.1.2" xref="S2.E6.m2.1.1.1.1.2.cmml"></mi><mo id="S2.E6.m2.1.1.1.1.1" xref="S2.E6.m2.1.1.1.1.1.cmml">=</mo><mrow id="S2.E6.m2.1.1.1.1.3" xref="S2.E6.m2.1.1.1.1.3.cmml"><msup id="S2.E6.m2.1.1.1.1.3.2" xref="S2.E6.m2.1.1.1.1.3.2.cmml"><mi id="S2.E6.m2.1.1.1.1.3.2.2" xref="S2.E6.m2.1.1.1.1.3.2.2.cmml">W</mi><mrow id="S2.E6.m2.1.1.1.1.3.2.3" xref="S2.E6.m2.1.1.1.1.3.2.3.cmml"><mi id="S2.E6.m2.1.1.1.1.3.2.3.2" xref="S2.E6.m2.1.1.1.1.3.2.3.2.cmml">D</mi><mo id="S2.E6.m2.1.1.1.1.3.2.3.1" xref="S2.E6.m2.1.1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S2.E6.m2.1.1.1.1.3.2.3.3" xref="S2.E6.m2.1.1.1.1.3.2.3.3.cmml">Q</mi></mrow></msup><mo id="S2.E6.m2.1.1.1.1.3.1" xref="S2.E6.m2.1.1.1.1.3.1.cmml">⁢</mo><msub id="S2.E6.m2.1.1.1.1.3.3" xref="S2.E6.m2.1.1.1.1.3.3.cmml"><mi id="S2.E6.m2.1.1.1.1.3.3.2" xref="S2.E6.m2.1.1.1.1.3.3.2.cmml">𝐡</mi><mi id="S2.E6.m2.1.1.1.1.3.3.3" xref="S2.E6.m2.1.1.1.1.3.3.3.cmml">t</mi></msub></mrow></mrow><mo id="S2.E6.m2.1.1.1.2" xref="S2.E6.m2.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E6.m2.1b"><apply id="S2.E6.m2.1.1.1.1.cmml" xref="S2.E6.m2.1.1.1"><eq id="S2.E6.m2.1.1.1.1.1.cmml" xref="S2.E6.m2.1.1.1.1.1"></eq><csymbol cd="latexml" id="S2.E6.m2.1.1.1.1.2.cmml" xref="S2.E6.m2.1.1.1.1.2">absent</csymbol><apply id="S2.E6.m2.1.1.1.1.3.cmml" xref="S2.E6.m2.1.1.1.1.3"><times id="S2.E6.m2.1.1.1.1.3.1.cmml" xref="S2.E6.m2.1.1.1.1.3.1"></times><apply id="S2.E6.m2.1.1.1.1.3.2.cmml" xref="S2.E6.m2.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S2.E6.m2.1.1.1.1.3.2.1.cmml" xref="S2.E6.m2.1.1.1.1.3.2">superscript</csymbol><ci id="S2.E6.m2.1.1.1.1.3.2.2.cmml" xref="S2.E6.m2.1.1.1.1.3.2.2">𝑊</ci><apply id="S2.E6.m2.1.1.1.1.3.2.3.cmml" xref="S2.E6.m2.1.1.1.1.3.2.3"><times id="S2.E6.m2.1.1.1.1.3.2.3.1.cmml" xref="S2.E6.m2.1.1.1.1.3.2.3.1"></times><ci id="S2.E6.m2.1.1.1.1.3.2.3.2.cmml" xref="S2.E6.m2.1.1.1.1.3.2.3.2">𝐷</ci><ci id="S2.E6.m2.1.1.1.1.3.2.3.3.cmml" xref="S2.E6.m2.1.1.1.1.3.2.3.3">𝑄</ci></apply></apply><apply id="S2.E6.m2.1.1.1.1.3.3.cmml" xref="S2.E6.m2.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S2.E6.m2.1.1.1.1.3.3.1.cmml" xref="S2.E6.m2.1.1.1.1.3.3">subscript</csymbol><ci id="S2.E6.m2.1.1.1.1.3.3.2.cmml" xref="S2.E6.m2.1.1.1.1.3.3.2">𝐡</ci><ci id="S2.E6.m2.1.1.1.1.3.3.3.cmml" xref="S2.E6.m2.1.1.1.1.3.3.3">𝑡</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E6.m2.1c">\displaystyle=W^{DQ}\mathbf{h}_{t},</annotation><annotation encoding="application/x-llamapun" id="S2.E6.m2.1d">= italic_W start_POSTSUPERSCRIPT italic_D italic_Q end_POSTSUPERSCRIPT bold_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(6)</span></td>
</tr></tbody>
<tbody id="S2.E7"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle[\mathbf{q}_{t,1}^{C};\mathbf{q}_{t,2}^{C};...;\mathbf{q}_{t,n_{h%
}}^{C}]=\mathbf{q}_{t}^{C}" class="ltx_Math" display="inline" id="S2.E7.m1.10"><semantics id="S2.E7.m1.10a"><mrow id="S2.E7.m1.10.10" xref="S2.E7.m1.10.10.cmml"><mrow id="S2.E7.m1.10.10.3.3" xref="S2.E7.m1.10.10.3.4.cmml"><mo id="S2.E7.m1.10.10.3.3.4" stretchy="false" xref="S2.E7.m1.10.10.3.4.cmml">[</mo><msubsup id="S2.E7.m1.8.8.1.1.1" xref="S2.E7.m1.8.8.1.1.1.cmml"><mi id="S2.E7.m1.8.8.1.1.1.2.2" xref="S2.E7.m1.8.8.1.1.1.2.2.cmml">𝐪</mi><mrow id="S2.E7.m1.2.2.2.4" xref="S2.E7.m1.2.2.2.3.cmml"><mi id="S2.E7.m1.1.1.1.1" xref="S2.E7.m1.1.1.1.1.cmml">t</mi><mo id="S2.E7.m1.2.2.2.4.1" xref="S2.E7.m1.2.2.2.3.cmml">,</mo><mn id="S2.E7.m1.2.2.2.2" xref="S2.E7.m1.2.2.2.2.cmml">1</mn></mrow><mi id="S2.E7.m1.8.8.1.1.1.3" xref="S2.E7.m1.8.8.1.1.1.3.cmml">C</mi></msubsup><mo id="S2.E7.m1.10.10.3.3.5" xref="S2.E7.m1.10.10.3.4.cmml">;</mo><msubsup id="S2.E7.m1.9.9.2.2.2" xref="S2.E7.m1.9.9.2.2.2.cmml"><mi id="S2.E7.m1.9.9.2.2.2.2.2" xref="S2.E7.m1.9.9.2.2.2.2.2.cmml">𝐪</mi><mrow id="S2.E7.m1.4.4.2.4" xref="S2.E7.m1.4.4.2.3.cmml"><mi id="S2.E7.m1.3.3.1.1" xref="S2.E7.m1.3.3.1.1.cmml">t</mi><mo id="S2.E7.m1.4.4.2.4.1" xref="S2.E7.m1.4.4.2.3.cmml">,</mo><mn id="S2.E7.m1.4.4.2.2" xref="S2.E7.m1.4.4.2.2.cmml">2</mn></mrow><mi id="S2.E7.m1.9.9.2.2.2.3" xref="S2.E7.m1.9.9.2.2.2.3.cmml">C</mi></msubsup><mo id="S2.E7.m1.10.10.3.3.6" xref="S2.E7.m1.10.10.3.4.cmml">;</mo><mi id="S2.E7.m1.7.7" mathvariant="normal" xref="S2.E7.m1.7.7.cmml">…</mi><mo id="S2.E7.m1.10.10.3.3.7" xref="S2.E7.m1.10.10.3.4.cmml">;</mo><msubsup id="S2.E7.m1.10.10.3.3.3" xref="S2.E7.m1.10.10.3.3.3.cmml"><mi id="S2.E7.m1.10.10.3.3.3.2.2" xref="S2.E7.m1.10.10.3.3.3.2.2.cmml">𝐪</mi><mrow id="S2.E7.m1.6.6.2.2" xref="S2.E7.m1.6.6.2.3.cmml"><mi id="S2.E7.m1.5.5.1.1" xref="S2.E7.m1.5.5.1.1.cmml">t</mi><mo id="S2.E7.m1.6.6.2.2.2" xref="S2.E7.m1.6.6.2.3.cmml">,</mo><msub id="S2.E7.m1.6.6.2.2.1" xref="S2.E7.m1.6.6.2.2.1.cmml"><mi id="S2.E7.m1.6.6.2.2.1.2" xref="S2.E7.m1.6.6.2.2.1.2.cmml">n</mi><mi id="S2.E7.m1.6.6.2.2.1.3" xref="S2.E7.m1.6.6.2.2.1.3.cmml">h</mi></msub></mrow><mi id="S2.E7.m1.10.10.3.3.3.3" xref="S2.E7.m1.10.10.3.3.3.3.cmml">C</mi></msubsup><mo id="S2.E7.m1.10.10.3.3.8" stretchy="false" xref="S2.E7.m1.10.10.3.4.cmml">]</mo></mrow><mo id="S2.E7.m1.10.10.4" xref="S2.E7.m1.10.10.4.cmml">=</mo><msubsup id="S2.E7.m1.10.10.5" xref="S2.E7.m1.10.10.5.cmml"><mi id="S2.E7.m1.10.10.5.2.2" xref="S2.E7.m1.10.10.5.2.2.cmml">𝐪</mi><mi id="S2.E7.m1.10.10.5.2.3" xref="S2.E7.m1.10.10.5.2.3.cmml">t</mi><mi id="S2.E7.m1.10.10.5.3" xref="S2.E7.m1.10.10.5.3.cmml">C</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S2.E7.m1.10b"><apply id="S2.E7.m1.10.10.cmml" xref="S2.E7.m1.10.10"><eq id="S2.E7.m1.10.10.4.cmml" xref="S2.E7.m1.10.10.4"></eq><list id="S2.E7.m1.10.10.3.4.cmml" xref="S2.E7.m1.10.10.3.3"><apply id="S2.E7.m1.8.8.1.1.1.cmml" xref="S2.E7.m1.8.8.1.1.1"><csymbol cd="ambiguous" id="S2.E7.m1.8.8.1.1.1.1.cmml" xref="S2.E7.m1.8.8.1.1.1">superscript</csymbol><apply id="S2.E7.m1.8.8.1.1.1.2.cmml" xref="S2.E7.m1.8.8.1.1.1"><csymbol cd="ambiguous" id="S2.E7.m1.8.8.1.1.1.2.1.cmml" xref="S2.E7.m1.8.8.1.1.1">subscript</csymbol><ci id="S2.E7.m1.8.8.1.1.1.2.2.cmml" xref="S2.E7.m1.8.8.1.1.1.2.2">𝐪</ci><list id="S2.E7.m1.2.2.2.3.cmml" xref="S2.E7.m1.2.2.2.4"><ci id="S2.E7.m1.1.1.1.1.cmml" xref="S2.E7.m1.1.1.1.1">𝑡</ci><cn id="S2.E7.m1.2.2.2.2.cmml" type="integer" xref="S2.E7.m1.2.2.2.2">1</cn></list></apply><ci id="S2.E7.m1.8.8.1.1.1.3.cmml" xref="S2.E7.m1.8.8.1.1.1.3">𝐶</ci></apply><apply id="S2.E7.m1.9.9.2.2.2.cmml" xref="S2.E7.m1.9.9.2.2.2"><csymbol cd="ambiguous" id="S2.E7.m1.9.9.2.2.2.1.cmml" xref="S2.E7.m1.9.9.2.2.2">superscript</csymbol><apply id="S2.E7.m1.9.9.2.2.2.2.cmml" xref="S2.E7.m1.9.9.2.2.2"><csymbol cd="ambiguous" id="S2.E7.m1.9.9.2.2.2.2.1.cmml" xref="S2.E7.m1.9.9.2.2.2">subscript</csymbol><ci id="S2.E7.m1.9.9.2.2.2.2.2.cmml" xref="S2.E7.m1.9.9.2.2.2.2.2">𝐪</ci><list id="S2.E7.m1.4.4.2.3.cmml" xref="S2.E7.m1.4.4.2.4"><ci id="S2.E7.m1.3.3.1.1.cmml" xref="S2.E7.m1.3.3.1.1">𝑡</ci><cn id="S2.E7.m1.4.4.2.2.cmml" type="integer" xref="S2.E7.m1.4.4.2.2">2</cn></list></apply><ci id="S2.E7.m1.9.9.2.2.2.3.cmml" xref="S2.E7.m1.9.9.2.2.2.3">𝐶</ci></apply><ci id="S2.E7.m1.7.7.cmml" xref="S2.E7.m1.7.7">…</ci><apply id="S2.E7.m1.10.10.3.3.3.cmml" xref="S2.E7.m1.10.10.3.3.3"><csymbol cd="ambiguous" id="S2.E7.m1.10.10.3.3.3.1.cmml" xref="S2.E7.m1.10.10.3.3.3">superscript</csymbol><apply id="S2.E7.m1.10.10.3.3.3.2.cmml" xref="S2.E7.m1.10.10.3.3.3"><csymbol cd="ambiguous" id="S2.E7.m1.10.10.3.3.3.2.1.cmml" xref="S2.E7.m1.10.10.3.3.3">subscript</csymbol><ci id="S2.E7.m1.10.10.3.3.3.2.2.cmml" xref="S2.E7.m1.10.10.3.3.3.2.2">𝐪</ci><list id="S2.E7.m1.6.6.2.3.cmml" xref="S2.E7.m1.6.6.2.2"><ci id="S2.E7.m1.5.5.1.1.cmml" xref="S2.E7.m1.5.5.1.1">𝑡</ci><apply id="S2.E7.m1.6.6.2.2.1.cmml" xref="S2.E7.m1.6.6.2.2.1"><csymbol cd="ambiguous" id="S2.E7.m1.6.6.2.2.1.1.cmml" xref="S2.E7.m1.6.6.2.2.1">subscript</csymbol><ci id="S2.E7.m1.6.6.2.2.1.2.cmml" xref="S2.E7.m1.6.6.2.2.1.2">𝑛</ci><ci id="S2.E7.m1.6.6.2.2.1.3.cmml" xref="S2.E7.m1.6.6.2.2.1.3">ℎ</ci></apply></list></apply><ci id="S2.E7.m1.10.10.3.3.3.3.cmml" xref="S2.E7.m1.10.10.3.3.3.3">𝐶</ci></apply></list><apply id="S2.E7.m1.10.10.5.cmml" xref="S2.E7.m1.10.10.5"><csymbol cd="ambiguous" id="S2.E7.m1.10.10.5.1.cmml" xref="S2.E7.m1.10.10.5">superscript</csymbol><apply id="S2.E7.m1.10.10.5.2.cmml" xref="S2.E7.m1.10.10.5"><csymbol cd="ambiguous" id="S2.E7.m1.10.10.5.2.1.cmml" xref="S2.E7.m1.10.10.5">subscript</csymbol><ci id="S2.E7.m1.10.10.5.2.2.cmml" xref="S2.E7.m1.10.10.5.2.2">𝐪</ci><ci id="S2.E7.m1.10.10.5.2.3.cmml" xref="S2.E7.m1.10.10.5.2.3">𝑡</ci></apply><ci id="S2.E7.m1.10.10.5.3.cmml" xref="S2.E7.m1.10.10.5.3">𝐶</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E7.m1.10c">\displaystyle[\mathbf{q}_{t,1}^{C};\mathbf{q}_{t,2}^{C};...;\mathbf{q}_{t,n_{h%
}}^{C}]=\mathbf{q}_{t}^{C}</annotation><annotation encoding="application/x-llamapun" id="S2.E7.m1.10d">[ bold_q start_POSTSUBSCRIPT italic_t , 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ; bold_q start_POSTSUBSCRIPT italic_t , 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ; … ; bold_q start_POSTSUBSCRIPT italic_t , italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ] = bold_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=W^{UQ}\mathbf{c}_{t}^{Q}," class="ltx_Math" display="inline" id="S2.E7.m2.1"><semantics id="S2.E7.m2.1a"><mrow id="S2.E7.m2.1.1.1" xref="S2.E7.m2.1.1.1.1.cmml"><mrow id="S2.E7.m2.1.1.1.1" xref="S2.E7.m2.1.1.1.1.cmml"><mi id="S2.E7.m2.1.1.1.1.2" xref="S2.E7.m2.1.1.1.1.2.cmml"></mi><mo id="S2.E7.m2.1.1.1.1.1" xref="S2.E7.m2.1.1.1.1.1.cmml">=</mo><mrow id="S2.E7.m2.1.1.1.1.3" xref="S2.E7.m2.1.1.1.1.3.cmml"><msup id="S2.E7.m2.1.1.1.1.3.2" xref="S2.E7.m2.1.1.1.1.3.2.cmml"><mi id="S2.E7.m2.1.1.1.1.3.2.2" xref="S2.E7.m2.1.1.1.1.3.2.2.cmml">W</mi><mrow id="S2.E7.m2.1.1.1.1.3.2.3" xref="S2.E7.m2.1.1.1.1.3.2.3.cmml"><mi id="S2.E7.m2.1.1.1.1.3.2.3.2" xref="S2.E7.m2.1.1.1.1.3.2.3.2.cmml">U</mi><mo id="S2.E7.m2.1.1.1.1.3.2.3.1" xref="S2.E7.m2.1.1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S2.E7.m2.1.1.1.1.3.2.3.3" xref="S2.E7.m2.1.1.1.1.3.2.3.3.cmml">Q</mi></mrow></msup><mo id="S2.E7.m2.1.1.1.1.3.1" xref="S2.E7.m2.1.1.1.1.3.1.cmml">⁢</mo><msubsup id="S2.E7.m2.1.1.1.1.3.3" xref="S2.E7.m2.1.1.1.1.3.3.cmml"><mi id="S2.E7.m2.1.1.1.1.3.3.2.2" xref="S2.E7.m2.1.1.1.1.3.3.2.2.cmml">𝐜</mi><mi id="S2.E7.m2.1.1.1.1.3.3.2.3" xref="S2.E7.m2.1.1.1.1.3.3.2.3.cmml">t</mi><mi id="S2.E7.m2.1.1.1.1.3.3.3" xref="S2.E7.m2.1.1.1.1.3.3.3.cmml">Q</mi></msubsup></mrow></mrow><mo id="S2.E7.m2.1.1.1.2" xref="S2.E7.m2.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E7.m2.1b"><apply id="S2.E7.m2.1.1.1.1.cmml" xref="S2.E7.m2.1.1.1"><eq id="S2.E7.m2.1.1.1.1.1.cmml" xref="S2.E7.m2.1.1.1.1.1"></eq><csymbol cd="latexml" id="S2.E7.m2.1.1.1.1.2.cmml" xref="S2.E7.m2.1.1.1.1.2">absent</csymbol><apply id="S2.E7.m2.1.1.1.1.3.cmml" xref="S2.E7.m2.1.1.1.1.3"><times id="S2.E7.m2.1.1.1.1.3.1.cmml" xref="S2.E7.m2.1.1.1.1.3.1"></times><apply id="S2.E7.m2.1.1.1.1.3.2.cmml" xref="S2.E7.m2.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S2.E7.m2.1.1.1.1.3.2.1.cmml" xref="S2.E7.m2.1.1.1.1.3.2">superscript</csymbol><ci id="S2.E7.m2.1.1.1.1.3.2.2.cmml" xref="S2.E7.m2.1.1.1.1.3.2.2">𝑊</ci><apply id="S2.E7.m2.1.1.1.1.3.2.3.cmml" xref="S2.E7.m2.1.1.1.1.3.2.3"><times id="S2.E7.m2.1.1.1.1.3.2.3.1.cmml" xref="S2.E7.m2.1.1.1.1.3.2.3.1"></times><ci id="S2.E7.m2.1.1.1.1.3.2.3.2.cmml" xref="S2.E7.m2.1.1.1.1.3.2.3.2">𝑈</ci><ci id="S2.E7.m2.1.1.1.1.3.2.3.3.cmml" xref="S2.E7.m2.1.1.1.1.3.2.3.3">𝑄</ci></apply></apply><apply id="S2.E7.m2.1.1.1.1.3.3.cmml" xref="S2.E7.m2.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S2.E7.m2.1.1.1.1.3.3.1.cmml" xref="S2.E7.m2.1.1.1.1.3.3">superscript</csymbol><apply id="S2.E7.m2.1.1.1.1.3.3.2.cmml" xref="S2.E7.m2.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S2.E7.m2.1.1.1.1.3.3.2.1.cmml" xref="S2.E7.m2.1.1.1.1.3.3">subscript</csymbol><ci id="S2.E7.m2.1.1.1.1.3.3.2.2.cmml" xref="S2.E7.m2.1.1.1.1.3.3.2.2">𝐜</ci><ci id="S2.E7.m2.1.1.1.1.3.3.2.3.cmml" xref="S2.E7.m2.1.1.1.1.3.3.2.3">𝑡</ci></apply><ci id="S2.E7.m2.1.1.1.1.3.3.3.cmml" xref="S2.E7.m2.1.1.1.1.3.3.3">𝑄</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E7.m2.1c">\displaystyle=W^{UQ}\mathbf{c}_{t}^{Q},</annotation><annotation encoding="application/x-llamapun" id="S2.E7.m2.1d">= italic_W start_POSTSUPERSCRIPT italic_U italic_Q end_POSTSUPERSCRIPT bold_c start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_Q end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(7)</span></td>
</tr></tbody>
<tbody id="S2.E8"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle[\mathbf{q}_{t,1}^{R};\mathbf{q}_{t,2}^{R};...;\mathbf{q}_{t,n_{h%
}}^{R}]=\mathbf{q}_{t}^{R}" class="ltx_Math" display="inline" id="S2.E8.m1.10"><semantics id="S2.E8.m1.10a"><mrow id="S2.E8.m1.10.10" xref="S2.E8.m1.10.10.cmml"><mrow id="S2.E8.m1.10.10.3.3" xref="S2.E8.m1.10.10.3.4.cmml"><mo id="S2.E8.m1.10.10.3.3.4" stretchy="false" xref="S2.E8.m1.10.10.3.4.cmml">[</mo><msubsup id="S2.E8.m1.8.8.1.1.1" xref="S2.E8.m1.8.8.1.1.1.cmml"><mi id="S2.E8.m1.8.8.1.1.1.2.2" xref="S2.E8.m1.8.8.1.1.1.2.2.cmml">𝐪</mi><mrow id="S2.E8.m1.2.2.2.4" xref="S2.E8.m1.2.2.2.3.cmml"><mi id="S2.E8.m1.1.1.1.1" xref="S2.E8.m1.1.1.1.1.cmml">t</mi><mo id="S2.E8.m1.2.2.2.4.1" xref="S2.E8.m1.2.2.2.3.cmml">,</mo><mn id="S2.E8.m1.2.2.2.2" xref="S2.E8.m1.2.2.2.2.cmml">1</mn></mrow><mi id="S2.E8.m1.8.8.1.1.1.3" xref="S2.E8.m1.8.8.1.1.1.3.cmml">R</mi></msubsup><mo id="S2.E8.m1.10.10.3.3.5" xref="S2.E8.m1.10.10.3.4.cmml">;</mo><msubsup id="S2.E8.m1.9.9.2.2.2" xref="S2.E8.m1.9.9.2.2.2.cmml"><mi id="S2.E8.m1.9.9.2.2.2.2.2" xref="S2.E8.m1.9.9.2.2.2.2.2.cmml">𝐪</mi><mrow id="S2.E8.m1.4.4.2.4" xref="S2.E8.m1.4.4.2.3.cmml"><mi id="S2.E8.m1.3.3.1.1" xref="S2.E8.m1.3.3.1.1.cmml">t</mi><mo id="S2.E8.m1.4.4.2.4.1" xref="S2.E8.m1.4.4.2.3.cmml">,</mo><mn id="S2.E8.m1.4.4.2.2" xref="S2.E8.m1.4.4.2.2.cmml">2</mn></mrow><mi id="S2.E8.m1.9.9.2.2.2.3" xref="S2.E8.m1.9.9.2.2.2.3.cmml">R</mi></msubsup><mo id="S2.E8.m1.10.10.3.3.6" xref="S2.E8.m1.10.10.3.4.cmml">;</mo><mi id="S2.E8.m1.7.7" mathvariant="normal" xref="S2.E8.m1.7.7.cmml">…</mi><mo id="S2.E8.m1.10.10.3.3.7" xref="S2.E8.m1.10.10.3.4.cmml">;</mo><msubsup id="S2.E8.m1.10.10.3.3.3" xref="S2.E8.m1.10.10.3.3.3.cmml"><mi id="S2.E8.m1.10.10.3.3.3.2.2" xref="S2.E8.m1.10.10.3.3.3.2.2.cmml">𝐪</mi><mrow id="S2.E8.m1.6.6.2.2" xref="S2.E8.m1.6.6.2.3.cmml"><mi id="S2.E8.m1.5.5.1.1" xref="S2.E8.m1.5.5.1.1.cmml">t</mi><mo id="S2.E8.m1.6.6.2.2.2" xref="S2.E8.m1.6.6.2.3.cmml">,</mo><msub id="S2.E8.m1.6.6.2.2.1" xref="S2.E8.m1.6.6.2.2.1.cmml"><mi id="S2.E8.m1.6.6.2.2.1.2" xref="S2.E8.m1.6.6.2.2.1.2.cmml">n</mi><mi id="S2.E8.m1.6.6.2.2.1.3" xref="S2.E8.m1.6.6.2.2.1.3.cmml">h</mi></msub></mrow><mi id="S2.E8.m1.10.10.3.3.3.3" xref="S2.E8.m1.10.10.3.3.3.3.cmml">R</mi></msubsup><mo id="S2.E8.m1.10.10.3.3.8" stretchy="false" xref="S2.E8.m1.10.10.3.4.cmml">]</mo></mrow><mo id="S2.E8.m1.10.10.4" xref="S2.E8.m1.10.10.4.cmml">=</mo><msubsup id="S2.E8.m1.10.10.5" xref="S2.E8.m1.10.10.5.cmml"><mi id="S2.E8.m1.10.10.5.2.2" xref="S2.E8.m1.10.10.5.2.2.cmml">𝐪</mi><mi id="S2.E8.m1.10.10.5.2.3" xref="S2.E8.m1.10.10.5.2.3.cmml">t</mi><mi id="S2.E8.m1.10.10.5.3" xref="S2.E8.m1.10.10.5.3.cmml">R</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S2.E8.m1.10b"><apply id="S2.E8.m1.10.10.cmml" xref="S2.E8.m1.10.10"><eq id="S2.E8.m1.10.10.4.cmml" xref="S2.E8.m1.10.10.4"></eq><list id="S2.E8.m1.10.10.3.4.cmml" xref="S2.E8.m1.10.10.3.3"><apply id="S2.E8.m1.8.8.1.1.1.cmml" xref="S2.E8.m1.8.8.1.1.1"><csymbol cd="ambiguous" id="S2.E8.m1.8.8.1.1.1.1.cmml" xref="S2.E8.m1.8.8.1.1.1">superscript</csymbol><apply id="S2.E8.m1.8.8.1.1.1.2.cmml" xref="S2.E8.m1.8.8.1.1.1"><csymbol cd="ambiguous" id="S2.E8.m1.8.8.1.1.1.2.1.cmml" xref="S2.E8.m1.8.8.1.1.1">subscript</csymbol><ci id="S2.E8.m1.8.8.1.1.1.2.2.cmml" xref="S2.E8.m1.8.8.1.1.1.2.2">𝐪</ci><list id="S2.E8.m1.2.2.2.3.cmml" xref="S2.E8.m1.2.2.2.4"><ci id="S2.E8.m1.1.1.1.1.cmml" xref="S2.E8.m1.1.1.1.1">𝑡</ci><cn id="S2.E8.m1.2.2.2.2.cmml" type="integer" xref="S2.E8.m1.2.2.2.2">1</cn></list></apply><ci id="S2.E8.m1.8.8.1.1.1.3.cmml" xref="S2.E8.m1.8.8.1.1.1.3">𝑅</ci></apply><apply id="S2.E8.m1.9.9.2.2.2.cmml" xref="S2.E8.m1.9.9.2.2.2"><csymbol cd="ambiguous" id="S2.E8.m1.9.9.2.2.2.1.cmml" xref="S2.E8.m1.9.9.2.2.2">superscript</csymbol><apply id="S2.E8.m1.9.9.2.2.2.2.cmml" xref="S2.E8.m1.9.9.2.2.2"><csymbol cd="ambiguous" id="S2.E8.m1.9.9.2.2.2.2.1.cmml" xref="S2.E8.m1.9.9.2.2.2">subscript</csymbol><ci id="S2.E8.m1.9.9.2.2.2.2.2.cmml" xref="S2.E8.m1.9.9.2.2.2.2.2">𝐪</ci><list id="S2.E8.m1.4.4.2.3.cmml" xref="S2.E8.m1.4.4.2.4"><ci id="S2.E8.m1.3.3.1.1.cmml" xref="S2.E8.m1.3.3.1.1">𝑡</ci><cn id="S2.E8.m1.4.4.2.2.cmml" type="integer" xref="S2.E8.m1.4.4.2.2">2</cn></list></apply><ci id="S2.E8.m1.9.9.2.2.2.3.cmml" xref="S2.E8.m1.9.9.2.2.2.3">𝑅</ci></apply><ci id="S2.E8.m1.7.7.cmml" xref="S2.E8.m1.7.7">…</ci><apply id="S2.E8.m1.10.10.3.3.3.cmml" xref="S2.E8.m1.10.10.3.3.3"><csymbol cd="ambiguous" id="S2.E8.m1.10.10.3.3.3.1.cmml" xref="S2.E8.m1.10.10.3.3.3">superscript</csymbol><apply id="S2.E8.m1.10.10.3.3.3.2.cmml" xref="S2.E8.m1.10.10.3.3.3"><csymbol cd="ambiguous" id="S2.E8.m1.10.10.3.3.3.2.1.cmml" xref="S2.E8.m1.10.10.3.3.3">subscript</csymbol><ci id="S2.E8.m1.10.10.3.3.3.2.2.cmml" xref="S2.E8.m1.10.10.3.3.3.2.2">𝐪</ci><list id="S2.E8.m1.6.6.2.3.cmml" xref="S2.E8.m1.6.6.2.2"><ci id="S2.E8.m1.5.5.1.1.cmml" xref="S2.E8.m1.5.5.1.1">𝑡</ci><apply id="S2.E8.m1.6.6.2.2.1.cmml" xref="S2.E8.m1.6.6.2.2.1"><csymbol cd="ambiguous" id="S2.E8.m1.6.6.2.2.1.1.cmml" xref="S2.E8.m1.6.6.2.2.1">subscript</csymbol><ci id="S2.E8.m1.6.6.2.2.1.2.cmml" xref="S2.E8.m1.6.6.2.2.1.2">𝑛</ci><ci id="S2.E8.m1.6.6.2.2.1.3.cmml" xref="S2.E8.m1.6.6.2.2.1.3">ℎ</ci></apply></list></apply><ci id="S2.E8.m1.10.10.3.3.3.3.cmml" xref="S2.E8.m1.10.10.3.3.3.3">𝑅</ci></apply></list><apply id="S2.E8.m1.10.10.5.cmml" xref="S2.E8.m1.10.10.5"><csymbol cd="ambiguous" id="S2.E8.m1.10.10.5.1.cmml" xref="S2.E8.m1.10.10.5">superscript</csymbol><apply id="S2.E8.m1.10.10.5.2.cmml" xref="S2.E8.m1.10.10.5"><csymbol cd="ambiguous" id="S2.E8.m1.10.10.5.2.1.cmml" xref="S2.E8.m1.10.10.5">subscript</csymbol><ci id="S2.E8.m1.10.10.5.2.2.cmml" xref="S2.E8.m1.10.10.5.2.2">𝐪</ci><ci id="S2.E8.m1.10.10.5.2.3.cmml" xref="S2.E8.m1.10.10.5.2.3">𝑡</ci></apply><ci id="S2.E8.m1.10.10.5.3.cmml" xref="S2.E8.m1.10.10.5.3">𝑅</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E8.m1.10c">\displaystyle[\mathbf{q}_{t,1}^{R};\mathbf{q}_{t,2}^{R};...;\mathbf{q}_{t,n_{h%
}}^{R}]=\mathbf{q}_{t}^{R}</annotation><annotation encoding="application/x-llamapun" id="S2.E8.m1.10d">[ bold_q start_POSTSUBSCRIPT italic_t , 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT ; bold_q start_POSTSUBSCRIPT italic_t , 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT ; … ; bold_q start_POSTSUBSCRIPT italic_t , italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT ] = bold_q start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\operatorname{RoPE}({W^{QR}}\mathbf{c}_{t}^{Q})," class="ltx_Math" display="inline" id="S2.E8.m2.2"><semantics id="S2.E8.m2.2a"><mrow id="S2.E8.m2.2.2.1" xref="S2.E8.m2.2.2.1.1.cmml"><mrow id="S2.E8.m2.2.2.1.1" xref="S2.E8.m2.2.2.1.1.cmml"><mi id="S2.E8.m2.2.2.1.1.3" xref="S2.E8.m2.2.2.1.1.3.cmml"></mi><mo id="S2.E8.m2.2.2.1.1.2" xref="S2.E8.m2.2.2.1.1.2.cmml">=</mo><mrow id="S2.E8.m2.2.2.1.1.1.1" xref="S2.E8.m2.2.2.1.1.1.2.cmml"><mi id="S2.E8.m2.1.1" xref="S2.E8.m2.1.1.cmml">RoPE</mi><mo id="S2.E8.m2.2.2.1.1.1.1a" xref="S2.E8.m2.2.2.1.1.1.2.cmml">⁡</mo><mrow id="S2.E8.m2.2.2.1.1.1.1.1" xref="S2.E8.m2.2.2.1.1.1.2.cmml"><mo id="S2.E8.m2.2.2.1.1.1.1.1.2" stretchy="false" xref="S2.E8.m2.2.2.1.1.1.2.cmml">(</mo><mrow id="S2.E8.m2.2.2.1.1.1.1.1.1" xref="S2.E8.m2.2.2.1.1.1.1.1.1.cmml"><msup id="S2.E8.m2.2.2.1.1.1.1.1.1.2" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2.cmml"><mi id="S2.E8.m2.2.2.1.1.1.1.1.1.2.2" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2.2.cmml">W</mi><mrow id="S2.E8.m2.2.2.1.1.1.1.1.1.2.3" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.cmml"><mi id="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.2" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.2.cmml">Q</mi><mo id="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.1" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.3" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.3.cmml">R</mi></mrow></msup><mo id="S2.E8.m2.2.2.1.1.1.1.1.1.1" xref="S2.E8.m2.2.2.1.1.1.1.1.1.1.cmml">⁢</mo><msubsup id="S2.E8.m2.2.2.1.1.1.1.1.1.3" xref="S2.E8.m2.2.2.1.1.1.1.1.1.3.cmml"><mi id="S2.E8.m2.2.2.1.1.1.1.1.1.3.2.2" xref="S2.E8.m2.2.2.1.1.1.1.1.1.3.2.2.cmml">𝐜</mi><mi id="S2.E8.m2.2.2.1.1.1.1.1.1.3.2.3" xref="S2.E8.m2.2.2.1.1.1.1.1.1.3.2.3.cmml">t</mi><mi id="S2.E8.m2.2.2.1.1.1.1.1.1.3.3" xref="S2.E8.m2.2.2.1.1.1.1.1.1.3.3.cmml">Q</mi></msubsup></mrow><mo id="S2.E8.m2.2.2.1.1.1.1.1.3" stretchy="false" xref="S2.E8.m2.2.2.1.1.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E8.m2.2.2.1.2" xref="S2.E8.m2.2.2.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E8.m2.2b"><apply id="S2.E8.m2.2.2.1.1.cmml" xref="S2.E8.m2.2.2.1"><eq id="S2.E8.m2.2.2.1.1.2.cmml" xref="S2.E8.m2.2.2.1.1.2"></eq><csymbol cd="latexml" id="S2.E8.m2.2.2.1.1.3.cmml" xref="S2.E8.m2.2.2.1.1.3">absent</csymbol><apply id="S2.E8.m2.2.2.1.1.1.2.cmml" xref="S2.E8.m2.2.2.1.1.1.1"><ci id="S2.E8.m2.1.1.cmml" xref="S2.E8.m2.1.1">RoPE</ci><apply id="S2.E8.m2.2.2.1.1.1.1.1.1.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1"><times id="S2.E8.m2.2.2.1.1.1.1.1.1.1.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.1"></times><apply id="S2.E8.m2.2.2.1.1.1.1.1.1.2.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E8.m2.2.2.1.1.1.1.1.1.2.1.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2">superscript</csymbol><ci id="S2.E8.m2.2.2.1.1.1.1.1.1.2.2.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2.2">𝑊</ci><apply id="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2.3"><times id="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.1.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.1"></times><ci id="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.2.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.2">𝑄</ci><ci id="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.3.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.2.3.3">𝑅</ci></apply></apply><apply id="S2.E8.m2.2.2.1.1.1.1.1.1.3.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E8.m2.2.2.1.1.1.1.1.1.3.1.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.3">superscript</csymbol><apply id="S2.E8.m2.2.2.1.1.1.1.1.1.3.2.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E8.m2.2.2.1.1.1.1.1.1.3.2.1.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.3">subscript</csymbol><ci id="S2.E8.m2.2.2.1.1.1.1.1.1.3.2.2.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.3.2.2">𝐜</ci><ci id="S2.E8.m2.2.2.1.1.1.1.1.1.3.2.3.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.3.2.3">𝑡</ci></apply><ci id="S2.E8.m2.2.2.1.1.1.1.1.1.3.3.cmml" xref="S2.E8.m2.2.2.1.1.1.1.1.1.3.3">𝑄</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E8.m2.2c">\displaystyle=\operatorname{RoPE}({W^{QR}}\mathbf{c}_{t}^{Q}),</annotation><annotation encoding="application/x-llamapun" id="S2.E8.m2.2d">= roman_RoPE ( italic_W start_POSTSUPERSCRIPT italic_Q italic_R end_POSTSUPERSCRIPT bold_c start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_Q end_POSTSUPERSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(8)</span></td>
</tr></tbody>
<tbody id="S2.E9"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathbf{q}_{t,i}" class="ltx_Math" display="inline" id="S2.E9.m1.2"><semantics id="S2.E9.m1.2a"><msub id="S2.E9.m1.2.3" xref="S2.E9.m1.2.3.cmml"><mi id="S2.E9.m1.2.3.2" xref="S2.E9.m1.2.3.2.cmml">𝐪</mi><mrow id="S2.E9.m1.2.2.2.4" xref="S2.E9.m1.2.2.2.3.cmml"><mi id="S2.E9.m1.1.1.1.1" xref="S2.E9.m1.1.1.1.1.cmml">t</mi><mo id="S2.E9.m1.2.2.2.4.1" xref="S2.E9.m1.2.2.2.3.cmml">,</mo><mi id="S2.E9.m1.2.2.2.2" xref="S2.E9.m1.2.2.2.2.cmml">i</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.E9.m1.2b"><apply id="S2.E9.m1.2.3.cmml" xref="S2.E9.m1.2.3"><csymbol cd="ambiguous" id="S2.E9.m1.2.3.1.cmml" xref="S2.E9.m1.2.3">subscript</csymbol><ci id="S2.E9.m1.2.3.2.cmml" xref="S2.E9.m1.2.3.2">𝐪</ci><list id="S2.E9.m1.2.2.2.3.cmml" xref="S2.E9.m1.2.2.2.4"><ci id="S2.E9.m1.1.1.1.1.cmml" xref="S2.E9.m1.1.1.1.1">𝑡</ci><ci id="S2.E9.m1.2.2.2.2.cmml" xref="S2.E9.m1.2.2.2.2">𝑖</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E9.m1.2c">\displaystyle\mathbf{q}_{t,i}</annotation><annotation encoding="application/x-llamapun" id="S2.E9.m1.2d">bold_q start_POSTSUBSCRIPT italic_t , italic_i end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=[\mathbf{q}_{t,i}^{C};\mathbf{q}_{t,i}^{R}]," class="ltx_Math" display="inline" id="S2.E9.m2.5"><semantics id="S2.E9.m2.5a"><mrow id="S2.E9.m2.5.5.1" xref="S2.E9.m2.5.5.1.1.cmml"><mrow id="S2.E9.m2.5.5.1.1" xref="S2.E9.m2.5.5.1.1.cmml"><mi id="S2.E9.m2.5.5.1.1.4" xref="S2.E9.m2.5.5.1.1.4.cmml"></mi><mo id="S2.E9.m2.5.5.1.1.3" xref="S2.E9.m2.5.5.1.1.3.cmml">=</mo><mrow id="S2.E9.m2.5.5.1.1.2.2" xref="S2.E9.m2.5.5.1.1.2.3.cmml"><mo id="S2.E9.m2.5.5.1.1.2.2.3" stretchy="false" xref="S2.E9.m2.5.5.1.1.2.3.cmml">[</mo><msubsup id="S2.E9.m2.5.5.1.1.1.1.1" xref="S2.E9.m2.5.5.1.1.1.1.1.cmml"><mi id="S2.E9.m2.5.5.1.1.1.1.1.2.2" xref="S2.E9.m2.5.5.1.1.1.1.1.2.2.cmml">𝐪</mi><mrow id="S2.E9.m2.2.2.2.4" xref="S2.E9.m2.2.2.2.3.cmml"><mi id="S2.E9.m2.1.1.1.1" xref="S2.E9.m2.1.1.1.1.cmml">t</mi><mo id="S2.E9.m2.2.2.2.4.1" xref="S2.E9.m2.2.2.2.3.cmml">,</mo><mi id="S2.E9.m2.2.2.2.2" xref="S2.E9.m2.2.2.2.2.cmml">i</mi></mrow><mi id="S2.E9.m2.5.5.1.1.1.1.1.3" xref="S2.E9.m2.5.5.1.1.1.1.1.3.cmml">C</mi></msubsup><mo id="S2.E9.m2.5.5.1.1.2.2.4" xref="S2.E9.m2.5.5.1.1.2.3.cmml">;</mo><msubsup id="S2.E9.m2.5.5.1.1.2.2.2" xref="S2.E9.m2.5.5.1.1.2.2.2.cmml"><mi id="S2.E9.m2.5.5.1.1.2.2.2.2.2" xref="S2.E9.m2.5.5.1.1.2.2.2.2.2.cmml">𝐪</mi><mrow id="S2.E9.m2.4.4.2.4" xref="S2.E9.m2.4.4.2.3.cmml"><mi id="S2.E9.m2.3.3.1.1" xref="S2.E9.m2.3.3.1.1.cmml">t</mi><mo id="S2.E9.m2.4.4.2.4.1" xref="S2.E9.m2.4.4.2.3.cmml">,</mo><mi id="S2.E9.m2.4.4.2.2" xref="S2.E9.m2.4.4.2.2.cmml">i</mi></mrow><mi id="S2.E9.m2.5.5.1.1.2.2.2.3" xref="S2.E9.m2.5.5.1.1.2.2.2.3.cmml">R</mi></msubsup><mo id="S2.E9.m2.5.5.1.1.2.2.5" stretchy="false" xref="S2.E9.m2.5.5.1.1.2.3.cmml">]</mo></mrow></mrow><mo id="S2.E9.m2.5.5.1.2" xref="S2.E9.m2.5.5.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E9.m2.5b"><apply id="S2.E9.m2.5.5.1.1.cmml" xref="S2.E9.m2.5.5.1"><eq id="S2.E9.m2.5.5.1.1.3.cmml" xref="S2.E9.m2.5.5.1.1.3"></eq><csymbol cd="latexml" id="S2.E9.m2.5.5.1.1.4.cmml" xref="S2.E9.m2.5.5.1.1.4">absent</csymbol><list id="S2.E9.m2.5.5.1.1.2.3.cmml" xref="S2.E9.m2.5.5.1.1.2.2"><apply id="S2.E9.m2.5.5.1.1.1.1.1.cmml" xref="S2.E9.m2.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E9.m2.5.5.1.1.1.1.1.1.cmml" xref="S2.E9.m2.5.5.1.1.1.1.1">superscript</csymbol><apply id="S2.E9.m2.5.5.1.1.1.1.1.2.cmml" xref="S2.E9.m2.5.5.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E9.m2.5.5.1.1.1.1.1.2.1.cmml" xref="S2.E9.m2.5.5.1.1.1.1.1">subscript</csymbol><ci id="S2.E9.m2.5.5.1.1.1.1.1.2.2.cmml" xref="S2.E9.m2.5.5.1.1.1.1.1.2.2">𝐪</ci><list id="S2.E9.m2.2.2.2.3.cmml" xref="S2.E9.m2.2.2.2.4"><ci id="S2.E9.m2.1.1.1.1.cmml" xref="S2.E9.m2.1.1.1.1">𝑡</ci><ci id="S2.E9.m2.2.2.2.2.cmml" xref="S2.E9.m2.2.2.2.2">𝑖</ci></list></apply><ci id="S2.E9.m2.5.5.1.1.1.1.1.3.cmml" xref="S2.E9.m2.5.5.1.1.1.1.1.3">𝐶</ci></apply><apply id="S2.E9.m2.5.5.1.1.2.2.2.cmml" xref="S2.E9.m2.5.5.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E9.m2.5.5.1.1.2.2.2.1.cmml" xref="S2.E9.m2.5.5.1.1.2.2.2">superscript</csymbol><apply id="S2.E9.m2.5.5.1.1.2.2.2.2.cmml" xref="S2.E9.m2.5.5.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E9.m2.5.5.1.1.2.2.2.2.1.cmml" xref="S2.E9.m2.5.5.1.1.2.2.2">subscript</csymbol><ci id="S2.E9.m2.5.5.1.1.2.2.2.2.2.cmml" xref="S2.E9.m2.5.5.1.1.2.2.2.2.2">𝐪</ci><list id="S2.E9.m2.4.4.2.3.cmml" xref="S2.E9.m2.4.4.2.4"><ci id="S2.E9.m2.3.3.1.1.cmml" xref="S2.E9.m2.3.3.1.1">𝑡</ci><ci id="S2.E9.m2.4.4.2.2.cmml" xref="S2.E9.m2.4.4.2.2">𝑖</ci></list></apply><ci id="S2.E9.m2.5.5.1.1.2.2.2.3.cmml" xref="S2.E9.m2.5.5.1.1.2.2.2.3">𝑅</ci></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E9.m2.5c">\displaystyle=[\mathbf{q}_{t,i}^{C};\mathbf{q}_{t,i}^{R}],</annotation><annotation encoding="application/x-llamapun" id="S2.E9.m2.5d">= [ bold_q start_POSTSUBSCRIPT italic_t , italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ; bold_q start_POSTSUBSCRIPT italic_t , italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT ] ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(9)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS1.SSS1.p2.4">where <math alttext="\mathbf{c}_{t}^{Q}\in\mathbb{R}^{d_{c}^{\prime}}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p2.1.m1.1"><semantics id="S2.SS1.SSS1.p2.1.m1.1a"><mrow id="S2.SS1.SSS1.p2.1.m1.1.1" xref="S2.SS1.SSS1.p2.1.m1.1.1.cmml"><msubsup id="S2.SS1.SSS1.p2.1.m1.1.1.2" xref="S2.SS1.SSS1.p2.1.m1.1.1.2.cmml"><mi id="S2.SS1.SSS1.p2.1.m1.1.1.2.2.2" xref="S2.SS1.SSS1.p2.1.m1.1.1.2.2.2.cmml">𝐜</mi><mi id="S2.SS1.SSS1.p2.1.m1.1.1.2.2.3" xref="S2.SS1.SSS1.p2.1.m1.1.1.2.2.3.cmml">t</mi><mi id="S2.SS1.SSS1.p2.1.m1.1.1.2.3" xref="S2.SS1.SSS1.p2.1.m1.1.1.2.3.cmml">Q</mi></msubsup><mo id="S2.SS1.SSS1.p2.1.m1.1.1.1" xref="S2.SS1.SSS1.p2.1.m1.1.1.1.cmml">∈</mo><msup id="S2.SS1.SSS1.p2.1.m1.1.1.3" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.cmml"><mi id="S2.SS1.SSS1.p2.1.m1.1.1.3.2" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.2.cmml">ℝ</mi><msubsup id="S2.SS1.SSS1.p2.1.m1.1.1.3.3" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.3.cmml"><mi id="S2.SS1.SSS1.p2.1.m1.1.1.3.3.2.2" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.3.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p2.1.m1.1.1.3.3.2.3" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.3.2.3.cmml">c</mi><mo id="S2.SS1.SSS1.p2.1.m1.1.1.3.3.3" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.3.3.cmml">′</mo></msubsup></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p2.1.m1.1b"><apply id="S2.SS1.SSS1.p2.1.m1.1.1.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1"><in id="S2.SS1.SSS1.p2.1.m1.1.1.1.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.1"></in><apply id="S2.SS1.SSS1.p2.1.m1.1.1.2.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.1.m1.1.1.2.1.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.2">superscript</csymbol><apply id="S2.SS1.SSS1.p2.1.m1.1.1.2.2.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.1.m1.1.1.2.2.1.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.2">subscript</csymbol><ci id="S2.SS1.SSS1.p2.1.m1.1.1.2.2.2.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.2.2.2">𝐜</ci><ci id="S2.SS1.SSS1.p2.1.m1.1.1.2.2.3.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.2.2.3">𝑡</ci></apply><ci id="S2.SS1.SSS1.p2.1.m1.1.1.2.3.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.2.3">𝑄</ci></apply><apply id="S2.SS1.SSS1.p2.1.m1.1.1.3.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.1.m1.1.1.3.1.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.3">superscript</csymbol><ci id="S2.SS1.SSS1.p2.1.m1.1.1.3.2.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.2">ℝ</ci><apply id="S2.SS1.SSS1.p2.1.m1.1.1.3.3.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.1.m1.1.1.3.3.1.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.3">superscript</csymbol><apply id="S2.SS1.SSS1.p2.1.m1.1.1.3.3.2.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.1.m1.1.1.3.3.2.1.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.3">subscript</csymbol><ci id="S2.SS1.SSS1.p2.1.m1.1.1.3.3.2.2.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.3.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p2.1.m1.1.1.3.3.2.3.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.3.2.3">𝑐</ci></apply><ci id="S2.SS1.SSS1.p2.1.m1.1.1.3.3.3.cmml" xref="S2.SS1.SSS1.p2.1.m1.1.1.3.3.3">′</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p2.1.m1.1c">\mathbf{c}_{t}^{Q}\in\mathbb{R}^{d_{c}^{\prime}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p2.1.m1.1d">bold_c start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_Q end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> is the compressed latent vector for queries;
<math alttext="d_{c}^{\prime}(\ll d_{h}n_{h})" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p2.2.m2.1"><semantics id="S2.SS1.SSS1.p2.2.m2.1a"><mrow id="S2.SS1.SSS1.p2.2.m2.1.1" xref="S2.SS1.SSS1.p2.2.m2.1.1.cmml"><msubsup id="S2.SS1.SSS1.p2.2.m2.1.1.3" xref="S2.SS1.SSS1.p2.2.m2.1.1.3.cmml"><mi id="S2.SS1.SSS1.p2.2.m2.1.1.3.2.2" xref="S2.SS1.SSS1.p2.2.m2.1.1.3.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p2.2.m2.1.1.3.2.3" xref="S2.SS1.SSS1.p2.2.m2.1.1.3.2.3.cmml">c</mi><mo id="S2.SS1.SSS1.p2.2.m2.1.1.3.3" xref="S2.SS1.SSS1.p2.2.m2.1.1.3.3.cmml">′</mo></msubsup><mspace id="S2.SS1.SSS1.p2.2.m2.1.1a" width="0.3888888888888889em" xref="S2.SS1.SSS1.p2.2.m2.1.1.cmml"></mspace><mrow id="S2.SS1.SSS1.p2.2.m2.1.1.1.1" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.cmml"><mo id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.2" stretchy="false" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.cmml">(</mo><mrow id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.cmml"><mi id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.2" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.2.cmml"></mi><mo id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.1" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.1.cmml">≪</mo><mrow id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.cmml"><msub id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2.cmml"><mi id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2.2" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2.3" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2.3.cmml">h</mi></msub><mo id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.1" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.1.cmml">⁢</mo><msub id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3.cmml"><mi id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3.2" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3.2.cmml">n</mi><mi id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3.3" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3.3.cmml">h</mi></msub></mrow></mrow><mo id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.3" stretchy="false" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p2.2.m2.1b"><apply id="S2.SS1.SSS1.p2.2.m2.1.1.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1"><csymbol cd="latexml" id="S2.SS1.SSS1.p2.2.m2.1.1.2.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1">annotated</csymbol><apply id="S2.SS1.SSS1.p2.2.m2.1.1.3.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.2.m2.1.1.3.1.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.3">superscript</csymbol><apply id="S2.SS1.SSS1.p2.2.m2.1.1.3.2.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.2.m2.1.1.3.2.1.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.3">subscript</csymbol><ci id="S2.SS1.SSS1.p2.2.m2.1.1.3.2.2.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.3.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p2.2.m2.1.1.3.2.3.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.3.2.3">𝑐</ci></apply><ci id="S2.SS1.SSS1.p2.2.m2.1.1.3.3.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.3.3">′</ci></apply><apply id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1"><csymbol cd="latexml" id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.1.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.1">much-less-than</csymbol><csymbol cd="latexml" id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.2.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.2">absent</csymbol><apply id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3"><times id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.1.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.1"></times><apply id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2.1.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2">subscript</csymbol><ci id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2.2.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2.3.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.2.3">ℎ</ci></apply><apply id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3.1.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3">subscript</csymbol><ci id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3.2.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3.2">𝑛</ci><ci id="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3.3.cmml" xref="S2.SS1.SSS1.p2.2.m2.1.1.1.1.1.3.3.3">ℎ</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p2.2.m2.1c">d_{c}^{\prime}(\ll d_{h}n_{h})</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p2.2.m2.1d">italic_d start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( ≪ italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT )</annotation></semantics></math> denotes the query compression dimension;
<math alttext="W^{DQ}\in\mathbb{R}^{d_{c}^{\prime}\times d},W^{UQ}\in\mathbb{R}^{d_{h}n_{h}%
\times d_{c}^{\prime}}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p2.3.m3.2"><semantics id="S2.SS1.SSS1.p2.3.m3.2a"><mrow id="S2.SS1.SSS1.p2.3.m3.2.2.2" xref="S2.SS1.SSS1.p2.3.m3.2.2.3.cmml"><mrow id="S2.SS1.SSS1.p2.3.m3.1.1.1.1" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.cmml"><msup id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.cmml"><mi id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.2" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.2.cmml">W</mi><mrow id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.cmml"><mi id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.2" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.2.cmml">D</mi><mo id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.1" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.1.cmml">⁢</mo><mi id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.3" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.3.cmml">Q</mi></mrow></msup><mo id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.1" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.1.cmml">∈</mo><msup id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.cmml"><mi id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.2" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.2.cmml">ℝ</mi><mrow id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.cmml"><msubsup id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.cmml"><mi id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.2.2" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.2.3" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.2.3.cmml">c</mi><mo id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.3" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.3.cmml">′</mo></msubsup><mo id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.1.cmml">×</mo><mi id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.3" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.3.cmml">d</mi></mrow></msup></mrow><mo id="S2.SS1.SSS1.p2.3.m3.2.2.2.3" xref="S2.SS1.SSS1.p2.3.m3.2.2.3a.cmml">,</mo><mrow id="S2.SS1.SSS1.p2.3.m3.2.2.2.2" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.cmml"><msup id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.cmml"><mi id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.2" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.2.cmml">W</mi><mrow id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.cmml"><mi id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.2" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.2.cmml">U</mi><mo id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.1" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.1.cmml">⁢</mo><mi id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.3" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.3.cmml">Q</mi></mrow></msup><mo id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.1" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.1.cmml">∈</mo><msup id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.cmml"><mi id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.2" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.2.cmml">ℝ</mi><mrow id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.cmml"><mrow id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.cmml"><msub id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2.cmml"><mi id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2.2" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2.3" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2.3.cmml">h</mi></msub><mo id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.1" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.1.cmml">⁢</mo><msub id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3.cmml"><mi id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3.2" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3.2.cmml">n</mi><mi id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3.3" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3.3.cmml">h</mi></msub></mrow><mo id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.1" lspace="0.222em" rspace="0.222em" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.1.cmml">×</mo><msubsup id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.cmml"><mi id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.2.2" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.2.3" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.2.3.cmml">c</mi><mo id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.3" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.3.cmml">′</mo></msubsup></mrow></msup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p2.3.m3.2b"><apply id="S2.SS1.SSS1.p2.3.m3.2.2.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.3.m3.2.2.3a.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.3">formulae-sequence</csymbol><apply id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1"><in id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.1"></in><apply id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2">superscript</csymbol><ci id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.2">𝑊</ci><apply id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3"><times id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.1"></times><ci id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.2">𝐷</ci><ci id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.2.3.3">𝑄</ci></apply></apply><apply id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3">superscript</csymbol><ci id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.2">ℝ</ci><apply id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3"><times id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.1"></times><apply id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2">superscript</csymbol><apply id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.2.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2">subscript</csymbol><ci id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.2.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.2.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.2.3">𝑐</ci></apply><ci id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.2.3">′</ci></apply><ci id="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.1.1.1.1.3.3.3">𝑑</ci></apply></apply></apply><apply id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2"><in id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.1"></in><apply id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2">superscript</csymbol><ci id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.2">𝑊</ci><apply id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3"><times id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.1"></times><ci id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.2">𝑈</ci><ci id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.2.3.3">𝑄</ci></apply></apply><apply id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3">superscript</csymbol><ci id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.2">ℝ</ci><apply id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3"><times id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.1"></times><apply id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2"><times id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.1"></times><apply id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2">subscript</csymbol><ci id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.2.3">ℎ</ci></apply><apply id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3">subscript</csymbol><ci id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3.2">𝑛</ci><ci id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.2.3.3">ℎ</ci></apply></apply><apply id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3">superscript</csymbol><apply id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.2.1.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3">subscript</csymbol><ci id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.2.2.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.2.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.2.3">𝑐</ci></apply><ci id="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.3.cmml" xref="S2.SS1.SSS1.p2.3.m3.2.2.2.2.3.3.3.3">′</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p2.3.m3.2c">W^{DQ}\in\mathbb{R}^{d_{c}^{\prime}\times d},W^{UQ}\in\mathbb{R}^{d_{h}n_{h}%
\times d_{c}^{\prime}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p2.3.m3.2d">italic_W start_POSTSUPERSCRIPT italic_D italic_Q end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT × italic_d end_POSTSUPERSCRIPT , italic_W start_POSTSUPERSCRIPT italic_U italic_Q end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT × italic_d start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> are the down-projection and up-projection matrices for queries, respectively;
and <math alttext="W^{QR}\in\mathbb{R}^{d_{h}^{R}n_{h}\times d_{c}^{\prime}}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p2.4.m4.1"><semantics id="S2.SS1.SSS1.p2.4.m4.1a"><mrow id="S2.SS1.SSS1.p2.4.m4.1.1" xref="S2.SS1.SSS1.p2.4.m4.1.1.cmml"><msup id="S2.SS1.SSS1.p2.4.m4.1.1.2" xref="S2.SS1.SSS1.p2.4.m4.1.1.2.cmml"><mi id="S2.SS1.SSS1.p2.4.m4.1.1.2.2" xref="S2.SS1.SSS1.p2.4.m4.1.1.2.2.cmml">W</mi><mrow id="S2.SS1.SSS1.p2.4.m4.1.1.2.3" xref="S2.SS1.SSS1.p2.4.m4.1.1.2.3.cmml"><mi id="S2.SS1.SSS1.p2.4.m4.1.1.2.3.2" xref="S2.SS1.SSS1.p2.4.m4.1.1.2.3.2.cmml">Q</mi><mo id="S2.SS1.SSS1.p2.4.m4.1.1.2.3.1" xref="S2.SS1.SSS1.p2.4.m4.1.1.2.3.1.cmml">⁢</mo><mi id="S2.SS1.SSS1.p2.4.m4.1.1.2.3.3" xref="S2.SS1.SSS1.p2.4.m4.1.1.2.3.3.cmml">R</mi></mrow></msup><mo id="S2.SS1.SSS1.p2.4.m4.1.1.1" xref="S2.SS1.SSS1.p2.4.m4.1.1.1.cmml">∈</mo><msup id="S2.SS1.SSS1.p2.4.m4.1.1.3" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.cmml"><mi id="S2.SS1.SSS1.p2.4.m4.1.1.3.2" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.2.cmml">ℝ</mi><mrow id="S2.SS1.SSS1.p2.4.m4.1.1.3.3" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.cmml"><mrow id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.cmml"><msubsup id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.cmml"><mi id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.2.2" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.2.3" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.2.3.cmml">h</mi><mi id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.3" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.3.cmml">R</mi></msubsup><mo id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.1" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.1.cmml">⁢</mo><msub id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3.cmml"><mi id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3.2" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3.2.cmml">n</mi><mi id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3.3" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3.3.cmml">h</mi></msub></mrow><mo id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.1" lspace="0.222em" rspace="0.222em" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.1.cmml">×</mo><msubsup id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.cmml"><mi id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.2.2" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.2.2.cmml">d</mi><mi id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.2.3" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.2.3.cmml">c</mi><mo id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.3" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.3.cmml">′</mo></msubsup></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p2.4.m4.1b"><apply id="S2.SS1.SSS1.p2.4.m4.1.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1"><in id="S2.SS1.SSS1.p2.4.m4.1.1.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.1"></in><apply id="S2.SS1.SSS1.p2.4.m4.1.1.2.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.4.m4.1.1.2.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.2">superscript</csymbol><ci id="S2.SS1.SSS1.p2.4.m4.1.1.2.2.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.2.2">𝑊</ci><apply id="S2.SS1.SSS1.p2.4.m4.1.1.2.3.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.2.3"><times id="S2.SS1.SSS1.p2.4.m4.1.1.2.3.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.2.3.1"></times><ci id="S2.SS1.SSS1.p2.4.m4.1.1.2.3.2.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.2.3.2">𝑄</ci><ci id="S2.SS1.SSS1.p2.4.m4.1.1.2.3.3.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.2.3.3">𝑅</ci></apply></apply><apply id="S2.SS1.SSS1.p2.4.m4.1.1.3.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.4.m4.1.1.3.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3">superscript</csymbol><ci id="S2.SS1.SSS1.p2.4.m4.1.1.3.2.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.2">ℝ</ci><apply id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3"><times id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.1"></times><apply id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2"><times id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.1"></times><apply id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2">superscript</csymbol><apply id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.2.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.2.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2">subscript</csymbol><ci id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.2.2.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.2.3.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.2.3">ℎ</ci></apply><ci id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.3.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.2.3">𝑅</ci></apply><apply id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3">subscript</csymbol><ci id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3.2.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3.2">𝑛</ci><ci id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3.3.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.2.3.3">ℎ</ci></apply></apply><apply id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3">superscript</csymbol><apply id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.2.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.2.1.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3">subscript</csymbol><ci id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.2.2.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.2.2">𝑑</ci><ci id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.2.3.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.2.3">𝑐</ci></apply><ci id="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.3.cmml" xref="S2.SS1.SSS1.p2.4.m4.1.1.3.3.3.3">′</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p2.4.m4.1c">W^{QR}\in\mathbb{R}^{d_{h}^{R}n_{h}\times d_{c}^{\prime}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p2.4.m4.1d">italic_W start_POSTSUPERSCRIPT italic_Q italic_R end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT × italic_d start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> is the matrix to produce the decoupled queries that carry RoPE.</p>
</div>
<div class="ltx_para" id="S2.SS1.SSS1.p3">
<p class="ltx_p" id="S2.SS1.SSS1.p3.4">Ultimately, the attention queries (<math alttext="\mathbf{q}_{t,i}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p3.1.m1.2"><semantics id="S2.SS1.SSS1.p3.1.m1.2a"><msub id="S2.SS1.SSS1.p3.1.m1.2.3" xref="S2.SS1.SSS1.p3.1.m1.2.3.cmml"><mi id="S2.SS1.SSS1.p3.1.m1.2.3.2" xref="S2.SS1.SSS1.p3.1.m1.2.3.2.cmml">𝐪</mi><mrow id="S2.SS1.SSS1.p3.1.m1.2.2.2.4" xref="S2.SS1.SSS1.p3.1.m1.2.2.2.3.cmml"><mi id="S2.SS1.SSS1.p3.1.m1.1.1.1.1" xref="S2.SS1.SSS1.p3.1.m1.1.1.1.1.cmml">t</mi><mo id="S2.SS1.SSS1.p3.1.m1.2.2.2.4.1" xref="S2.SS1.SSS1.p3.1.m1.2.2.2.3.cmml">,</mo><mi id="S2.SS1.SSS1.p3.1.m1.2.2.2.2" xref="S2.SS1.SSS1.p3.1.m1.2.2.2.2.cmml">i</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p3.1.m1.2b"><apply id="S2.SS1.SSS1.p3.1.m1.2.3.cmml" xref="S2.SS1.SSS1.p3.1.m1.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p3.1.m1.2.3.1.cmml" xref="S2.SS1.SSS1.p3.1.m1.2.3">subscript</csymbol><ci id="S2.SS1.SSS1.p3.1.m1.2.3.2.cmml" xref="S2.SS1.SSS1.p3.1.m1.2.3.2">𝐪</ci><list id="S2.SS1.SSS1.p3.1.m1.2.2.2.3.cmml" xref="S2.SS1.SSS1.p3.1.m1.2.2.2.4"><ci id="S2.SS1.SSS1.p3.1.m1.1.1.1.1.cmml" xref="S2.SS1.SSS1.p3.1.m1.1.1.1.1">𝑡</ci><ci id="S2.SS1.SSS1.p3.1.m1.2.2.2.2.cmml" xref="S2.SS1.SSS1.p3.1.m1.2.2.2.2">𝑖</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p3.1.m1.2c">\mathbf{q}_{t,i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p3.1.m1.2d">bold_q start_POSTSUBSCRIPT italic_t , italic_i end_POSTSUBSCRIPT</annotation></semantics></math>), keys (<math alttext="\mathbf{k}_{j,i}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p3.2.m2.2"><semantics id="S2.SS1.SSS1.p3.2.m2.2a"><msub id="S2.SS1.SSS1.p3.2.m2.2.3" xref="S2.SS1.SSS1.p3.2.m2.2.3.cmml"><mi id="S2.SS1.SSS1.p3.2.m2.2.3.2" xref="S2.SS1.SSS1.p3.2.m2.2.3.2.cmml">𝐤</mi><mrow id="S2.SS1.SSS1.p3.2.m2.2.2.2.4" xref="S2.SS1.SSS1.p3.2.m2.2.2.2.3.cmml"><mi id="S2.SS1.SSS1.p3.2.m2.1.1.1.1" xref="S2.SS1.SSS1.p3.2.m2.1.1.1.1.cmml">j</mi><mo id="S2.SS1.SSS1.p3.2.m2.2.2.2.4.1" xref="S2.SS1.SSS1.p3.2.m2.2.2.2.3.cmml">,</mo><mi id="S2.SS1.SSS1.p3.2.m2.2.2.2.2" xref="S2.SS1.SSS1.p3.2.m2.2.2.2.2.cmml">i</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p3.2.m2.2b"><apply id="S2.SS1.SSS1.p3.2.m2.2.3.cmml" xref="S2.SS1.SSS1.p3.2.m2.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p3.2.m2.2.3.1.cmml" xref="S2.SS1.SSS1.p3.2.m2.2.3">subscript</csymbol><ci id="S2.SS1.SSS1.p3.2.m2.2.3.2.cmml" xref="S2.SS1.SSS1.p3.2.m2.2.3.2">𝐤</ci><list id="S2.SS1.SSS1.p3.2.m2.2.2.2.3.cmml" xref="S2.SS1.SSS1.p3.2.m2.2.2.2.4"><ci id="S2.SS1.SSS1.p3.2.m2.1.1.1.1.cmml" xref="S2.SS1.SSS1.p3.2.m2.1.1.1.1">𝑗</ci><ci id="S2.SS1.SSS1.p3.2.m2.2.2.2.2.cmml" xref="S2.SS1.SSS1.p3.2.m2.2.2.2.2">𝑖</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p3.2.m2.2c">\mathbf{k}_{j,i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p3.2.m2.2d">bold_k start_POSTSUBSCRIPT italic_j , italic_i end_POSTSUBSCRIPT</annotation></semantics></math>), and values (<math alttext="\mathbf{v}_{j,i}^{C}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p3.3.m3.2"><semantics id="S2.SS1.SSS1.p3.3.m3.2a"><msubsup id="S2.SS1.SSS1.p3.3.m3.2.3" xref="S2.SS1.SSS1.p3.3.m3.2.3.cmml"><mi id="S2.SS1.SSS1.p3.3.m3.2.3.2.2" xref="S2.SS1.SSS1.p3.3.m3.2.3.2.2.cmml">𝐯</mi><mrow id="S2.SS1.SSS1.p3.3.m3.2.2.2.4" xref="S2.SS1.SSS1.p3.3.m3.2.2.2.3.cmml"><mi id="S2.SS1.SSS1.p3.3.m3.1.1.1.1" xref="S2.SS1.SSS1.p3.3.m3.1.1.1.1.cmml">j</mi><mo id="S2.SS1.SSS1.p3.3.m3.2.2.2.4.1" xref="S2.SS1.SSS1.p3.3.m3.2.2.2.3.cmml">,</mo><mi id="S2.SS1.SSS1.p3.3.m3.2.2.2.2" xref="S2.SS1.SSS1.p3.3.m3.2.2.2.2.cmml">i</mi></mrow><mi id="S2.SS1.SSS1.p3.3.m3.2.3.3" xref="S2.SS1.SSS1.p3.3.m3.2.3.3.cmml">C</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p3.3.m3.2b"><apply id="S2.SS1.SSS1.p3.3.m3.2.3.cmml" xref="S2.SS1.SSS1.p3.3.m3.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p3.3.m3.2.3.1.cmml" xref="S2.SS1.SSS1.p3.3.m3.2.3">superscript</csymbol><apply id="S2.SS1.SSS1.p3.3.m3.2.3.2.cmml" xref="S2.SS1.SSS1.p3.3.m3.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p3.3.m3.2.3.2.1.cmml" xref="S2.SS1.SSS1.p3.3.m3.2.3">subscript</csymbol><ci id="S2.SS1.SSS1.p3.3.m3.2.3.2.2.cmml" xref="S2.SS1.SSS1.p3.3.m3.2.3.2.2">𝐯</ci><list id="S2.SS1.SSS1.p3.3.m3.2.2.2.3.cmml" xref="S2.SS1.SSS1.p3.3.m3.2.2.2.4"><ci id="S2.SS1.SSS1.p3.3.m3.1.1.1.1.cmml" xref="S2.SS1.SSS1.p3.3.m3.1.1.1.1">𝑗</ci><ci id="S2.SS1.SSS1.p3.3.m3.2.2.2.2.cmml" xref="S2.SS1.SSS1.p3.3.m3.2.2.2.2">𝑖</ci></list></apply><ci id="S2.SS1.SSS1.p3.3.m3.2.3.3.cmml" xref="S2.SS1.SSS1.p3.3.m3.2.3.3">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p3.3.m3.2c">\mathbf{v}_{j,i}^{C}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p3.3.m3.2d">bold_v start_POSTSUBSCRIPT italic_j , italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT</annotation></semantics></math>) are combined to yield the final attention output <math alttext="\mathbf{u}_{t}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p3.4.m4.1"><semantics id="S2.SS1.SSS1.p3.4.m4.1a"><msub id="S2.SS1.SSS1.p3.4.m4.1.1" xref="S2.SS1.SSS1.p3.4.m4.1.1.cmml"><mi id="S2.SS1.SSS1.p3.4.m4.1.1.2" xref="S2.SS1.SSS1.p3.4.m4.1.1.2.cmml">𝐮</mi><mi id="S2.SS1.SSS1.p3.4.m4.1.1.3" xref="S2.SS1.SSS1.p3.4.m4.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p3.4.m4.1b"><apply id="S2.SS1.SSS1.p3.4.m4.1.1.cmml" xref="S2.SS1.SSS1.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p3.4.m4.1.1.1.cmml" xref="S2.SS1.SSS1.p3.4.m4.1.1">subscript</csymbol><ci id="S2.SS1.SSS1.p3.4.m4.1.1.2.cmml" xref="S2.SS1.SSS1.p3.4.m4.1.1.2">𝐮</ci><ci id="S2.SS1.SSS1.p3.4.m4.1.1.3.cmml" xref="S2.SS1.SSS1.p3.4.m4.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p3.4.m4.1c">\mathbf{u}_{t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p3.4.m4.1d">bold_u start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A3.EGx3">
<tbody id="S2.E10"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathbf{o}_{t,i}" class="ltx_Math" display="inline" id="S2.E10.m1.2"><semantics id="S2.E10.m1.2a"><msub id="S2.E10.m1.2.3" xref="S2.E10.m1.2.3.cmml"><mi id="S2.E10.m1.2.3.2" xref="S2.E10.m1.2.3.2.cmml">𝐨</mi><mrow id="S2.E10.m1.2.2.2.4" xref="S2.E10.m1.2.2.2.3.cmml"><mi id="S2.E10.m1.1.1.1.1" xref="S2.E10.m1.1.1.1.1.cmml">t</mi><mo id="S2.E10.m1.2.2.2.4.1" xref="S2.E10.m1.2.2.2.3.cmml">,</mo><mi id="S2.E10.m1.2.2.2.2" xref="S2.E10.m1.2.2.2.2.cmml">i</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.E10.m1.2b"><apply id="S2.E10.m1.2.3.cmml" xref="S2.E10.m1.2.3"><csymbol cd="ambiguous" id="S2.E10.m1.2.3.1.cmml" xref="S2.E10.m1.2.3">subscript</csymbol><ci id="S2.E10.m1.2.3.2.cmml" xref="S2.E10.m1.2.3.2">𝐨</ci><list id="S2.E10.m1.2.2.2.3.cmml" xref="S2.E10.m1.2.2.2.4"><ci id="S2.E10.m1.1.1.1.1.cmml" xref="S2.E10.m1.1.1.1.1">𝑡</ci><ci id="S2.E10.m1.2.2.2.2.cmml" xref="S2.E10.m1.2.2.2.2">𝑖</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E10.m1.2c">\displaystyle\mathbf{o}_{t,i}</annotation><annotation encoding="application/x-llamapun" id="S2.E10.m1.2d">bold_o start_POSTSUBSCRIPT italic_t , italic_i end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\sum_{j=1}^{t}\operatorname{Softmax}_{j}(\frac{\mathbf{q}_{t,i}^%
{T}\mathbf{k}_{j,i}}{\sqrt{d_{h}+d_{h}^{R}}})\mathbf{v}_{j,i}^{C}," class="ltx_Math" display="inline" id="S2.E10.m2.7"><semantics id="S2.E10.m2.7a"><mrow id="S2.E10.m2.7.7.1" xref="S2.E10.m2.7.7.1.1.cmml"><mrow id="S2.E10.m2.7.7.1.1" xref="S2.E10.m2.7.7.1.1.cmml"><mi id="S2.E10.m2.7.7.1.1.3" xref="S2.E10.m2.7.7.1.1.3.cmml"></mi><mo id="S2.E10.m2.7.7.1.1.2" xref="S2.E10.m2.7.7.1.1.2.cmml">=</mo><mrow id="S2.E10.m2.7.7.1.1.1" xref="S2.E10.m2.7.7.1.1.1.cmml"><mstyle displaystyle="true" id="S2.E10.m2.7.7.1.1.1.2" xref="S2.E10.m2.7.7.1.1.1.2.cmml"><munderover id="S2.E10.m2.7.7.1.1.1.2a" xref="S2.E10.m2.7.7.1.1.1.2.cmml"><mo id="S2.E10.m2.7.7.1.1.1.2.2.2" movablelimits="false" xref="S2.E10.m2.7.7.1.1.1.2.2.2.cmml">∑</mo><mrow id="S2.E10.m2.7.7.1.1.1.2.2.3" xref="S2.E10.m2.7.7.1.1.1.2.2.3.cmml"><mi id="S2.E10.m2.7.7.1.1.1.2.2.3.2" xref="S2.E10.m2.7.7.1.1.1.2.2.3.2.cmml">j</mi><mo id="S2.E10.m2.7.7.1.1.1.2.2.3.1" xref="S2.E10.m2.7.7.1.1.1.2.2.3.1.cmml">=</mo><mn id="S2.E10.m2.7.7.1.1.1.2.2.3.3" xref="S2.E10.m2.7.7.1.1.1.2.2.3.3.cmml">1</mn></mrow><mi id="S2.E10.m2.7.7.1.1.1.2.3" xref="S2.E10.m2.7.7.1.1.1.2.3.cmml">t</mi></munderover></mstyle><mrow id="S2.E10.m2.7.7.1.1.1.1" xref="S2.E10.m2.7.7.1.1.1.1.cmml"><mrow id="S2.E10.m2.7.7.1.1.1.1.1.1" xref="S2.E10.m2.7.7.1.1.1.1.1.2.cmml"><msub id="S2.E10.m2.7.7.1.1.1.1.1.1.1" xref="S2.E10.m2.7.7.1.1.1.1.1.1.1.cmml"><mi id="S2.E10.m2.7.7.1.1.1.1.1.1.1.2" xref="S2.E10.m2.7.7.1.1.1.1.1.1.1.2.cmml">Softmax</mi><mi id="S2.E10.m2.7.7.1.1.1.1.1.1.1.3" xref="S2.E10.m2.7.7.1.1.1.1.1.1.1.3.cmml">j</mi></msub><mo id="S2.E10.m2.7.7.1.1.1.1.1.1a" xref="S2.E10.m2.7.7.1.1.1.1.1.2.cmml">⁡</mo><mrow id="S2.E10.m2.7.7.1.1.1.1.1.1.2" xref="S2.E10.m2.7.7.1.1.1.1.1.2.cmml"><mo id="S2.E10.m2.7.7.1.1.1.1.1.1.2.1" stretchy="false" xref="S2.E10.m2.7.7.1.1.1.1.1.2.cmml">(</mo><mstyle displaystyle="true" id="S2.E10.m2.4.4" xref="S2.E10.m2.4.4.cmml"><mfrac id="S2.E10.m2.4.4a" xref="S2.E10.m2.4.4.cmml"><mrow id="S2.E10.m2.4.4.4" xref="S2.E10.m2.4.4.4.cmml"><msubsup id="S2.E10.m2.4.4.4.6" xref="S2.E10.m2.4.4.4.6.cmml"><mi id="S2.E10.m2.4.4.4.6.2.2" xref="S2.E10.m2.4.4.4.6.2.2.cmml">𝐪</mi><mrow id="S2.E10.m2.2.2.2.2.2.4" xref="S2.E10.m2.2.2.2.2.2.3.cmml"><mi id="S2.E10.m2.1.1.1.1.1.1" xref="S2.E10.m2.1.1.1.1.1.1.cmml">t</mi><mo id="S2.E10.m2.2.2.2.2.2.4.1" xref="S2.E10.m2.2.2.2.2.2.3.cmml">,</mo><mi id="S2.E10.m2.2.2.2.2.2.2" xref="S2.E10.m2.2.2.2.2.2.2.cmml">i</mi></mrow><mi id="S2.E10.m2.4.4.4.6.3" xref="S2.E10.m2.4.4.4.6.3.cmml">T</mi></msubsup><mo id="S2.E10.m2.4.4.4.5" xref="S2.E10.m2.4.4.4.5.cmml">⁢</mo><msub id="S2.E10.m2.4.4.4.7" xref="S2.E10.m2.4.4.4.7.cmml"><mi id="S2.E10.m2.4.4.4.7.2" xref="S2.E10.m2.4.4.4.7.2.cmml">𝐤</mi><mrow id="S2.E10.m2.4.4.4.4.2.4" xref="S2.E10.m2.4.4.4.4.2.3.cmml"><mi id="S2.E10.m2.3.3.3.3.1.1" xref="S2.E10.m2.3.3.3.3.1.1.cmml">j</mi><mo id="S2.E10.m2.4.4.4.4.2.4.1" xref="S2.E10.m2.4.4.4.4.2.3.cmml">,</mo><mi id="S2.E10.m2.4.4.4.4.2.2" xref="S2.E10.m2.4.4.4.4.2.2.cmml">i</mi></mrow></msub></mrow><msqrt id="S2.E10.m2.4.4.6" xref="S2.E10.m2.4.4.6.cmml"><mrow id="S2.E10.m2.4.4.6.2" xref="S2.E10.m2.4.4.6.2.cmml"><msub id="S2.E10.m2.4.4.6.2.2" xref="S2.E10.m2.4.4.6.2.2.cmml"><mi id="S2.E10.m2.4.4.6.2.2.2" xref="S2.E10.m2.4.4.6.2.2.2.cmml">d</mi><mi id="S2.E10.m2.4.4.6.2.2.3" xref="S2.E10.m2.4.4.6.2.2.3.cmml">h</mi></msub><mo id="S2.E10.m2.4.4.6.2.1" xref="S2.E10.m2.4.4.6.2.1.cmml">+</mo><msubsup id="S2.E10.m2.4.4.6.2.3" xref="S2.E10.m2.4.4.6.2.3.cmml"><mi id="S2.E10.m2.4.4.6.2.3.2.2" xref="S2.E10.m2.4.4.6.2.3.2.2.cmml">d</mi><mi id="S2.E10.m2.4.4.6.2.3.2.3" xref="S2.E10.m2.4.4.6.2.3.2.3.cmml">h</mi><mi id="S2.E10.m2.4.4.6.2.3.3" xref="S2.E10.m2.4.4.6.2.3.3.cmml">R</mi></msubsup></mrow></msqrt></mfrac></mstyle><mo id="S2.E10.m2.7.7.1.1.1.1.1.1.2.2" stretchy="false" xref="S2.E10.m2.7.7.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S2.E10.m2.7.7.1.1.1.1.2" xref="S2.E10.m2.7.7.1.1.1.1.2.cmml">⁢</mo><msubsup id="S2.E10.m2.7.7.1.1.1.1.3" xref="S2.E10.m2.7.7.1.1.1.1.3.cmml"><mi id="S2.E10.m2.7.7.1.1.1.1.3.2.2" xref="S2.E10.m2.7.7.1.1.1.1.3.2.2.cmml">𝐯</mi><mrow id="S2.E10.m2.6.6.2.4" xref="S2.E10.m2.6.6.2.3.cmml"><mi id="S2.E10.m2.5.5.1.1" xref="S2.E10.m2.5.5.1.1.cmml">j</mi><mo id="S2.E10.m2.6.6.2.4.1" xref="S2.E10.m2.6.6.2.3.cmml">,</mo><mi id="S2.E10.m2.6.6.2.2" xref="S2.E10.m2.6.6.2.2.cmml">i</mi></mrow><mi id="S2.E10.m2.7.7.1.1.1.1.3.3" xref="S2.E10.m2.7.7.1.1.1.1.3.3.cmml">C</mi></msubsup></mrow></mrow></mrow><mo id="S2.E10.m2.7.7.1.2" xref="S2.E10.m2.7.7.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E10.m2.7b"><apply id="S2.E10.m2.7.7.1.1.cmml" xref="S2.E10.m2.7.7.1"><eq id="S2.E10.m2.7.7.1.1.2.cmml" xref="S2.E10.m2.7.7.1.1.2"></eq><csymbol cd="latexml" id="S2.E10.m2.7.7.1.1.3.cmml" xref="S2.E10.m2.7.7.1.1.3">absent</csymbol><apply id="S2.E10.m2.7.7.1.1.1.cmml" xref="S2.E10.m2.7.7.1.1.1"><apply id="S2.E10.m2.7.7.1.1.1.2.cmml" xref="S2.E10.m2.7.7.1.1.1.2"><csymbol cd="ambiguous" id="S2.E10.m2.7.7.1.1.1.2.1.cmml" xref="S2.E10.m2.7.7.1.1.1.2">superscript</csymbol><apply id="S2.E10.m2.7.7.1.1.1.2.2.cmml" xref="S2.E10.m2.7.7.1.1.1.2"><csymbol cd="ambiguous" id="S2.E10.m2.7.7.1.1.1.2.2.1.cmml" xref="S2.E10.m2.7.7.1.1.1.2">subscript</csymbol><sum id="S2.E10.m2.7.7.1.1.1.2.2.2.cmml" xref="S2.E10.m2.7.7.1.1.1.2.2.2"></sum><apply id="S2.E10.m2.7.7.1.1.1.2.2.3.cmml" xref="S2.E10.m2.7.7.1.1.1.2.2.3"><eq id="S2.E10.m2.7.7.1.1.1.2.2.3.1.cmml" xref="S2.E10.m2.7.7.1.1.1.2.2.3.1"></eq><ci id="S2.E10.m2.7.7.1.1.1.2.2.3.2.cmml" xref="S2.E10.m2.7.7.1.1.1.2.2.3.2">𝑗</ci><cn id="S2.E10.m2.7.7.1.1.1.2.2.3.3.cmml" type="integer" xref="S2.E10.m2.7.7.1.1.1.2.2.3.3">1</cn></apply></apply><ci id="S2.E10.m2.7.7.1.1.1.2.3.cmml" xref="S2.E10.m2.7.7.1.1.1.2.3">𝑡</ci></apply><apply id="S2.E10.m2.7.7.1.1.1.1.cmml" xref="S2.E10.m2.7.7.1.1.1.1"><times id="S2.E10.m2.7.7.1.1.1.1.2.cmml" xref="S2.E10.m2.7.7.1.1.1.1.2"></times><apply id="S2.E10.m2.7.7.1.1.1.1.1.2.cmml" xref="S2.E10.m2.7.7.1.1.1.1.1.1"><apply id="S2.E10.m2.7.7.1.1.1.1.1.1.1.cmml" xref="S2.E10.m2.7.7.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E10.m2.7.7.1.1.1.1.1.1.1.1.cmml" xref="S2.E10.m2.7.7.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E10.m2.7.7.1.1.1.1.1.1.1.2.cmml" xref="S2.E10.m2.7.7.1.1.1.1.1.1.1.2">Softmax</ci><ci id="S2.E10.m2.7.7.1.1.1.1.1.1.1.3.cmml" xref="S2.E10.m2.7.7.1.1.1.1.1.1.1.3">𝑗</ci></apply><apply id="S2.E10.m2.4.4.cmml" xref="S2.E10.m2.4.4"><divide id="S2.E10.m2.4.4.5.cmml" xref="S2.E10.m2.4.4"></divide><apply id="S2.E10.m2.4.4.4.cmml" xref="S2.E10.m2.4.4.4"><times id="S2.E10.m2.4.4.4.5.cmml" xref="S2.E10.m2.4.4.4.5"></times><apply id="S2.E10.m2.4.4.4.6.cmml" xref="S2.E10.m2.4.4.4.6"><csymbol cd="ambiguous" id="S2.E10.m2.4.4.4.6.1.cmml" xref="S2.E10.m2.4.4.4.6">superscript</csymbol><apply id="S2.E10.m2.4.4.4.6.2.cmml" xref="S2.E10.m2.4.4.4.6"><csymbol cd="ambiguous" id="S2.E10.m2.4.4.4.6.2.1.cmml" xref="S2.E10.m2.4.4.4.6">subscript</csymbol><ci id="S2.E10.m2.4.4.4.6.2.2.cmml" xref="S2.E10.m2.4.4.4.6.2.2">𝐪</ci><list id="S2.E10.m2.2.2.2.2.2.3.cmml" xref="S2.E10.m2.2.2.2.2.2.4"><ci id="S2.E10.m2.1.1.1.1.1.1.cmml" xref="S2.E10.m2.1.1.1.1.1.1">𝑡</ci><ci id="S2.E10.m2.2.2.2.2.2.2.cmml" xref="S2.E10.m2.2.2.2.2.2.2">𝑖</ci></list></apply><ci id="S2.E10.m2.4.4.4.6.3.cmml" xref="S2.E10.m2.4.4.4.6.3">𝑇</ci></apply><apply id="S2.E10.m2.4.4.4.7.cmml" xref="S2.E10.m2.4.4.4.7"><csymbol cd="ambiguous" id="S2.E10.m2.4.4.4.7.1.cmml" xref="S2.E10.m2.4.4.4.7">subscript</csymbol><ci id="S2.E10.m2.4.4.4.7.2.cmml" xref="S2.E10.m2.4.4.4.7.2">𝐤</ci><list id="S2.E10.m2.4.4.4.4.2.3.cmml" xref="S2.E10.m2.4.4.4.4.2.4"><ci id="S2.E10.m2.3.3.3.3.1.1.cmml" xref="S2.E10.m2.3.3.3.3.1.1">𝑗</ci><ci id="S2.E10.m2.4.4.4.4.2.2.cmml" xref="S2.E10.m2.4.4.4.4.2.2">𝑖</ci></list></apply></apply><apply id="S2.E10.m2.4.4.6.cmml" xref="S2.E10.m2.4.4.6"><root id="S2.E10.m2.4.4.6a.cmml" xref="S2.E10.m2.4.4.6"></root><apply id="S2.E10.m2.4.4.6.2.cmml" xref="S2.E10.m2.4.4.6.2"><plus id="S2.E10.m2.4.4.6.2.1.cmml" xref="S2.E10.m2.4.4.6.2.1"></plus><apply id="S2.E10.m2.4.4.6.2.2.cmml" xref="S2.E10.m2.4.4.6.2.2"><csymbol cd="ambiguous" id="S2.E10.m2.4.4.6.2.2.1.cmml" xref="S2.E10.m2.4.4.6.2.2">subscript</csymbol><ci id="S2.E10.m2.4.4.6.2.2.2.cmml" xref="S2.E10.m2.4.4.6.2.2.2">𝑑</ci><ci id="S2.E10.m2.4.4.6.2.2.3.cmml" xref="S2.E10.m2.4.4.6.2.2.3">ℎ</ci></apply><apply id="S2.E10.m2.4.4.6.2.3.cmml" xref="S2.E10.m2.4.4.6.2.3"><csymbol cd="ambiguous" id="S2.E10.m2.4.4.6.2.3.1.cmml" xref="S2.E10.m2.4.4.6.2.3">superscript</csymbol><apply id="S2.E10.m2.4.4.6.2.3.2.cmml" xref="S2.E10.m2.4.4.6.2.3"><csymbol cd="ambiguous" id="S2.E10.m2.4.4.6.2.3.2.1.cmml" xref="S2.E10.m2.4.4.6.2.3">subscript</csymbol><ci id="S2.E10.m2.4.4.6.2.3.2.2.cmml" xref="S2.E10.m2.4.4.6.2.3.2.2">𝑑</ci><ci id="S2.E10.m2.4.4.6.2.3.2.3.cmml" xref="S2.E10.m2.4.4.6.2.3.2.3">ℎ</ci></apply><ci id="S2.E10.m2.4.4.6.2.3.3.cmml" xref="S2.E10.m2.4.4.6.2.3.3">𝑅</ci></apply></apply></apply></apply></apply><apply id="S2.E10.m2.7.7.1.1.1.1.3.cmml" xref="S2.E10.m2.7.7.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E10.m2.7.7.1.1.1.1.3.1.cmml" xref="S2.E10.m2.7.7.1.1.1.1.3">superscript</csymbol><apply id="S2.E10.m2.7.7.1.1.1.1.3.2.cmml" xref="S2.E10.m2.7.7.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E10.m2.7.7.1.1.1.1.3.2.1.cmml" xref="S2.E10.m2.7.7.1.1.1.1.3">subscript</csymbol><ci id="S2.E10.m2.7.7.1.1.1.1.3.2.2.cmml" xref="S2.E10.m2.7.7.1.1.1.1.3.2.2">𝐯</ci><list id="S2.E10.m2.6.6.2.3.cmml" xref="S2.E10.m2.6.6.2.4"><ci id="S2.E10.m2.5.5.1.1.cmml" xref="S2.E10.m2.5.5.1.1">𝑗</ci><ci id="S2.E10.m2.6.6.2.2.cmml" xref="S2.E10.m2.6.6.2.2">𝑖</ci></list></apply><ci id="S2.E10.m2.7.7.1.1.1.1.3.3.cmml" xref="S2.E10.m2.7.7.1.1.1.1.3.3">𝐶</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E10.m2.7c">\displaystyle=\sum_{j=1}^{t}\operatorname{Softmax}_{j}(\frac{\mathbf{q}_{t,i}^%
{T}\mathbf{k}_{j,i}}{\sqrt{d_{h}+d_{h}^{R}}})\mathbf{v}_{j,i}^{C},</annotation><annotation encoding="application/x-llamapun" id="S2.E10.m2.7d">= ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_t end_POSTSUPERSCRIPT roman_Softmax start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT ( divide start_ARG bold_q start_POSTSUBSCRIPT italic_t , italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT bold_k start_POSTSUBSCRIPT italic_j , italic_i end_POSTSUBSCRIPT end_ARG start_ARG square-root start_ARG italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT + italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT end_ARG end_ARG ) bold_v start_POSTSUBSCRIPT italic_j , italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_C end_POSTSUPERSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(10)</span></td>
</tr></tbody>
<tbody id="S2.E11"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathbf{u}_{t}" class="ltx_Math" display="inline" id="S2.E11.m1.1"><semantics id="S2.E11.m1.1a"><msub id="S2.E11.m1.1.1" xref="S2.E11.m1.1.1.cmml"><mi id="S2.E11.m1.1.1.2" xref="S2.E11.m1.1.1.2.cmml">𝐮</mi><mi id="S2.E11.m1.1.1.3" xref="S2.E11.m1.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S2.E11.m1.1b"><apply id="S2.E11.m1.1.1.cmml" xref="S2.E11.m1.1.1"><csymbol cd="ambiguous" id="S2.E11.m1.1.1.1.cmml" xref="S2.E11.m1.1.1">subscript</csymbol><ci id="S2.E11.m1.1.1.2.cmml" xref="S2.E11.m1.1.1.2">𝐮</ci><ci id="S2.E11.m1.1.1.3.cmml" xref="S2.E11.m1.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E11.m1.1c">\displaystyle\mathbf{u}_{t}</annotation><annotation encoding="application/x-llamapun" id="S2.E11.m1.1d">bold_u start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=W^{O}[\mathbf{o}_{t,1};\mathbf{o}_{t,2};...;\mathbf{o}_{t,n_{h}}]," class="ltx_Math" display="inline" id="S2.E11.m2.8"><semantics id="S2.E11.m2.8a"><mrow id="S2.E11.m2.8.8.1" xref="S2.E11.m2.8.8.1.1.cmml"><mrow id="S2.E11.m2.8.8.1.1" xref="S2.E11.m2.8.8.1.1.cmml"><mi id="S2.E11.m2.8.8.1.1.5" xref="S2.E11.m2.8.8.1.1.5.cmml"></mi><mo id="S2.E11.m2.8.8.1.1.4" xref="S2.E11.m2.8.8.1.1.4.cmml">=</mo><mrow id="S2.E11.m2.8.8.1.1.3" xref="S2.E11.m2.8.8.1.1.3.cmml"><msup id="S2.E11.m2.8.8.1.1.3.5" xref="S2.E11.m2.8.8.1.1.3.5.cmml"><mi id="S2.E11.m2.8.8.1.1.3.5.2" xref="S2.E11.m2.8.8.1.1.3.5.2.cmml">W</mi><mi id="S2.E11.m2.8.8.1.1.3.5.3" xref="S2.E11.m2.8.8.1.1.3.5.3.cmml">O</mi></msup><mo id="S2.E11.m2.8.8.1.1.3.4" xref="S2.E11.m2.8.8.1.1.3.4.cmml">⁢</mo><mrow id="S2.E11.m2.8.8.1.1.3.3.3" xref="S2.E11.m2.8.8.1.1.3.3.4.cmml"><mo id="S2.E11.m2.8.8.1.1.3.3.3.4" stretchy="false" xref="S2.E11.m2.8.8.1.1.3.3.4.cmml">[</mo><msub id="S2.E11.m2.8.8.1.1.1.1.1.1" xref="S2.E11.m2.8.8.1.1.1.1.1.1.cmml"><mi id="S2.E11.m2.8.8.1.1.1.1.1.1.2" xref="S2.E11.m2.8.8.1.1.1.1.1.1.2.cmml">𝐨</mi><mrow id="S2.E11.m2.2.2.2.4" xref="S2.E11.m2.2.2.2.3.cmml"><mi id="S2.E11.m2.1.1.1.1" xref="S2.E11.m2.1.1.1.1.cmml">t</mi><mo id="S2.E11.m2.2.2.2.4.1" xref="S2.E11.m2.2.2.2.3.cmml">,</mo><mn id="S2.E11.m2.2.2.2.2" xref="S2.E11.m2.2.2.2.2.cmml">1</mn></mrow></msub><mo id="S2.E11.m2.8.8.1.1.3.3.3.5" xref="S2.E11.m2.8.8.1.1.3.3.4.cmml">;</mo><msub id="S2.E11.m2.8.8.1.1.2.2.2.2" xref="S2.E11.m2.8.8.1.1.2.2.2.2.cmml"><mi id="S2.E11.m2.8.8.1.1.2.2.2.2.2" xref="S2.E11.m2.8.8.1.1.2.2.2.2.2.cmml">𝐨</mi><mrow id="S2.E11.m2.4.4.2.4" xref="S2.E11.m2.4.4.2.3.cmml"><mi id="S2.E11.m2.3.3.1.1" xref="S2.E11.m2.3.3.1.1.cmml">t</mi><mo id="S2.E11.m2.4.4.2.4.1" xref="S2.E11.m2.4.4.2.3.cmml">,</mo><mn id="S2.E11.m2.4.4.2.2" xref="S2.E11.m2.4.4.2.2.cmml">2</mn></mrow></msub><mo id="S2.E11.m2.8.8.1.1.3.3.3.6" xref="S2.E11.m2.8.8.1.1.3.3.4.cmml">;</mo><mi id="S2.E11.m2.7.7" mathvariant="normal" xref="S2.E11.m2.7.7.cmml">…</mi><mo id="S2.E11.m2.8.8.1.1.3.3.3.7" xref="S2.E11.m2.8.8.1.1.3.3.4.cmml">;</mo><msub id="S2.E11.m2.8.8.1.1.3.3.3.3" xref="S2.E11.m2.8.8.1.1.3.3.3.3.cmml"><mi id="S2.E11.m2.8.8.1.1.3.3.3.3.2" xref="S2.E11.m2.8.8.1.1.3.3.3.3.2.cmml">𝐨</mi><mrow id="S2.E11.m2.6.6.2.2" xref="S2.E11.m2.6.6.2.3.cmml"><mi id="S2.E11.m2.5.5.1.1" xref="S2.E11.m2.5.5.1.1.cmml">t</mi><mo id="S2.E11.m2.6.6.2.2.2" xref="S2.E11.m2.6.6.2.3.cmml">,</mo><msub id="S2.E11.m2.6.6.2.2.1" xref="S2.E11.m2.6.6.2.2.1.cmml"><mi id="S2.E11.m2.6.6.2.2.1.2" xref="S2.E11.m2.6.6.2.2.1.2.cmml">n</mi><mi id="S2.E11.m2.6.6.2.2.1.3" xref="S2.E11.m2.6.6.2.2.1.3.cmml">h</mi></msub></mrow></msub><mo id="S2.E11.m2.8.8.1.1.3.3.3.8" stretchy="false" xref="S2.E11.m2.8.8.1.1.3.3.4.cmml">]</mo></mrow></mrow></mrow><mo id="S2.E11.m2.8.8.1.2" xref="S2.E11.m2.8.8.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E11.m2.8b"><apply id="S2.E11.m2.8.8.1.1.cmml" xref="S2.E11.m2.8.8.1"><eq id="S2.E11.m2.8.8.1.1.4.cmml" xref="S2.E11.m2.8.8.1.1.4"></eq><csymbol cd="latexml" id="S2.E11.m2.8.8.1.1.5.cmml" xref="S2.E11.m2.8.8.1.1.5">absent</csymbol><apply id="S2.E11.m2.8.8.1.1.3.cmml" xref="S2.E11.m2.8.8.1.1.3"><times id="S2.E11.m2.8.8.1.1.3.4.cmml" xref="S2.E11.m2.8.8.1.1.3.4"></times><apply id="S2.E11.m2.8.8.1.1.3.5.cmml" xref="S2.E11.m2.8.8.1.1.3.5"><csymbol cd="ambiguous" id="S2.E11.m2.8.8.1.1.3.5.1.cmml" xref="S2.E11.m2.8.8.1.1.3.5">superscript</csymbol><ci id="S2.E11.m2.8.8.1.1.3.5.2.cmml" xref="S2.E11.m2.8.8.1.1.3.5.2">𝑊</ci><ci id="S2.E11.m2.8.8.1.1.3.5.3.cmml" xref="S2.E11.m2.8.8.1.1.3.5.3">𝑂</ci></apply><list id="S2.E11.m2.8.8.1.1.3.3.4.cmml" xref="S2.E11.m2.8.8.1.1.3.3.3"><apply id="S2.E11.m2.8.8.1.1.1.1.1.1.cmml" xref="S2.E11.m2.8.8.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E11.m2.8.8.1.1.1.1.1.1.1.cmml" xref="S2.E11.m2.8.8.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E11.m2.8.8.1.1.1.1.1.1.2.cmml" xref="S2.E11.m2.8.8.1.1.1.1.1.1.2">𝐨</ci><list id="S2.E11.m2.2.2.2.3.cmml" xref="S2.E11.m2.2.2.2.4"><ci id="S2.E11.m2.1.1.1.1.cmml" xref="S2.E11.m2.1.1.1.1">𝑡</ci><cn id="S2.E11.m2.2.2.2.2.cmml" type="integer" xref="S2.E11.m2.2.2.2.2">1</cn></list></apply><apply id="S2.E11.m2.8.8.1.1.2.2.2.2.cmml" xref="S2.E11.m2.8.8.1.1.2.2.2.2"><csymbol cd="ambiguous" id="S2.E11.m2.8.8.1.1.2.2.2.2.1.cmml" xref="S2.E11.m2.8.8.1.1.2.2.2.2">subscript</csymbol><ci id="S2.E11.m2.8.8.1.1.2.2.2.2.2.cmml" xref="S2.E11.m2.8.8.1.1.2.2.2.2.2">𝐨</ci><list id="S2.E11.m2.4.4.2.3.cmml" xref="S2.E11.m2.4.4.2.4"><ci id="S2.E11.m2.3.3.1.1.cmml" xref="S2.E11.m2.3.3.1.1">𝑡</ci><cn id="S2.E11.m2.4.4.2.2.cmml" type="integer" xref="S2.E11.m2.4.4.2.2">2</cn></list></apply><ci id="S2.E11.m2.7.7.cmml" xref="S2.E11.m2.7.7">…</ci><apply id="S2.E11.m2.8.8.1.1.3.3.3.3.cmml" xref="S2.E11.m2.8.8.1.1.3.3.3.3"><csymbol cd="ambiguous" id="S2.E11.m2.8.8.1.1.3.3.3.3.1.cmml" xref="S2.E11.m2.8.8.1.1.3.3.3.3">subscript</csymbol><ci id="S2.E11.m2.8.8.1.1.3.3.3.3.2.cmml" xref="S2.E11.m2.8.8.1.1.3.3.3.3.2">𝐨</ci><list id="S2.E11.m2.6.6.2.3.cmml" xref="S2.E11.m2.6.6.2.2"><ci id="S2.E11.m2.5.5.1.1.cmml" xref="S2.E11.m2.5.5.1.1">𝑡</ci><apply id="S2.E11.m2.6.6.2.2.1.cmml" xref="S2.E11.m2.6.6.2.2.1"><csymbol cd="ambiguous" id="S2.E11.m2.6.6.2.2.1.1.cmml" xref="S2.E11.m2.6.6.2.2.1">subscript</csymbol><ci id="S2.E11.m2.6.6.2.2.1.2.cmml" xref="S2.E11.m2.6.6.2.2.1.2">𝑛</ci><ci id="S2.E11.m2.6.6.2.2.1.3.cmml" xref="S2.E11.m2.6.6.2.2.1.3">ℎ</ci></apply></list></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E11.m2.8c">\displaystyle=W^{O}[\mathbf{o}_{t,1};\mathbf{o}_{t,2};...;\mathbf{o}_{t,n_{h}}],</annotation><annotation encoding="application/x-llamapun" id="S2.E11.m2.8d">= italic_W start_POSTSUPERSCRIPT italic_O end_POSTSUPERSCRIPT [ bold_o start_POSTSUBSCRIPT italic_t , 1 end_POSTSUBSCRIPT ; bold_o start_POSTSUBSCRIPT italic_t , 2 end_POSTSUBSCRIPT ; … ; bold_o start_POSTSUBSCRIPT italic_t , italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT end_POSTSUBSCRIPT ] ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(11)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS1.SSS1.p3.5">where <math alttext="W^{O}\in\mathbb{R}^{d\times d_{h}n_{h}}" class="ltx_Math" display="inline" id="S2.SS1.SSS1.p3.5.m1.1"><semantics id="S2.SS1.SSS1.p3.5.m1.1a"><mrow id="S2.SS1.SSS1.p3.5.m1.1.1" xref="S2.SS1.SSS1.p3.5.m1.1.1.cmml"><msup id="S2.SS1.SSS1.p3.5.m1.1.1.2" xref="S2.SS1.SSS1.p3.5.m1.1.1.2.cmml"><mi id="S2.SS1.SSS1.p3.5.m1.1.1.2.2" xref="S2.SS1.SSS1.p3.5.m1.1.1.2.2.cmml">W</mi><mi id="S2.SS1.SSS1.p3.5.m1.1.1.2.3" xref="S2.SS1.SSS1.p3.5.m1.1.1.2.3.cmml">O</mi></msup><mo id="S2.SS1.SSS1.p3.5.m1.1.1.1" xref="S2.SS1.SSS1.p3.5.m1.1.1.1.cmml">∈</mo><msup id="S2.SS1.SSS1.p3.5.m1.1.1.3" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.cmml"><mi id="S2.SS1.SSS1.p3.5.m1.1.1.3.2" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.2.cmml">ℝ</mi><mrow id="S2.SS1.SSS1.p3.5.m1.1.1.3.3" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.cmml"><mrow id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.cmml"><mi id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.2" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.2.cmml">d</mi><mo id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.1" lspace="0.222em" rspace="0.222em" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.1.cmml">×</mo><msub id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3.cmml"><mi id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3.2" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3.2.cmml">d</mi><mi id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3.3" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3.3.cmml">h</mi></msub></mrow><mo id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.1" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.1.cmml">⁢</mo><msub id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3.cmml"><mi id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3.2" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3.2.cmml">n</mi><mi id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3.3" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3.3.cmml">h</mi></msub></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS1.p3.5.m1.1b"><apply id="S2.SS1.SSS1.p3.5.m1.1.1.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1"><in id="S2.SS1.SSS1.p3.5.m1.1.1.1.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.1"></in><apply id="S2.SS1.SSS1.p3.5.m1.1.1.2.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p3.5.m1.1.1.2.1.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.2">superscript</csymbol><ci id="S2.SS1.SSS1.p3.5.m1.1.1.2.2.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.2.2">𝑊</ci><ci id="S2.SS1.SSS1.p3.5.m1.1.1.2.3.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.2.3">𝑂</ci></apply><apply id="S2.SS1.SSS1.p3.5.m1.1.1.3.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p3.5.m1.1.1.3.1.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3">superscript</csymbol><ci id="S2.SS1.SSS1.p3.5.m1.1.1.3.2.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.2">ℝ</ci><apply id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3"><times id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.1.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.1"></times><apply id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2"><times id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.1.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.1"></times><ci id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.2.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.2">𝑑</ci><apply id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3.1.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3">subscript</csymbol><ci id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3.2.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3.2">𝑑</ci><ci id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3.3.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.2.3.3">ℎ</ci></apply></apply><apply id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3"><csymbol cd="ambiguous" id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3.1.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3">subscript</csymbol><ci id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3.2.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3.2">𝑛</ci><ci id="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3.3.cmml" xref="S2.SS1.SSS1.p3.5.m1.1.1.3.3.3.3">ℎ</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS1.p3.5.m1.1c">W^{O}\in\mathbb{R}^{d\times d_{h}n_{h}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS1.p3.5.m1.1d">italic_W start_POSTSUPERSCRIPT italic_O end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d × italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math> denotes the output projection matrix.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S2.SS1.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">2.1.2 </span>DeepSeekMoE with Auxiliary-Loss-Free Load Balancing</h4>
<section class="ltx_paragraph" id="S2.SS1.SSS2.Px1">
<h5 class="ltx_title ltx_title_paragraph">Basic Architecture of DeepSeekMoE.</h5>
<div class="ltx_para" id="S2.SS1.SSS2.Px1.p1">
<p class="ltx_p" id="S2.SS1.SSS2.Px1.p1.3">For Feed-Forward Networks (FFNs), DeepSeek-V3 employs the DeepSeekMoE architecture <cite class="ltx_cite ltx_citemacro_citep">(Dai et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib13" title="">2024</a>)</cite>.
Compared with traditional MoE architectures like GShard <cite class="ltx_cite ltx_citemacro_citep">(Lepikhin et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib45" title="">2021</a>)</cite>, DeepSeekMoE uses finer-grained experts and isolates some experts as shared ones.
Let <math alttext="\mathbf{u}_{t}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.1.m1.1"><semantics id="S2.SS1.SSS2.Px1.p1.1.m1.1a"><msub id="S2.SS1.SSS2.Px1.p1.1.m1.1.1" xref="S2.SS1.SSS2.Px1.p1.1.m1.1.1.cmml"><mi id="S2.SS1.SSS2.Px1.p1.1.m1.1.1.2" xref="S2.SS1.SSS2.Px1.p1.1.m1.1.1.2.cmml">𝐮</mi><mi id="S2.SS1.SSS2.Px1.p1.1.m1.1.1.3" xref="S2.SS1.SSS2.Px1.p1.1.m1.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.1.m1.1b"><apply id="S2.SS1.SSS2.Px1.p1.1.m1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.1.m1.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.1.m1.1.1">subscript</csymbol><ci id="S2.SS1.SSS2.Px1.p1.1.m1.1.1.2.cmml" xref="S2.SS1.SSS2.Px1.p1.1.m1.1.1.2">𝐮</ci><ci id="S2.SS1.SSS2.Px1.p1.1.m1.1.1.3.cmml" xref="S2.SS1.SSS2.Px1.p1.1.m1.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.1.m1.1c">\mathbf{u}_{t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.1.m1.1d">bold_u start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> denote the FFN input of the <math alttext="t" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.2.m2.1"><semantics id="S2.SS1.SSS2.Px1.p1.2.m2.1a"><mi id="S2.SS1.SSS2.Px1.p1.2.m2.1.1" xref="S2.SS1.SSS2.Px1.p1.2.m2.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.2.m2.1b"><ci id="S2.SS1.SSS2.Px1.p1.2.m2.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.2.m2.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.2.m2.1c">t</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.2.m2.1d">italic_t</annotation></semantics></math>-th token, we compute the FFN output <math alttext="\mathbf{h}_{t}^{\prime}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.3.m3.1"><semantics id="S2.SS1.SSS2.Px1.p1.3.m3.1a"><msubsup id="S2.SS1.SSS2.Px1.p1.3.m3.1.1" xref="S2.SS1.SSS2.Px1.p1.3.m3.1.1.cmml"><mi id="S2.SS1.SSS2.Px1.p1.3.m3.1.1.2.2" xref="S2.SS1.SSS2.Px1.p1.3.m3.1.1.2.2.cmml">𝐡</mi><mi id="S2.SS1.SSS2.Px1.p1.3.m3.1.1.2.3" xref="S2.SS1.SSS2.Px1.p1.3.m3.1.1.2.3.cmml">t</mi><mo id="S2.SS1.SSS2.Px1.p1.3.m3.1.1.3" xref="S2.SS1.SSS2.Px1.p1.3.m3.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.3.m3.1b"><apply id="S2.SS1.SSS2.Px1.p1.3.m3.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.3.m3.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.3.m3.1.1">superscript</csymbol><apply id="S2.SS1.SSS2.Px1.p1.3.m3.1.1.2.cmml" xref="S2.SS1.SSS2.Px1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.3.m3.1.1.2.1.cmml" xref="S2.SS1.SSS2.Px1.p1.3.m3.1.1">subscript</csymbol><ci id="S2.SS1.SSS2.Px1.p1.3.m3.1.1.2.2.cmml" xref="S2.SS1.SSS2.Px1.p1.3.m3.1.1.2.2">𝐡</ci><ci id="S2.SS1.SSS2.Px1.p1.3.m3.1.1.2.3.cmml" xref="S2.SS1.SSS2.Px1.p1.3.m3.1.1.2.3">𝑡</ci></apply><ci id="S2.SS1.SSS2.Px1.p1.3.m3.1.1.3.cmml" xref="S2.SS1.SSS2.Px1.p1.3.m3.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.3.m3.1c">\mathbf{h}_{t}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.3.m3.1d">bold_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> as follows:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A3.EGx4">
<tbody id="S2.E12"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathbf{h}_{t}^{\prime}" class="ltx_Math" display="inline" id="S2.E12.m1.1"><semantics id="S2.E12.m1.1a"><msubsup id="S2.E12.m1.1.1" xref="S2.E12.m1.1.1.cmml"><mi id="S2.E12.m1.1.1.2.2" xref="S2.E12.m1.1.1.2.2.cmml">𝐡</mi><mi id="S2.E12.m1.1.1.2.3" xref="S2.E12.m1.1.1.2.3.cmml">t</mi><mo id="S2.E12.m1.1.1.3" xref="S2.E12.m1.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S2.E12.m1.1b"><apply id="S2.E12.m1.1.1.cmml" xref="S2.E12.m1.1.1"><csymbol cd="ambiguous" id="S2.E12.m1.1.1.1.cmml" xref="S2.E12.m1.1.1">superscript</csymbol><apply id="S2.E12.m1.1.1.2.cmml" xref="S2.E12.m1.1.1"><csymbol cd="ambiguous" id="S2.E12.m1.1.1.2.1.cmml" xref="S2.E12.m1.1.1">subscript</csymbol><ci id="S2.E12.m1.1.1.2.2.cmml" xref="S2.E12.m1.1.1.2.2">𝐡</ci><ci id="S2.E12.m1.1.1.2.3.cmml" xref="S2.E12.m1.1.1.2.3">𝑡</ci></apply><ci id="S2.E12.m1.1.1.3.cmml" xref="S2.E12.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E12.m1.1c">\displaystyle\mathbf{h}_{t}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S2.E12.m1.1d">bold_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\mathbf{u}_{t}+\sum_{i=1}^{N_{s}}{\operatorname{FFN}^{(s)}_{i}%
\left(\mathbf{u}_{t}\right)}+\sum_{i=1}^{N_{r}}{g_{i,t}\operatorname{FFN}^{(r)%
}_{i}\left(\mathbf{u}_{t}\right)}," class="ltx_Math" display="inline" id="S2.E12.m2.5"><semantics id="S2.E12.m2.5a"><mrow id="S2.E12.m2.5.5.1" xref="S2.E12.m2.5.5.1.1.cmml"><mrow id="S2.E12.m2.5.5.1.1" xref="S2.E12.m2.5.5.1.1.cmml"><mi id="S2.E12.m2.5.5.1.1.6" xref="S2.E12.m2.5.5.1.1.6.cmml"></mi><mo id="S2.E12.m2.5.5.1.1.5" xref="S2.E12.m2.5.5.1.1.5.cmml">=</mo><mrow id="S2.E12.m2.5.5.1.1.4" xref="S2.E12.m2.5.5.1.1.4.cmml"><msub id="S2.E12.m2.5.5.1.1.4.6" xref="S2.E12.m2.5.5.1.1.4.6.cmml"><mi id="S2.E12.m2.5.5.1.1.4.6.2" xref="S2.E12.m2.5.5.1.1.4.6.2.cmml">𝐮</mi><mi id="S2.E12.m2.5.5.1.1.4.6.3" xref="S2.E12.m2.5.5.1.1.4.6.3.cmml">t</mi></msub><mo id="S2.E12.m2.5.5.1.1.4.5" xref="S2.E12.m2.5.5.1.1.4.5.cmml">+</mo><mrow id="S2.E12.m2.5.5.1.1.2.2" xref="S2.E12.m2.5.5.1.1.2.2.cmml"><mstyle displaystyle="true" id="S2.E12.m2.5.5.1.1.2.2.3" xref="S2.E12.m2.5.5.1.1.2.2.3.cmml"><munderover id="S2.E12.m2.5.5.1.1.2.2.3a" xref="S2.E12.m2.5.5.1.1.2.2.3.cmml"><mo id="S2.E12.m2.5.5.1.1.2.2.3.2.2" movablelimits="false" xref="S2.E12.m2.5.5.1.1.2.2.3.2.2.cmml">∑</mo><mrow id="S2.E12.m2.5.5.1.1.2.2.3.2.3" xref="S2.E12.m2.5.5.1.1.2.2.3.2.3.cmml"><mi id="S2.E12.m2.5.5.1.1.2.2.3.2.3.2" xref="S2.E12.m2.5.5.1.1.2.2.3.2.3.2.cmml">i</mi><mo id="S2.E12.m2.5.5.1.1.2.2.3.2.3.1" xref="S2.E12.m2.5.5.1.1.2.2.3.2.3.1.cmml">=</mo><mn id="S2.E12.m2.5.5.1.1.2.2.3.2.3.3" xref="S2.E12.m2.5.5.1.1.2.2.3.2.3.3.cmml">1</mn></mrow><msub id="S2.E12.m2.5.5.1.1.2.2.3.3" xref="S2.E12.m2.5.5.1.1.2.2.3.3.cmml"><mi id="S2.E12.m2.5.5.1.1.2.2.3.3.2" xref="S2.E12.m2.5.5.1.1.2.2.3.3.2.cmml">N</mi><mi id="S2.E12.m2.5.5.1.1.2.2.3.3.3" xref="S2.E12.m2.5.5.1.1.2.2.3.3.3.cmml">s</mi></msub></munderover></mstyle><mrow id="S2.E12.m2.5.5.1.1.2.2.2.2" xref="S2.E12.m2.5.5.1.1.2.2.2.3.cmml"><msubsup id="S2.E12.m2.5.5.1.1.1.1.1.1.1" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1.cmml"><mi id="S2.E12.m2.5.5.1.1.1.1.1.1.1.2.2" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1.2.2.cmml">FFN</mi><mi id="S2.E12.m2.5.5.1.1.1.1.1.1.1.3" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1.3.cmml">i</mi><mrow id="S2.E12.m2.1.1.1.3" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1.cmml"><mo id="S2.E12.m2.1.1.1.3.1" stretchy="false" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1.cmml">(</mo><mi id="S2.E12.m2.1.1.1.1" xref="S2.E12.m2.1.1.1.1.cmml">s</mi><mo id="S2.E12.m2.1.1.1.3.2" stretchy="false" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1.cmml">)</mo></mrow></msubsup><mo id="S2.E12.m2.5.5.1.1.2.2.2.2a" xref="S2.E12.m2.5.5.1.1.2.2.2.3.cmml">⁡</mo><mrow id="S2.E12.m2.5.5.1.1.2.2.2.2.2" xref="S2.E12.m2.5.5.1.1.2.2.2.3.cmml"><mo id="S2.E12.m2.5.5.1.1.2.2.2.2.2.2" xref="S2.E12.m2.5.5.1.1.2.2.2.3.cmml">(</mo><msub id="S2.E12.m2.5.5.1.1.2.2.2.2.2.1" xref="S2.E12.m2.5.5.1.1.2.2.2.2.2.1.cmml"><mi id="S2.E12.m2.5.5.1.1.2.2.2.2.2.1.2" xref="S2.E12.m2.5.5.1.1.2.2.2.2.2.1.2.cmml">𝐮</mi><mi id="S2.E12.m2.5.5.1.1.2.2.2.2.2.1.3" xref="S2.E12.m2.5.5.1.1.2.2.2.2.2.1.3.cmml">t</mi></msub><mo id="S2.E12.m2.5.5.1.1.2.2.2.2.2.3" xref="S2.E12.m2.5.5.1.1.2.2.2.3.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E12.m2.5.5.1.1.4.5a" xref="S2.E12.m2.5.5.1.1.4.5.cmml">+</mo><mrow id="S2.E12.m2.5.5.1.1.4.4" xref="S2.E12.m2.5.5.1.1.4.4.cmml"><mstyle displaystyle="true" id="S2.E12.m2.5.5.1.1.4.4.3" xref="S2.E12.m2.5.5.1.1.4.4.3.cmml"><munderover id="S2.E12.m2.5.5.1.1.4.4.3a" xref="S2.E12.m2.5.5.1.1.4.4.3.cmml"><mo id="S2.E12.m2.5.5.1.1.4.4.3.2.2" movablelimits="false" xref="S2.E12.m2.5.5.1.1.4.4.3.2.2.cmml">∑</mo><mrow id="S2.E12.m2.5.5.1.1.4.4.3.2.3" xref="S2.E12.m2.5.5.1.1.4.4.3.2.3.cmml"><mi id="S2.E12.m2.5.5.1.1.4.4.3.2.3.2" xref="S2.E12.m2.5.5.1.1.4.4.3.2.3.2.cmml">i</mi><mo id="S2.E12.m2.5.5.1.1.4.4.3.2.3.1" xref="S2.E12.m2.5.5.1.1.4.4.3.2.3.1.cmml">=</mo><mn id="S2.E12.m2.5.5.1.1.4.4.3.2.3.3" xref="S2.E12.m2.5.5.1.1.4.4.3.2.3.3.cmml">1</mn></mrow><msub id="S2.E12.m2.5.5.1.1.4.4.3.3" xref="S2.E12.m2.5.5.1.1.4.4.3.3.cmml"><mi id="S2.E12.m2.5.5.1.1.4.4.3.3.2" xref="S2.E12.m2.5.5.1.1.4.4.3.3.2.cmml">N</mi><mi id="S2.E12.m2.5.5.1.1.4.4.3.3.3" xref="S2.E12.m2.5.5.1.1.4.4.3.3.3.cmml">r</mi></msub></munderover></mstyle><mrow id="S2.E12.m2.5.5.1.1.4.4.2" xref="S2.E12.m2.5.5.1.1.4.4.2.cmml"><msub id="S2.E12.m2.5.5.1.1.4.4.2.4" xref="S2.E12.m2.5.5.1.1.4.4.2.4.cmml"><mi id="S2.E12.m2.5.5.1.1.4.4.2.4.2" xref="S2.E12.m2.5.5.1.1.4.4.2.4.2.cmml">g</mi><mrow id="S2.E12.m2.3.3.2.4" xref="S2.E12.m2.3.3.2.3.cmml"><mi id="S2.E12.m2.2.2.1.1" xref="S2.E12.m2.2.2.1.1.cmml">i</mi><mo id="S2.E12.m2.3.3.2.4.1" xref="S2.E12.m2.3.3.2.3.cmml">,</mo><mi id="S2.E12.m2.3.3.2.2" xref="S2.E12.m2.3.3.2.2.cmml">t</mi></mrow></msub><mo id="S2.E12.m2.5.5.1.1.4.4.2.3" lspace="0.167em" xref="S2.E12.m2.5.5.1.1.4.4.2.3.cmml">⁢</mo><mrow id="S2.E12.m2.5.5.1.1.4.4.2.2.2" xref="S2.E12.m2.5.5.1.1.4.4.2.2.3.cmml"><msubsup id="S2.E12.m2.5.5.1.1.3.3.1.1.1.1" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.cmml"><mi id="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.2.2" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.2.2.cmml">FFN</mi><mi id="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.3" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.3.cmml">i</mi><mrow id="S2.E12.m2.4.4.1.3" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.cmml"><mo id="S2.E12.m2.4.4.1.3.1" stretchy="false" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.cmml">(</mo><mi id="S2.E12.m2.4.4.1.1" xref="S2.E12.m2.4.4.1.1.cmml">r</mi><mo id="S2.E12.m2.4.4.1.3.2" stretchy="false" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.cmml">)</mo></mrow></msubsup><mo id="S2.E12.m2.5.5.1.1.4.4.2.2.2a" xref="S2.E12.m2.5.5.1.1.4.4.2.2.3.cmml">⁡</mo><mrow id="S2.E12.m2.5.5.1.1.4.4.2.2.2.2" xref="S2.E12.m2.5.5.1.1.4.4.2.2.3.cmml"><mo id="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.2" xref="S2.E12.m2.5.5.1.1.4.4.2.2.3.cmml">(</mo><msub id="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1" xref="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1.cmml"><mi id="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1.2" xref="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1.2.cmml">𝐮</mi><mi id="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1.3" xref="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1.3.cmml">t</mi></msub><mo id="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.3" xref="S2.E12.m2.5.5.1.1.4.4.2.2.3.cmml">)</mo></mrow></mrow></mrow></mrow></mrow></mrow><mo id="S2.E12.m2.5.5.1.2" xref="S2.E12.m2.5.5.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E12.m2.5b"><apply id="S2.E12.m2.5.5.1.1.cmml" xref="S2.E12.m2.5.5.1"><eq id="S2.E12.m2.5.5.1.1.5.cmml" xref="S2.E12.m2.5.5.1.1.5"></eq><csymbol cd="latexml" id="S2.E12.m2.5.5.1.1.6.cmml" xref="S2.E12.m2.5.5.1.1.6">absent</csymbol><apply id="S2.E12.m2.5.5.1.1.4.cmml" xref="S2.E12.m2.5.5.1.1.4"><plus id="S2.E12.m2.5.5.1.1.4.5.cmml" xref="S2.E12.m2.5.5.1.1.4.5"></plus><apply id="S2.E12.m2.5.5.1.1.4.6.cmml" xref="S2.E12.m2.5.5.1.1.4.6"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.4.6.1.cmml" xref="S2.E12.m2.5.5.1.1.4.6">subscript</csymbol><ci id="S2.E12.m2.5.5.1.1.4.6.2.cmml" xref="S2.E12.m2.5.5.1.1.4.6.2">𝐮</ci><ci id="S2.E12.m2.5.5.1.1.4.6.3.cmml" xref="S2.E12.m2.5.5.1.1.4.6.3">𝑡</ci></apply><apply id="S2.E12.m2.5.5.1.1.2.2.cmml" xref="S2.E12.m2.5.5.1.1.2.2"><apply id="S2.E12.m2.5.5.1.1.2.2.3.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.2.2.3.1.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3">superscript</csymbol><apply id="S2.E12.m2.5.5.1.1.2.2.3.2.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.2.2.3.2.1.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3">subscript</csymbol><sum id="S2.E12.m2.5.5.1.1.2.2.3.2.2.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3.2.2"></sum><apply id="S2.E12.m2.5.5.1.1.2.2.3.2.3.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3.2.3"><eq id="S2.E12.m2.5.5.1.1.2.2.3.2.3.1.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3.2.3.1"></eq><ci id="S2.E12.m2.5.5.1.1.2.2.3.2.3.2.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3.2.3.2">𝑖</ci><cn id="S2.E12.m2.5.5.1.1.2.2.3.2.3.3.cmml" type="integer" xref="S2.E12.m2.5.5.1.1.2.2.3.2.3.3">1</cn></apply></apply><apply id="S2.E12.m2.5.5.1.1.2.2.3.3.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3.3"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.2.2.3.3.1.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3.3">subscript</csymbol><ci id="S2.E12.m2.5.5.1.1.2.2.3.3.2.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3.3.2">𝑁</ci><ci id="S2.E12.m2.5.5.1.1.2.2.3.3.3.cmml" xref="S2.E12.m2.5.5.1.1.2.2.3.3.3">𝑠</ci></apply></apply><apply id="S2.E12.m2.5.5.1.1.2.2.2.3.cmml" xref="S2.E12.m2.5.5.1.1.2.2.2.2"><apply id="S2.E12.m2.5.5.1.1.1.1.1.1.1.cmml" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.1.1.1.1.1.1.cmml" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1">subscript</csymbol><apply id="S2.E12.m2.5.5.1.1.1.1.1.1.1.2.cmml" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.1.1.1.1.1.2.1.cmml" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1">superscript</csymbol><ci id="S2.E12.m2.5.5.1.1.1.1.1.1.1.2.2.cmml" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1.2.2">FFN</ci><ci id="S2.E12.m2.1.1.1.1.cmml" xref="S2.E12.m2.1.1.1.1">𝑠</ci></apply><ci id="S2.E12.m2.5.5.1.1.1.1.1.1.1.3.cmml" xref="S2.E12.m2.5.5.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S2.E12.m2.5.5.1.1.2.2.2.2.2.1.cmml" xref="S2.E12.m2.5.5.1.1.2.2.2.2.2.1"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.2.2.2.2.2.1.1.cmml" xref="S2.E12.m2.5.5.1.1.2.2.2.2.2.1">subscript</csymbol><ci id="S2.E12.m2.5.5.1.1.2.2.2.2.2.1.2.cmml" xref="S2.E12.m2.5.5.1.1.2.2.2.2.2.1.2">𝐮</ci><ci id="S2.E12.m2.5.5.1.1.2.2.2.2.2.1.3.cmml" xref="S2.E12.m2.5.5.1.1.2.2.2.2.2.1.3">𝑡</ci></apply></apply></apply><apply id="S2.E12.m2.5.5.1.1.4.4.cmml" xref="S2.E12.m2.5.5.1.1.4.4"><apply id="S2.E12.m2.5.5.1.1.4.4.3.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.4.4.3.1.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3">superscript</csymbol><apply id="S2.E12.m2.5.5.1.1.4.4.3.2.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.4.4.3.2.1.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3">subscript</csymbol><sum id="S2.E12.m2.5.5.1.1.4.4.3.2.2.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3.2.2"></sum><apply id="S2.E12.m2.5.5.1.1.4.4.3.2.3.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3.2.3"><eq id="S2.E12.m2.5.5.1.1.4.4.3.2.3.1.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3.2.3.1"></eq><ci id="S2.E12.m2.5.5.1.1.4.4.3.2.3.2.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3.2.3.2">𝑖</ci><cn id="S2.E12.m2.5.5.1.1.4.4.3.2.3.3.cmml" type="integer" xref="S2.E12.m2.5.5.1.1.4.4.3.2.3.3">1</cn></apply></apply><apply id="S2.E12.m2.5.5.1.1.4.4.3.3.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3.3"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.4.4.3.3.1.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3.3">subscript</csymbol><ci id="S2.E12.m2.5.5.1.1.4.4.3.3.2.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3.3.2">𝑁</ci><ci id="S2.E12.m2.5.5.1.1.4.4.3.3.3.cmml" xref="S2.E12.m2.5.5.1.1.4.4.3.3.3">𝑟</ci></apply></apply><apply id="S2.E12.m2.5.5.1.1.4.4.2.cmml" xref="S2.E12.m2.5.5.1.1.4.4.2"><times id="S2.E12.m2.5.5.1.1.4.4.2.3.cmml" xref="S2.E12.m2.5.5.1.1.4.4.2.3"></times><apply id="S2.E12.m2.5.5.1.1.4.4.2.4.cmml" xref="S2.E12.m2.5.5.1.1.4.4.2.4"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.4.4.2.4.1.cmml" xref="S2.E12.m2.5.5.1.1.4.4.2.4">subscript</csymbol><ci id="S2.E12.m2.5.5.1.1.4.4.2.4.2.cmml" xref="S2.E12.m2.5.5.1.1.4.4.2.4.2">𝑔</ci><list id="S2.E12.m2.3.3.2.3.cmml" xref="S2.E12.m2.3.3.2.4"><ci id="S2.E12.m2.2.2.1.1.cmml" xref="S2.E12.m2.2.2.1.1">𝑖</ci><ci id="S2.E12.m2.3.3.2.2.cmml" xref="S2.E12.m2.3.3.2.2">𝑡</ci></list></apply><apply id="S2.E12.m2.5.5.1.1.4.4.2.2.3.cmml" xref="S2.E12.m2.5.5.1.1.4.4.2.2.2"><apply id="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.cmml" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.1.cmml" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1">subscript</csymbol><apply id="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.2.cmml" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.2.1.cmml" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1">superscript</csymbol><ci id="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.2.2.cmml" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.2.2">FFN</ci><ci id="S2.E12.m2.4.4.1.1.cmml" xref="S2.E12.m2.4.4.1.1">𝑟</ci></apply><ci id="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.3.cmml" xref="S2.E12.m2.5.5.1.1.3.3.1.1.1.1.3">𝑖</ci></apply><apply id="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1.cmml" xref="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1"><csymbol cd="ambiguous" id="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1.1.cmml" xref="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1">subscript</csymbol><ci id="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1.2.cmml" xref="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1.2">𝐮</ci><ci id="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1.3.cmml" xref="S2.E12.m2.5.5.1.1.4.4.2.2.2.2.1.3">𝑡</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E12.m2.5c">\displaystyle=\mathbf{u}_{t}+\sum_{i=1}^{N_{s}}{\operatorname{FFN}^{(s)}_{i}%
\left(\mathbf{u}_{t}\right)}+\sum_{i=1}^{N_{r}}{g_{i,t}\operatorname{FFN}^{(r)%
}_{i}\left(\mathbf{u}_{t}\right)},</annotation><annotation encoding="application/x-llamapun" id="S2.E12.m2.5d">= bold_u start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT + ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N start_POSTSUBSCRIPT italic_s end_POSTSUBSCRIPT end_POSTSUPERSCRIPT roman_FFN start_POSTSUPERSCRIPT ( italic_s ) end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ( bold_u start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ) + ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT end_POSTSUPERSCRIPT italic_g start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT roman_FFN start_POSTSUPERSCRIPT ( italic_r ) end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ( bold_u start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(12)</span></td>
</tr></tbody>
<tbody id="S2.E13"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle g_{i,t}" class="ltx_Math" display="inline" id="S2.E13.m1.2"><semantics id="S2.E13.m1.2a"><msub id="S2.E13.m1.2.3" xref="S2.E13.m1.2.3.cmml"><mi id="S2.E13.m1.2.3.2" xref="S2.E13.m1.2.3.2.cmml">g</mi><mrow id="S2.E13.m1.2.2.2.4" xref="S2.E13.m1.2.2.2.3.cmml"><mi id="S2.E13.m1.1.1.1.1" xref="S2.E13.m1.1.1.1.1.cmml">i</mi><mo id="S2.E13.m1.2.2.2.4.1" xref="S2.E13.m1.2.2.2.3.cmml">,</mo><mi id="S2.E13.m1.2.2.2.2" xref="S2.E13.m1.2.2.2.2.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.E13.m1.2b"><apply id="S2.E13.m1.2.3.cmml" xref="S2.E13.m1.2.3"><csymbol cd="ambiguous" id="S2.E13.m1.2.3.1.cmml" xref="S2.E13.m1.2.3">subscript</csymbol><ci id="S2.E13.m1.2.3.2.cmml" xref="S2.E13.m1.2.3.2">𝑔</ci><list id="S2.E13.m1.2.2.2.3.cmml" xref="S2.E13.m1.2.2.2.4"><ci id="S2.E13.m1.1.1.1.1.cmml" xref="S2.E13.m1.1.1.1.1">𝑖</ci><ci id="S2.E13.m1.2.2.2.2.cmml" xref="S2.E13.m1.2.2.2.2">𝑡</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E13.m1.2c">\displaystyle g_{i,t}</annotation><annotation encoding="application/x-llamapun" id="S2.E13.m1.2d">italic_g start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{g^{\prime}_{i,t}}{\sum_{j=1}^{N_{r}}g^{\prime}_{j,t}}," class="ltx_Math" display="inline" id="S2.E13.m2.5"><semantics id="S2.E13.m2.5a"><mrow id="S2.E13.m2.5.5.1" xref="S2.E13.m2.5.5.1.1.cmml"><mrow id="S2.E13.m2.5.5.1.1" xref="S2.E13.m2.5.5.1.1.cmml"><mi id="S2.E13.m2.5.5.1.1.2" xref="S2.E13.m2.5.5.1.1.2.cmml"></mi><mo id="S2.E13.m2.5.5.1.1.1" xref="S2.E13.m2.5.5.1.1.1.cmml">=</mo><mstyle displaystyle="true" id="S2.E13.m2.4.4" xref="S2.E13.m2.4.4.cmml"><mfrac id="S2.E13.m2.4.4a" xref="S2.E13.m2.4.4.cmml"><msubsup id="S2.E13.m2.2.2.2" xref="S2.E13.m2.2.2.2.cmml"><mi id="S2.E13.m2.2.2.2.4.2" xref="S2.E13.m2.2.2.2.4.2.cmml">g</mi><mrow id="S2.E13.m2.2.2.2.2.2.4" xref="S2.E13.m2.2.2.2.2.2.3.cmml"><mi id="S2.E13.m2.1.1.1.1.1.1" xref="S2.E13.m2.1.1.1.1.1.1.cmml">i</mi><mo id="S2.E13.m2.2.2.2.2.2.4.1" xref="S2.E13.m2.2.2.2.2.2.3.cmml">,</mo><mi id="S2.E13.m2.2.2.2.2.2.2" xref="S2.E13.m2.2.2.2.2.2.2.cmml">t</mi></mrow><mo id="S2.E13.m2.2.2.2.4.3" xref="S2.E13.m2.2.2.2.4.3.cmml">′</mo></msubsup><mrow id="S2.E13.m2.4.4.4" xref="S2.E13.m2.4.4.4.cmml"><msubsup id="S2.E13.m2.4.4.4.3" xref="S2.E13.m2.4.4.4.3.cmml"><mo id="S2.E13.m2.4.4.4.3.2.2" xref="S2.E13.m2.4.4.4.3.2.2.cmml">∑</mo><mrow id="S2.E13.m2.4.4.4.3.2.3" xref="S2.E13.m2.4.4.4.3.2.3.cmml"><mi id="S2.E13.m2.4.4.4.3.2.3.2" xref="S2.E13.m2.4.4.4.3.2.3.2.cmml">j</mi><mo id="S2.E13.m2.4.4.4.3.2.3.1" xref="S2.E13.m2.4.4.4.3.2.3.1.cmml">=</mo><mn id="S2.E13.m2.4.4.4.3.2.3.3" xref="S2.E13.m2.4.4.4.3.2.3.3.cmml">1</mn></mrow><msub id="S2.E13.m2.4.4.4.3.3" xref="S2.E13.m2.4.4.4.3.3.cmml"><mi id="S2.E13.m2.4.4.4.3.3.2" xref="S2.E13.m2.4.4.4.3.3.2.cmml">N</mi><mi id="S2.E13.m2.4.4.4.3.3.3" xref="S2.E13.m2.4.4.4.3.3.3.cmml">r</mi></msub></msubsup><msubsup id="S2.E13.m2.4.4.4.4" xref="S2.E13.m2.4.4.4.4.cmml"><mi id="S2.E13.m2.4.4.4.4.2.2" xref="S2.E13.m2.4.4.4.4.2.2.cmml">g</mi><mrow id="S2.E13.m2.4.4.4.2.2.4" xref="S2.E13.m2.4.4.4.2.2.3.cmml"><mi id="S2.E13.m2.3.3.3.1.1.1" xref="S2.E13.m2.3.3.3.1.1.1.cmml">j</mi><mo id="S2.E13.m2.4.4.4.2.2.4.1" xref="S2.E13.m2.4.4.4.2.2.3.cmml">,</mo><mi id="S2.E13.m2.4.4.4.2.2.2" xref="S2.E13.m2.4.4.4.2.2.2.cmml">t</mi></mrow><mo id="S2.E13.m2.4.4.4.4.2.3" xref="S2.E13.m2.4.4.4.4.2.3.cmml">′</mo></msubsup></mrow></mfrac></mstyle></mrow><mo id="S2.E13.m2.5.5.1.2" xref="S2.E13.m2.5.5.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E13.m2.5b"><apply id="S2.E13.m2.5.5.1.1.cmml" xref="S2.E13.m2.5.5.1"><eq id="S2.E13.m2.5.5.1.1.1.cmml" xref="S2.E13.m2.5.5.1.1.1"></eq><csymbol cd="latexml" id="S2.E13.m2.5.5.1.1.2.cmml" xref="S2.E13.m2.5.5.1.1.2">absent</csymbol><apply id="S2.E13.m2.4.4.cmml" xref="S2.E13.m2.4.4"><divide id="S2.E13.m2.4.4.5.cmml" xref="S2.E13.m2.4.4"></divide><apply id="S2.E13.m2.2.2.2.cmml" xref="S2.E13.m2.2.2.2"><csymbol cd="ambiguous" id="S2.E13.m2.2.2.2.3.cmml" xref="S2.E13.m2.2.2.2">subscript</csymbol><apply id="S2.E13.m2.2.2.2.4.cmml" xref="S2.E13.m2.2.2.2"><csymbol cd="ambiguous" id="S2.E13.m2.2.2.2.4.1.cmml" xref="S2.E13.m2.2.2.2">superscript</csymbol><ci id="S2.E13.m2.2.2.2.4.2.cmml" xref="S2.E13.m2.2.2.2.4.2">𝑔</ci><ci id="S2.E13.m2.2.2.2.4.3.cmml" xref="S2.E13.m2.2.2.2.4.3">′</ci></apply><list id="S2.E13.m2.2.2.2.2.2.3.cmml" xref="S2.E13.m2.2.2.2.2.2.4"><ci id="S2.E13.m2.1.1.1.1.1.1.cmml" xref="S2.E13.m2.1.1.1.1.1.1">𝑖</ci><ci id="S2.E13.m2.2.2.2.2.2.2.cmml" xref="S2.E13.m2.2.2.2.2.2.2">𝑡</ci></list></apply><apply id="S2.E13.m2.4.4.4.cmml" xref="S2.E13.m2.4.4.4"><apply id="S2.E13.m2.4.4.4.3.cmml" xref="S2.E13.m2.4.4.4.3"><csymbol cd="ambiguous" id="S2.E13.m2.4.4.4.3.1.cmml" xref="S2.E13.m2.4.4.4.3">superscript</csymbol><apply id="S2.E13.m2.4.4.4.3.2.cmml" xref="S2.E13.m2.4.4.4.3"><csymbol cd="ambiguous" id="S2.E13.m2.4.4.4.3.2.1.cmml" xref="S2.E13.m2.4.4.4.3">subscript</csymbol><sum id="S2.E13.m2.4.4.4.3.2.2.cmml" xref="S2.E13.m2.4.4.4.3.2.2"></sum><apply id="S2.E13.m2.4.4.4.3.2.3.cmml" xref="S2.E13.m2.4.4.4.3.2.3"><eq id="S2.E13.m2.4.4.4.3.2.3.1.cmml" xref="S2.E13.m2.4.4.4.3.2.3.1"></eq><ci id="S2.E13.m2.4.4.4.3.2.3.2.cmml" xref="S2.E13.m2.4.4.4.3.2.3.2">𝑗</ci><cn id="S2.E13.m2.4.4.4.3.2.3.3.cmml" type="integer" xref="S2.E13.m2.4.4.4.3.2.3.3">1</cn></apply></apply><apply id="S2.E13.m2.4.4.4.3.3.cmml" xref="S2.E13.m2.4.4.4.3.3"><csymbol cd="ambiguous" id="S2.E13.m2.4.4.4.3.3.1.cmml" xref="S2.E13.m2.4.4.4.3.3">subscript</csymbol><ci id="S2.E13.m2.4.4.4.3.3.2.cmml" xref="S2.E13.m2.4.4.4.3.3.2">𝑁</ci><ci id="S2.E13.m2.4.4.4.3.3.3.cmml" xref="S2.E13.m2.4.4.4.3.3.3">𝑟</ci></apply></apply><apply id="S2.E13.m2.4.4.4.4.cmml" xref="S2.E13.m2.4.4.4.4"><csymbol cd="ambiguous" id="S2.E13.m2.4.4.4.4.1.cmml" xref="S2.E13.m2.4.4.4.4">subscript</csymbol><apply id="S2.E13.m2.4.4.4.4.2.cmml" xref="S2.E13.m2.4.4.4.4"><csymbol cd="ambiguous" id="S2.E13.m2.4.4.4.4.2.1.cmml" xref="S2.E13.m2.4.4.4.4">superscript</csymbol><ci id="S2.E13.m2.4.4.4.4.2.2.cmml" xref="S2.E13.m2.4.4.4.4.2.2">𝑔</ci><ci id="S2.E13.m2.4.4.4.4.2.3.cmml" xref="S2.E13.m2.4.4.4.4.2.3">′</ci></apply><list id="S2.E13.m2.4.4.4.2.2.3.cmml" xref="S2.E13.m2.4.4.4.2.2.4"><ci id="S2.E13.m2.3.3.3.1.1.1.cmml" xref="S2.E13.m2.3.3.3.1.1.1">𝑗</ci><ci id="S2.E13.m2.4.4.4.2.2.2.cmml" xref="S2.E13.m2.4.4.4.2.2.2">𝑡</ci></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E13.m2.5c">\displaystyle=\frac{g^{\prime}_{i,t}}{\sum_{j=1}^{N_{r}}g^{\prime}_{j,t}},</annotation><annotation encoding="application/x-llamapun" id="S2.E13.m2.5d">= divide start_ARG italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT end_POSTSUPERSCRIPT italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_j , italic_t end_POSTSUBSCRIPT end_ARG ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(13)</span></td>
</tr></tbody>
<tbody id="S2.E14"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle g^{\prime}_{i,t}" class="ltx_Math" display="inline" id="S2.E14.m1.2"><semantics id="S2.E14.m1.2a"><msubsup id="S2.E14.m1.2.3" xref="S2.E14.m1.2.3.cmml"><mi id="S2.E14.m1.2.3.2.2" xref="S2.E14.m1.2.3.2.2.cmml">g</mi><mrow id="S2.E14.m1.2.2.2.4" xref="S2.E14.m1.2.2.2.3.cmml"><mi id="S2.E14.m1.1.1.1.1" xref="S2.E14.m1.1.1.1.1.cmml">i</mi><mo id="S2.E14.m1.2.2.2.4.1" xref="S2.E14.m1.2.2.2.3.cmml">,</mo><mi id="S2.E14.m1.2.2.2.2" xref="S2.E14.m1.2.2.2.2.cmml">t</mi></mrow><mo id="S2.E14.m1.2.3.2.3" xref="S2.E14.m1.2.3.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S2.E14.m1.2b"><apply id="S2.E14.m1.2.3.cmml" xref="S2.E14.m1.2.3"><csymbol cd="ambiguous" id="S2.E14.m1.2.3.1.cmml" xref="S2.E14.m1.2.3">subscript</csymbol><apply id="S2.E14.m1.2.3.2.cmml" xref="S2.E14.m1.2.3"><csymbol cd="ambiguous" id="S2.E14.m1.2.3.2.1.cmml" xref="S2.E14.m1.2.3">superscript</csymbol><ci id="S2.E14.m1.2.3.2.2.cmml" xref="S2.E14.m1.2.3.2.2">𝑔</ci><ci id="S2.E14.m1.2.3.2.3.cmml" xref="S2.E14.m1.2.3.2.3">′</ci></apply><list id="S2.E14.m1.2.2.2.3.cmml" xref="S2.E14.m1.2.2.2.4"><ci id="S2.E14.m1.1.1.1.1.cmml" xref="S2.E14.m1.1.1.1.1">𝑖</ci><ci id="S2.E14.m1.2.2.2.2.cmml" xref="S2.E14.m1.2.2.2.2">𝑡</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E14.m1.2c">\displaystyle g^{\prime}_{i,t}</annotation><annotation encoding="application/x-llamapun" id="S2.E14.m1.2d">italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\begin{cases}s_{i,t},&amp;s_{i,t}\in\operatorname{Topk}(\{s_{j,t}|1%
\leqslant j\leqslant N_{r}\},K_{r}),\\
0,&amp;\text{otherwise},\end{cases}" class="ltx_Math" display="inline" id="S2.E14.m2.4"><semantics id="S2.E14.m2.4a"><mrow id="S2.E14.m2.4.5" xref="S2.E14.m2.4.5.cmml"><mi id="S2.E14.m2.4.5.2" xref="S2.E14.m2.4.5.2.cmml"></mi><mo id="S2.E14.m2.4.5.1" xref="S2.E14.m2.4.5.1.cmml">=</mo><mrow id="S2.E14.m2.4.4a" xref="S2.E14.m2.4.5.3.1.cmml"><mo id="S2.E14.m2.4.4a.5" xref="S2.E14.m2.4.5.3.1.1.cmml">{</mo><mtable columnspacing="5pt" id="S2.E14.m2.4.4.4a" rowspacing="0pt" xref="S2.E14.m2.4.5.3.1.cmml"><mtr id="S2.E14.m2.4.4.4aa" xref="S2.E14.m2.4.5.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S2.E14.m2.4.4.4ab" xref="S2.E14.m2.4.5.3.1.cmml"><mrow id="S2.E14.m2.1.1.1.1.1.1.3" xref="S2.E14.m2.1.1.1.1.1.1.3.1.cmml"><msub id="S2.E14.m2.1.1.1.1.1.1.3.1" xref="S2.E14.m2.1.1.1.1.1.1.3.1.cmml"><mi id="S2.E14.m2.1.1.1.1.1.1.3.1.2" xref="S2.E14.m2.1.1.1.1.1.1.3.1.2.cmml">s</mi><mrow id="S2.E14.m2.1.1.1.1.1.1.2.2.4" xref="S2.E14.m2.1.1.1.1.1.1.2.2.3.cmml"><mi id="S2.E14.m2.1.1.1.1.1.1.1.1.1" xref="S2.E14.m2.1.1.1.1.1.1.1.1.1.cmml">i</mi><mo id="S2.E14.m2.1.1.1.1.1.1.2.2.4.1" xref="S2.E14.m2.1.1.1.1.1.1.2.2.3.cmml">,</mo><mi id="S2.E14.m2.1.1.1.1.1.1.2.2.2" xref="S2.E14.m2.1.1.1.1.1.1.2.2.2.cmml">t</mi></mrow></msub><mo id="S2.E14.m2.1.1.1.1.1.1.3.2" xref="S2.E14.m2.1.1.1.1.1.1.3.1.cmml">,</mo></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S2.E14.m2.4.4.4ac" xref="S2.E14.m2.4.5.3.1.cmml"><mrow id="S2.E14.m2.2.2.2.2.2.1.6" xref="S2.E14.m2.2.2.2.2.2.1.6.1.cmml"><mrow id="S2.E14.m2.2.2.2.2.2.1.6.1" xref="S2.E14.m2.2.2.2.2.2.1.6.1.cmml"><msub id="S2.E14.m2.2.2.2.2.2.1.6.1.4" xref="S2.E14.m2.2.2.2.2.2.1.6.1.4.cmml"><mi id="S2.E14.m2.2.2.2.2.2.1.6.1.4.2" xref="S2.E14.m2.2.2.2.2.2.1.6.1.4.2.cmml">s</mi><mrow id="S2.E14.m2.2.2.2.2.2.1.2.2.4" xref="S2.E14.m2.2.2.2.2.2.1.2.2.3.cmml"><mi id="S2.E14.m2.2.2.2.2.2.1.1.1.1" xref="S2.E14.m2.2.2.2.2.2.1.1.1.1.cmml">i</mi><mo id="S2.E14.m2.2.2.2.2.2.1.2.2.4.1" xref="S2.E14.m2.2.2.2.2.2.1.2.2.3.cmml">,</mo><mi id="S2.E14.m2.2.2.2.2.2.1.2.2.2" xref="S2.E14.m2.2.2.2.2.2.1.2.2.2.cmml">t</mi></mrow></msub><mo id="S2.E14.m2.2.2.2.2.2.1.6.1.3" xref="S2.E14.m2.2.2.2.2.2.1.6.1.3.cmml">∈</mo><mrow id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.3.cmml"><mi id="S2.E14.m2.2.2.2.2.2.1.5" xref="S2.E14.m2.2.2.2.2.2.1.5.cmml">Topk</mi><mo id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2a" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.3.cmml">⁡</mo><mrow id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.3.cmml"><mo id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.3" stretchy="false" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.3.cmml">(</mo><mrow id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.cmml"><mo id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.3" stretchy="false" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.1.cmml">{</mo><msub id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.cmml"><mi id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2.cmml">s</mi><mrow id="S2.E14.m2.2.2.2.2.2.1.4.2.4" xref="S2.E14.m2.2.2.2.2.2.1.4.2.3.cmml"><mi id="S2.E14.m2.2.2.2.2.2.1.3.1.1" xref="S2.E14.m2.2.2.2.2.2.1.3.1.1.cmml">j</mi><mo id="S2.E14.m2.2.2.2.2.2.1.4.2.4.1" xref="S2.E14.m2.2.2.2.2.2.1.4.2.3.cmml">,</mo><mi id="S2.E14.m2.2.2.2.2.2.1.4.2.2" xref="S2.E14.m2.2.2.2.2.2.1.4.2.2.cmml">t</mi></mrow></msub><mo id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.4" lspace="0em" rspace="0em" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.1.cmml">|</mo><mrow id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.cmml"><mn id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.2" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.2.cmml">1</mn><mo id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.3" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.3.cmml">⩽</mo><mi id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.4" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.4.cmml">j</mi><mo id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.5" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.5.cmml">⩽</mo><msub id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.cmml"><mi id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.2" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.2.cmml">N</mi><mi id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.3" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.3.cmml">r</mi></msub></mrow><mo id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.5" stretchy="false" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.1.cmml">}</mo></mrow><mo id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.4" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.3.cmml">,</mo><msub id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2.cmml"><mi id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2.2" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2.2.cmml">K</mi><mi id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2.3" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2.3.cmml">r</mi></msub><mo id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.5" stretchy="false" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.3.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E14.m2.2.2.2.2.2.1.6.2" xref="S2.E14.m2.2.2.2.2.2.1.6.1.cmml">,</mo></mrow></mtd></mtr><mtr id="S2.E14.m2.4.4.4ad" xref="S2.E14.m2.4.5.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S2.E14.m2.4.4.4ae" xref="S2.E14.m2.4.5.3.1.cmml"><mrow id="S2.E14.m2.3.3.3.3.1.1.3" xref="S2.E14.m2.4.5.3.1.cmml"><mn id="S2.E14.m2.3.3.3.3.1.1.1" xref="S2.E14.m2.3.3.3.3.1.1.1.cmml">0</mn><mo id="S2.E14.m2.3.3.3.3.1.1.3.1" xref="S2.E14.m2.4.5.3.1.cmml">,</mo></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S2.E14.m2.4.4.4af" xref="S2.E14.m2.4.5.3.1.cmml"><mrow id="S2.E14.m2.4.4.4.4.2.1.3" xref="S2.E14.m2.4.4.4.4.2.1.1a.cmml"><mtext id="S2.E14.m2.4.4.4.4.2.1.1" xref="S2.E14.m2.4.4.4.4.2.1.1.cmml">otherwise</mtext><mo id="S2.E14.m2.4.4.4.4.2.1.3.1" xref="S2.E14.m2.4.4.4.4.2.1.1a.cmml">,</mo></mrow></mtd></mtr></mtable></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E14.m2.4b"><apply id="S2.E14.m2.4.5.cmml" xref="S2.E14.m2.4.5"><eq id="S2.E14.m2.4.5.1.cmml" xref="S2.E14.m2.4.5.1"></eq><csymbol cd="latexml" id="S2.E14.m2.4.5.2.cmml" xref="S2.E14.m2.4.5.2">absent</csymbol><apply id="S2.E14.m2.4.5.3.1.cmml" xref="S2.E14.m2.4.4a"><csymbol cd="latexml" id="S2.E14.m2.4.5.3.1.1.cmml" xref="S2.E14.m2.4.4a.5">cases</csymbol><apply id="S2.E14.m2.1.1.1.1.1.1.3.1.cmml" xref="S2.E14.m2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E14.m2.1.1.1.1.1.1.3.1.1.cmml" xref="S2.E14.m2.1.1.1.1.1.1.3">subscript</csymbol><ci id="S2.E14.m2.1.1.1.1.1.1.3.1.2.cmml" xref="S2.E14.m2.1.1.1.1.1.1.3.1.2">𝑠</ci><list id="S2.E14.m2.1.1.1.1.1.1.2.2.3.cmml" xref="S2.E14.m2.1.1.1.1.1.1.2.2.4"><ci id="S2.E14.m2.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E14.m2.1.1.1.1.1.1.1.1.1">𝑖</ci><ci id="S2.E14.m2.1.1.1.1.1.1.2.2.2.cmml" xref="S2.E14.m2.1.1.1.1.1.1.2.2.2">𝑡</ci></list></apply><apply id="S2.E14.m2.2.2.2.2.2.1.6.1.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6"><in id="S2.E14.m2.2.2.2.2.2.1.6.1.3.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.3"></in><apply id="S2.E14.m2.2.2.2.2.2.1.6.1.4.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.4"><csymbol cd="ambiguous" id="S2.E14.m2.2.2.2.2.2.1.6.1.4.1.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.4">subscript</csymbol><ci id="S2.E14.m2.2.2.2.2.2.1.6.1.4.2.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.4.2">𝑠</ci><list id="S2.E14.m2.2.2.2.2.2.1.2.2.3.cmml" xref="S2.E14.m2.2.2.2.2.2.1.2.2.4"><ci id="S2.E14.m2.2.2.2.2.2.1.1.1.1.cmml" xref="S2.E14.m2.2.2.2.2.2.1.1.1.1">𝑖</ci><ci id="S2.E14.m2.2.2.2.2.2.1.2.2.2.cmml" xref="S2.E14.m2.2.2.2.2.2.1.2.2.2">𝑡</ci></list></apply><apply id="S2.E14.m2.2.2.2.2.2.1.6.1.2.3.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.2"><ci id="S2.E14.m2.2.2.2.2.2.1.5.cmml" xref="S2.E14.m2.2.2.2.2.2.1.5">Topk</ci><apply id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2"><csymbol cd="latexml" id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.1.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.3">conditional-set</csymbol><apply id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.1.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2">𝑠</ci><list id="S2.E14.m2.2.2.2.2.2.1.4.2.3.cmml" xref="S2.E14.m2.2.2.2.2.2.1.4.2.4"><ci id="S2.E14.m2.2.2.2.2.2.1.3.1.1.cmml" xref="S2.E14.m2.2.2.2.2.2.1.3.1.1">𝑗</ci><ci id="S2.E14.m2.2.2.2.2.2.1.4.2.2.cmml" xref="S2.E14.m2.2.2.2.2.2.1.4.2.2">𝑡</ci></list></apply><apply id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2"><and id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2a.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2"></and><apply id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2b.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2"><leq id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.3.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.3"></leq><cn id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.2.cmml" type="integer" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.2">1</cn><ci id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.4.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.4">𝑗</ci></apply><apply id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2c.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2"><leq id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.5.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.5"></leq><share href="https://arxiv.org/html/2412.19437v1#S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.4.cmml" id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2d.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2"></share><apply id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6"><csymbol cd="ambiguous" id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.1.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6">subscript</csymbol><ci id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.2.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.2">𝑁</ci><ci id="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.3.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.3">𝑟</ci></apply></apply></apply></apply><apply id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2"><csymbol cd="ambiguous" id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2.1.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2">subscript</csymbol><ci id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2.2.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2.2">𝐾</ci><ci id="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2.3.cmml" xref="S2.E14.m2.2.2.2.2.2.1.6.1.2.2.2.2.3">𝑟</ci></apply></apply></apply><cn id="S2.E14.m2.3.3.3.3.1.1.1.cmml" type="integer" xref="S2.E14.m2.3.3.3.3.1.1.1">0</cn><ci id="S2.E14.m2.4.4.4.4.2.1.1a.cmml" xref="S2.E14.m2.4.4.4.4.2.1.3"><mtext id="S2.E14.m2.4.4.4.4.2.1.1.cmml" xref="S2.E14.m2.4.4.4.4.2.1.1">otherwise</mtext></ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E14.m2.4c">\displaystyle=\begin{cases}s_{i,t},&amp;s_{i,t}\in\operatorname{Topk}(\{s_{j,t}|1%
\leqslant j\leqslant N_{r}\},K_{r}),\\
0,&amp;\text{otherwise},\end{cases}</annotation><annotation encoding="application/x-llamapun" id="S2.E14.m2.4d">= { start_ROW start_CELL italic_s start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT , end_CELL start_CELL italic_s start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT ∈ roman_Topk ( { italic_s start_POSTSUBSCRIPT italic_j , italic_t end_POSTSUBSCRIPT | 1 ⩽ italic_j ⩽ italic_N start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT } , italic_K start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ) , end_CELL end_ROW start_ROW start_CELL 0 , end_CELL start_CELL otherwise , end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(14)</span></td>
</tr></tbody>
<tbody id="S2.E15"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle s_{i,t}" class="ltx_Math" display="inline" id="S2.E15.m1.2"><semantics id="S2.E15.m1.2a"><msub id="S2.E15.m1.2.3" xref="S2.E15.m1.2.3.cmml"><mi id="S2.E15.m1.2.3.2" xref="S2.E15.m1.2.3.2.cmml">s</mi><mrow id="S2.E15.m1.2.2.2.4" xref="S2.E15.m1.2.2.2.3.cmml"><mi id="S2.E15.m1.1.1.1.1" xref="S2.E15.m1.1.1.1.1.cmml">i</mi><mo id="S2.E15.m1.2.2.2.4.1" xref="S2.E15.m1.2.2.2.3.cmml">,</mo><mi id="S2.E15.m1.2.2.2.2" xref="S2.E15.m1.2.2.2.2.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.E15.m1.2b"><apply id="S2.E15.m1.2.3.cmml" xref="S2.E15.m1.2.3"><csymbol cd="ambiguous" id="S2.E15.m1.2.3.1.cmml" xref="S2.E15.m1.2.3">subscript</csymbol><ci id="S2.E15.m1.2.3.2.cmml" xref="S2.E15.m1.2.3.2">𝑠</ci><list id="S2.E15.m1.2.2.2.3.cmml" xref="S2.E15.m1.2.2.2.4"><ci id="S2.E15.m1.1.1.1.1.cmml" xref="S2.E15.m1.1.1.1.1">𝑖</ci><ci id="S2.E15.m1.2.2.2.2.cmml" xref="S2.E15.m1.2.2.2.2">𝑡</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E15.m1.2c">\displaystyle s_{i,t}</annotation><annotation encoding="application/x-llamapun" id="S2.E15.m1.2d">italic_s start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\operatorname{Sigmoid}\left({\mathbf{u}_{t}}^{T}\mathbf{e}_{i}%
\right)," class="ltx_Math" display="inline" id="S2.E15.m2.2"><semantics id="S2.E15.m2.2a"><mrow id="S2.E15.m2.2.2.1" xref="S2.E15.m2.2.2.1.1.cmml"><mrow id="S2.E15.m2.2.2.1.1" xref="S2.E15.m2.2.2.1.1.cmml"><mi id="S2.E15.m2.2.2.1.1.3" xref="S2.E15.m2.2.2.1.1.3.cmml"></mi><mo id="S2.E15.m2.2.2.1.1.2" xref="S2.E15.m2.2.2.1.1.2.cmml">=</mo><mrow id="S2.E15.m2.2.2.1.1.1.1" xref="S2.E15.m2.2.2.1.1.1.2.cmml"><mi id="S2.E15.m2.1.1" xref="S2.E15.m2.1.1.cmml">Sigmoid</mi><mo id="S2.E15.m2.2.2.1.1.1.1a" xref="S2.E15.m2.2.2.1.1.1.2.cmml">⁡</mo><mrow id="S2.E15.m2.2.2.1.1.1.1.1" xref="S2.E15.m2.2.2.1.1.1.2.cmml"><mo id="S2.E15.m2.2.2.1.1.1.1.1.2" xref="S2.E15.m2.2.2.1.1.1.2.cmml">(</mo><mrow id="S2.E15.m2.2.2.1.1.1.1.1.1" xref="S2.E15.m2.2.2.1.1.1.1.1.1.cmml"><mmultiscripts id="S2.E15.m2.2.2.1.1.1.1.1.1.2" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2.cmml"><mi id="S2.E15.m2.2.2.1.1.1.1.1.1.2.2.2" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2.2.2.cmml">𝐮</mi><mi id="S2.E15.m2.2.2.1.1.1.1.1.1.2.2.3" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2.2.3.cmml">t</mi><mrow id="S2.E15.m2.2.2.1.1.1.1.1.1.2a" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2.cmml"></mrow><mrow id="S2.E15.m2.2.2.1.1.1.1.1.1.2b" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2.cmml"></mrow><mi id="S2.E15.m2.2.2.1.1.1.1.1.1.2.3" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2.3.cmml">T</mi></mmultiscripts><mo id="S2.E15.m2.2.2.1.1.1.1.1.1.1" xref="S2.E15.m2.2.2.1.1.1.1.1.1.1.cmml">⁢</mo><msub id="S2.E15.m2.2.2.1.1.1.1.1.1.3" xref="S2.E15.m2.2.2.1.1.1.1.1.1.3.cmml"><mi id="S2.E15.m2.2.2.1.1.1.1.1.1.3.2" xref="S2.E15.m2.2.2.1.1.1.1.1.1.3.2.cmml">𝐞</mi><mi id="S2.E15.m2.2.2.1.1.1.1.1.1.3.3" xref="S2.E15.m2.2.2.1.1.1.1.1.1.3.3.cmml">i</mi></msub></mrow><mo id="S2.E15.m2.2.2.1.1.1.1.1.3" xref="S2.E15.m2.2.2.1.1.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E15.m2.2.2.1.2" xref="S2.E15.m2.2.2.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E15.m2.2b"><apply id="S2.E15.m2.2.2.1.1.cmml" xref="S2.E15.m2.2.2.1"><eq id="S2.E15.m2.2.2.1.1.2.cmml" xref="S2.E15.m2.2.2.1.1.2"></eq><csymbol cd="latexml" id="S2.E15.m2.2.2.1.1.3.cmml" xref="S2.E15.m2.2.2.1.1.3">absent</csymbol><apply id="S2.E15.m2.2.2.1.1.1.2.cmml" xref="S2.E15.m2.2.2.1.1.1.1"><ci id="S2.E15.m2.1.1.cmml" xref="S2.E15.m2.1.1">Sigmoid</ci><apply id="S2.E15.m2.2.2.1.1.1.1.1.1.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1"><times id="S2.E15.m2.2.2.1.1.1.1.1.1.1.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.1"></times><apply id="S2.E15.m2.2.2.1.1.1.1.1.1.2.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E15.m2.2.2.1.1.1.1.1.1.2.1.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2">superscript</csymbol><apply id="S2.E15.m2.2.2.1.1.1.1.1.1.2.2.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E15.m2.2.2.1.1.1.1.1.1.2.2.1.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2">subscript</csymbol><ci id="S2.E15.m2.2.2.1.1.1.1.1.1.2.2.2.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2.2.2">𝐮</ci><ci id="S2.E15.m2.2.2.1.1.1.1.1.1.2.2.3.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2.2.3">𝑡</ci></apply><ci id="S2.E15.m2.2.2.1.1.1.1.1.1.2.3.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.2.3">𝑇</ci></apply><apply id="S2.E15.m2.2.2.1.1.1.1.1.1.3.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E15.m2.2.2.1.1.1.1.1.1.3.1.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.3">subscript</csymbol><ci id="S2.E15.m2.2.2.1.1.1.1.1.1.3.2.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.3.2">𝐞</ci><ci id="S2.E15.m2.2.2.1.1.1.1.1.1.3.3.cmml" xref="S2.E15.m2.2.2.1.1.1.1.1.1.3.3">𝑖</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E15.m2.2c">\displaystyle=\operatorname{Sigmoid}\left({\mathbf{u}_{t}}^{T}\mathbf{e}_{i}%
\right),</annotation><annotation encoding="application/x-llamapun" id="S2.E15.m2.2d">= roman_Sigmoid ( bold_u start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT bold_e start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(15)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS1.SSS2.Px1.p1.18">where <math alttext="N_{s}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.4.m1.1"><semantics id="S2.SS1.SSS2.Px1.p1.4.m1.1a"><msub id="S2.SS1.SSS2.Px1.p1.4.m1.1.1" xref="S2.SS1.SSS2.Px1.p1.4.m1.1.1.cmml"><mi id="S2.SS1.SSS2.Px1.p1.4.m1.1.1.2" xref="S2.SS1.SSS2.Px1.p1.4.m1.1.1.2.cmml">N</mi><mi id="S2.SS1.SSS2.Px1.p1.4.m1.1.1.3" xref="S2.SS1.SSS2.Px1.p1.4.m1.1.1.3.cmml">s</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.4.m1.1b"><apply id="S2.SS1.SSS2.Px1.p1.4.m1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.4.m1.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.4.m1.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.4.m1.1.1">subscript</csymbol><ci id="S2.SS1.SSS2.Px1.p1.4.m1.1.1.2.cmml" xref="S2.SS1.SSS2.Px1.p1.4.m1.1.1.2">𝑁</ci><ci id="S2.SS1.SSS2.Px1.p1.4.m1.1.1.3.cmml" xref="S2.SS1.SSS2.Px1.p1.4.m1.1.1.3">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.4.m1.1c">N_{s}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.4.m1.1d">italic_N start_POSTSUBSCRIPT italic_s end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="N_{r}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.5.m2.1"><semantics id="S2.SS1.SSS2.Px1.p1.5.m2.1a"><msub id="S2.SS1.SSS2.Px1.p1.5.m2.1.1" xref="S2.SS1.SSS2.Px1.p1.5.m2.1.1.cmml"><mi id="S2.SS1.SSS2.Px1.p1.5.m2.1.1.2" xref="S2.SS1.SSS2.Px1.p1.5.m2.1.1.2.cmml">N</mi><mi id="S2.SS1.SSS2.Px1.p1.5.m2.1.1.3" xref="S2.SS1.SSS2.Px1.p1.5.m2.1.1.3.cmml">r</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.5.m2.1b"><apply id="S2.SS1.SSS2.Px1.p1.5.m2.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.5.m2.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.5.m2.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.5.m2.1.1">subscript</csymbol><ci id="S2.SS1.SSS2.Px1.p1.5.m2.1.1.2.cmml" xref="S2.SS1.SSS2.Px1.p1.5.m2.1.1.2">𝑁</ci><ci id="S2.SS1.SSS2.Px1.p1.5.m2.1.1.3.cmml" xref="S2.SS1.SSS2.Px1.p1.5.m2.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.5.m2.1c">N_{r}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.5.m2.1d">italic_N start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT</annotation></semantics></math> denote the numbers of shared experts and routed experts, respectively;
<math alttext="\operatorname{FFN}^{(s)}_{i}(\cdot)" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.6.m3.3"><semantics id="S2.SS1.SSS2.Px1.p1.6.m3.3a"><mrow id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.2.cmml"><msubsup id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.cmml"><mi id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.2.2" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.2.2.cmml">FFN</mi><mi id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.3" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.3.cmml">i</mi><mrow id="S2.SS1.SSS2.Px1.p1.6.m3.1.1.1.3" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.cmml"><mo id="S2.SS1.SSS2.Px1.p1.6.m3.1.1.1.3.1" stretchy="false" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.cmml">(</mo><mi id="S2.SS1.SSS2.Px1.p1.6.m3.1.1.1.1" xref="S2.SS1.SSS2.Px1.p1.6.m3.1.1.1.1.cmml">s</mi><mo id="S2.SS1.SSS2.Px1.p1.6.m3.1.1.1.3.2" stretchy="false" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.cmml">)</mo></mrow></msubsup><mo id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1a" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.2.cmml">⁡</mo><mrow id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.2" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.2.cmml"><mo id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.2.1" stretchy="false" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.2.cmml">(</mo><mo id="S2.SS1.SSS2.Px1.p1.6.m3.2.2" lspace="0em" rspace="0em" xref="S2.SS1.SSS2.Px1.p1.6.m3.2.2.cmml">⋅</mo><mo id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.2.2" stretchy="false" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.6.m3.3b"><apply id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.2.cmml" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1"><apply id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1">subscript</csymbol><apply id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.2.cmml" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.2.1.cmml" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1">superscript</csymbol><ci id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.2.2.cmml" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.2.2">FFN</ci><ci id="S2.SS1.SSS2.Px1.p1.6.m3.1.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.6.m3.1.1.1.1">𝑠</ci></apply><ci id="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.3.cmml" xref="S2.SS1.SSS2.Px1.p1.6.m3.3.3.1.1.3">𝑖</ci></apply><ci id="S2.SS1.SSS2.Px1.p1.6.m3.2.2.cmml" xref="S2.SS1.SSS2.Px1.p1.6.m3.2.2">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.6.m3.3c">\operatorname{FFN}^{(s)}_{i}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.6.m3.3d">roman_FFN start_POSTSUPERSCRIPT ( italic_s ) end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ( ⋅ )</annotation></semantics></math> and <math alttext="\operatorname{FFN}^{(r)}_{i}(\cdot)" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.7.m4.3"><semantics id="S2.SS1.SSS2.Px1.p1.7.m4.3a"><mrow id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.2.cmml"><msubsup id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.cmml"><mi id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.2.2" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.2.2.cmml">FFN</mi><mi id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.3" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.3.cmml">i</mi><mrow id="S2.SS1.SSS2.Px1.p1.7.m4.1.1.1.3" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.cmml"><mo id="S2.SS1.SSS2.Px1.p1.7.m4.1.1.1.3.1" stretchy="false" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.cmml">(</mo><mi id="S2.SS1.SSS2.Px1.p1.7.m4.1.1.1.1" xref="S2.SS1.SSS2.Px1.p1.7.m4.1.1.1.1.cmml">r</mi><mo id="S2.SS1.SSS2.Px1.p1.7.m4.1.1.1.3.2" stretchy="false" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.cmml">)</mo></mrow></msubsup><mo id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1a" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.2.cmml">⁡</mo><mrow id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.2" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.2.cmml"><mo id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.2.1" stretchy="false" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.2.cmml">(</mo><mo id="S2.SS1.SSS2.Px1.p1.7.m4.2.2" lspace="0em" rspace="0em" xref="S2.SS1.SSS2.Px1.p1.7.m4.2.2.cmml">⋅</mo><mo id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.2.2" stretchy="false" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.7.m4.3b"><apply id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.2.cmml" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1"><apply id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1">subscript</csymbol><apply id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.2.cmml" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.2.1.cmml" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1">superscript</csymbol><ci id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.2.2.cmml" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.2.2">FFN</ci><ci id="S2.SS1.SSS2.Px1.p1.7.m4.1.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.7.m4.1.1.1.1">𝑟</ci></apply><ci id="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.3.cmml" xref="S2.SS1.SSS2.Px1.p1.7.m4.3.3.1.1.3">𝑖</ci></apply><ci id="S2.SS1.SSS2.Px1.p1.7.m4.2.2.cmml" xref="S2.SS1.SSS2.Px1.p1.7.m4.2.2">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.7.m4.3c">\operatorname{FFN}^{(r)}_{i}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.7.m4.3d">roman_FFN start_POSTSUPERSCRIPT ( italic_r ) end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ( ⋅ )</annotation></semantics></math> denote the <math alttext="i" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.8.m5.1"><semantics id="S2.SS1.SSS2.Px1.p1.8.m5.1a"><mi id="S2.SS1.SSS2.Px1.p1.8.m5.1.1" xref="S2.SS1.SSS2.Px1.p1.8.m5.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.8.m5.1b"><ci id="S2.SS1.SSS2.Px1.p1.8.m5.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.8.m5.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.8.m5.1c">i</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.8.m5.1d">italic_i</annotation></semantics></math>-th shared expert and the <math alttext="i" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.9.m6.1"><semantics id="S2.SS1.SSS2.Px1.p1.9.m6.1a"><mi id="S2.SS1.SSS2.Px1.p1.9.m6.1.1" xref="S2.SS1.SSS2.Px1.p1.9.m6.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.9.m6.1b"><ci id="S2.SS1.SSS2.Px1.p1.9.m6.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.9.m6.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.9.m6.1c">i</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.9.m6.1d">italic_i</annotation></semantics></math>-th routed expert, respectively;
<math alttext="K_{r}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.10.m7.1"><semantics id="S2.SS1.SSS2.Px1.p1.10.m7.1a"><msub id="S2.SS1.SSS2.Px1.p1.10.m7.1.1" xref="S2.SS1.SSS2.Px1.p1.10.m7.1.1.cmml"><mi id="S2.SS1.SSS2.Px1.p1.10.m7.1.1.2" xref="S2.SS1.SSS2.Px1.p1.10.m7.1.1.2.cmml">K</mi><mi id="S2.SS1.SSS2.Px1.p1.10.m7.1.1.3" xref="S2.SS1.SSS2.Px1.p1.10.m7.1.1.3.cmml">r</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.10.m7.1b"><apply id="S2.SS1.SSS2.Px1.p1.10.m7.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.10.m7.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.10.m7.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.10.m7.1.1">subscript</csymbol><ci id="S2.SS1.SSS2.Px1.p1.10.m7.1.1.2.cmml" xref="S2.SS1.SSS2.Px1.p1.10.m7.1.1.2">𝐾</ci><ci id="S2.SS1.SSS2.Px1.p1.10.m7.1.1.3.cmml" xref="S2.SS1.SSS2.Px1.p1.10.m7.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.10.m7.1c">K_{r}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.10.m7.1d">italic_K start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT</annotation></semantics></math> denotes the number of activated routed experts;
<math alttext="g_{i,t}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.11.m8.2"><semantics id="S2.SS1.SSS2.Px1.p1.11.m8.2a"><msub id="S2.SS1.SSS2.Px1.p1.11.m8.2.3" xref="S2.SS1.SSS2.Px1.p1.11.m8.2.3.cmml"><mi id="S2.SS1.SSS2.Px1.p1.11.m8.2.3.2" xref="S2.SS1.SSS2.Px1.p1.11.m8.2.3.2.cmml">g</mi><mrow id="S2.SS1.SSS2.Px1.p1.11.m8.2.2.2.4" xref="S2.SS1.SSS2.Px1.p1.11.m8.2.2.2.3.cmml"><mi id="S2.SS1.SSS2.Px1.p1.11.m8.1.1.1.1" xref="S2.SS1.SSS2.Px1.p1.11.m8.1.1.1.1.cmml">i</mi><mo id="S2.SS1.SSS2.Px1.p1.11.m8.2.2.2.4.1" xref="S2.SS1.SSS2.Px1.p1.11.m8.2.2.2.3.cmml">,</mo><mi id="S2.SS1.SSS2.Px1.p1.11.m8.2.2.2.2" xref="S2.SS1.SSS2.Px1.p1.11.m8.2.2.2.2.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.11.m8.2b"><apply id="S2.SS1.SSS2.Px1.p1.11.m8.2.3.cmml" xref="S2.SS1.SSS2.Px1.p1.11.m8.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.11.m8.2.3.1.cmml" xref="S2.SS1.SSS2.Px1.p1.11.m8.2.3">subscript</csymbol><ci id="S2.SS1.SSS2.Px1.p1.11.m8.2.3.2.cmml" xref="S2.SS1.SSS2.Px1.p1.11.m8.2.3.2">𝑔</ci><list id="S2.SS1.SSS2.Px1.p1.11.m8.2.2.2.3.cmml" xref="S2.SS1.SSS2.Px1.p1.11.m8.2.2.2.4"><ci id="S2.SS1.SSS2.Px1.p1.11.m8.1.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.11.m8.1.1.1.1">𝑖</ci><ci id="S2.SS1.SSS2.Px1.p1.11.m8.2.2.2.2.cmml" xref="S2.SS1.SSS2.Px1.p1.11.m8.2.2.2.2">𝑡</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.11.m8.2c">g_{i,t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.11.m8.2d">italic_g start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT</annotation></semantics></math> is the gating value for the <math alttext="i" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.12.m9.1"><semantics id="S2.SS1.SSS2.Px1.p1.12.m9.1a"><mi id="S2.SS1.SSS2.Px1.p1.12.m9.1.1" xref="S2.SS1.SSS2.Px1.p1.12.m9.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.12.m9.1b"><ci id="S2.SS1.SSS2.Px1.p1.12.m9.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.12.m9.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.12.m9.1c">i</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.12.m9.1d">italic_i</annotation></semantics></math>-th expert;
<math alttext="s_{i,t}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.13.m10.2"><semantics id="S2.SS1.SSS2.Px1.p1.13.m10.2a"><msub id="S2.SS1.SSS2.Px1.p1.13.m10.2.3" xref="S2.SS1.SSS2.Px1.p1.13.m10.2.3.cmml"><mi id="S2.SS1.SSS2.Px1.p1.13.m10.2.3.2" xref="S2.SS1.SSS2.Px1.p1.13.m10.2.3.2.cmml">s</mi><mrow id="S2.SS1.SSS2.Px1.p1.13.m10.2.2.2.4" xref="S2.SS1.SSS2.Px1.p1.13.m10.2.2.2.3.cmml"><mi id="S2.SS1.SSS2.Px1.p1.13.m10.1.1.1.1" xref="S2.SS1.SSS2.Px1.p1.13.m10.1.1.1.1.cmml">i</mi><mo id="S2.SS1.SSS2.Px1.p1.13.m10.2.2.2.4.1" xref="S2.SS1.SSS2.Px1.p1.13.m10.2.2.2.3.cmml">,</mo><mi id="S2.SS1.SSS2.Px1.p1.13.m10.2.2.2.2" xref="S2.SS1.SSS2.Px1.p1.13.m10.2.2.2.2.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.13.m10.2b"><apply id="S2.SS1.SSS2.Px1.p1.13.m10.2.3.cmml" xref="S2.SS1.SSS2.Px1.p1.13.m10.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.13.m10.2.3.1.cmml" xref="S2.SS1.SSS2.Px1.p1.13.m10.2.3">subscript</csymbol><ci id="S2.SS1.SSS2.Px1.p1.13.m10.2.3.2.cmml" xref="S2.SS1.SSS2.Px1.p1.13.m10.2.3.2">𝑠</ci><list id="S2.SS1.SSS2.Px1.p1.13.m10.2.2.2.3.cmml" xref="S2.SS1.SSS2.Px1.p1.13.m10.2.2.2.4"><ci id="S2.SS1.SSS2.Px1.p1.13.m10.1.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.13.m10.1.1.1.1">𝑖</ci><ci id="S2.SS1.SSS2.Px1.p1.13.m10.2.2.2.2.cmml" xref="S2.SS1.SSS2.Px1.p1.13.m10.2.2.2.2">𝑡</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.13.m10.2c">s_{i,t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.13.m10.2d">italic_s start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT</annotation></semantics></math> is the token-to-expert affinity;
<math alttext="\mathbf{e}_{i}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.14.m11.1"><semantics id="S2.SS1.SSS2.Px1.p1.14.m11.1a"><msub id="S2.SS1.SSS2.Px1.p1.14.m11.1.1" xref="S2.SS1.SSS2.Px1.p1.14.m11.1.1.cmml"><mi id="S2.SS1.SSS2.Px1.p1.14.m11.1.1.2" xref="S2.SS1.SSS2.Px1.p1.14.m11.1.1.2.cmml">𝐞</mi><mi id="S2.SS1.SSS2.Px1.p1.14.m11.1.1.3" xref="S2.SS1.SSS2.Px1.p1.14.m11.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.14.m11.1b"><apply id="S2.SS1.SSS2.Px1.p1.14.m11.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.14.m11.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px1.p1.14.m11.1.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.14.m11.1.1">subscript</csymbol><ci id="S2.SS1.SSS2.Px1.p1.14.m11.1.1.2.cmml" xref="S2.SS1.SSS2.Px1.p1.14.m11.1.1.2">𝐞</ci><ci id="S2.SS1.SSS2.Px1.p1.14.m11.1.1.3.cmml" xref="S2.SS1.SSS2.Px1.p1.14.m11.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.14.m11.1c">\mathbf{e}_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.14.m11.1d">bold_e start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is the centroid vector of the <math alttext="i" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.15.m12.1"><semantics id="S2.SS1.SSS2.Px1.p1.15.m12.1a"><mi id="S2.SS1.SSS2.Px1.p1.15.m12.1.1" xref="S2.SS1.SSS2.Px1.p1.15.m12.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.15.m12.1b"><ci id="S2.SS1.SSS2.Px1.p1.15.m12.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.15.m12.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.15.m12.1c">i</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.15.m12.1d">italic_i</annotation></semantics></math>-th routed expert;
and <math alttext="\operatorname{Topk}(\cdot,K)" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.16.m13.3"><semantics id="S2.SS1.SSS2.Px1.p1.16.m13.3a"><mrow id="S2.SS1.SSS2.Px1.p1.16.m13.3.4.2" xref="S2.SS1.SSS2.Px1.p1.16.m13.3.4.1.cmml"><mi id="S2.SS1.SSS2.Px1.p1.16.m13.1.1" xref="S2.SS1.SSS2.Px1.p1.16.m13.1.1.cmml">Topk</mi><mo id="S2.SS1.SSS2.Px1.p1.16.m13.3.4.2a" xref="S2.SS1.SSS2.Px1.p1.16.m13.3.4.1.cmml">⁡</mo><mrow id="S2.SS1.SSS2.Px1.p1.16.m13.3.4.2.1" xref="S2.SS1.SSS2.Px1.p1.16.m13.3.4.1.cmml"><mo id="S2.SS1.SSS2.Px1.p1.16.m13.3.4.2.1.1" stretchy="false" xref="S2.SS1.SSS2.Px1.p1.16.m13.3.4.1.cmml">(</mo><mo id="S2.SS1.SSS2.Px1.p1.16.m13.2.2" lspace="0em" rspace="0em" xref="S2.SS1.SSS2.Px1.p1.16.m13.2.2.cmml">⋅</mo><mo id="S2.SS1.SSS2.Px1.p1.16.m13.3.4.2.1.2" xref="S2.SS1.SSS2.Px1.p1.16.m13.3.4.1.cmml">,</mo><mi id="S2.SS1.SSS2.Px1.p1.16.m13.3.3" xref="S2.SS1.SSS2.Px1.p1.16.m13.3.3.cmml">K</mi><mo id="S2.SS1.SSS2.Px1.p1.16.m13.3.4.2.1.3" stretchy="false" xref="S2.SS1.SSS2.Px1.p1.16.m13.3.4.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.16.m13.3b"><apply id="S2.SS1.SSS2.Px1.p1.16.m13.3.4.1.cmml" xref="S2.SS1.SSS2.Px1.p1.16.m13.3.4.2"><ci id="S2.SS1.SSS2.Px1.p1.16.m13.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.16.m13.1.1">Topk</ci><ci id="S2.SS1.SSS2.Px1.p1.16.m13.2.2.cmml" xref="S2.SS1.SSS2.Px1.p1.16.m13.2.2">⋅</ci><ci id="S2.SS1.SSS2.Px1.p1.16.m13.3.3.cmml" xref="S2.SS1.SSS2.Px1.p1.16.m13.3.3">𝐾</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.16.m13.3c">\operatorname{Topk}(\cdot,K)</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.16.m13.3d">roman_Topk ( ⋅ , italic_K )</annotation></semantics></math> denotes the set comprising <math alttext="K" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.17.m14.1"><semantics id="S2.SS1.SSS2.Px1.p1.17.m14.1a"><mi id="S2.SS1.SSS2.Px1.p1.17.m14.1.1" xref="S2.SS1.SSS2.Px1.p1.17.m14.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.17.m14.1b"><ci id="S2.SS1.SSS2.Px1.p1.17.m14.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.17.m14.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.17.m14.1c">K</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.17.m14.1d">italic_K</annotation></semantics></math> highest scores among the affinity scores calculated for the <math alttext="t" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px1.p1.18.m15.1"><semantics id="S2.SS1.SSS2.Px1.p1.18.m15.1a"><mi id="S2.SS1.SSS2.Px1.p1.18.m15.1.1" xref="S2.SS1.SSS2.Px1.p1.18.m15.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px1.p1.18.m15.1b"><ci id="S2.SS1.SSS2.Px1.p1.18.m15.1.1.cmml" xref="S2.SS1.SSS2.Px1.p1.18.m15.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px1.p1.18.m15.1c">t</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px1.p1.18.m15.1d">italic_t</annotation></semantics></math>-th token and all routed experts.
Slightly different from DeepSeek-V2, DeepSeek-V3 uses the sigmoid function to compute the affinity scores, and applies a normalization among all selected affinity scores to produce the gating values.</p>
</div>
</section>
<section class="ltx_paragraph" id="S2.SS1.SSS2.Px2">
<h5 class="ltx_title ltx_title_paragraph">Auxiliary-Loss-Free Load Balancing.</h5>
<div class="ltx_para" id="S2.SS1.SSS2.Px2.p1">
<p class="ltx_p" id="S2.SS1.SSS2.Px2.p1.2">For MoE models, an unbalanced expert load will lead to routing collapse <cite class="ltx_cite ltx_citemacro_citep">(Shazeer et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib81" title="">2017</a>)</cite> and diminish computational efficiency in scenarios with expert parallelism.
Conventional solutions usually rely on the auxiliary loss <cite class="ltx_cite ltx_citemacro_citep">(Fedus et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib21" title="">2021</a>; Lepikhin et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib45" title="">2021</a>)</cite> to avoid unbalanced load.
However, too large an auxiliary loss will impair the model performance <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib93" title="">2024a</a>)</cite>.
To achieve a better trade-off between load balance and model performance, we pioneer an auxiliary-loss-free load balancing strategy <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib93" title="">2024a</a>)</cite> to ensure load balance.
To be specific, we introduce a bias term <math alttext="b_{i}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px2.p1.1.m1.1"><semantics id="S2.SS1.SSS2.Px2.p1.1.m1.1a"><msub id="S2.SS1.SSS2.Px2.p1.1.m1.1.1" xref="S2.SS1.SSS2.Px2.p1.1.m1.1.1.cmml"><mi id="S2.SS1.SSS2.Px2.p1.1.m1.1.1.2" xref="S2.SS1.SSS2.Px2.p1.1.m1.1.1.2.cmml">b</mi><mi id="S2.SS1.SSS2.Px2.p1.1.m1.1.1.3" xref="S2.SS1.SSS2.Px2.p1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px2.p1.1.m1.1b"><apply id="S2.SS1.SSS2.Px2.p1.1.m1.1.1.cmml" xref="S2.SS1.SSS2.Px2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px2.p1.1.m1.1.1.1.cmml" xref="S2.SS1.SSS2.Px2.p1.1.m1.1.1">subscript</csymbol><ci id="S2.SS1.SSS2.Px2.p1.1.m1.1.1.2.cmml" xref="S2.SS1.SSS2.Px2.p1.1.m1.1.1.2">𝑏</ci><ci id="S2.SS1.SSS2.Px2.p1.1.m1.1.1.3.cmml" xref="S2.SS1.SSS2.Px2.p1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px2.p1.1.m1.1c">b_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px2.p1.1.m1.1d">italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> for each expert and add it to the corresponding affinity scores <math alttext="s_{i,t}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px2.p1.2.m2.2"><semantics id="S2.SS1.SSS2.Px2.p1.2.m2.2a"><msub id="S2.SS1.SSS2.Px2.p1.2.m2.2.3" xref="S2.SS1.SSS2.Px2.p1.2.m2.2.3.cmml"><mi id="S2.SS1.SSS2.Px2.p1.2.m2.2.3.2" xref="S2.SS1.SSS2.Px2.p1.2.m2.2.3.2.cmml">s</mi><mrow id="S2.SS1.SSS2.Px2.p1.2.m2.2.2.2.4" xref="S2.SS1.SSS2.Px2.p1.2.m2.2.2.2.3.cmml"><mi id="S2.SS1.SSS2.Px2.p1.2.m2.1.1.1.1" xref="S2.SS1.SSS2.Px2.p1.2.m2.1.1.1.1.cmml">i</mi><mo id="S2.SS1.SSS2.Px2.p1.2.m2.2.2.2.4.1" xref="S2.SS1.SSS2.Px2.p1.2.m2.2.2.2.3.cmml">,</mo><mi id="S2.SS1.SSS2.Px2.p1.2.m2.2.2.2.2" xref="S2.SS1.SSS2.Px2.p1.2.m2.2.2.2.2.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px2.p1.2.m2.2b"><apply id="S2.SS1.SSS2.Px2.p1.2.m2.2.3.cmml" xref="S2.SS1.SSS2.Px2.p1.2.m2.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px2.p1.2.m2.2.3.1.cmml" xref="S2.SS1.SSS2.Px2.p1.2.m2.2.3">subscript</csymbol><ci id="S2.SS1.SSS2.Px2.p1.2.m2.2.3.2.cmml" xref="S2.SS1.SSS2.Px2.p1.2.m2.2.3.2">𝑠</ci><list id="S2.SS1.SSS2.Px2.p1.2.m2.2.2.2.3.cmml" xref="S2.SS1.SSS2.Px2.p1.2.m2.2.2.2.4"><ci id="S2.SS1.SSS2.Px2.p1.2.m2.1.1.1.1.cmml" xref="S2.SS1.SSS2.Px2.p1.2.m2.1.1.1.1">𝑖</ci><ci id="S2.SS1.SSS2.Px2.p1.2.m2.2.2.2.2.cmml" xref="S2.SS1.SSS2.Px2.p1.2.m2.2.2.2.2">𝑡</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px2.p1.2.m2.2c">s_{i,t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px2.p1.2.m2.2d">italic_s start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT</annotation></semantics></math> to determine the top-K routing:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A3.EGx5">
<tbody id="S2.E16"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle g^{\prime}_{i,t}" class="ltx_Math" display="inline" id="S2.E16.m1.2"><semantics id="S2.E16.m1.2a"><msubsup id="S2.E16.m1.2.3" xref="S2.E16.m1.2.3.cmml"><mi id="S2.E16.m1.2.3.2.2" xref="S2.E16.m1.2.3.2.2.cmml">g</mi><mrow id="S2.E16.m1.2.2.2.4" xref="S2.E16.m1.2.2.2.3.cmml"><mi id="S2.E16.m1.1.1.1.1" xref="S2.E16.m1.1.1.1.1.cmml">i</mi><mo id="S2.E16.m1.2.2.2.4.1" xref="S2.E16.m1.2.2.2.3.cmml">,</mo><mi id="S2.E16.m1.2.2.2.2" xref="S2.E16.m1.2.2.2.2.cmml">t</mi></mrow><mo id="S2.E16.m1.2.3.2.3" xref="S2.E16.m1.2.3.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S2.E16.m1.2b"><apply id="S2.E16.m1.2.3.cmml" xref="S2.E16.m1.2.3"><csymbol cd="ambiguous" id="S2.E16.m1.2.3.1.cmml" xref="S2.E16.m1.2.3">subscript</csymbol><apply id="S2.E16.m1.2.3.2.cmml" xref="S2.E16.m1.2.3"><csymbol cd="ambiguous" id="S2.E16.m1.2.3.2.1.cmml" xref="S2.E16.m1.2.3">superscript</csymbol><ci id="S2.E16.m1.2.3.2.2.cmml" xref="S2.E16.m1.2.3.2.2">𝑔</ci><ci id="S2.E16.m1.2.3.2.3.cmml" xref="S2.E16.m1.2.3.2.3">′</ci></apply><list id="S2.E16.m1.2.2.2.3.cmml" xref="S2.E16.m1.2.2.2.4"><ci id="S2.E16.m1.1.1.1.1.cmml" xref="S2.E16.m1.1.1.1.1">𝑖</ci><ci id="S2.E16.m1.2.2.2.2.cmml" xref="S2.E16.m1.2.2.2.2">𝑡</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E16.m1.2c">\displaystyle g^{\prime}_{i,t}</annotation><annotation encoding="application/x-llamapun" id="S2.E16.m1.2d">italic_g start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\begin{cases}s_{i,t},&amp;s_{i,t}+b_{i}\in\operatorname{Topk}(\{s_{j%
,t}+b_{j}|1\leqslant j\leqslant N_{r}\},K_{r}),\\
0,&amp;\text{otherwise}.\end{cases}" class="ltx_Math" display="inline" id="S2.E16.m2.4"><semantics id="S2.E16.m2.4a"><mrow id="S2.E16.m2.4.5" xref="S2.E16.m2.4.5.cmml"><mi id="S2.E16.m2.4.5.2" xref="S2.E16.m2.4.5.2.cmml"></mi><mo id="S2.E16.m2.4.5.1" xref="S2.E16.m2.4.5.1.cmml">=</mo><mrow id="S2.E16.m2.4.4a" xref="S2.E16.m2.4.5.3.1.cmml"><mo id="S2.E16.m2.4.4a.5" xref="S2.E16.m2.4.5.3.1.1.cmml">{</mo><mtable columnspacing="5pt" id="S2.E16.m2.4.4.4a" rowspacing="0pt" xref="S2.E16.m2.4.5.3.1.cmml"><mtr id="S2.E16.m2.4.4.4aa" xref="S2.E16.m2.4.5.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S2.E16.m2.4.4.4ab" xref="S2.E16.m2.4.5.3.1.cmml"><mrow id="S2.E16.m2.1.1.1.1.1.1.3" xref="S2.E16.m2.1.1.1.1.1.1.3.1.cmml"><msub id="S2.E16.m2.1.1.1.1.1.1.3.1" xref="S2.E16.m2.1.1.1.1.1.1.3.1.cmml"><mi id="S2.E16.m2.1.1.1.1.1.1.3.1.2" xref="S2.E16.m2.1.1.1.1.1.1.3.1.2.cmml">s</mi><mrow id="S2.E16.m2.1.1.1.1.1.1.2.2.4" xref="S2.E16.m2.1.1.1.1.1.1.2.2.3.cmml"><mi id="S2.E16.m2.1.1.1.1.1.1.1.1.1" xref="S2.E16.m2.1.1.1.1.1.1.1.1.1.cmml">i</mi><mo id="S2.E16.m2.1.1.1.1.1.1.2.2.4.1" xref="S2.E16.m2.1.1.1.1.1.1.2.2.3.cmml">,</mo><mi id="S2.E16.m2.1.1.1.1.1.1.2.2.2" xref="S2.E16.m2.1.1.1.1.1.1.2.2.2.cmml">t</mi></mrow></msub><mo id="S2.E16.m2.1.1.1.1.1.1.3.2" xref="S2.E16.m2.1.1.1.1.1.1.3.1.cmml">,</mo></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S2.E16.m2.4.4.4ac" xref="S2.E16.m2.4.5.3.1.cmml"><mrow id="S2.E16.m2.2.2.2.2.2.1.6" xref="S2.E16.m2.2.2.2.2.2.1.6.1.cmml"><mrow id="S2.E16.m2.2.2.2.2.2.1.6.1" xref="S2.E16.m2.2.2.2.2.2.1.6.1.cmml"><mrow id="S2.E16.m2.2.2.2.2.2.1.6.1.4" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.cmml"><msub id="S2.E16.m2.2.2.2.2.2.1.6.1.4.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.2.cmml"><mi id="S2.E16.m2.2.2.2.2.2.1.6.1.4.2.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.2.2.cmml">s</mi><mrow id="S2.E16.m2.2.2.2.2.2.1.2.2.4" xref="S2.E16.m2.2.2.2.2.2.1.2.2.3.cmml"><mi id="S2.E16.m2.2.2.2.2.2.1.1.1.1" xref="S2.E16.m2.2.2.2.2.2.1.1.1.1.cmml">i</mi><mo id="S2.E16.m2.2.2.2.2.2.1.2.2.4.1" xref="S2.E16.m2.2.2.2.2.2.1.2.2.3.cmml">,</mo><mi id="S2.E16.m2.2.2.2.2.2.1.2.2.2" xref="S2.E16.m2.2.2.2.2.2.1.2.2.2.cmml">t</mi></mrow></msub><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.4.1" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.1.cmml">+</mo><msub id="S2.E16.m2.2.2.2.2.2.1.6.1.4.3" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.3.cmml"><mi id="S2.E16.m2.2.2.2.2.2.1.6.1.4.3.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.3.2.cmml">b</mi><mi id="S2.E16.m2.2.2.2.2.2.1.6.1.4.3.3" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.3.3.cmml">i</mi></msub></mrow><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.3" xref="S2.E16.m2.2.2.2.2.2.1.6.1.3.cmml">∈</mo><mrow id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.3.cmml"><mi id="S2.E16.m2.2.2.2.2.2.1.5" xref="S2.E16.m2.2.2.2.2.2.1.5.cmml">Topk</mi><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2a" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.3.cmml">⁡</mo><mrow id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.3.cmml"><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.3" stretchy="false" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.3.cmml">(</mo><mrow id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.cmml"><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.3" stretchy="false" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.1.cmml">{</mo><mrow id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.cmml"><msub id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2.cmml"><mi id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2.2.cmml">s</mi><mrow id="S2.E16.m2.2.2.2.2.2.1.4.2.4" xref="S2.E16.m2.2.2.2.2.2.1.4.2.3.cmml"><mi id="S2.E16.m2.2.2.2.2.2.1.3.1.1" xref="S2.E16.m2.2.2.2.2.2.1.3.1.1.cmml">j</mi><mo id="S2.E16.m2.2.2.2.2.2.1.4.2.4.1" xref="S2.E16.m2.2.2.2.2.2.1.4.2.3.cmml">,</mo><mi id="S2.E16.m2.2.2.2.2.2.1.4.2.2" xref="S2.E16.m2.2.2.2.2.2.1.4.2.2.cmml">t</mi></mrow></msub><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.1" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.1.cmml">+</mo><msub id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3.cmml"><mi id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3.2.cmml">b</mi><mi id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3.3" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3.3.cmml">j</mi></msub></mrow><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.4" lspace="0em" rspace="0em" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.1.cmml">|</mo><mrow id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.cmml"><mn id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.2.cmml">1</mn><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.3" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.3.cmml">⩽</mo><mi id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.4" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.4.cmml">j</mi><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.5" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.5.cmml">⩽</mo><msub id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.cmml"><mi id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.2.cmml">N</mi><mi id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.3" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.3.cmml">r</mi></msub></mrow><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.5" stretchy="false" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.1.cmml">}</mo></mrow><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.4" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.3.cmml">,</mo><msub id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2.cmml"><mi id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2.2.cmml">K</mi><mi id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2.3" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2.3.cmml">r</mi></msub><mo id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.5" stretchy="false" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.3.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E16.m2.2.2.2.2.2.1.6.2" xref="S2.E16.m2.2.2.2.2.2.1.6.1.cmml">,</mo></mrow></mtd></mtr><mtr id="S2.E16.m2.4.4.4ad" xref="S2.E16.m2.4.5.3.1.cmml"><mtd class="ltx_align_left" columnalign="left" id="S2.E16.m2.4.4.4ae" xref="S2.E16.m2.4.5.3.1.cmml"><mrow id="S2.E16.m2.3.3.3.3.1.1.3" xref="S2.E16.m2.4.5.3.1.cmml"><mn id="S2.E16.m2.3.3.3.3.1.1.1" xref="S2.E16.m2.3.3.3.3.1.1.1.cmml">0</mn><mo id="S2.E16.m2.3.3.3.3.1.1.3.1" xref="S2.E16.m2.4.5.3.1.cmml">,</mo></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S2.E16.m2.4.4.4af" xref="S2.E16.m2.4.5.3.1.cmml"><mrow id="S2.E16.m2.4.4.4.4.2.1.3" xref="S2.E16.m2.4.4.4.4.2.1.1a.cmml"><mtext id="S2.E16.m2.4.4.4.4.2.1.1" xref="S2.E16.m2.4.4.4.4.2.1.1.cmml">otherwise</mtext><mo id="S2.E16.m2.4.4.4.4.2.1.3.1" lspace="0em" xref="S2.E16.m2.4.4.4.4.2.1.1a.cmml">.</mo></mrow></mtd></mtr></mtable></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E16.m2.4b"><apply id="S2.E16.m2.4.5.cmml" xref="S2.E16.m2.4.5"><eq id="S2.E16.m2.4.5.1.cmml" xref="S2.E16.m2.4.5.1"></eq><csymbol cd="latexml" id="S2.E16.m2.4.5.2.cmml" xref="S2.E16.m2.4.5.2">absent</csymbol><apply id="S2.E16.m2.4.5.3.1.cmml" xref="S2.E16.m2.4.4a"><csymbol cd="latexml" id="S2.E16.m2.4.5.3.1.1.cmml" xref="S2.E16.m2.4.4a.5">cases</csymbol><apply id="S2.E16.m2.1.1.1.1.1.1.3.1.cmml" xref="S2.E16.m2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E16.m2.1.1.1.1.1.1.3.1.1.cmml" xref="S2.E16.m2.1.1.1.1.1.1.3">subscript</csymbol><ci id="S2.E16.m2.1.1.1.1.1.1.3.1.2.cmml" xref="S2.E16.m2.1.1.1.1.1.1.3.1.2">𝑠</ci><list id="S2.E16.m2.1.1.1.1.1.1.2.2.3.cmml" xref="S2.E16.m2.1.1.1.1.1.1.2.2.4"><ci id="S2.E16.m2.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E16.m2.1.1.1.1.1.1.1.1.1">𝑖</ci><ci id="S2.E16.m2.1.1.1.1.1.1.2.2.2.cmml" xref="S2.E16.m2.1.1.1.1.1.1.2.2.2">𝑡</ci></list></apply><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6"><in id="S2.E16.m2.2.2.2.2.2.1.6.1.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.3"></in><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.4.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4"><plus id="S2.E16.m2.2.2.2.2.2.1.6.1.4.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.1"></plus><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.4.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.2"><csymbol cd="ambiguous" id="S2.E16.m2.2.2.2.2.2.1.6.1.4.2.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.2">subscript</csymbol><ci id="S2.E16.m2.2.2.2.2.2.1.6.1.4.2.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.2.2">𝑠</ci><list id="S2.E16.m2.2.2.2.2.2.1.2.2.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.2.2.4"><ci id="S2.E16.m2.2.2.2.2.2.1.1.1.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.1.1.1">𝑖</ci><ci id="S2.E16.m2.2.2.2.2.2.1.2.2.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.2.2.2">𝑡</ci></list></apply><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.4.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.3"><csymbol cd="ambiguous" id="S2.E16.m2.2.2.2.2.2.1.6.1.4.3.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.3">subscript</csymbol><ci id="S2.E16.m2.2.2.2.2.2.1.6.1.4.3.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.3.2">𝑏</ci><ci id="S2.E16.m2.2.2.2.2.2.1.6.1.4.3.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.4.3.3">𝑖</ci></apply></apply><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.2.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.2"><ci id="S2.E16.m2.2.2.2.2.2.1.5.cmml" xref="S2.E16.m2.2.2.2.2.2.1.5">Topk</ci><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2"><csymbol cd="latexml" id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.3.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.3">conditional-set</csymbol><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1"><plus id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.1"></plus><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.2.2">𝑠</ci><list id="S2.E16.m2.2.2.2.2.2.1.4.2.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.4.2.4"><ci id="S2.E16.m2.2.2.2.2.2.1.3.1.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.3.1.1">𝑗</ci><ci id="S2.E16.m2.2.2.2.2.2.1.4.2.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.4.2.2">𝑡</ci></list></apply><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3.2">𝑏</ci><ci id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.1.1.3.3">𝑗</ci></apply></apply><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2"><and id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2a.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2"></and><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2b.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2"><leq id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.3"></leq><cn id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.2.cmml" type="integer" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.2">1</cn><ci id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.4.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.4">𝑗</ci></apply><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2c.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2"><leq id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.5.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.5"></leq><share href="https://arxiv.org/html/2412.19437v1#S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.4.cmml" id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2d.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2"></share><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6"><csymbol cd="ambiguous" id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6">subscript</csymbol><ci id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.2">𝑁</ci><ci id="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.1.1.1.1.2.2.6.3">𝑟</ci></apply></apply></apply></apply><apply id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2"><csymbol cd="ambiguous" id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2.1.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2">subscript</csymbol><ci id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2.2.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2.2">𝐾</ci><ci id="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2.3.cmml" xref="S2.E16.m2.2.2.2.2.2.1.6.1.2.2.2.2.3">𝑟</ci></apply></apply></apply><cn id="S2.E16.m2.3.3.3.3.1.1.1.cmml" type="integer" xref="S2.E16.m2.3.3.3.3.1.1.1">0</cn><ci id="S2.E16.m2.4.4.4.4.2.1.1a.cmml" xref="S2.E16.m2.4.4.4.4.2.1.3"><mtext id="S2.E16.m2.4.4.4.4.2.1.1.cmml" xref="S2.E16.m2.4.4.4.4.2.1.1">otherwise</mtext></ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E16.m2.4c">\displaystyle=\begin{cases}s_{i,t},&amp;s_{i,t}+b_{i}\in\operatorname{Topk}(\{s_{j%
,t}+b_{j}|1\leqslant j\leqslant N_{r}\},K_{r}),\\
0,&amp;\text{otherwise}.\end{cases}</annotation><annotation encoding="application/x-llamapun" id="S2.E16.m2.4d">= { start_ROW start_CELL italic_s start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT , end_CELL start_CELL italic_s start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT + italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ roman_Topk ( { italic_s start_POSTSUBSCRIPT italic_j , italic_t end_POSTSUBSCRIPT + italic_b start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT | 1 ⩽ italic_j ⩽ italic_N start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT } , italic_K start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ) , end_CELL end_ROW start_ROW start_CELL 0 , end_CELL start_CELL otherwise . end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(16)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS1.SSS2.Px2.p1.6">Note that the bias term is only used for routing.
The gating value, which will be multiplied with the FFN output, is still derived from the original affinity score <math alttext="s_{i,t}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px2.p1.3.m1.2"><semantics id="S2.SS1.SSS2.Px2.p1.3.m1.2a"><msub id="S2.SS1.SSS2.Px2.p1.3.m1.2.3" xref="S2.SS1.SSS2.Px2.p1.3.m1.2.3.cmml"><mi id="S2.SS1.SSS2.Px2.p1.3.m1.2.3.2" xref="S2.SS1.SSS2.Px2.p1.3.m1.2.3.2.cmml">s</mi><mrow id="S2.SS1.SSS2.Px2.p1.3.m1.2.2.2.4" xref="S2.SS1.SSS2.Px2.p1.3.m1.2.2.2.3.cmml"><mi id="S2.SS1.SSS2.Px2.p1.3.m1.1.1.1.1" xref="S2.SS1.SSS2.Px2.p1.3.m1.1.1.1.1.cmml">i</mi><mo id="S2.SS1.SSS2.Px2.p1.3.m1.2.2.2.4.1" xref="S2.SS1.SSS2.Px2.p1.3.m1.2.2.2.3.cmml">,</mo><mi id="S2.SS1.SSS2.Px2.p1.3.m1.2.2.2.2" xref="S2.SS1.SSS2.Px2.p1.3.m1.2.2.2.2.cmml">t</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px2.p1.3.m1.2b"><apply id="S2.SS1.SSS2.Px2.p1.3.m1.2.3.cmml" xref="S2.SS1.SSS2.Px2.p1.3.m1.2.3"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px2.p1.3.m1.2.3.1.cmml" xref="S2.SS1.SSS2.Px2.p1.3.m1.2.3">subscript</csymbol><ci id="S2.SS1.SSS2.Px2.p1.3.m1.2.3.2.cmml" xref="S2.SS1.SSS2.Px2.p1.3.m1.2.3.2">𝑠</ci><list id="S2.SS1.SSS2.Px2.p1.3.m1.2.2.2.3.cmml" xref="S2.SS1.SSS2.Px2.p1.3.m1.2.2.2.4"><ci id="S2.SS1.SSS2.Px2.p1.3.m1.1.1.1.1.cmml" xref="S2.SS1.SSS2.Px2.p1.3.m1.1.1.1.1">𝑖</ci><ci id="S2.SS1.SSS2.Px2.p1.3.m1.2.2.2.2.cmml" xref="S2.SS1.SSS2.Px2.p1.3.m1.2.2.2.2">𝑡</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px2.p1.3.m1.2c">s_{i,t}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px2.p1.3.m1.2d">italic_s start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT</annotation></semantics></math>.
During training, we keep monitoring the expert load on the whole batch of each training step.
At the end of each step, we will decrease the bias term by <math alttext="\gamma" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px2.p1.4.m2.1"><semantics id="S2.SS1.SSS2.Px2.p1.4.m2.1a"><mi id="S2.SS1.SSS2.Px2.p1.4.m2.1.1" xref="S2.SS1.SSS2.Px2.p1.4.m2.1.1.cmml">γ</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px2.p1.4.m2.1b"><ci id="S2.SS1.SSS2.Px2.p1.4.m2.1.1.cmml" xref="S2.SS1.SSS2.Px2.p1.4.m2.1.1">𝛾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px2.p1.4.m2.1c">\gamma</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px2.p1.4.m2.1d">italic_γ</annotation></semantics></math> if its corresponding expert is overloaded, and increase it by <math alttext="\gamma" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px2.p1.5.m3.1"><semantics id="S2.SS1.SSS2.Px2.p1.5.m3.1a"><mi id="S2.SS1.SSS2.Px2.p1.5.m3.1.1" xref="S2.SS1.SSS2.Px2.p1.5.m3.1.1.cmml">γ</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px2.p1.5.m3.1b"><ci id="S2.SS1.SSS2.Px2.p1.5.m3.1.1.cmml" xref="S2.SS1.SSS2.Px2.p1.5.m3.1.1">𝛾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px2.p1.5.m3.1c">\gamma</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px2.p1.5.m3.1d">italic_γ</annotation></semantics></math> if its corresponding expert is underloaded, where <math alttext="\gamma" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px2.p1.6.m4.1"><semantics id="S2.SS1.SSS2.Px2.p1.6.m4.1a"><mi id="S2.SS1.SSS2.Px2.p1.6.m4.1.1" xref="S2.SS1.SSS2.Px2.p1.6.m4.1.1.cmml">γ</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px2.p1.6.m4.1b"><ci id="S2.SS1.SSS2.Px2.p1.6.m4.1.1.cmml" xref="S2.SS1.SSS2.Px2.p1.6.m4.1.1">𝛾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px2.p1.6.m4.1c">\gamma</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px2.p1.6.m4.1d">italic_γ</annotation></semantics></math> is a hyper-parameter called bias update speed.
Through the dynamic adjustment, DeepSeek-V3 keeps balanced expert load during training, and achieves better performance than models that encourage load balance through pure auxiliary losses.</p>
</div>
</section>
<section class="ltx_paragraph" id="S2.SS1.SSS2.Px3">
<h5 class="ltx_title ltx_title_paragraph">Complementary Sequence-Wise Auxiliary Loss.</h5>
<div class="ltx_para" id="S2.SS1.SSS2.Px3.p1">
<p class="ltx_p" id="S2.SS1.SSS2.Px3.p1.4">Although DeepSeek-V3 mainly relies on the auxiliary-loss-free strategy for load balance, to prevent extreme imbalance within any single sequence, we also employ a complementary sequence-wise balance loss:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A3.EGx6">
<tbody id="S2.E17"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\mathcal{L}_{\mathrm{Bal}}" class="ltx_Math" display="inline" id="S2.E17.m1.1"><semantics id="S2.E17.m1.1a"><msub id="S2.E17.m1.1.1" xref="S2.E17.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.E17.m1.1.1.2" xref="S2.E17.m1.1.1.2.cmml">ℒ</mi><mi id="S2.E17.m1.1.1.3" xref="S2.E17.m1.1.1.3.cmml">Bal</mi></msub><annotation-xml encoding="MathML-Content" id="S2.E17.m1.1b"><apply id="S2.E17.m1.1.1.cmml" xref="S2.E17.m1.1.1"><csymbol cd="ambiguous" id="S2.E17.m1.1.1.1.cmml" xref="S2.E17.m1.1.1">subscript</csymbol><ci id="S2.E17.m1.1.1.2.cmml" xref="S2.E17.m1.1.1.2">ℒ</ci><ci id="S2.E17.m1.1.1.3.cmml" xref="S2.E17.m1.1.1.3">Bal</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E17.m1.1c">\displaystyle\mathcal{L}_{\mathrm{Bal}}</annotation><annotation encoding="application/x-llamapun" id="S2.E17.m1.1d">caligraphic_L start_POSTSUBSCRIPT roman_Bal end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\alpha\sum_{i=1}^{N_{r}}{f_{i}P_{i}}," class="ltx_Math" display="inline" id="S2.E17.m2.1"><semantics id="S2.E17.m2.1a"><mrow id="S2.E17.m2.1.1.1" xref="S2.E17.m2.1.1.1.1.cmml"><mrow id="S2.E17.m2.1.1.1.1" xref="S2.E17.m2.1.1.1.1.cmml"><mi id="S2.E17.m2.1.1.1.1.2" xref="S2.E17.m2.1.1.1.1.2.cmml"></mi><mo id="S2.E17.m2.1.1.1.1.1" xref="S2.E17.m2.1.1.1.1.1.cmml">=</mo><mrow id="S2.E17.m2.1.1.1.1.3" xref="S2.E17.m2.1.1.1.1.3.cmml"><mi id="S2.E17.m2.1.1.1.1.3.2" xref="S2.E17.m2.1.1.1.1.3.2.cmml">α</mi><mo id="S2.E17.m2.1.1.1.1.3.1" xref="S2.E17.m2.1.1.1.1.3.1.cmml">⁢</mo><mrow id="S2.E17.m2.1.1.1.1.3.3" xref="S2.E17.m2.1.1.1.1.3.3.cmml"><mstyle displaystyle="true" id="S2.E17.m2.1.1.1.1.3.3.1" xref="S2.E17.m2.1.1.1.1.3.3.1.cmml"><munderover id="S2.E17.m2.1.1.1.1.3.3.1a" xref="S2.E17.m2.1.1.1.1.3.3.1.cmml"><mo id="S2.E17.m2.1.1.1.1.3.3.1.2.2" movablelimits="false" xref="S2.E17.m2.1.1.1.1.3.3.1.2.2.cmml">∑</mo><mrow id="S2.E17.m2.1.1.1.1.3.3.1.2.3" xref="S2.E17.m2.1.1.1.1.3.3.1.2.3.cmml"><mi id="S2.E17.m2.1.1.1.1.3.3.1.2.3.2" xref="S2.E17.m2.1.1.1.1.3.3.1.2.3.2.cmml">i</mi><mo id="S2.E17.m2.1.1.1.1.3.3.1.2.3.1" xref="S2.E17.m2.1.1.1.1.3.3.1.2.3.1.cmml">=</mo><mn id="S2.E17.m2.1.1.1.1.3.3.1.2.3.3" xref="S2.E17.m2.1.1.1.1.3.3.1.2.3.3.cmml">1</mn></mrow><msub id="S2.E17.m2.1.1.1.1.3.3.1.3" xref="S2.E17.m2.1.1.1.1.3.3.1.3.cmml"><mi id="S2.E17.m2.1.1.1.1.3.3.1.3.2" xref="S2.E17.m2.1.1.1.1.3.3.1.3.2.cmml">N</mi><mi id="S2.E17.m2.1.1.1.1.3.3.1.3.3" xref="S2.E17.m2.1.1.1.1.3.3.1.3.3.cmml">r</mi></msub></munderover></mstyle><mrow id="S2.E17.m2.1.1.1.1.3.3.2" xref="S2.E17.m2.1.1.1.1.3.3.2.cmml"><msub id="S2.E17.m2.1.1.1.1.3.3.2.2" xref="S2.E17.m2.1.1.1.1.3.3.2.2.cmml"><mi id="S2.E17.m2.1.1.1.1.3.3.2.2.2" xref="S2.E17.m2.1.1.1.1.3.3.2.2.2.cmml">f</mi><mi id="S2.E17.m2.1.1.1.1.3.3.2.2.3" xref="S2.E17.m2.1.1.1.1.3.3.2.2.3.cmml">i</mi></msub><mo id="S2.E17.m2.1.1.1.1.3.3.2.1" xref="S2.E17.m2.1.1.1.1.3.3.2.1.cmml">⁢</mo><msub id="S2.E17.m2.1.1.1.1.3.3.2.3" xref="S2.E17.m2.1.1.1.1.3.3.2.3.cmml"><mi id="S2.E17.m2.1.1.1.1.3.3.2.3.2" xref="S2.E17.m2.1.1.1.1.3.3.2.3.2.cmml">P</mi><mi id="S2.E17.m2.1.1.1.1.3.3.2.3.3" xref="S2.E17.m2.1.1.1.1.3.3.2.3.3.cmml">i</mi></msub></mrow></mrow></mrow></mrow><mo id="S2.E17.m2.1.1.1.2" xref="S2.E17.m2.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E17.m2.1b"><apply id="S2.E17.m2.1.1.1.1.cmml" xref="S2.E17.m2.1.1.1"><eq id="S2.E17.m2.1.1.1.1.1.cmml" xref="S2.E17.m2.1.1.1.1.1"></eq><csymbol cd="latexml" id="S2.E17.m2.1.1.1.1.2.cmml" xref="S2.E17.m2.1.1.1.1.2">absent</csymbol><apply id="S2.E17.m2.1.1.1.1.3.cmml" xref="S2.E17.m2.1.1.1.1.3"><times id="S2.E17.m2.1.1.1.1.3.1.cmml" xref="S2.E17.m2.1.1.1.1.3.1"></times><ci id="S2.E17.m2.1.1.1.1.3.2.cmml" xref="S2.E17.m2.1.1.1.1.3.2">𝛼</ci><apply id="S2.E17.m2.1.1.1.1.3.3.cmml" xref="S2.E17.m2.1.1.1.1.3.3"><apply id="S2.E17.m2.1.1.1.1.3.3.1.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1"><csymbol cd="ambiguous" id="S2.E17.m2.1.1.1.1.3.3.1.1.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1">superscript</csymbol><apply id="S2.E17.m2.1.1.1.1.3.3.1.2.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1"><csymbol cd="ambiguous" id="S2.E17.m2.1.1.1.1.3.3.1.2.1.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1">subscript</csymbol><sum id="S2.E17.m2.1.1.1.1.3.3.1.2.2.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1.2.2"></sum><apply id="S2.E17.m2.1.1.1.1.3.3.1.2.3.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1.2.3"><eq id="S2.E17.m2.1.1.1.1.3.3.1.2.3.1.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1.2.3.1"></eq><ci id="S2.E17.m2.1.1.1.1.3.3.1.2.3.2.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1.2.3.2">𝑖</ci><cn id="S2.E17.m2.1.1.1.1.3.3.1.2.3.3.cmml" type="integer" xref="S2.E17.m2.1.1.1.1.3.3.1.2.3.3">1</cn></apply></apply><apply id="S2.E17.m2.1.1.1.1.3.3.1.3.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1.3"><csymbol cd="ambiguous" id="S2.E17.m2.1.1.1.1.3.3.1.3.1.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1.3">subscript</csymbol><ci id="S2.E17.m2.1.1.1.1.3.3.1.3.2.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1.3.2">𝑁</ci><ci id="S2.E17.m2.1.1.1.1.3.3.1.3.3.cmml" xref="S2.E17.m2.1.1.1.1.3.3.1.3.3">𝑟</ci></apply></apply><apply id="S2.E17.m2.1.1.1.1.3.3.2.cmml" xref="S2.E17.m2.1.1.1.1.3.3.2"><times id="S2.E17.m2.1.1.1.1.3.3.2.1.cmml" xref="S2.E17.m2.1.1.1.1.3.3.2.1"></times><apply id="S2.E17.m2.1.1.1.1.3.3.2.2.cmml" xref="S2.E17.m2.1.1.1.1.3.3.2.2"><csymbol cd="ambiguous" id="S2.E17.m2.1.1.1.1.3.3.2.2.1.cmml" xref="S2.E17.m2.1.1.1.1.3.3.2.2">subscript</csymbol><ci id="S2.E17.m2.1.1.1.1.3.3.2.2.2.cmml" xref="S2.E17.m2.1.1.1.1.3.3.2.2.2">𝑓</ci><ci id="S2.E17.m2.1.1.1.1.3.3.2.2.3.cmml" xref="S2.E17.m2.1.1.1.1.3.3.2.2.3">𝑖</ci></apply><apply id="S2.E17.m2.1.1.1.1.3.3.2.3.cmml" xref="S2.E17.m2.1.1.1.1.3.3.2.3"><csymbol cd="ambiguous" id="S2.E17.m2.1.1.1.1.3.3.2.3.1.cmml" xref="S2.E17.m2.1.1.1.1.3.3.2.3">subscript</csymbol><ci id="S2.E17.m2.1.1.1.1.3.3.2.3.2.cmml" xref="S2.E17.m2.1.1.1.1.3.3.2.3.2">𝑃</ci><ci id="S2.E17.m2.1.1.1.1.3.3.2.3.3.cmml" xref="S2.E17.m2.1.1.1.1.3.3.2.3.3">𝑖</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E17.m2.1c">\displaystyle=\alpha\sum_{i=1}^{N_{r}}{f_{i}P_{i}},</annotation><annotation encoding="application/x-llamapun" id="S2.E17.m2.1d">= italic_α ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT end_POSTSUPERSCRIPT italic_f start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT italic_P start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(17)</span></td>
</tr></tbody>
<tbody id="S2.E18"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle f_{i}=\frac{N_{r}}{K_{r}T}\sum_{t=1}^{T}\mathds{1}" class="ltx_Math" display="inline" id="S2.E18.m1.1"><semantics id="S2.E18.m1.1a"><mrow id="S2.E18.m1.1.1" xref="S2.E18.m1.1.1.cmml"><msub id="S2.E18.m1.1.1.2" xref="S2.E18.m1.1.1.2.cmml"><mi id="S2.E18.m1.1.1.2.2" xref="S2.E18.m1.1.1.2.2.cmml">f</mi><mi id="S2.E18.m1.1.1.2.3" xref="S2.E18.m1.1.1.2.3.cmml">i</mi></msub><mo id="S2.E18.m1.1.1.1" xref="S2.E18.m1.1.1.1.cmml">=</mo><mrow id="S2.E18.m1.1.1.3" xref="S2.E18.m1.1.1.3.cmml"><mstyle displaystyle="true" id="S2.E18.m1.1.1.3.2" xref="S2.E18.m1.1.1.3.2.cmml"><mfrac id="S2.E18.m1.1.1.3.2a" xref="S2.E18.m1.1.1.3.2.cmml"><msub id="S2.E18.m1.1.1.3.2.2" xref="S2.E18.m1.1.1.3.2.2.cmml"><mi id="S2.E18.m1.1.1.3.2.2.2" xref="S2.E18.m1.1.1.3.2.2.2.cmml">N</mi><mi id="S2.E18.m1.1.1.3.2.2.3" xref="S2.E18.m1.1.1.3.2.2.3.cmml">r</mi></msub><mrow id="S2.E18.m1.1.1.3.2.3" xref="S2.E18.m1.1.1.3.2.3.cmml"><msub id="S2.E18.m1.1.1.3.2.3.2" xref="S2.E18.m1.1.1.3.2.3.2.cmml"><mi id="S2.E18.m1.1.1.3.2.3.2.2" xref="S2.E18.m1.1.1.3.2.3.2.2.cmml">K</mi><mi id="S2.E18.m1.1.1.3.2.3.2.3" xref="S2.E18.m1.1.1.3.2.3.2.3.cmml">r</mi></msub><mo id="S2.E18.m1.1.1.3.2.3.1" xref="S2.E18.m1.1.1.3.2.3.1.cmml">⁢</mo><mi id="S2.E18.m1.1.1.3.2.3.3" xref="S2.E18.m1.1.1.3.2.3.3.cmml">T</mi></mrow></mfrac></mstyle><mo id="S2.E18.m1.1.1.3.1" xref="S2.E18.m1.1.1.3.1.cmml">⁢</mo><mrow id="S2.E18.m1.1.1.3.3" xref="S2.E18.m1.1.1.3.3.cmml"><mstyle displaystyle="true" id="S2.E18.m1.1.1.3.3.1" xref="S2.E18.m1.1.1.3.3.1.cmml"><munderover id="S2.E18.m1.1.1.3.3.1a" xref="S2.E18.m1.1.1.3.3.1.cmml"><mo id="S2.E18.m1.1.1.3.3.1.2.2" movablelimits="false" xref="S2.E18.m1.1.1.3.3.1.2.2.cmml">∑</mo><mrow id="S2.E18.m1.1.1.3.3.1.2.3" xref="S2.E18.m1.1.1.3.3.1.2.3.cmml"><mi id="S2.E18.m1.1.1.3.3.1.2.3.2" xref="S2.E18.m1.1.1.3.3.1.2.3.2.cmml">t</mi><mo id="S2.E18.m1.1.1.3.3.1.2.3.1" xref="S2.E18.m1.1.1.3.3.1.2.3.1.cmml">=</mo><mn id="S2.E18.m1.1.1.3.3.1.2.3.3" xref="S2.E18.m1.1.1.3.3.1.2.3.3.cmml">1</mn></mrow><mi id="S2.E18.m1.1.1.3.3.1.3" xref="S2.E18.m1.1.1.3.3.1.3.cmml">T</mi></munderover></mstyle><mn id="S2.E18.m1.1.1.3.3.2" xref="S2.E18.m1.1.1.3.3.2.cmml">𝟙</mn></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E18.m1.1b"><apply id="S2.E18.m1.1.1.cmml" xref="S2.E18.m1.1.1"><eq id="S2.E18.m1.1.1.1.cmml" xref="S2.E18.m1.1.1.1"></eq><apply id="S2.E18.m1.1.1.2.cmml" xref="S2.E18.m1.1.1.2"><csymbol cd="ambiguous" id="S2.E18.m1.1.1.2.1.cmml" xref="S2.E18.m1.1.1.2">subscript</csymbol><ci id="S2.E18.m1.1.1.2.2.cmml" xref="S2.E18.m1.1.1.2.2">𝑓</ci><ci id="S2.E18.m1.1.1.2.3.cmml" xref="S2.E18.m1.1.1.2.3">𝑖</ci></apply><apply id="S2.E18.m1.1.1.3.cmml" xref="S2.E18.m1.1.1.3"><times id="S2.E18.m1.1.1.3.1.cmml" xref="S2.E18.m1.1.1.3.1"></times><apply id="S2.E18.m1.1.1.3.2.cmml" xref="S2.E18.m1.1.1.3.2"><divide id="S2.E18.m1.1.1.3.2.1.cmml" xref="S2.E18.m1.1.1.3.2"></divide><apply id="S2.E18.m1.1.1.3.2.2.cmml" xref="S2.E18.m1.1.1.3.2.2"><csymbol cd="ambiguous" id="S2.E18.m1.1.1.3.2.2.1.cmml" xref="S2.E18.m1.1.1.3.2.2">subscript</csymbol><ci id="S2.E18.m1.1.1.3.2.2.2.cmml" xref="S2.E18.m1.1.1.3.2.2.2">𝑁</ci><ci id="S2.E18.m1.1.1.3.2.2.3.cmml" xref="S2.E18.m1.1.1.3.2.2.3">𝑟</ci></apply><apply id="S2.E18.m1.1.1.3.2.3.cmml" xref="S2.E18.m1.1.1.3.2.3"><times id="S2.E18.m1.1.1.3.2.3.1.cmml" xref="S2.E18.m1.1.1.3.2.3.1"></times><apply id="S2.E18.m1.1.1.3.2.3.2.cmml" xref="S2.E18.m1.1.1.3.2.3.2"><csymbol cd="ambiguous" id="S2.E18.m1.1.1.3.2.3.2.1.cmml" xref="S2.E18.m1.1.1.3.2.3.2">subscript</csymbol><ci id="S2.E18.m1.1.1.3.2.3.2.2.cmml" xref="S2.E18.m1.1.1.3.2.3.2.2">𝐾</ci><ci id="S2.E18.m1.1.1.3.2.3.2.3.cmml" xref="S2.E18.m1.1.1.3.2.3.2.3">𝑟</ci></apply><ci id="S2.E18.m1.1.1.3.2.3.3.cmml" xref="S2.E18.m1.1.1.3.2.3.3">𝑇</ci></apply></apply><apply id="S2.E18.m1.1.1.3.3.cmml" xref="S2.E18.m1.1.1.3.3"><apply id="S2.E18.m1.1.1.3.3.1.cmml" xref="S2.E18.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="S2.E18.m1.1.1.3.3.1.1.cmml" xref="S2.E18.m1.1.1.3.3.1">superscript</csymbol><apply id="S2.E18.m1.1.1.3.3.1.2.cmml" xref="S2.E18.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="S2.E18.m1.1.1.3.3.1.2.1.cmml" xref="S2.E18.m1.1.1.3.3.1">subscript</csymbol><sum id="S2.E18.m1.1.1.3.3.1.2.2.cmml" xref="S2.E18.m1.1.1.3.3.1.2.2"></sum><apply id="S2.E18.m1.1.1.3.3.1.2.3.cmml" xref="S2.E18.m1.1.1.3.3.1.2.3"><eq id="S2.E18.m1.1.1.3.3.1.2.3.1.cmml" xref="S2.E18.m1.1.1.3.3.1.2.3.1"></eq><ci id="S2.E18.m1.1.1.3.3.1.2.3.2.cmml" xref="S2.E18.m1.1.1.3.3.1.2.3.2">𝑡</ci><cn id="S2.E18.m1.1.1.3.3.1.2.3.3.cmml" type="integer" xref="S2.E18.m1.1.1.3.3.1.2.3.3">1</cn></apply></apply><ci id="S2.E18.m1.1.1.3.3.1.3.cmml" xref="S2.E18.m1.1.1.3.3.1.3">𝑇</ci></apply><cn id="S2.E18.m1.1.1.3.3.2.cmml" type="integer" xref="S2.E18.m1.1.1.3.3.2">1</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E18.m1.1c">\displaystyle f_{i}=\frac{N_{r}}{K_{r}T}\sum_{t=1}^{T}\mathds{1}</annotation><annotation encoding="application/x-llamapun" id="S2.E18.m1.1d">italic_f start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = divide start_ARG italic_N start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT end_ARG start_ARG italic_K start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT italic_T end_ARG ∑ start_POSTSUBSCRIPT italic_t = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT blackboard_1</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\left(s_{i,t}\in\operatorname{Topk}(\{s_{j,t}|1\leqslant j%
\leqslant N_{r}\},K_{r})\right)," class="ltx_Math" display="inline" id="S2.E18.m2.6"><semantics id="S2.E18.m2.6a"><mrow id="S2.E18.m2.6.6.1"><mrow id="S2.E18.m2.6.6.1.1.1" xref="S2.E18.m2.6.6.1.1.1.1.cmml"><mo id="S2.E18.m2.6.6.1.1.1.2" xref="S2.E18.m2.6.6.1.1.1.1.cmml">(</mo><mrow id="S2.E18.m2.6.6.1.1.1.1" xref="S2.E18.m2.6.6.1.1.1.1.cmml"><msub id="S2.E18.m2.6.6.1.1.1.1.4" xref="S2.E18.m2.6.6.1.1.1.1.4.cmml"><mi id="S2.E18.m2.6.6.1.1.1.1.4.2" xref="S2.E18.m2.6.6.1.1.1.1.4.2.cmml">s</mi><mrow id="S2.E18.m2.2.2.2.4" xref="S2.E18.m2.2.2.2.3.cmml"><mi id="S2.E18.m2.1.1.1.1" xref="S2.E18.m2.1.1.1.1.cmml">i</mi><mo id="S2.E18.m2.2.2.2.4.1" xref="S2.E18.m2.2.2.2.3.cmml">,</mo><mi id="S2.E18.m2.2.2.2.2" xref="S2.E18.m2.2.2.2.2.cmml">t</mi></mrow></msub><mo id="S2.E18.m2.6.6.1.1.1.1.3" xref="S2.E18.m2.6.6.1.1.1.1.3.cmml">∈</mo><mrow id="S2.E18.m2.6.6.1.1.1.1.2.2" xref="S2.E18.m2.6.6.1.1.1.1.2.3.cmml"><mi id="S2.E18.m2.5.5" xref="S2.E18.m2.5.5.cmml">Topk</mi><mo id="S2.E18.m2.6.6.1.1.1.1.2.2a" xref="S2.E18.m2.6.6.1.1.1.1.2.3.cmml">⁡</mo><mrow id="S2.E18.m2.6.6.1.1.1.1.2.2.2" xref="S2.E18.m2.6.6.1.1.1.1.2.3.cmml"><mo id="S2.E18.m2.6.6.1.1.1.1.2.2.2.3" stretchy="false" xref="S2.E18.m2.6.6.1.1.1.1.2.3.cmml">(</mo><mrow id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.3.cmml"><mo id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.3" stretchy="false" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.3.1.cmml">{</mo><msub id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.1.1" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.1.1.2" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.1.1.2.cmml">s</mi><mrow id="S2.E18.m2.4.4.2.4" xref="S2.E18.m2.4.4.2.3.cmml"><mi id="S2.E18.m2.3.3.1.1" xref="S2.E18.m2.3.3.1.1.cmml">j</mi><mo id="S2.E18.m2.4.4.2.4.1" xref="S2.E18.m2.4.4.2.3.cmml">,</mo><mi id="S2.E18.m2.4.4.2.2" xref="S2.E18.m2.4.4.2.2.cmml">t</mi></mrow></msub><mo id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.4" lspace="0em" rspace="0em" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.3.1.cmml">|</mo><mrow id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.cmml"><mn id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.2" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.2.cmml">1</mn><mo id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.3" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.3.cmml">⩽</mo><mi id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.4" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.4.cmml">j</mi><mo id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.5" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.5.cmml">⩽</mo><msub id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6.cmml"><mi id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6.2" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6.2.cmml">N</mi><mi id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6.3" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6.3.cmml">r</mi></msub></mrow><mo id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.5" stretchy="false" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.3.1.cmml">}</mo></mrow><mo id="S2.E18.m2.6.6.1.1.1.1.2.2.2.4" xref="S2.E18.m2.6.6.1.1.1.1.2.3.cmml">,</mo><msub id="S2.E18.m2.6.6.1.1.1.1.2.2.2.2" xref="S2.E18.m2.6.6.1.1.1.1.2.2.2.2.cmml"><mi id="S2.E18.m2.6.6.1.1.1.1.2.2.2.2.2" xref="S2.E18.m2.6.6.1.1.1.1.2.2.2.2.2.cmml">K</mi><mi id="S2.E18.m2.6.6.1.1.1.1.2.2.2.2.3" xref="S2.E18.m2.6.6.1.1.1.1.2.2.2.2.3.cmml">r</mi></msub><mo id="S2.E18.m2.6.6.1.1.1.1.2.2.2.5" stretchy="false" xref="S2.E18.m2.6.6.1.1.1.1.2.3.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E18.m2.6.6.1.1.1.3" xref="S2.E18.m2.6.6.1.1.1.1.cmml">)</mo></mrow><mo id="S2.E18.m2.6.6.1.2">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E18.m2.6b"><apply id="S2.E18.m2.6.6.1.1.1.1.cmml" xref="S2.E18.m2.6.6.1.1.1"><in id="S2.E18.m2.6.6.1.1.1.1.3.cmml" xref="S2.E18.m2.6.6.1.1.1.1.3"></in><apply id="S2.E18.m2.6.6.1.1.1.1.4.cmml" xref="S2.E18.m2.6.6.1.1.1.1.4"><csymbol cd="ambiguous" id="S2.E18.m2.6.6.1.1.1.1.4.1.cmml" xref="S2.E18.m2.6.6.1.1.1.1.4">subscript</csymbol><ci id="S2.E18.m2.6.6.1.1.1.1.4.2.cmml" xref="S2.E18.m2.6.6.1.1.1.1.4.2">𝑠</ci><list id="S2.E18.m2.2.2.2.3.cmml" xref="S2.E18.m2.2.2.2.4"><ci id="S2.E18.m2.1.1.1.1.cmml" xref="S2.E18.m2.1.1.1.1">𝑖</ci><ci id="S2.E18.m2.2.2.2.2.cmml" xref="S2.E18.m2.2.2.2.2">𝑡</ci></list></apply><apply id="S2.E18.m2.6.6.1.1.1.1.2.3.cmml" xref="S2.E18.m2.6.6.1.1.1.1.2.2"><ci id="S2.E18.m2.5.5.cmml" xref="S2.E18.m2.5.5">Topk</ci><apply id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2"><csymbol cd="latexml" id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.3.1.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.3">conditional-set</csymbol><apply id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.1.1.2">𝑠</ci><list id="S2.E18.m2.4.4.2.3.cmml" xref="S2.E18.m2.4.4.2.4"><ci id="S2.E18.m2.3.3.1.1.cmml" xref="S2.E18.m2.3.3.1.1">𝑗</ci><ci id="S2.E18.m2.4.4.2.2.cmml" xref="S2.E18.m2.4.4.2.2">𝑡</ci></list></apply><apply id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2"><and id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2a.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2"></and><apply id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2b.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2"><leq id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.3"></leq><cn id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.2.cmml" type="integer" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.2">1</cn><ci id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.4.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.4">𝑗</ci></apply><apply id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2c.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2"><leq id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.5.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.5"></leq><share href="https://arxiv.org/html/2412.19437v1#S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.4.cmml" id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2d.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2"></share><apply id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6"><csymbol cd="ambiguous" id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6.1.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6">subscript</csymbol><ci id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6.2.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6.2">𝑁</ci><ci id="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6.3.cmml" xref="S2.E18.m2.6.6.1.1.1.1.1.1.1.1.2.2.6.3">𝑟</ci></apply></apply></apply></apply><apply id="S2.E18.m2.6.6.1.1.1.1.2.2.2.2.cmml" xref="S2.E18.m2.6.6.1.1.1.1.2.2.2.2"><csymbol cd="ambiguous" id="S2.E18.m2.6.6.1.1.1.1.2.2.2.2.1.cmml" xref="S2.E18.m2.6.6.1.1.1.1.2.2.2.2">subscript</csymbol><ci id="S2.E18.m2.6.6.1.1.1.1.2.2.2.2.2.cmml" xref="S2.E18.m2.6.6.1.1.1.1.2.2.2.2.2">𝐾</ci><ci id="S2.E18.m2.6.6.1.1.1.1.2.2.2.2.3.cmml" xref="S2.E18.m2.6.6.1.1.1.1.2.2.2.2.3">𝑟</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E18.m2.6c">\displaystyle\left(s_{i,t}\in\operatorname{Topk}(\{s_{j,t}|1\leqslant j%
\leqslant N_{r}\},K_{r})\right),</annotation><annotation encoding="application/x-llamapun" id="S2.E18.m2.6d">( italic_s start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT ∈ roman_Topk ( { italic_s start_POSTSUBSCRIPT italic_j , italic_t end_POSTSUBSCRIPT | 1 ⩽ italic_j ⩽ italic_N start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT } , italic_K start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ) ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(18)</span></td>
</tr></tbody>
<tbody id="S2.E19"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle s^{\prime}_{i,t}" class="ltx_Math" display="inline" id="S2.E19.m1.2"><semantics id="S2.E19.m1.2a"><msubsup id="S2.E19.m1.2.3" xref="S2.E19.m1.2.3.cmml"><mi id="S2.E19.m1.2.3.2.2" xref="S2.E19.m1.2.3.2.2.cmml">s</mi><mrow id="S2.E19.m1.2.2.2.4" xref="S2.E19.m1.2.2.2.3.cmml"><mi id="S2.E19.m1.1.1.1.1" xref="S2.E19.m1.1.1.1.1.cmml">i</mi><mo id="S2.E19.m1.2.2.2.4.1" xref="S2.E19.m1.2.2.2.3.cmml">,</mo><mi id="S2.E19.m1.2.2.2.2" xref="S2.E19.m1.2.2.2.2.cmml">t</mi></mrow><mo id="S2.E19.m1.2.3.2.3" xref="S2.E19.m1.2.3.2.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S2.E19.m1.2b"><apply id="S2.E19.m1.2.3.cmml" xref="S2.E19.m1.2.3"><csymbol cd="ambiguous" id="S2.E19.m1.2.3.1.cmml" xref="S2.E19.m1.2.3">subscript</csymbol><apply id="S2.E19.m1.2.3.2.cmml" xref="S2.E19.m1.2.3"><csymbol cd="ambiguous" id="S2.E19.m1.2.3.2.1.cmml" xref="S2.E19.m1.2.3">superscript</csymbol><ci id="S2.E19.m1.2.3.2.2.cmml" xref="S2.E19.m1.2.3.2.2">𝑠</ci><ci id="S2.E19.m1.2.3.2.3.cmml" xref="S2.E19.m1.2.3.2.3">′</ci></apply><list id="S2.E19.m1.2.2.2.3.cmml" xref="S2.E19.m1.2.2.2.4"><ci id="S2.E19.m1.1.1.1.1.cmml" xref="S2.E19.m1.1.1.1.1">𝑖</ci><ci id="S2.E19.m1.2.2.2.2.cmml" xref="S2.E19.m1.2.2.2.2">𝑡</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E19.m1.2c">\displaystyle s^{\prime}_{i,t}</annotation><annotation encoding="application/x-llamapun" id="S2.E19.m1.2d">italic_s start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{s_{i,t}}{\sum_{j=1}^{N_{r}}s_{j,t}}," class="ltx_Math" display="inline" id="S2.E19.m2.5"><semantics id="S2.E19.m2.5a"><mrow id="S2.E19.m2.5.5.1" xref="S2.E19.m2.5.5.1.1.cmml"><mrow id="S2.E19.m2.5.5.1.1" xref="S2.E19.m2.5.5.1.1.cmml"><mi id="S2.E19.m2.5.5.1.1.2" xref="S2.E19.m2.5.5.1.1.2.cmml"></mi><mo id="S2.E19.m2.5.5.1.1.1" xref="S2.E19.m2.5.5.1.1.1.cmml">=</mo><mstyle displaystyle="true" id="S2.E19.m2.4.4" xref="S2.E19.m2.4.4.cmml"><mfrac id="S2.E19.m2.4.4a" xref="S2.E19.m2.4.4.cmml"><msub id="S2.E19.m2.2.2.2" xref="S2.E19.m2.2.2.2.cmml"><mi id="S2.E19.m2.2.2.2.4" xref="S2.E19.m2.2.2.2.4.cmml">s</mi><mrow id="S2.E19.m2.2.2.2.2.2.4" xref="S2.E19.m2.2.2.2.2.2.3.cmml"><mi id="S2.E19.m2.1.1.1.1.1.1" xref="S2.E19.m2.1.1.1.1.1.1.cmml">i</mi><mo id="S2.E19.m2.2.2.2.2.2.4.1" xref="S2.E19.m2.2.2.2.2.2.3.cmml">,</mo><mi id="S2.E19.m2.2.2.2.2.2.2" xref="S2.E19.m2.2.2.2.2.2.2.cmml">t</mi></mrow></msub><mrow id="S2.E19.m2.4.4.4" xref="S2.E19.m2.4.4.4.cmml"><msubsup id="S2.E19.m2.4.4.4.3" xref="S2.E19.m2.4.4.4.3.cmml"><mo id="S2.E19.m2.4.4.4.3.2.2" xref="S2.E19.m2.4.4.4.3.2.2.cmml">∑</mo><mrow id="S2.E19.m2.4.4.4.3.2.3" xref="S2.E19.m2.4.4.4.3.2.3.cmml"><mi id="S2.E19.m2.4.4.4.3.2.3.2" xref="S2.E19.m2.4.4.4.3.2.3.2.cmml">j</mi><mo id="S2.E19.m2.4.4.4.3.2.3.1" xref="S2.E19.m2.4.4.4.3.2.3.1.cmml">=</mo><mn id="S2.E19.m2.4.4.4.3.2.3.3" xref="S2.E19.m2.4.4.4.3.2.3.3.cmml">1</mn></mrow><msub id="S2.E19.m2.4.4.4.3.3" xref="S2.E19.m2.4.4.4.3.3.cmml"><mi id="S2.E19.m2.4.4.4.3.3.2" xref="S2.E19.m2.4.4.4.3.3.2.cmml">N</mi><mi id="S2.E19.m2.4.4.4.3.3.3" xref="S2.E19.m2.4.4.4.3.3.3.cmml">r</mi></msub></msubsup><msub id="S2.E19.m2.4.4.4.4" xref="S2.E19.m2.4.4.4.4.cmml"><mi id="S2.E19.m2.4.4.4.4.2" xref="S2.E19.m2.4.4.4.4.2.cmml">s</mi><mrow id="S2.E19.m2.4.4.4.2.2.4" xref="S2.E19.m2.4.4.4.2.2.3.cmml"><mi id="S2.E19.m2.3.3.3.1.1.1" xref="S2.E19.m2.3.3.3.1.1.1.cmml">j</mi><mo id="S2.E19.m2.4.4.4.2.2.4.1" xref="S2.E19.m2.4.4.4.2.2.3.cmml">,</mo><mi id="S2.E19.m2.4.4.4.2.2.2" xref="S2.E19.m2.4.4.4.2.2.2.cmml">t</mi></mrow></msub></mrow></mfrac></mstyle></mrow><mo id="S2.E19.m2.5.5.1.2" xref="S2.E19.m2.5.5.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E19.m2.5b"><apply id="S2.E19.m2.5.5.1.1.cmml" xref="S2.E19.m2.5.5.1"><eq id="S2.E19.m2.5.5.1.1.1.cmml" xref="S2.E19.m2.5.5.1.1.1"></eq><csymbol cd="latexml" id="S2.E19.m2.5.5.1.1.2.cmml" xref="S2.E19.m2.5.5.1.1.2">absent</csymbol><apply id="S2.E19.m2.4.4.cmml" xref="S2.E19.m2.4.4"><divide id="S2.E19.m2.4.4.5.cmml" xref="S2.E19.m2.4.4"></divide><apply id="S2.E19.m2.2.2.2.cmml" xref="S2.E19.m2.2.2.2"><csymbol cd="ambiguous" id="S2.E19.m2.2.2.2.3.cmml" xref="S2.E19.m2.2.2.2">subscript</csymbol><ci id="S2.E19.m2.2.2.2.4.cmml" xref="S2.E19.m2.2.2.2.4">𝑠</ci><list id="S2.E19.m2.2.2.2.2.2.3.cmml" xref="S2.E19.m2.2.2.2.2.2.4"><ci id="S2.E19.m2.1.1.1.1.1.1.cmml" xref="S2.E19.m2.1.1.1.1.1.1">𝑖</ci><ci id="S2.E19.m2.2.2.2.2.2.2.cmml" xref="S2.E19.m2.2.2.2.2.2.2">𝑡</ci></list></apply><apply id="S2.E19.m2.4.4.4.cmml" xref="S2.E19.m2.4.4.4"><apply id="S2.E19.m2.4.4.4.3.cmml" xref="S2.E19.m2.4.4.4.3"><csymbol cd="ambiguous" id="S2.E19.m2.4.4.4.3.1.cmml" xref="S2.E19.m2.4.4.4.3">superscript</csymbol><apply id="S2.E19.m2.4.4.4.3.2.cmml" xref="S2.E19.m2.4.4.4.3"><csymbol cd="ambiguous" id="S2.E19.m2.4.4.4.3.2.1.cmml" xref="S2.E19.m2.4.4.4.3">subscript</csymbol><sum id="S2.E19.m2.4.4.4.3.2.2.cmml" xref="S2.E19.m2.4.4.4.3.2.2"></sum><apply id="S2.E19.m2.4.4.4.3.2.3.cmml" xref="S2.E19.m2.4.4.4.3.2.3"><eq id="S2.E19.m2.4.4.4.3.2.3.1.cmml" xref="S2.E19.m2.4.4.4.3.2.3.1"></eq><ci id="S2.E19.m2.4.4.4.3.2.3.2.cmml" xref="S2.E19.m2.4.4.4.3.2.3.2">𝑗</ci><cn id="S2.E19.m2.4.4.4.3.2.3.3.cmml" type="integer" xref="S2.E19.m2.4.4.4.3.2.3.3">1</cn></apply></apply><apply id="S2.E19.m2.4.4.4.3.3.cmml" xref="S2.E19.m2.4.4.4.3.3"><csymbol cd="ambiguous" id="S2.E19.m2.4.4.4.3.3.1.cmml" xref="S2.E19.m2.4.4.4.3.3">subscript</csymbol><ci id="S2.E19.m2.4.4.4.3.3.2.cmml" xref="S2.E19.m2.4.4.4.3.3.2">𝑁</ci><ci id="S2.E19.m2.4.4.4.3.3.3.cmml" xref="S2.E19.m2.4.4.4.3.3.3">𝑟</ci></apply></apply><apply id="S2.E19.m2.4.4.4.4.cmml" xref="S2.E19.m2.4.4.4.4"><csymbol cd="ambiguous" id="S2.E19.m2.4.4.4.4.1.cmml" xref="S2.E19.m2.4.4.4.4">subscript</csymbol><ci id="S2.E19.m2.4.4.4.4.2.cmml" xref="S2.E19.m2.4.4.4.4.2">𝑠</ci><list id="S2.E19.m2.4.4.4.2.2.3.cmml" xref="S2.E19.m2.4.4.4.2.2.4"><ci id="S2.E19.m2.3.3.3.1.1.1.cmml" xref="S2.E19.m2.3.3.3.1.1.1">𝑗</ci><ci id="S2.E19.m2.4.4.4.2.2.2.cmml" xref="S2.E19.m2.4.4.4.2.2.2">𝑡</ci></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E19.m2.5c">\displaystyle=\frac{s_{i,t}}{\sum_{j=1}^{N_{r}}s_{j,t}},</annotation><annotation encoding="application/x-llamapun" id="S2.E19.m2.5d">= divide start_ARG italic_s start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT end_POSTSUPERSCRIPT italic_s start_POSTSUBSCRIPT italic_j , italic_t end_POSTSUBSCRIPT end_ARG ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(19)</span></td>
</tr></tbody>
<tbody id="S2.E20"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle P_{i}" class="ltx_Math" display="inline" id="S2.E20.m1.1"><semantics id="S2.E20.m1.1a"><msub id="S2.E20.m1.1.1" xref="S2.E20.m1.1.1.cmml"><mi id="S2.E20.m1.1.1.2" xref="S2.E20.m1.1.1.2.cmml">P</mi><mi id="S2.E20.m1.1.1.3" xref="S2.E20.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.E20.m1.1b"><apply id="S2.E20.m1.1.1.cmml" xref="S2.E20.m1.1.1"><csymbol cd="ambiguous" id="S2.E20.m1.1.1.1.cmml" xref="S2.E20.m1.1.1">subscript</csymbol><ci id="S2.E20.m1.1.1.2.cmml" xref="S2.E20.m1.1.1.2">𝑃</ci><ci id="S2.E20.m1.1.1.3.cmml" xref="S2.E20.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E20.m1.1c">\displaystyle P_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.E20.m1.1d">italic_P start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{1}{T}\sum_{t=1}^{T}{s^{\prime}_{i,t}}," class="ltx_Math" display="inline" id="S2.E20.m2.3"><semantics id="S2.E20.m2.3a"><mrow id="S2.E20.m2.3.3.1" xref="S2.E20.m2.3.3.1.1.cmml"><mrow id="S2.E20.m2.3.3.1.1" xref="S2.E20.m2.3.3.1.1.cmml"><mi id="S2.E20.m2.3.3.1.1.2" xref="S2.E20.m2.3.3.1.1.2.cmml"></mi><mo id="S2.E20.m2.3.3.1.1.1" xref="S2.E20.m2.3.3.1.1.1.cmml">=</mo><mrow id="S2.E20.m2.3.3.1.1.3" xref="S2.E20.m2.3.3.1.1.3.cmml"><mstyle displaystyle="true" id="S2.E20.m2.3.3.1.1.3.2" xref="S2.E20.m2.3.3.1.1.3.2.cmml"><mfrac id="S2.E20.m2.3.3.1.1.3.2a" xref="S2.E20.m2.3.3.1.1.3.2.cmml"><mn id="S2.E20.m2.3.3.1.1.3.2.2" xref="S2.E20.m2.3.3.1.1.3.2.2.cmml">1</mn><mi id="S2.E20.m2.3.3.1.1.3.2.3" xref="S2.E20.m2.3.3.1.1.3.2.3.cmml">T</mi></mfrac></mstyle><mo id="S2.E20.m2.3.3.1.1.3.1" xref="S2.E20.m2.3.3.1.1.3.1.cmml">⁢</mo><mrow id="S2.E20.m2.3.3.1.1.3.3" xref="S2.E20.m2.3.3.1.1.3.3.cmml"><mstyle displaystyle="true" id="S2.E20.m2.3.3.1.1.3.3.1" xref="S2.E20.m2.3.3.1.1.3.3.1.cmml"><munderover id="S2.E20.m2.3.3.1.1.3.3.1a" xref="S2.E20.m2.3.3.1.1.3.3.1.cmml"><mo id="S2.E20.m2.3.3.1.1.3.3.1.2.2" movablelimits="false" xref="S2.E20.m2.3.3.1.1.3.3.1.2.2.cmml">∑</mo><mrow id="S2.E20.m2.3.3.1.1.3.3.1.2.3" xref="S2.E20.m2.3.3.1.1.3.3.1.2.3.cmml"><mi id="S2.E20.m2.3.3.1.1.3.3.1.2.3.2" xref="S2.E20.m2.3.3.1.1.3.3.1.2.3.2.cmml">t</mi><mo id="S2.E20.m2.3.3.1.1.3.3.1.2.3.1" xref="S2.E20.m2.3.3.1.1.3.3.1.2.3.1.cmml">=</mo><mn id="S2.E20.m2.3.3.1.1.3.3.1.2.3.3" xref="S2.E20.m2.3.3.1.1.3.3.1.2.3.3.cmml">1</mn></mrow><mi id="S2.E20.m2.3.3.1.1.3.3.1.3" xref="S2.E20.m2.3.3.1.1.3.3.1.3.cmml">T</mi></munderover></mstyle><msubsup id="S2.E20.m2.3.3.1.1.3.3.2" xref="S2.E20.m2.3.3.1.1.3.3.2.cmml"><mi id="S2.E20.m2.3.3.1.1.3.3.2.2.2" xref="S2.E20.m2.3.3.1.1.3.3.2.2.2.cmml">s</mi><mrow id="S2.E20.m2.2.2.2.4" xref="S2.E20.m2.2.2.2.3.cmml"><mi id="S2.E20.m2.1.1.1.1" xref="S2.E20.m2.1.1.1.1.cmml">i</mi><mo id="S2.E20.m2.2.2.2.4.1" xref="S2.E20.m2.2.2.2.3.cmml">,</mo><mi id="S2.E20.m2.2.2.2.2" xref="S2.E20.m2.2.2.2.2.cmml">t</mi></mrow><mo id="S2.E20.m2.3.3.1.1.3.3.2.2.3" xref="S2.E20.m2.3.3.1.1.3.3.2.2.3.cmml">′</mo></msubsup></mrow></mrow></mrow><mo id="S2.E20.m2.3.3.1.2" xref="S2.E20.m2.3.3.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E20.m2.3b"><apply id="S2.E20.m2.3.3.1.1.cmml" xref="S2.E20.m2.3.3.1"><eq id="S2.E20.m2.3.3.1.1.1.cmml" xref="S2.E20.m2.3.3.1.1.1"></eq><csymbol cd="latexml" id="S2.E20.m2.3.3.1.1.2.cmml" xref="S2.E20.m2.3.3.1.1.2">absent</csymbol><apply id="S2.E20.m2.3.3.1.1.3.cmml" xref="S2.E20.m2.3.3.1.1.3"><times id="S2.E20.m2.3.3.1.1.3.1.cmml" xref="S2.E20.m2.3.3.1.1.3.1"></times><apply id="S2.E20.m2.3.3.1.1.3.2.cmml" xref="S2.E20.m2.3.3.1.1.3.2"><divide id="S2.E20.m2.3.3.1.1.3.2.1.cmml" xref="S2.E20.m2.3.3.1.1.3.2"></divide><cn id="S2.E20.m2.3.3.1.1.3.2.2.cmml" type="integer" xref="S2.E20.m2.3.3.1.1.3.2.2">1</cn><ci id="S2.E20.m2.3.3.1.1.3.2.3.cmml" xref="S2.E20.m2.3.3.1.1.3.2.3">𝑇</ci></apply><apply id="S2.E20.m2.3.3.1.1.3.3.cmml" xref="S2.E20.m2.3.3.1.1.3.3"><apply id="S2.E20.m2.3.3.1.1.3.3.1.cmml" xref="S2.E20.m2.3.3.1.1.3.3.1"><csymbol cd="ambiguous" id="S2.E20.m2.3.3.1.1.3.3.1.1.cmml" xref="S2.E20.m2.3.3.1.1.3.3.1">superscript</csymbol><apply id="S2.E20.m2.3.3.1.1.3.3.1.2.cmml" xref="S2.E20.m2.3.3.1.1.3.3.1"><csymbol cd="ambiguous" id="S2.E20.m2.3.3.1.1.3.3.1.2.1.cmml" xref="S2.E20.m2.3.3.1.1.3.3.1">subscript</csymbol><sum id="S2.E20.m2.3.3.1.1.3.3.1.2.2.cmml" xref="S2.E20.m2.3.3.1.1.3.3.1.2.2"></sum><apply id="S2.E20.m2.3.3.1.1.3.3.1.2.3.cmml" xref="S2.E20.m2.3.3.1.1.3.3.1.2.3"><eq id="S2.E20.m2.3.3.1.1.3.3.1.2.3.1.cmml" xref="S2.E20.m2.3.3.1.1.3.3.1.2.3.1"></eq><ci id="S2.E20.m2.3.3.1.1.3.3.1.2.3.2.cmml" xref="S2.E20.m2.3.3.1.1.3.3.1.2.3.2">𝑡</ci><cn id="S2.E20.m2.3.3.1.1.3.3.1.2.3.3.cmml" type="integer" xref="S2.E20.m2.3.3.1.1.3.3.1.2.3.3">1</cn></apply></apply><ci id="S2.E20.m2.3.3.1.1.3.3.1.3.cmml" xref="S2.E20.m2.3.3.1.1.3.3.1.3">𝑇</ci></apply><apply id="S2.E20.m2.3.3.1.1.3.3.2.cmml" xref="S2.E20.m2.3.3.1.1.3.3.2"><csymbol cd="ambiguous" id="S2.E20.m2.3.3.1.1.3.3.2.1.cmml" xref="S2.E20.m2.3.3.1.1.3.3.2">subscript</csymbol><apply id="S2.E20.m2.3.3.1.1.3.3.2.2.cmml" xref="S2.E20.m2.3.3.1.1.3.3.2"><csymbol cd="ambiguous" id="S2.E20.m2.3.3.1.1.3.3.2.2.1.cmml" xref="S2.E20.m2.3.3.1.1.3.3.2">superscript</csymbol><ci id="S2.E20.m2.3.3.1.1.3.3.2.2.2.cmml" xref="S2.E20.m2.3.3.1.1.3.3.2.2.2">𝑠</ci><ci id="S2.E20.m2.3.3.1.1.3.3.2.2.3.cmml" xref="S2.E20.m2.3.3.1.1.3.3.2.2.3">′</ci></apply><list id="S2.E20.m2.2.2.2.3.cmml" xref="S2.E20.m2.2.2.2.4"><ci id="S2.E20.m2.1.1.1.1.cmml" xref="S2.E20.m2.1.1.1.1">𝑖</ci><ci id="S2.E20.m2.2.2.2.2.cmml" xref="S2.E20.m2.2.2.2.2">𝑡</ci></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E20.m2.3c">\displaystyle=\frac{1}{T}\sum_{t=1}^{T}{s^{\prime}_{i,t}},</annotation><annotation encoding="application/x-llamapun" id="S2.E20.m2.3d">= divide start_ARG 1 end_ARG start_ARG italic_T end_ARG ∑ start_POSTSUBSCRIPT italic_t = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT italic_s start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i , italic_t end_POSTSUBSCRIPT ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(20)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS1.SSS2.Px3.p1.3">where the balance factor <math alttext="\alpha" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px3.p1.1.m1.1"><semantics id="S2.SS1.SSS2.Px3.p1.1.m1.1a"><mi id="S2.SS1.SSS2.Px3.p1.1.m1.1.1" xref="S2.SS1.SSS2.Px3.p1.1.m1.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px3.p1.1.m1.1b"><ci id="S2.SS1.SSS2.Px3.p1.1.m1.1.1.cmml" xref="S2.SS1.SSS2.Px3.p1.1.m1.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px3.p1.1.m1.1c">\alpha</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px3.p1.1.m1.1d">italic_α</annotation></semantics></math> is a hyper-parameter, which will be assigned an extremely small value for DeepSeek-V3;
<math alttext="\mathds{1}(\cdot)" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px3.p1.2.m2.1"><semantics id="S2.SS1.SSS2.Px3.p1.2.m2.1a"><mrow id="S2.SS1.SSS2.Px3.p1.2.m2.1.2" xref="S2.SS1.SSS2.Px3.p1.2.m2.1.2.cmml"><mn id="S2.SS1.SSS2.Px3.p1.2.m2.1.2.2" xref="S2.SS1.SSS2.Px3.p1.2.m2.1.2.2.cmml">𝟙</mn><mo id="S2.SS1.SSS2.Px3.p1.2.m2.1.2.1" xref="S2.SS1.SSS2.Px3.p1.2.m2.1.2.1.cmml">⁢</mo><mrow id="S2.SS1.SSS2.Px3.p1.2.m2.1.2.3.2" xref="S2.SS1.SSS2.Px3.p1.2.m2.1.2.cmml"><mo id="S2.SS1.SSS2.Px3.p1.2.m2.1.2.3.2.1" stretchy="false" xref="S2.SS1.SSS2.Px3.p1.2.m2.1.2.cmml">(</mo><mo id="S2.SS1.SSS2.Px3.p1.2.m2.1.1" lspace="0em" rspace="0em" xref="S2.SS1.SSS2.Px3.p1.2.m2.1.1.cmml">⋅</mo><mo id="S2.SS1.SSS2.Px3.p1.2.m2.1.2.3.2.2" stretchy="false" xref="S2.SS1.SSS2.Px3.p1.2.m2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px3.p1.2.m2.1b"><apply id="S2.SS1.SSS2.Px3.p1.2.m2.1.2.cmml" xref="S2.SS1.SSS2.Px3.p1.2.m2.1.2"><times id="S2.SS1.SSS2.Px3.p1.2.m2.1.2.1.cmml" xref="S2.SS1.SSS2.Px3.p1.2.m2.1.2.1"></times><cn id="S2.SS1.SSS2.Px3.p1.2.m2.1.2.2.cmml" type="integer" xref="S2.SS1.SSS2.Px3.p1.2.m2.1.2.2">1</cn><ci id="S2.SS1.SSS2.Px3.p1.2.m2.1.1.cmml" xref="S2.SS1.SSS2.Px3.p1.2.m2.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px3.p1.2.m2.1c">\mathds{1}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px3.p1.2.m2.1d">blackboard_1 ( ⋅ )</annotation></semantics></math> denotes the indicator function;
and <math alttext="T" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px3.p1.3.m3.1"><semantics id="S2.SS1.SSS2.Px3.p1.3.m3.1a"><mi id="S2.SS1.SSS2.Px3.p1.3.m3.1.1" xref="S2.SS1.SSS2.Px3.p1.3.m3.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px3.p1.3.m3.1b"><ci id="S2.SS1.SSS2.Px3.p1.3.m3.1.1.cmml" xref="S2.SS1.SSS2.Px3.p1.3.m3.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px3.p1.3.m3.1c">T</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px3.p1.3.m3.1d">italic_T</annotation></semantics></math> denotes the number of tokens in a sequence.
The sequence-wise balance loss encourages the expert load on each sequence to be balanced.</p>
</div>
</section>
<section class="ltx_paragraph" id="S2.SS1.SSS2.Px4">
<h5 class="ltx_title ltx_title_paragraph">Node-Limited Routing.</h5>
<div class="ltx_para" id="S2.SS1.SSS2.Px4.p1">
<p class="ltx_p" id="S2.SS1.SSS2.Px4.p1.2">Like the device-limited routing used by DeepSeek-V2, DeepSeek-V3 also uses a restricted routing mechanism to limit communication costs during training.
In short, we ensure that each token will be sent to at most <math alttext="M" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px4.p1.1.m1.1"><semantics id="S2.SS1.SSS2.Px4.p1.1.m1.1a"><mi id="S2.SS1.SSS2.Px4.p1.1.m1.1.1" xref="S2.SS1.SSS2.Px4.p1.1.m1.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px4.p1.1.m1.1b"><ci id="S2.SS1.SSS2.Px4.p1.1.m1.1.1.cmml" xref="S2.SS1.SSS2.Px4.p1.1.m1.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px4.p1.1.m1.1c">M</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px4.p1.1.m1.1d">italic_M</annotation></semantics></math> nodes, which are selected according to the sum of the highest <math alttext="\frac{K_{r}}{M}" class="ltx_Math" display="inline" id="S2.SS1.SSS2.Px4.p1.2.m2.1"><semantics id="S2.SS1.SSS2.Px4.p1.2.m2.1a"><mfrac id="S2.SS1.SSS2.Px4.p1.2.m2.1.1" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1.cmml"><msub id="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2.cmml"><mi id="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2.2" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2.2.cmml">K</mi><mi id="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2.3" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2.3.cmml">r</mi></msub><mi id="S2.SS1.SSS2.Px4.p1.2.m2.1.1.3" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1.3.cmml">M</mi></mfrac><annotation-xml encoding="MathML-Content" id="S2.SS1.SSS2.Px4.p1.2.m2.1b"><apply id="S2.SS1.SSS2.Px4.p1.2.m2.1.1.cmml" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1"><divide id="S2.SS1.SSS2.Px4.p1.2.m2.1.1.1.cmml" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1"></divide><apply id="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2.cmml" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2"><csymbol cd="ambiguous" id="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2.1.cmml" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2">subscript</csymbol><ci id="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2.2.cmml" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2.2">𝐾</ci><ci id="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2.3.cmml" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1.2.3">𝑟</ci></apply><ci id="S2.SS1.SSS2.Px4.p1.2.m2.1.1.3.cmml" xref="S2.SS1.SSS2.Px4.p1.2.m2.1.1.3">𝑀</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.SSS2.Px4.p1.2.m2.1c">\frac{K_{r}}{M}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.SSS2.Px4.p1.2.m2.1d">divide start_ARG italic_K start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT end_ARG start_ARG italic_M end_ARG</annotation></semantics></math> affinity scores of the experts distributed on each node.
Under this constraint, our MoE training framework can nearly achieve full computation-communication overlap.</p>
</div>
</section>
<section class="ltx_paragraph" id="S2.SS1.SSS2.Px5">
<h5 class="ltx_title ltx_title_paragraph">No Token-Dropping.</h5>
<div class="ltx_para" id="S2.SS1.SSS2.Px5.p1">
<p class="ltx_p" id="S2.SS1.SSS2.Px5.p1.1">Due to the effective load balancing strategy, DeepSeek-V3 keeps a good load balance during its full training.
Therefore, DeepSeek-V3 does not drop any tokens during training.
In addition, we also implement specific deployment strategies to ensure inference load balance, so DeepSeek-V3 also does not drop tokens during inference.</p>
</div>
<figure class="ltx_figure" id="S2.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="366" id="S2.F3.g1" src="x3.png" width="822"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span>
Illustration of our Multi-Token Prediction (MTP) implementation.
We keep the complete causal chain for the prediction of each token at each depth.
</figcaption>
</figure>
</section>
</section>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2 </span>Multi-Token Prediction</h3>
<div class="ltx_para" id="S2.SS2.p1">
<p class="ltx_p" id="S2.SS2.p1.1">Inspired by <cite class="ltx_cite ltx_citemacro_citet">Gloeckle et al. (<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib26" title="">2024</a>)</cite>, we investigate and set a Multi-Token Prediction (MTP) objective for DeepSeek-V3, which extends the prediction scope to multiple future tokens at each position.
On the one hand, an MTP objective densifies the training signals and may improve data efficiency.
On the other hand, MTP may enable the model to pre-plan its representations for better prediction of future tokens.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S2.F3" title="Figure 3 ‣ No Token-Dropping. ‣ 2.1.2 DeepSeekMoE with Auxiliary-Loss-Free Load Balancing ‣ 2.1 Basic Architecture ‣ 2 Architecture ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">3</span></a> illustrates our implementation of MTP.
Different from <cite class="ltx_cite ltx_citemacro_citet">Gloeckle et al. (<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib26" title="">2024</a>)</cite>, which parallelly predicts <math alttext="D" class="ltx_Math" display="inline" id="S2.SS2.p1.1.m1.1"><semantics id="S2.SS2.p1.1.m1.1a"><mi id="S2.SS2.p1.1.m1.1.1" xref="S2.SS2.p1.1.m1.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.1.m1.1b"><ci id="S2.SS2.p1.1.m1.1.1.cmml" xref="S2.SS2.p1.1.m1.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.1.m1.1c">D</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.1.m1.1d">italic_D</annotation></semantics></math> additional tokens using independent output heads, we sequentially predict additional tokens and keep the complete causal chain at each prediction depth.
We introduce the details of our MTP implementation in this section.</p>
</div>
<section class="ltx_paragraph" id="S2.SS2.SSS0.Px1">
<h5 class="ltx_title ltx_title_paragraph">MTP Modules.</h5>
<div class="ltx_para" id="S2.SS2.SSS0.Px1.p1">
<p class="ltx_p" id="S2.SS2.SSS0.Px1.p1.15">To be specific, our MTP implementation uses <math alttext="D" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.1.m1.1"><semantics id="S2.SS2.SSS0.Px1.p1.1.m1.1a"><mi id="S2.SS2.SSS0.Px1.p1.1.m1.1.1" xref="S2.SS2.SSS0.Px1.p1.1.m1.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.1.m1.1b"><ci id="S2.SS2.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.1.m1.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.1.m1.1c">D</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.1.m1.1d">italic_D</annotation></semantics></math> sequential modules to predict <math alttext="D" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.2.m2.1"><semantics id="S2.SS2.SSS0.Px1.p1.2.m2.1a"><mi id="S2.SS2.SSS0.Px1.p1.2.m2.1.1" xref="S2.SS2.SSS0.Px1.p1.2.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.2.m2.1b"><ci id="S2.SS2.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.2.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.2.m2.1c">D</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.2.m2.1d">italic_D</annotation></semantics></math> additional tokens.
The <math alttext="k" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.3.m3.1"><semantics id="S2.SS2.SSS0.Px1.p1.3.m3.1a"><mi id="S2.SS2.SSS0.Px1.p1.3.m3.1.1" xref="S2.SS2.SSS0.Px1.p1.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.3.m3.1b"><ci id="S2.SS2.SSS0.Px1.p1.3.m3.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.3.m3.1d">italic_k</annotation></semantics></math>-th MTP module consists of a shared embedding layer <math alttext="\operatorname{Emb}(\cdot)" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.4.m4.2"><semantics id="S2.SS2.SSS0.Px1.p1.4.m4.2a"><mrow id="S2.SS2.SSS0.Px1.p1.4.m4.2.3.2" xref="S2.SS2.SSS0.Px1.p1.4.m4.2.3.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.4.m4.1.1" xref="S2.SS2.SSS0.Px1.p1.4.m4.1.1.cmml">Emb</mi><mo id="S2.SS2.SSS0.Px1.p1.4.m4.2.3.2a" xref="S2.SS2.SSS0.Px1.p1.4.m4.2.3.1.cmml">⁡</mo><mrow id="S2.SS2.SSS0.Px1.p1.4.m4.2.3.2.1" xref="S2.SS2.SSS0.Px1.p1.4.m4.2.3.1.cmml"><mo id="S2.SS2.SSS0.Px1.p1.4.m4.2.3.2.1.1" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.4.m4.2.3.1.cmml">(</mo><mo id="S2.SS2.SSS0.Px1.p1.4.m4.2.2" lspace="0em" rspace="0em" xref="S2.SS2.SSS0.Px1.p1.4.m4.2.2.cmml">⋅</mo><mo id="S2.SS2.SSS0.Px1.p1.4.m4.2.3.2.1.2" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.4.m4.2.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.4.m4.2b"><apply id="S2.SS2.SSS0.Px1.p1.4.m4.2.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.4.m4.2.3.2"><ci id="S2.SS2.SSS0.Px1.p1.4.m4.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.4.m4.1.1">Emb</ci><ci id="S2.SS2.SSS0.Px1.p1.4.m4.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.4.m4.2.2">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.4.m4.2c">\operatorname{Emb}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.4.m4.2d">roman_Emb ( ⋅ )</annotation></semantics></math>, a shared output head <math alttext="\operatorname{OutHead}(\cdot)" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.5.m5.2"><semantics id="S2.SS2.SSS0.Px1.p1.5.m5.2a"><mrow id="S2.SS2.SSS0.Px1.p1.5.m5.2.3.2" xref="S2.SS2.SSS0.Px1.p1.5.m5.2.3.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.5.m5.1.1" xref="S2.SS2.SSS0.Px1.p1.5.m5.1.1.cmml">OutHead</mi><mo id="S2.SS2.SSS0.Px1.p1.5.m5.2.3.2a" xref="S2.SS2.SSS0.Px1.p1.5.m5.2.3.1.cmml">⁡</mo><mrow id="S2.SS2.SSS0.Px1.p1.5.m5.2.3.2.1" xref="S2.SS2.SSS0.Px1.p1.5.m5.2.3.1.cmml"><mo id="S2.SS2.SSS0.Px1.p1.5.m5.2.3.2.1.1" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.5.m5.2.3.1.cmml">(</mo><mo id="S2.SS2.SSS0.Px1.p1.5.m5.2.2" lspace="0em" rspace="0em" xref="S2.SS2.SSS0.Px1.p1.5.m5.2.2.cmml">⋅</mo><mo id="S2.SS2.SSS0.Px1.p1.5.m5.2.3.2.1.2" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.5.m5.2.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.5.m5.2b"><apply id="S2.SS2.SSS0.Px1.p1.5.m5.2.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.5.m5.2.3.2"><ci id="S2.SS2.SSS0.Px1.p1.5.m5.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.5.m5.1.1">OutHead</ci><ci id="S2.SS2.SSS0.Px1.p1.5.m5.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.5.m5.2.2">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.5.m5.2c">\operatorname{OutHead}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.5.m5.2d">roman_OutHead ( ⋅ )</annotation></semantics></math>, a Transformer block <math alttext="\operatorname{TRM}_{k}(\cdot)" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.6.m6.2"><semantics id="S2.SS2.SSS0.Px1.p1.6.m6.2a"><mrow id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.2.cmml"><msub id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1.2" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1.2.cmml">TRM</mi><mi id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1.3" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1.3.cmml">k</mi></msub><mo id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1a" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.2.cmml">⁡</mo><mrow id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.2" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.2.cmml"><mo id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.2.1" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.2.cmml">(</mo><mo id="S2.SS2.SSS0.Px1.p1.6.m6.1.1" lspace="0em" rspace="0em" xref="S2.SS2.SSS0.Px1.p1.6.m6.1.1.cmml">⋅</mo><mo id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.2.2" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.6.m6.2b"><apply id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1"><apply id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1">subscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1.2">TRM</ci><ci id="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.6.m6.2.2.1.1.3">𝑘</ci></apply><ci id="S2.SS2.SSS0.Px1.p1.6.m6.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.6.m6.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.6.m6.2c">\operatorname{TRM}_{k}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.6.m6.2d">roman_TRM start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( ⋅ )</annotation></semantics></math>, and a projection matrix <math alttext="M_{k}\in\mathbb{R}^{d\times 2d}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.7.m7.1"><semantics id="S2.SS2.SSS0.Px1.p1.7.m7.1a"><mrow id="S2.SS2.SSS0.Px1.p1.7.m7.1.1" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.cmml"><msub id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2.cmml"><mi id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2.2" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2.2.cmml">M</mi><mi id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2.3" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2.3.cmml">k</mi></msub><mo id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.1" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.1.cmml">∈</mo><msup id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.cmml"><mi id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.2" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.2.cmml">ℝ</mi><mrow id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.cmml"><mrow id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.cmml"><mi id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.2" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.2.cmml">d</mi><mo id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.1" lspace="0.222em" rspace="0.222em" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.1.cmml">×</mo><mn id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.3" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.3.cmml">2</mn></mrow><mo id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.1" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.1.cmml">⁢</mo><mi id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.3" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.3.cmml">d</mi></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.7.m7.1b"><apply id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1"><in id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.1"></in><apply id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2.1.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2">subscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2.2">𝑀</ci><ci id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2.3.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3">superscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.2.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.2">ℝ</ci><apply id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3"><times id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.1"></times><apply id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2"><times id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.1.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.1"></times><ci id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.2">𝑑</ci><cn id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.3.cmml" type="integer" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.2.3">2</cn></apply><ci id="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.3.cmml" xref="S2.SS2.SSS0.Px1.p1.7.m7.1.1.3.3.3">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.7.m7.1c">M_{k}\in\mathbb{R}^{d\times 2d}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.7.m7.1d">italic_M start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d × 2 italic_d end_POSTSUPERSCRIPT</annotation></semantics></math>.
For the <math alttext="i" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.8.m8.1"><semantics id="S2.SS2.SSS0.Px1.p1.8.m8.1a"><mi id="S2.SS2.SSS0.Px1.p1.8.m8.1.1" xref="S2.SS2.SSS0.Px1.p1.8.m8.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.8.m8.1b"><ci id="S2.SS2.SSS0.Px1.p1.8.m8.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.8.m8.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.8.m8.1c">i</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.8.m8.1d">italic_i</annotation></semantics></math>-th input token <math alttext="t_{i}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.9.m9.1"><semantics id="S2.SS2.SSS0.Px1.p1.9.m9.1a"><msub id="S2.SS2.SSS0.Px1.p1.9.m9.1.1" xref="S2.SS2.SSS0.Px1.p1.9.m9.1.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.9.m9.1.1.2" xref="S2.SS2.SSS0.Px1.p1.9.m9.1.1.2.cmml">t</mi><mi id="S2.SS2.SSS0.Px1.p1.9.m9.1.1.3" xref="S2.SS2.SSS0.Px1.p1.9.m9.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.9.m9.1b"><apply id="S2.SS2.SSS0.Px1.p1.9.m9.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.9.m9.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.9.m9.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.9.m9.1.1">subscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.9.m9.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.9.m9.1.1.2">𝑡</ci><ci id="S2.SS2.SSS0.Px1.p1.9.m9.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.9.m9.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.9.m9.1c">t_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.9.m9.1d">italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, at the <math alttext="k" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.10.m10.1"><semantics id="S2.SS2.SSS0.Px1.p1.10.m10.1a"><mi id="S2.SS2.SSS0.Px1.p1.10.m10.1.1" xref="S2.SS2.SSS0.Px1.p1.10.m10.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.10.m10.1b"><ci id="S2.SS2.SSS0.Px1.p1.10.m10.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.10.m10.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.10.m10.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.10.m10.1d">italic_k</annotation></semantics></math>-th prediction depth, we first combine the representation of the <math alttext="i" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.11.m11.1"><semantics id="S2.SS2.SSS0.Px1.p1.11.m11.1a"><mi id="S2.SS2.SSS0.Px1.p1.11.m11.1.1" xref="S2.SS2.SSS0.Px1.p1.11.m11.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.11.m11.1b"><ci id="S2.SS2.SSS0.Px1.p1.11.m11.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.11.m11.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.11.m11.1c">i</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.11.m11.1d">italic_i</annotation></semantics></math>-th token at the <math alttext="(k-1)" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.12.m12.1"><semantics id="S2.SS2.SSS0.Px1.p1.12.m12.1a"><mrow id="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1" xref="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.cmml"><mo id="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.2" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.cmml">(</mo><mrow id="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1" xref="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.2" xref="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.2.cmml">k</mi><mo id="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.1" xref="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.1.cmml">−</mo><mn id="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.3" xref="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.3.cmml">1</mn></mrow><mo id="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.3" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.12.m12.1b"><apply id="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1"><minus id="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.1"></minus><ci id="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.2">𝑘</ci><cn id="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.3.cmml" type="integer" xref="S2.SS2.SSS0.Px1.p1.12.m12.1.1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.12.m12.1c">(k-1)</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.12.m12.1d">( italic_k - 1 )</annotation></semantics></math>-th depth <math alttext="\mathbf{h}_{i}^{k-1}\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.13.m13.1"><semantics id="S2.SS2.SSS0.Px1.p1.13.m13.1a"><mrow id="S2.SS2.SSS0.Px1.p1.13.m13.1.1" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.cmml"><msubsup id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.cmml"><mi id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.2.2" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.2.2.cmml">𝐡</mi><mi id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.2.3" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.2.3.cmml">i</mi><mrow id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.cmml"><mi id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.2" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.2.cmml">k</mi><mo id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.1" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.1.cmml">−</mo><mn id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.3" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.3.cmml">1</mn></mrow></msubsup><mo id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.1" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.1.cmml">∈</mo><msup id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3.cmml"><mi id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3.2" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3.2.cmml">ℝ</mi><mi id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3.3" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.13.m13.1b"><apply id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1"><in id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.1"></in><apply id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.1.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2">superscript</csymbol><apply id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.2.1.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2">subscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.2.2">𝐡</ci><ci id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.2.3.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.2.3">𝑖</ci></apply><apply id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3"><minus id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.1"></minus><ci id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.2.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.2">𝑘</ci><cn id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.3.cmml" type="integer" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.2.3.3">1</cn></apply></apply><apply id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3">superscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3.2.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3.2">ℝ</ci><ci id="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3.3.cmml" xref="S2.SS2.SSS0.Px1.p1.13.m13.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.13.m13.1c">\mathbf{h}_{i}^{k-1}\in\mathbb{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.13.m13.1d">bold_h start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k - 1 end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> and the embedding of the <math alttext="(i+k)" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.14.m14.1"><semantics id="S2.SS2.SSS0.Px1.p1.14.m14.1a"><mrow id="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1" xref="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.cmml"><mo id="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.2" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.cmml">(</mo><mrow id="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1" xref="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.2" xref="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.2.cmml">i</mi><mo id="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.1" xref="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.1.cmml">+</mo><mi id="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.3" xref="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.3.cmml">k</mi></mrow><mo id="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.3" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.14.m14.1b"><apply id="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1"><plus id="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.1"></plus><ci id="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.2">𝑖</ci><ci id="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.14.m14.1.1.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.14.m14.1c">(i+k)</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.14.m14.1d">( italic_i + italic_k )</annotation></semantics></math>-th token <math alttext="Emb(t_{i+k})\in\mathbb{R}^{d}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.15.m15.1"><semantics id="S2.SS2.SSS0.Px1.p1.15.m15.1a"><mrow id="S2.SS2.SSS0.Px1.p1.15.m15.1.1" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.cmml"><mrow id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.3" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.3.cmml">E</mi><mo id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.2" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.2.cmml">⁢</mo><mi id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.4" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.4.cmml">m</mi><mo id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.2a" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.2.cmml">⁢</mo><mi id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.5" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.5.cmml">b</mi><mo id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.2b" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.2.cmml">⁢</mo><mrow id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.cmml"><mo id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.2" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.cmml">(</mo><msub id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.2" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.2.cmml">t</mi><mrow id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.cmml"><mi id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.2" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.2.cmml">i</mi><mo id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.1" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.1.cmml">+</mo><mi id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.3" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.3.cmml">k</mi></mrow></msub><mo id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.3" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.2" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.2.cmml">∈</mo><msup id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3.cmml"><mi id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3.2" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3.2.cmml">ℝ</mi><mi id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3.3" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3.3.cmml">d</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.15.m15.1b"><apply id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1"><in id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.2"></in><apply id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1"><times id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.2"></times><ci id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.3">𝐸</ci><ci id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.4.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.4">𝑚</ci><ci id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.5.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.5">𝑏</ci><apply id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1">subscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.2">𝑡</ci><apply id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3"><plus id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.1"></plus><ci id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.2.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.2">𝑖</ci><ci id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.3.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.1.1.1.1.3.3">𝑘</ci></apply></apply></apply><apply id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3">superscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3.2.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3.2">ℝ</ci><ci id="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3.3.cmml" xref="S2.SS2.SSS0.Px1.p1.15.m15.1.1.3.3">𝑑</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.15.m15.1c">Emb(t_{i+k})\in\mathbb{R}^{d}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.15.m15.1d">italic_E italic_m italic_b ( italic_t start_POSTSUBSCRIPT italic_i + italic_k end_POSTSUBSCRIPT ) ∈ blackboard_R start_POSTSUPERSCRIPT italic_d end_POSTSUPERSCRIPT</annotation></semantics></math> with the linear projection:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E21">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathbf{h}_{i}^{\prime k}=M_{k}[\operatorname{RMSNorm}(\mathbf{h}_{i}^{k-1});%
\operatorname{RMSNorm}(\operatorname{Emb}(t_{i+k}))]," class="ltx_Math" display="block" id="S2.E21.m1.6"><semantics id="S2.E21.m1.6a"><mrow id="S2.E21.m1.6.6.1" xref="S2.E21.m1.6.6.1.1.cmml"><mrow id="S2.E21.m1.6.6.1.1" xref="S2.E21.m1.6.6.1.1.cmml"><msubsup id="S2.E21.m1.6.6.1.1.4" xref="S2.E21.m1.6.6.1.1.4.cmml"><mi id="S2.E21.m1.6.6.1.1.4.2.2" xref="S2.E21.m1.6.6.1.1.4.2.2.cmml">𝐡</mi><mi id="S2.E21.m1.6.6.1.1.4.2.3" xref="S2.E21.m1.6.6.1.1.4.2.3.cmml">i</mi><mrow id="S2.E21.m1.2.2.2.2" xref="S2.E21.m1.2.2.2.3.cmml"><mo id="S2.E21.m1.2.2.2.2.1" mathsize="142%" xref="S2.E21.m1.2.2.2.2.1.cmml">′</mo><mo id="S2.E21.m1.2.2.2.2.2" lspace="0em" xref="S2.E21.m1.2.2.2.3.cmml">⁣</mo><mi id="S2.E21.m1.1.1.1.1" xref="S2.E21.m1.1.1.1.1.cmml">k</mi></mrow></msubsup><mo id="S2.E21.m1.6.6.1.1.3" xref="S2.E21.m1.6.6.1.1.3.cmml">=</mo><mrow id="S2.E21.m1.6.6.1.1.2" xref="S2.E21.m1.6.6.1.1.2.cmml"><msub id="S2.E21.m1.6.6.1.1.2.4" xref="S2.E21.m1.6.6.1.1.2.4.cmml"><mi id="S2.E21.m1.6.6.1.1.2.4.2" xref="S2.E21.m1.6.6.1.1.2.4.2.cmml">M</mi><mi id="S2.E21.m1.6.6.1.1.2.4.3" xref="S2.E21.m1.6.6.1.1.2.4.3.cmml">k</mi></msub><mo id="S2.E21.m1.6.6.1.1.2.3" xref="S2.E21.m1.6.6.1.1.2.3.cmml">⁢</mo><mrow id="S2.E21.m1.6.6.1.1.2.2.2" xref="S2.E21.m1.6.6.1.1.2.2.3.cmml"><mo id="S2.E21.m1.6.6.1.1.2.2.2.3" stretchy="false" xref="S2.E21.m1.6.6.1.1.2.2.3.cmml">[</mo><mrow id="S2.E21.m1.6.6.1.1.1.1.1.1.1" xref="S2.E21.m1.6.6.1.1.1.1.1.1.2.cmml"><mi id="S2.E21.m1.3.3" xref="S2.E21.m1.3.3.cmml">RMSNorm</mi><mo id="S2.E21.m1.6.6.1.1.1.1.1.1.1a" xref="S2.E21.m1.6.6.1.1.1.1.1.1.2.cmml">⁡</mo><mrow id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1" xref="S2.E21.m1.6.6.1.1.1.1.1.1.2.cmml"><mo id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S2.E21.m1.6.6.1.1.1.1.1.1.2.cmml">(</mo><msubsup id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.cmml"><mi id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.2.2" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.2.2.cmml">𝐡</mi><mi id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.2.3" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.2.3.cmml">i</mi><mrow id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.2" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.2.cmml">k</mi><mo id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.1" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.1.cmml">−</mo><mn id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.3" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.3.cmml">1</mn></mrow></msubsup><mo id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S2.E21.m1.6.6.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S2.E21.m1.6.6.1.1.2.2.2.4" xref="S2.E21.m1.6.6.1.1.2.2.3.cmml">;</mo><mrow id="S2.E21.m1.6.6.1.1.2.2.2.2.1" xref="S2.E21.m1.6.6.1.1.2.2.2.2.2.cmml"><mi id="S2.E21.m1.5.5" xref="S2.E21.m1.5.5.cmml">RMSNorm</mi><mo id="S2.E21.m1.6.6.1.1.2.2.2.2.1a" xref="S2.E21.m1.6.6.1.1.2.2.2.2.2.cmml">⁡</mo><mrow id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1" xref="S2.E21.m1.6.6.1.1.2.2.2.2.2.cmml"><mo id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.2" stretchy="false" xref="S2.E21.m1.6.6.1.1.2.2.2.2.2.cmml">(</mo><mrow id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.2.cmml"><mi id="S2.E21.m1.4.4" xref="S2.E21.m1.4.4.cmml">Emb</mi><mo id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1a" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.2.cmml">⁡</mo><mrow id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.2.cmml"><mo id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.2" stretchy="false" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.2.cmml">(</mo><msub id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.cmml"><mi id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.2" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.2.cmml">t</mi><mrow id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.cmml"><mi id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.2" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.2.cmml">i</mi><mo id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.1" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.1.cmml">+</mo><mi id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.3" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.3.cmml">k</mi></mrow></msub><mo id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.3" stretchy="false" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.3" stretchy="false" xref="S2.E21.m1.6.6.1.1.2.2.2.2.2.cmml">)</mo></mrow></mrow><mo id="S2.E21.m1.6.6.1.1.2.2.2.5" stretchy="false" xref="S2.E21.m1.6.6.1.1.2.2.3.cmml">]</mo></mrow></mrow></mrow><mo id="S2.E21.m1.6.6.1.2" xref="S2.E21.m1.6.6.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E21.m1.6b"><apply id="S2.E21.m1.6.6.1.1.cmml" xref="S2.E21.m1.6.6.1"><eq id="S2.E21.m1.6.6.1.1.3.cmml" xref="S2.E21.m1.6.6.1.1.3"></eq><apply id="S2.E21.m1.6.6.1.1.4.cmml" xref="S2.E21.m1.6.6.1.1.4"><csymbol cd="ambiguous" id="S2.E21.m1.6.6.1.1.4.1.cmml" xref="S2.E21.m1.6.6.1.1.4">superscript</csymbol><apply id="S2.E21.m1.6.6.1.1.4.2.cmml" xref="S2.E21.m1.6.6.1.1.4"><csymbol cd="ambiguous" id="S2.E21.m1.6.6.1.1.4.2.1.cmml" xref="S2.E21.m1.6.6.1.1.4">subscript</csymbol><ci id="S2.E21.m1.6.6.1.1.4.2.2.cmml" xref="S2.E21.m1.6.6.1.1.4.2.2">𝐡</ci><ci id="S2.E21.m1.6.6.1.1.4.2.3.cmml" xref="S2.E21.m1.6.6.1.1.4.2.3">𝑖</ci></apply><list id="S2.E21.m1.2.2.2.3.cmml" xref="S2.E21.m1.2.2.2.2"><ci id="S2.E21.m1.2.2.2.2.1.cmml" xref="S2.E21.m1.2.2.2.2.1">′</ci><ci id="S2.E21.m1.1.1.1.1.cmml" xref="S2.E21.m1.1.1.1.1">𝑘</ci></list></apply><apply id="S2.E21.m1.6.6.1.1.2.cmml" xref="S2.E21.m1.6.6.1.1.2"><times id="S2.E21.m1.6.6.1.1.2.3.cmml" xref="S2.E21.m1.6.6.1.1.2.3"></times><apply id="S2.E21.m1.6.6.1.1.2.4.cmml" xref="S2.E21.m1.6.6.1.1.2.4"><csymbol cd="ambiguous" id="S2.E21.m1.6.6.1.1.2.4.1.cmml" xref="S2.E21.m1.6.6.1.1.2.4">subscript</csymbol><ci id="S2.E21.m1.6.6.1.1.2.4.2.cmml" xref="S2.E21.m1.6.6.1.1.2.4.2">𝑀</ci><ci id="S2.E21.m1.6.6.1.1.2.4.3.cmml" xref="S2.E21.m1.6.6.1.1.2.4.3">𝑘</ci></apply><list id="S2.E21.m1.6.6.1.1.2.2.3.cmml" xref="S2.E21.m1.6.6.1.1.2.2.2"><apply id="S2.E21.m1.6.6.1.1.1.1.1.1.2.cmml" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1"><ci id="S2.E21.m1.3.3.cmml" xref="S2.E21.m1.3.3">RMSNorm</ci><apply id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1">superscript</csymbol><apply id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.2.2">𝐡</ci><ci id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.2.3">𝑖</ci></apply><apply id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3"><minus id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.1"></minus><ci id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.2">𝑘</ci><cn id="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.3.cmml" type="integer" xref="S2.E21.m1.6.6.1.1.1.1.1.1.1.1.1.3.3">1</cn></apply></apply></apply><apply id="S2.E21.m1.6.6.1.1.2.2.2.2.2.cmml" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1"><ci id="S2.E21.m1.5.5.cmml" xref="S2.E21.m1.5.5">RMSNorm</ci><apply id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.2.cmml" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1"><ci id="S2.E21.m1.4.4.cmml" xref="S2.E21.m1.4.4">Emb</ci><apply id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.cmml" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.1.cmml" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.2.cmml" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.2">𝑡</ci><apply id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.cmml" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3"><plus id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.1.cmml" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.1"></plus><ci id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.2.cmml" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.2">𝑖</ci><ci id="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.3.cmml" xref="S2.E21.m1.6.6.1.1.2.2.2.2.1.1.1.1.1.1.3.3">𝑘</ci></apply></apply></apply></apply></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E21.m1.6c">\mathbf{h}_{i}^{\prime k}=M_{k}[\operatorname{RMSNorm}(\mathbf{h}_{i}^{k-1});%
\operatorname{RMSNorm}(\operatorname{Emb}(t_{i+k}))],</annotation><annotation encoding="application/x-llamapun" id="S2.E21.m1.6d">bold_h start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ italic_k end_POSTSUPERSCRIPT = italic_M start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT [ roman_RMSNorm ( bold_h start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k - 1 end_POSTSUPERSCRIPT ) ; roman_RMSNorm ( roman_Emb ( italic_t start_POSTSUBSCRIPT italic_i + italic_k end_POSTSUBSCRIPT ) ) ] ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(21)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS2.SSS0.Px1.p1.21">where <math alttext="[\cdot;\cdot]" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.16.m1.2"><semantics id="S2.SS2.SSS0.Px1.p1.16.m1.2a"><mrow id="S2.SS2.SSS0.Px1.p1.16.m1.2.3.2" xref="S2.SS2.SSS0.Px1.p1.16.m1.2.3.1.cmml"><mo id="S2.SS2.SSS0.Px1.p1.16.m1.2.3.2.1" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.16.m1.2.3.1.cmml">[</mo><mo id="S2.SS2.SSS0.Px1.p1.16.m1.1.1" lspace="0em" rspace="0em" xref="S2.SS2.SSS0.Px1.p1.16.m1.1.1.cmml">⋅</mo><mo id="S2.SS2.SSS0.Px1.p1.16.m1.2.3.2.2" rspace="0em" xref="S2.SS2.SSS0.Px1.p1.16.m1.2.3.1.cmml">;</mo><mo id="S2.SS2.SSS0.Px1.p1.16.m1.2.2" lspace="0em" rspace="0em" xref="S2.SS2.SSS0.Px1.p1.16.m1.2.2.cmml">⋅</mo><mo id="S2.SS2.SSS0.Px1.p1.16.m1.2.3.2.3" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.16.m1.2.3.1.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.16.m1.2b"><list id="S2.SS2.SSS0.Px1.p1.16.m1.2.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.16.m1.2.3.2"><ci id="S2.SS2.SSS0.Px1.p1.16.m1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.16.m1.1.1">⋅</ci><ci id="S2.SS2.SSS0.Px1.p1.16.m1.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.16.m1.2.2">⋅</ci></list></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.16.m1.2c">[\cdot;\cdot]</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.16.m1.2d">[ ⋅ ; ⋅ ]</annotation></semantics></math> denotes concatenation.
Especially, when <math alttext="k=1" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.17.m2.1"><semantics id="S2.SS2.SSS0.Px1.p1.17.m2.1a"><mrow id="S2.SS2.SSS0.Px1.p1.17.m2.1.1" xref="S2.SS2.SSS0.Px1.p1.17.m2.1.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.17.m2.1.1.2" xref="S2.SS2.SSS0.Px1.p1.17.m2.1.1.2.cmml">k</mi><mo id="S2.SS2.SSS0.Px1.p1.17.m2.1.1.1" xref="S2.SS2.SSS0.Px1.p1.17.m2.1.1.1.cmml">=</mo><mn id="S2.SS2.SSS0.Px1.p1.17.m2.1.1.3" xref="S2.SS2.SSS0.Px1.p1.17.m2.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.17.m2.1b"><apply id="S2.SS2.SSS0.Px1.p1.17.m2.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.17.m2.1.1"><eq id="S2.SS2.SSS0.Px1.p1.17.m2.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.17.m2.1.1.1"></eq><ci id="S2.SS2.SSS0.Px1.p1.17.m2.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.17.m2.1.1.2">𝑘</ci><cn id="S2.SS2.SSS0.Px1.p1.17.m2.1.1.3.cmml" type="integer" xref="S2.SS2.SSS0.Px1.p1.17.m2.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.17.m2.1c">k=1</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.17.m2.1d">italic_k = 1</annotation></semantics></math>, <math alttext="\mathbf{h}_{i}^{k-1}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.18.m3.1"><semantics id="S2.SS2.SSS0.Px1.p1.18.m3.1a"><msubsup id="S2.SS2.SSS0.Px1.p1.18.m3.1.1" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.2.2" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.2.2.cmml">𝐡</mi><mi id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.2.3" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.2.3.cmml">i</mi><mrow id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.cmml"><mi id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.2" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.2.cmml">k</mi><mo id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.1" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.1.cmml">−</mo><mn id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.3" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.18.m3.1b"><apply id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1">superscript</csymbol><apply id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.2.1.cmml" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1">subscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.2.2">𝐡</ci><ci id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.2.3.cmml" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.2.3">𝑖</ci></apply><apply id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3"><minus id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.1"></minus><ci id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.2.cmml" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.2">𝑘</ci><cn id="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.3.cmml" type="integer" xref="S2.SS2.SSS0.Px1.p1.18.m3.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.18.m3.1c">\mathbf{h}_{i}^{k-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.18.m3.1d">bold_h start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k - 1 end_POSTSUPERSCRIPT</annotation></semantics></math> refers to the representation given by the main model.
Note that for each MTP module, its embedding layer is shared with the main model.
The combined <math alttext="\mathbf{h}_{i}^{\prime k}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.19.m4.2"><semantics id="S2.SS2.SSS0.Px1.p1.19.m4.2a"><msubsup id="S2.SS2.SSS0.Px1.p1.19.m4.2.3" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.3.cmml"><mi id="S2.SS2.SSS0.Px1.p1.19.m4.2.3.2.2" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.3.2.2.cmml">𝐡</mi><mi id="S2.SS2.SSS0.Px1.p1.19.m4.2.3.2.3" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.3.2.3.cmml">i</mi><mrow id="S2.SS2.SSS0.Px1.p1.19.m4.2.2.2.2" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.2.2.3.cmml"><mo id="S2.SS2.SSS0.Px1.p1.19.m4.2.2.2.2.1" mathsize="142%" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.2.2.2.1.cmml">′</mo><mo id="S2.SS2.SSS0.Px1.p1.19.m4.2.2.2.2.2" lspace="0em" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.2.2.3.cmml">⁣</mo><mi id="S2.SS2.SSS0.Px1.p1.19.m4.1.1.1.1" xref="S2.SS2.SSS0.Px1.p1.19.m4.1.1.1.1.cmml">k</mi></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.19.m4.2b"><apply id="S2.SS2.SSS0.Px1.p1.19.m4.2.3.cmml" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.3"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.19.m4.2.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.3">superscript</csymbol><apply id="S2.SS2.SSS0.Px1.p1.19.m4.2.3.2.cmml" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.3"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.19.m4.2.3.2.1.cmml" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.3">subscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.19.m4.2.3.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.3.2.2">𝐡</ci><ci id="S2.SS2.SSS0.Px1.p1.19.m4.2.3.2.3.cmml" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.3.2.3">𝑖</ci></apply><list id="S2.SS2.SSS0.Px1.p1.19.m4.2.2.2.3.cmml" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.2.2.2"><ci id="S2.SS2.SSS0.Px1.p1.19.m4.2.2.2.2.1.cmml" xref="S2.SS2.SSS0.Px1.p1.19.m4.2.2.2.2.1">′</ci><ci id="S2.SS2.SSS0.Px1.p1.19.m4.1.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.19.m4.1.1.1.1">𝑘</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.19.m4.2c">\mathbf{h}_{i}^{\prime k}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.19.m4.2d">bold_h start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ italic_k end_POSTSUPERSCRIPT</annotation></semantics></math> serves as the input of the Transformer block at the <math alttext="k" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.20.m5.1"><semantics id="S2.SS2.SSS0.Px1.p1.20.m5.1a"><mi id="S2.SS2.SSS0.Px1.p1.20.m5.1.1" xref="S2.SS2.SSS0.Px1.p1.20.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.20.m5.1b"><ci id="S2.SS2.SSS0.Px1.p1.20.m5.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.20.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.20.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.20.m5.1d">italic_k</annotation></semantics></math>-th depth to produce the output representation at the current depth <math alttext="\mathbf{h}_{i}^{k}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.21.m6.1"><semantics id="S2.SS2.SSS0.Px1.p1.21.m6.1a"><msubsup id="S2.SS2.SSS0.Px1.p1.21.m6.1.1" xref="S2.SS2.SSS0.Px1.p1.21.m6.1.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.21.m6.1.1.2.2" xref="S2.SS2.SSS0.Px1.p1.21.m6.1.1.2.2.cmml">𝐡</mi><mi id="S2.SS2.SSS0.Px1.p1.21.m6.1.1.2.3" xref="S2.SS2.SSS0.Px1.p1.21.m6.1.1.2.3.cmml">i</mi><mi id="S2.SS2.SSS0.Px1.p1.21.m6.1.1.3" xref="S2.SS2.SSS0.Px1.p1.21.m6.1.1.3.cmml">k</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.21.m6.1b"><apply id="S2.SS2.SSS0.Px1.p1.21.m6.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.21.m6.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.21.m6.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.21.m6.1.1">superscript</csymbol><apply id="S2.SS2.SSS0.Px1.p1.21.m6.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.21.m6.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.21.m6.1.1.2.1.cmml" xref="S2.SS2.SSS0.Px1.p1.21.m6.1.1">subscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.21.m6.1.1.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.21.m6.1.1.2.2">𝐡</ci><ci id="S2.SS2.SSS0.Px1.p1.21.m6.1.1.2.3.cmml" xref="S2.SS2.SSS0.Px1.p1.21.m6.1.1.2.3">𝑖</ci></apply><ci id="S2.SS2.SSS0.Px1.p1.21.m6.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.21.m6.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.21.m6.1c">\mathbf{h}_{i}^{k}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.21.m6.1d">bold_h start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E22">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathbf{h}_{1:T-k}^{k}=\operatorname{TRM}_{k}(\mathbf{h}_{1:T-k}^{\prime k})," class="ltx_Math" display="block" id="S2.E22.m1.3"><semantics id="S2.E22.m1.3a"><mrow id="S2.E22.m1.3.3.1" xref="S2.E22.m1.3.3.1.1.cmml"><mrow id="S2.E22.m1.3.3.1.1" xref="S2.E22.m1.3.3.1.1.cmml"><msubsup id="S2.E22.m1.3.3.1.1.4" xref="S2.E22.m1.3.3.1.1.4.cmml"><mi id="S2.E22.m1.3.3.1.1.4.2.2" xref="S2.E22.m1.3.3.1.1.4.2.2.cmml">𝐡</mi><mrow id="S2.E22.m1.3.3.1.1.4.2.3" xref="S2.E22.m1.3.3.1.1.4.2.3.cmml"><mn id="S2.E22.m1.3.3.1.1.4.2.3.2" xref="S2.E22.m1.3.3.1.1.4.2.3.2.cmml">1</mn><mo id="S2.E22.m1.3.3.1.1.4.2.3.1" lspace="0.278em" rspace="0.278em" xref="S2.E22.m1.3.3.1.1.4.2.3.1.cmml">:</mo><mrow id="S2.E22.m1.3.3.1.1.4.2.3.3" xref="S2.E22.m1.3.3.1.1.4.2.3.3.cmml"><mi id="S2.E22.m1.3.3.1.1.4.2.3.3.2" xref="S2.E22.m1.3.3.1.1.4.2.3.3.2.cmml">T</mi><mo id="S2.E22.m1.3.3.1.1.4.2.3.3.1" xref="S2.E22.m1.3.3.1.1.4.2.3.3.1.cmml">−</mo><mi id="S2.E22.m1.3.3.1.1.4.2.3.3.3" xref="S2.E22.m1.3.3.1.1.4.2.3.3.3.cmml">k</mi></mrow></mrow><mi id="S2.E22.m1.3.3.1.1.4.3" xref="S2.E22.m1.3.3.1.1.4.3.cmml">k</mi></msubsup><mo id="S2.E22.m1.3.3.1.1.3" xref="S2.E22.m1.3.3.1.1.3.cmml">=</mo><mrow id="S2.E22.m1.3.3.1.1.2.2" xref="S2.E22.m1.3.3.1.1.2.3.cmml"><msub id="S2.E22.m1.3.3.1.1.1.1.1" xref="S2.E22.m1.3.3.1.1.1.1.1.cmml"><mi id="S2.E22.m1.3.3.1.1.1.1.1.2" xref="S2.E22.m1.3.3.1.1.1.1.1.2.cmml">TRM</mi><mi id="S2.E22.m1.3.3.1.1.1.1.1.3" xref="S2.E22.m1.3.3.1.1.1.1.1.3.cmml">k</mi></msub><mo id="S2.E22.m1.3.3.1.1.2.2a" xref="S2.E22.m1.3.3.1.1.2.3.cmml">⁡</mo><mrow id="S2.E22.m1.3.3.1.1.2.2.2" xref="S2.E22.m1.3.3.1.1.2.3.cmml"><mo id="S2.E22.m1.3.3.1.1.2.2.2.2" stretchy="false" xref="S2.E22.m1.3.3.1.1.2.3.cmml">(</mo><msubsup id="S2.E22.m1.3.3.1.1.2.2.2.1" xref="S2.E22.m1.3.3.1.1.2.2.2.1.cmml"><mi id="S2.E22.m1.3.3.1.1.2.2.2.1.2.2" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.2.cmml">𝐡</mi><mrow id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.cmml"><mn id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.2" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.2.cmml">1</mn><mo id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.1" lspace="0.278em" rspace="0.278em" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.1.cmml">:</mo><mrow id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.cmml"><mi id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.2" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.2.cmml">T</mi><mo id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.1" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.1.cmml">−</mo><mi id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.3" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.3.cmml">k</mi></mrow></mrow><mrow id="S2.E22.m1.2.2.2.2" xref="S2.E22.m1.2.2.2.3.cmml"><mo id="S2.E22.m1.2.2.2.2.1" mathsize="142%" xref="S2.E22.m1.2.2.2.2.1.cmml">′</mo><mo id="S2.E22.m1.2.2.2.2.2" lspace="0em" xref="S2.E22.m1.2.2.2.3.cmml">⁣</mo><mi id="S2.E22.m1.1.1.1.1" xref="S2.E22.m1.1.1.1.1.cmml">k</mi></mrow></msubsup><mo id="S2.E22.m1.3.3.1.1.2.2.2.3" stretchy="false" xref="S2.E22.m1.3.3.1.1.2.3.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E22.m1.3.3.1.2" xref="S2.E22.m1.3.3.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E22.m1.3b"><apply id="S2.E22.m1.3.3.1.1.cmml" xref="S2.E22.m1.3.3.1"><eq id="S2.E22.m1.3.3.1.1.3.cmml" xref="S2.E22.m1.3.3.1.1.3"></eq><apply id="S2.E22.m1.3.3.1.1.4.cmml" xref="S2.E22.m1.3.3.1.1.4"><csymbol cd="ambiguous" id="S2.E22.m1.3.3.1.1.4.1.cmml" xref="S2.E22.m1.3.3.1.1.4">superscript</csymbol><apply id="S2.E22.m1.3.3.1.1.4.2.cmml" xref="S2.E22.m1.3.3.1.1.4"><csymbol cd="ambiguous" id="S2.E22.m1.3.3.1.1.4.2.1.cmml" xref="S2.E22.m1.3.3.1.1.4">subscript</csymbol><ci id="S2.E22.m1.3.3.1.1.4.2.2.cmml" xref="S2.E22.m1.3.3.1.1.4.2.2">𝐡</ci><apply id="S2.E22.m1.3.3.1.1.4.2.3.cmml" xref="S2.E22.m1.3.3.1.1.4.2.3"><ci id="S2.E22.m1.3.3.1.1.4.2.3.1.cmml" xref="S2.E22.m1.3.3.1.1.4.2.3.1">:</ci><cn id="S2.E22.m1.3.3.1.1.4.2.3.2.cmml" type="integer" xref="S2.E22.m1.3.3.1.1.4.2.3.2">1</cn><apply id="S2.E22.m1.3.3.1.1.4.2.3.3.cmml" xref="S2.E22.m1.3.3.1.1.4.2.3.3"><minus id="S2.E22.m1.3.3.1.1.4.2.3.3.1.cmml" xref="S2.E22.m1.3.3.1.1.4.2.3.3.1"></minus><ci id="S2.E22.m1.3.3.1.1.4.2.3.3.2.cmml" xref="S2.E22.m1.3.3.1.1.4.2.3.3.2">𝑇</ci><ci id="S2.E22.m1.3.3.1.1.4.2.3.3.3.cmml" xref="S2.E22.m1.3.3.1.1.4.2.3.3.3">𝑘</ci></apply></apply></apply><ci id="S2.E22.m1.3.3.1.1.4.3.cmml" xref="S2.E22.m1.3.3.1.1.4.3">𝑘</ci></apply><apply id="S2.E22.m1.3.3.1.1.2.3.cmml" xref="S2.E22.m1.3.3.1.1.2.2"><apply id="S2.E22.m1.3.3.1.1.1.1.1.cmml" xref="S2.E22.m1.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E22.m1.3.3.1.1.1.1.1.1.cmml" xref="S2.E22.m1.3.3.1.1.1.1.1">subscript</csymbol><ci id="S2.E22.m1.3.3.1.1.1.1.1.2.cmml" xref="S2.E22.m1.3.3.1.1.1.1.1.2">TRM</ci><ci id="S2.E22.m1.3.3.1.1.1.1.1.3.cmml" xref="S2.E22.m1.3.3.1.1.1.1.1.3">𝑘</ci></apply><apply id="S2.E22.m1.3.3.1.1.2.2.2.1.cmml" xref="S2.E22.m1.3.3.1.1.2.2.2.1"><csymbol cd="ambiguous" id="S2.E22.m1.3.3.1.1.2.2.2.1.1.cmml" xref="S2.E22.m1.3.3.1.1.2.2.2.1">superscript</csymbol><apply id="S2.E22.m1.3.3.1.1.2.2.2.1.2.cmml" xref="S2.E22.m1.3.3.1.1.2.2.2.1"><csymbol cd="ambiguous" id="S2.E22.m1.3.3.1.1.2.2.2.1.2.1.cmml" xref="S2.E22.m1.3.3.1.1.2.2.2.1">subscript</csymbol><ci id="S2.E22.m1.3.3.1.1.2.2.2.1.2.2.cmml" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.2">𝐡</ci><apply id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.cmml" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3"><ci id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.1.cmml" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.1">:</ci><cn id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.2.cmml" type="integer" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.2">1</cn><apply id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.cmml" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3"><minus id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.1.cmml" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.1"></minus><ci id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.2.cmml" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.2">𝑇</ci><ci id="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.3.cmml" xref="S2.E22.m1.3.3.1.1.2.2.2.1.2.3.3.3">𝑘</ci></apply></apply></apply><list id="S2.E22.m1.2.2.2.3.cmml" xref="S2.E22.m1.2.2.2.2"><ci id="S2.E22.m1.2.2.2.2.1.cmml" xref="S2.E22.m1.2.2.2.2.1">′</ci><ci id="S2.E22.m1.1.1.1.1.cmml" xref="S2.E22.m1.1.1.1.1">𝑘</ci></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E22.m1.3c">\mathbf{h}_{1:T-k}^{k}=\operatorname{TRM}_{k}(\mathbf{h}_{1:T-k}^{\prime k}),</annotation><annotation encoding="application/x-llamapun" id="S2.E22.m1.3d">bold_h start_POSTSUBSCRIPT 1 : italic_T - italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT = roman_TRM start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT ( bold_h start_POSTSUBSCRIPT 1 : italic_T - italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ italic_k end_POSTSUPERSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(22)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS2.SSS0.Px1.p1.27">where <math alttext="T" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.22.m1.1"><semantics id="S2.SS2.SSS0.Px1.p1.22.m1.1a"><mi id="S2.SS2.SSS0.Px1.p1.22.m1.1.1" xref="S2.SS2.SSS0.Px1.p1.22.m1.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.22.m1.1b"><ci id="S2.SS2.SSS0.Px1.p1.22.m1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.22.m1.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.22.m1.1c">T</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.22.m1.1d">italic_T</annotation></semantics></math> represents the input sequence length and <sub class="ltx_sub" id="S2.SS2.SSS0.Px1.p1.27.1"><span class="ltx_text ltx_font_italic" id="S2.SS2.SSS0.Px1.p1.27.1.1">i:j</span></sub> denotes the slicing operation (inclusive of both the left and right boundaries).
Finally, taking <math alttext="\mathbf{h}_{i}^{k}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.24.m3.1"><semantics id="S2.SS2.SSS0.Px1.p1.24.m3.1a"><msubsup id="S2.SS2.SSS0.Px1.p1.24.m3.1.1" xref="S2.SS2.SSS0.Px1.p1.24.m3.1.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.24.m3.1.1.2.2" xref="S2.SS2.SSS0.Px1.p1.24.m3.1.1.2.2.cmml">𝐡</mi><mi id="S2.SS2.SSS0.Px1.p1.24.m3.1.1.2.3" xref="S2.SS2.SSS0.Px1.p1.24.m3.1.1.2.3.cmml">i</mi><mi id="S2.SS2.SSS0.Px1.p1.24.m3.1.1.3" xref="S2.SS2.SSS0.Px1.p1.24.m3.1.1.3.cmml">k</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.24.m3.1b"><apply id="S2.SS2.SSS0.Px1.p1.24.m3.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.24.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.24.m3.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.24.m3.1.1">superscript</csymbol><apply id="S2.SS2.SSS0.Px1.p1.24.m3.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.24.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.24.m3.1.1.2.1.cmml" xref="S2.SS2.SSS0.Px1.p1.24.m3.1.1">subscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.24.m3.1.1.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.24.m3.1.1.2.2">𝐡</ci><ci id="S2.SS2.SSS0.Px1.p1.24.m3.1.1.2.3.cmml" xref="S2.SS2.SSS0.Px1.p1.24.m3.1.1.2.3">𝑖</ci></apply><ci id="S2.SS2.SSS0.Px1.p1.24.m3.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.24.m3.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.24.m3.1c">\mathbf{h}_{i}^{k}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.24.m3.1d">bold_h start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT</annotation></semantics></math> as the input, the shared output head will compute the probability distribution for the <math alttext="k" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.25.m4.1"><semantics id="S2.SS2.SSS0.Px1.p1.25.m4.1a"><mi id="S2.SS2.SSS0.Px1.p1.25.m4.1.1" xref="S2.SS2.SSS0.Px1.p1.25.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.25.m4.1b"><ci id="S2.SS2.SSS0.Px1.p1.25.m4.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.25.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.25.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.25.m4.1d">italic_k</annotation></semantics></math>-th additional prediction token <math alttext="P_{i+1+k}^{k}\in\mathbb{R}^{V}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.26.m5.1"><semantics id="S2.SS2.SSS0.Px1.p1.26.m5.1a"><mrow id="S2.SS2.SSS0.Px1.p1.26.m5.1.1" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.cmml"><msubsup id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.cmml"><mi id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.2" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.2.cmml">P</mi><mrow id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.cmml"><mi id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.2" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.2.cmml">i</mi><mo id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.1" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.1.cmml">+</mo><mn id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.3" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.3.cmml">1</mn><mo id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.1a" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.1.cmml">+</mo><mi id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.4" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.4.cmml">k</mi></mrow><mi id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.3" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.3.cmml">k</mi></msubsup><mo id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.1" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.1.cmml">∈</mo><msup id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3.cmml"><mi id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3.2" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3.2.cmml">ℝ</mi><mi id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3.3" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3.3.cmml">V</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.26.m5.1b"><apply id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1"><in id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.1"></in><apply id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.1.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2">superscript</csymbol><apply id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.1.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2">subscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.2">𝑃</ci><apply id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3"><plus id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.1"></plus><ci id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.2.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.2">𝑖</ci><cn id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.3.cmml" type="integer" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.3">1</cn><ci id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.4.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.2.3.4">𝑘</ci></apply></apply><ci id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.3.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3">superscript</csymbol><ci id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3.2.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3.2">ℝ</ci><ci id="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3.3.cmml" xref="S2.SS2.SSS0.Px1.p1.26.m5.1.1.3.3">𝑉</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.26.m5.1c">P_{i+1+k}^{k}\in\mathbb{R}^{V}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.26.m5.1d">italic_P start_POSTSUBSCRIPT italic_i + 1 + italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT ∈ blackboard_R start_POSTSUPERSCRIPT italic_V end_POSTSUPERSCRIPT</annotation></semantics></math>, where <math alttext="V" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.27.m6.1"><semantics id="S2.SS2.SSS0.Px1.p1.27.m6.1a"><mi id="S2.SS2.SSS0.Px1.p1.27.m6.1.1" xref="S2.SS2.SSS0.Px1.p1.27.m6.1.1.cmml">V</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.27.m6.1b"><ci id="S2.SS2.SSS0.Px1.p1.27.m6.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.27.m6.1.1">𝑉</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.27.m6.1c">V</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.27.m6.1d">italic_V</annotation></semantics></math> is the vocabulary size:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E23">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="P_{i+k+1}^{k}=\operatorname{OutHead}(\mathbf{h}_{i}^{k})." class="ltx_Math" display="block" id="S2.E23.m1.2"><semantics id="S2.E23.m1.2a"><mrow id="S2.E23.m1.2.2.1" xref="S2.E23.m1.2.2.1.1.cmml"><mrow id="S2.E23.m1.2.2.1.1" xref="S2.E23.m1.2.2.1.1.cmml"><msubsup id="S2.E23.m1.2.2.1.1.3" xref="S2.E23.m1.2.2.1.1.3.cmml"><mi id="S2.E23.m1.2.2.1.1.3.2.2" xref="S2.E23.m1.2.2.1.1.3.2.2.cmml">P</mi><mrow id="S2.E23.m1.2.2.1.1.3.2.3" xref="S2.E23.m1.2.2.1.1.3.2.3.cmml"><mi id="S2.E23.m1.2.2.1.1.3.2.3.2" xref="S2.E23.m1.2.2.1.1.3.2.3.2.cmml">i</mi><mo id="S2.E23.m1.2.2.1.1.3.2.3.1" xref="S2.E23.m1.2.2.1.1.3.2.3.1.cmml">+</mo><mi id="S2.E23.m1.2.2.1.1.3.2.3.3" xref="S2.E23.m1.2.2.1.1.3.2.3.3.cmml">k</mi><mo id="S2.E23.m1.2.2.1.1.3.2.3.1a" xref="S2.E23.m1.2.2.1.1.3.2.3.1.cmml">+</mo><mn id="S2.E23.m1.2.2.1.1.3.2.3.4" xref="S2.E23.m1.2.2.1.1.3.2.3.4.cmml">1</mn></mrow><mi id="S2.E23.m1.2.2.1.1.3.3" xref="S2.E23.m1.2.2.1.1.3.3.cmml">k</mi></msubsup><mo id="S2.E23.m1.2.2.1.1.2" xref="S2.E23.m1.2.2.1.1.2.cmml">=</mo><mrow id="S2.E23.m1.2.2.1.1.1.1" xref="S2.E23.m1.2.2.1.1.1.2.cmml"><mi id="S2.E23.m1.1.1" xref="S2.E23.m1.1.1.cmml">OutHead</mi><mo id="S2.E23.m1.2.2.1.1.1.1a" xref="S2.E23.m1.2.2.1.1.1.2.cmml">⁡</mo><mrow id="S2.E23.m1.2.2.1.1.1.1.1" xref="S2.E23.m1.2.2.1.1.1.2.cmml"><mo id="S2.E23.m1.2.2.1.1.1.1.1.2" stretchy="false" xref="S2.E23.m1.2.2.1.1.1.2.cmml">(</mo><msubsup id="S2.E23.m1.2.2.1.1.1.1.1.1" xref="S2.E23.m1.2.2.1.1.1.1.1.1.cmml"><mi id="S2.E23.m1.2.2.1.1.1.1.1.1.2.2" xref="S2.E23.m1.2.2.1.1.1.1.1.1.2.2.cmml">𝐡</mi><mi id="S2.E23.m1.2.2.1.1.1.1.1.1.2.3" xref="S2.E23.m1.2.2.1.1.1.1.1.1.2.3.cmml">i</mi><mi id="S2.E23.m1.2.2.1.1.1.1.1.1.3" xref="S2.E23.m1.2.2.1.1.1.1.1.1.3.cmml">k</mi></msubsup><mo id="S2.E23.m1.2.2.1.1.1.1.1.3" stretchy="false" xref="S2.E23.m1.2.2.1.1.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E23.m1.2.2.1.2" lspace="0em" xref="S2.E23.m1.2.2.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E23.m1.2b"><apply id="S2.E23.m1.2.2.1.1.cmml" xref="S2.E23.m1.2.2.1"><eq id="S2.E23.m1.2.2.1.1.2.cmml" xref="S2.E23.m1.2.2.1.1.2"></eq><apply id="S2.E23.m1.2.2.1.1.3.cmml" xref="S2.E23.m1.2.2.1.1.3"><csymbol cd="ambiguous" id="S2.E23.m1.2.2.1.1.3.1.cmml" xref="S2.E23.m1.2.2.1.1.3">superscript</csymbol><apply id="S2.E23.m1.2.2.1.1.3.2.cmml" xref="S2.E23.m1.2.2.1.1.3"><csymbol cd="ambiguous" id="S2.E23.m1.2.2.1.1.3.2.1.cmml" xref="S2.E23.m1.2.2.1.1.3">subscript</csymbol><ci id="S2.E23.m1.2.2.1.1.3.2.2.cmml" xref="S2.E23.m1.2.2.1.1.3.2.2">𝑃</ci><apply id="S2.E23.m1.2.2.1.1.3.2.3.cmml" xref="S2.E23.m1.2.2.1.1.3.2.3"><plus id="S2.E23.m1.2.2.1.1.3.2.3.1.cmml" xref="S2.E23.m1.2.2.1.1.3.2.3.1"></plus><ci id="S2.E23.m1.2.2.1.1.3.2.3.2.cmml" xref="S2.E23.m1.2.2.1.1.3.2.3.2">𝑖</ci><ci id="S2.E23.m1.2.2.1.1.3.2.3.3.cmml" xref="S2.E23.m1.2.2.1.1.3.2.3.3">𝑘</ci><cn id="S2.E23.m1.2.2.1.1.3.2.3.4.cmml" type="integer" xref="S2.E23.m1.2.2.1.1.3.2.3.4">1</cn></apply></apply><ci id="S2.E23.m1.2.2.1.1.3.3.cmml" xref="S2.E23.m1.2.2.1.1.3.3">𝑘</ci></apply><apply id="S2.E23.m1.2.2.1.1.1.2.cmml" xref="S2.E23.m1.2.2.1.1.1.1"><ci id="S2.E23.m1.1.1.cmml" xref="S2.E23.m1.1.1">OutHead</ci><apply id="S2.E23.m1.2.2.1.1.1.1.1.1.cmml" xref="S2.E23.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E23.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S2.E23.m1.2.2.1.1.1.1.1.1">superscript</csymbol><apply id="S2.E23.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S2.E23.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E23.m1.2.2.1.1.1.1.1.1.2.1.cmml" xref="S2.E23.m1.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E23.m1.2.2.1.1.1.1.1.1.2.2.cmml" xref="S2.E23.m1.2.2.1.1.1.1.1.1.2.2">𝐡</ci><ci id="S2.E23.m1.2.2.1.1.1.1.1.1.2.3.cmml" xref="S2.E23.m1.2.2.1.1.1.1.1.1.2.3">𝑖</ci></apply><ci id="S2.E23.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S2.E23.m1.2.2.1.1.1.1.1.1.3">𝑘</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E23.m1.2c">P_{i+k+1}^{k}=\operatorname{OutHead}(\mathbf{h}_{i}^{k}).</annotation><annotation encoding="application/x-llamapun" id="S2.E23.m1.2d">italic_P start_POSTSUBSCRIPT italic_i + italic_k + 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT = roman_OutHead ( bold_h start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(23)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS2.SSS0.Px1.p1.30">The output head <math alttext="\operatorname{OutHead}(\cdot)" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.28.m1.2"><semantics id="S2.SS2.SSS0.Px1.p1.28.m1.2a"><mrow id="S2.SS2.SSS0.Px1.p1.28.m1.2.3.2" xref="S2.SS2.SSS0.Px1.p1.28.m1.2.3.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.28.m1.1.1" xref="S2.SS2.SSS0.Px1.p1.28.m1.1.1.cmml">OutHead</mi><mo id="S2.SS2.SSS0.Px1.p1.28.m1.2.3.2a" xref="S2.SS2.SSS0.Px1.p1.28.m1.2.3.1.cmml">⁡</mo><mrow id="S2.SS2.SSS0.Px1.p1.28.m1.2.3.2.1" xref="S2.SS2.SSS0.Px1.p1.28.m1.2.3.1.cmml"><mo id="S2.SS2.SSS0.Px1.p1.28.m1.2.3.2.1.1" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.28.m1.2.3.1.cmml">(</mo><mo id="S2.SS2.SSS0.Px1.p1.28.m1.2.2" lspace="0em" rspace="0em" xref="S2.SS2.SSS0.Px1.p1.28.m1.2.2.cmml">⋅</mo><mo id="S2.SS2.SSS0.Px1.p1.28.m1.2.3.2.1.2" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.28.m1.2.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.28.m1.2b"><apply id="S2.SS2.SSS0.Px1.p1.28.m1.2.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.28.m1.2.3.2"><ci id="S2.SS2.SSS0.Px1.p1.28.m1.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.28.m1.1.1">OutHead</ci><ci id="S2.SS2.SSS0.Px1.p1.28.m1.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.28.m1.2.2">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.28.m1.2c">\operatorname{OutHead}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.28.m1.2d">roman_OutHead ( ⋅ )</annotation></semantics></math> linearly maps the representation to logits and subsequently applies the <math alttext="\operatorname{Softmax}(\cdot)" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.29.m2.2"><semantics id="S2.SS2.SSS0.Px1.p1.29.m2.2a"><mrow id="S2.SS2.SSS0.Px1.p1.29.m2.2.3.2" xref="S2.SS2.SSS0.Px1.p1.29.m2.2.3.1.cmml"><mi id="S2.SS2.SSS0.Px1.p1.29.m2.1.1" xref="S2.SS2.SSS0.Px1.p1.29.m2.1.1.cmml">Softmax</mi><mo id="S2.SS2.SSS0.Px1.p1.29.m2.2.3.2a" xref="S2.SS2.SSS0.Px1.p1.29.m2.2.3.1.cmml">⁡</mo><mrow id="S2.SS2.SSS0.Px1.p1.29.m2.2.3.2.1" xref="S2.SS2.SSS0.Px1.p1.29.m2.2.3.1.cmml"><mo id="S2.SS2.SSS0.Px1.p1.29.m2.2.3.2.1.1" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.29.m2.2.3.1.cmml">(</mo><mo id="S2.SS2.SSS0.Px1.p1.29.m2.2.2" lspace="0em" rspace="0em" xref="S2.SS2.SSS0.Px1.p1.29.m2.2.2.cmml">⋅</mo><mo id="S2.SS2.SSS0.Px1.p1.29.m2.2.3.2.1.2" stretchy="false" xref="S2.SS2.SSS0.Px1.p1.29.m2.2.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.29.m2.2b"><apply id="S2.SS2.SSS0.Px1.p1.29.m2.2.3.1.cmml" xref="S2.SS2.SSS0.Px1.p1.29.m2.2.3.2"><ci id="S2.SS2.SSS0.Px1.p1.29.m2.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.29.m2.1.1">Softmax</ci><ci id="S2.SS2.SSS0.Px1.p1.29.m2.2.2.cmml" xref="S2.SS2.SSS0.Px1.p1.29.m2.2.2">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.29.m2.2c">\operatorname{Softmax}(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.29.m2.2d">roman_Softmax ( ⋅ )</annotation></semantics></math> function to compute the prediction probabilities of the <math alttext="k" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px1.p1.30.m3.1"><semantics id="S2.SS2.SSS0.Px1.p1.30.m3.1a"><mi id="S2.SS2.SSS0.Px1.p1.30.m3.1.1" xref="S2.SS2.SSS0.Px1.p1.30.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px1.p1.30.m3.1b"><ci id="S2.SS2.SSS0.Px1.p1.30.m3.1.1.cmml" xref="S2.SS2.SSS0.Px1.p1.30.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px1.p1.30.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px1.p1.30.m3.1d">italic_k</annotation></semantics></math>-th additional token.
Also, for each MTP module, its output head is shared with the main model.
Our principle of maintaining the causal chain of predictions is similar to that of EAGLE <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib51" title="">2024b</a>)</cite>, but its primary objective is speculative decoding <cite class="ltx_cite ltx_citemacro_citep">(Xia et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib99" title="">2023</a>; Leviathan et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib46" title="">2023</a>)</cite>, whereas we utilize MTP to improve training.</p>
</div>
</section>
<section class="ltx_paragraph" id="S2.SS2.SSS0.Px2">
<h5 class="ltx_title ltx_title_paragraph">MTP Training Objective.</h5>
<div class="ltx_para" id="S2.SS2.SSS0.Px2.p1">
<p class="ltx_p" id="S2.SS2.SSS0.Px2.p1.1">For each prediction depth, we compute a cross-entropy loss <math alttext="\mathcal{L}_{\text{MTP}}^{k}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px2.p1.1.m1.1"><semantics id="S2.SS2.SSS0.Px2.p1.1.m1.1a"><msubsup id="S2.SS2.SSS0.Px2.p1.1.m1.1.1" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.2" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.2.cmml">ℒ</mi><mtext id="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.3" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.3a.cmml">MTP</mtext><mi id="S2.SS2.SSS0.Px2.p1.1.m1.1.1.3" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1.3.cmml">k</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px2.p1.1.m1.1b"><apply id="S2.SS2.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1">superscript</csymbol><apply id="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.1.cmml" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1">subscript</csymbol><ci id="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.2.cmml" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.2">ℒ</ci><ci id="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.3a.cmml" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.3"><mtext id="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.3.cmml" mathsize="70%" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1.2.3">MTP</mtext></ci></apply><ci id="S2.SS2.SSS0.Px2.p1.1.m1.1.1.3.cmml" xref="S2.SS2.SSS0.Px2.p1.1.m1.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px2.p1.1.m1.1c">\mathcal{L}_{\text{MTP}}^{k}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px2.p1.1.m1.1d">caligraphic_L start_POSTSUBSCRIPT MTP end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT</annotation></semantics></math>:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E24">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{\text{MTP}}^{k}=\operatorname{CrossEntropy}(P_{2+k:T+1}^{k},t_{2+%
k:T+1})=-\frac{1}{T}\sum_{i=2+k}^{T+1}\log P_{i}^{k}[t_{i}]," class="ltx_Math" display="block" id="S2.E24.m1.2"><semantics id="S2.E24.m1.2a"><mrow id="S2.E24.m1.2.2.1" xref="S2.E24.m1.2.2.1.1.cmml"><mrow id="S2.E24.m1.2.2.1.1" xref="S2.E24.m1.2.2.1.1.cmml"><msubsup id="S2.E24.m1.2.2.1.1.5" xref="S2.E24.m1.2.2.1.1.5.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.E24.m1.2.2.1.1.5.2.2" xref="S2.E24.m1.2.2.1.1.5.2.2.cmml">ℒ</mi><mtext id="S2.E24.m1.2.2.1.1.5.2.3" xref="S2.E24.m1.2.2.1.1.5.2.3a.cmml">MTP</mtext><mi id="S2.E24.m1.2.2.1.1.5.3" xref="S2.E24.m1.2.2.1.1.5.3.cmml">k</mi></msubsup><mo id="S2.E24.m1.2.2.1.1.6" xref="S2.E24.m1.2.2.1.1.6.cmml">=</mo><mrow id="S2.E24.m1.2.2.1.1.2.2" xref="S2.E24.m1.2.2.1.1.2.3.cmml"><mi id="S2.E24.m1.1.1" xref="S2.E24.m1.1.1.cmml">CrossEntropy</mi><mo id="S2.E24.m1.2.2.1.1.2.2a" xref="S2.E24.m1.2.2.1.1.2.3.cmml">⁡</mo><mrow id="S2.E24.m1.2.2.1.1.2.2.2" xref="S2.E24.m1.2.2.1.1.2.3.cmml"><mo id="S2.E24.m1.2.2.1.1.2.2.2.3" stretchy="false" xref="S2.E24.m1.2.2.1.1.2.3.cmml">(</mo><msubsup id="S2.E24.m1.2.2.1.1.1.1.1.1" xref="S2.E24.m1.2.2.1.1.1.1.1.1.cmml"><mi id="S2.E24.m1.2.2.1.1.1.1.1.1.2.2" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.2.cmml">P</mi><mrow id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.cmml"><mrow id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.cmml"><mn id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.2" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.2.cmml">2</mn><mo id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.1" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.1.cmml">+</mo><mi id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.3" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.3.cmml">k</mi></mrow><mo id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.1" lspace="0.278em" rspace="0.278em" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.1.cmml">:</mo><mrow id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.cmml"><mi id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.2" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.2.cmml">T</mi><mo id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.1" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.1.cmml">+</mo><mn id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.3" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.3.cmml">1</mn></mrow></mrow><mi id="S2.E24.m1.2.2.1.1.1.1.1.1.3" xref="S2.E24.m1.2.2.1.1.1.1.1.1.3.cmml">k</mi></msubsup><mo id="S2.E24.m1.2.2.1.1.2.2.2.4" xref="S2.E24.m1.2.2.1.1.2.3.cmml">,</mo><msub id="S2.E24.m1.2.2.1.1.2.2.2.2" xref="S2.E24.m1.2.2.1.1.2.2.2.2.cmml"><mi id="S2.E24.m1.2.2.1.1.2.2.2.2.2" xref="S2.E24.m1.2.2.1.1.2.2.2.2.2.cmml">t</mi><mrow id="S2.E24.m1.2.2.1.1.2.2.2.2.3" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.cmml"><mrow id="S2.E24.m1.2.2.1.1.2.2.2.2.3.2" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.cmml"><mn id="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.2" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.2.cmml">2</mn><mo id="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.1" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.1.cmml">+</mo><mi id="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.3" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.3.cmml">k</mi></mrow><mo id="S2.E24.m1.2.2.1.1.2.2.2.2.3.1" lspace="0.278em" rspace="0.278em" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.1.cmml">:</mo><mrow id="S2.E24.m1.2.2.1.1.2.2.2.2.3.3" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.cmml"><mi id="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.2" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.2.cmml">T</mi><mo id="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.1" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.1.cmml">+</mo><mn id="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.3" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.3.cmml">1</mn></mrow></mrow></msub><mo id="S2.E24.m1.2.2.1.1.2.2.2.5" stretchy="false" xref="S2.E24.m1.2.2.1.1.2.3.cmml">)</mo></mrow></mrow><mo id="S2.E24.m1.2.2.1.1.7" xref="S2.E24.m1.2.2.1.1.7.cmml">=</mo><mrow id="S2.E24.m1.2.2.1.1.3" xref="S2.E24.m1.2.2.1.1.3.cmml"><mo id="S2.E24.m1.2.2.1.1.3a" xref="S2.E24.m1.2.2.1.1.3.cmml">−</mo><mrow id="S2.E24.m1.2.2.1.1.3.1" xref="S2.E24.m1.2.2.1.1.3.1.cmml"><mfrac id="S2.E24.m1.2.2.1.1.3.1.3" xref="S2.E24.m1.2.2.1.1.3.1.3.cmml"><mn id="S2.E24.m1.2.2.1.1.3.1.3.2" xref="S2.E24.m1.2.2.1.1.3.1.3.2.cmml">1</mn><mi id="S2.E24.m1.2.2.1.1.3.1.3.3" xref="S2.E24.m1.2.2.1.1.3.1.3.3.cmml">T</mi></mfrac><mo id="S2.E24.m1.2.2.1.1.3.1.2" xref="S2.E24.m1.2.2.1.1.3.1.2.cmml">⁢</mo><mrow id="S2.E24.m1.2.2.1.1.3.1.1" xref="S2.E24.m1.2.2.1.1.3.1.1.cmml"><munderover id="S2.E24.m1.2.2.1.1.3.1.1.2" xref="S2.E24.m1.2.2.1.1.3.1.1.2.cmml"><mo id="S2.E24.m1.2.2.1.1.3.1.1.2.2.2" movablelimits="false" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.2.cmml">∑</mo><mrow id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.cmml"><mi id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.2" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.2.cmml">i</mi><mo id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.1" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.1.cmml">=</mo><mrow id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.cmml"><mn id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.2" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.2.cmml">2</mn><mo id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.1" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.1.cmml">+</mo><mi id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.3" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.3.cmml">k</mi></mrow></mrow><mrow id="S2.E24.m1.2.2.1.1.3.1.1.2.3" xref="S2.E24.m1.2.2.1.1.3.1.1.2.3.cmml"><mi id="S2.E24.m1.2.2.1.1.3.1.1.2.3.2" xref="S2.E24.m1.2.2.1.1.3.1.1.2.3.2.cmml">T</mi><mo id="S2.E24.m1.2.2.1.1.3.1.1.2.3.1" xref="S2.E24.m1.2.2.1.1.3.1.1.2.3.1.cmml">+</mo><mn id="S2.E24.m1.2.2.1.1.3.1.1.2.3.3" xref="S2.E24.m1.2.2.1.1.3.1.1.2.3.3.cmml">1</mn></mrow></munderover><mrow id="S2.E24.m1.2.2.1.1.3.1.1.1" xref="S2.E24.m1.2.2.1.1.3.1.1.1.cmml"><mrow id="S2.E24.m1.2.2.1.1.3.1.1.1.3" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.cmml"><mi id="S2.E24.m1.2.2.1.1.3.1.1.1.3.1" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.1.cmml">log</mi><mo id="S2.E24.m1.2.2.1.1.3.1.1.1.3a" lspace="0.167em" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.cmml">⁡</mo><msubsup id="S2.E24.m1.2.2.1.1.3.1.1.1.3.2" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.cmml"><mi id="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.2.2" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.2.2.cmml">P</mi><mi id="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.2.3" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.2.3.cmml">i</mi><mi id="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.3" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.3.cmml">k</mi></msubsup></mrow><mo id="S2.E24.m1.2.2.1.1.3.1.1.1.2" xref="S2.E24.m1.2.2.1.1.3.1.1.1.2.cmml">⁢</mo><mrow id="S2.E24.m1.2.2.1.1.3.1.1.1.1.1" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.2.cmml"><mo id="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.2" stretchy="false" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.2.1.cmml">[</mo><msub id="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1.cmml"><mi id="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1.2" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1.2.cmml">t</mi><mi id="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1.3" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.3" stretchy="false" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.2.1.cmml">]</mo></mrow></mrow></mrow></mrow></mrow></mrow><mo id="S2.E24.m1.2.2.1.2" xref="S2.E24.m1.2.2.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E24.m1.2b"><apply id="S2.E24.m1.2.2.1.1.cmml" xref="S2.E24.m1.2.2.1"><and id="S2.E24.m1.2.2.1.1a.cmml" xref="S2.E24.m1.2.2.1"></and><apply id="S2.E24.m1.2.2.1.1b.cmml" xref="S2.E24.m1.2.2.1"><eq id="S2.E24.m1.2.2.1.1.6.cmml" xref="S2.E24.m1.2.2.1.1.6"></eq><apply id="S2.E24.m1.2.2.1.1.5.cmml" xref="S2.E24.m1.2.2.1.1.5"><csymbol cd="ambiguous" id="S2.E24.m1.2.2.1.1.5.1.cmml" xref="S2.E24.m1.2.2.1.1.5">superscript</csymbol><apply id="S2.E24.m1.2.2.1.1.5.2.cmml" xref="S2.E24.m1.2.2.1.1.5"><csymbol cd="ambiguous" id="S2.E24.m1.2.2.1.1.5.2.1.cmml" xref="S2.E24.m1.2.2.1.1.5">subscript</csymbol><ci id="S2.E24.m1.2.2.1.1.5.2.2.cmml" xref="S2.E24.m1.2.2.1.1.5.2.2">ℒ</ci><ci id="S2.E24.m1.2.2.1.1.5.2.3a.cmml" xref="S2.E24.m1.2.2.1.1.5.2.3"><mtext id="S2.E24.m1.2.2.1.1.5.2.3.cmml" mathsize="70%" xref="S2.E24.m1.2.2.1.1.5.2.3">MTP</mtext></ci></apply><ci id="S2.E24.m1.2.2.1.1.5.3.cmml" xref="S2.E24.m1.2.2.1.1.5.3">𝑘</ci></apply><apply id="S2.E24.m1.2.2.1.1.2.3.cmml" xref="S2.E24.m1.2.2.1.1.2.2"><ci id="S2.E24.m1.1.1.cmml" xref="S2.E24.m1.1.1">CrossEntropy</ci><apply id="S2.E24.m1.2.2.1.1.1.1.1.1.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E24.m1.2.2.1.1.1.1.1.1.1.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1">superscript</csymbol><apply id="S2.E24.m1.2.2.1.1.1.1.1.1.2.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E24.m1.2.2.1.1.1.1.1.1.2.1.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E24.m1.2.2.1.1.1.1.1.1.2.2.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.2">𝑃</ci><apply id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3"><ci id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.1.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.1">:</ci><apply id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2"><plus id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.1.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.1"></plus><cn id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.2.cmml" type="integer" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.2">2</cn><ci id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.3.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.2.3">𝑘</ci></apply><apply id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3"><plus id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.1.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.1"></plus><ci id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.2.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.2">𝑇</ci><cn id="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.3.cmml" type="integer" xref="S2.E24.m1.2.2.1.1.1.1.1.1.2.3.3.3">1</cn></apply></apply></apply><ci id="S2.E24.m1.2.2.1.1.1.1.1.1.3.cmml" xref="S2.E24.m1.2.2.1.1.1.1.1.1.3">𝑘</ci></apply><apply id="S2.E24.m1.2.2.1.1.2.2.2.2.cmml" xref="S2.E24.m1.2.2.1.1.2.2.2.2"><csymbol cd="ambiguous" id="S2.E24.m1.2.2.1.1.2.2.2.2.1.cmml" xref="S2.E24.m1.2.2.1.1.2.2.2.2">subscript</csymbol><ci id="S2.E24.m1.2.2.1.1.2.2.2.2.2.cmml" xref="S2.E24.m1.2.2.1.1.2.2.2.2.2">𝑡</ci><apply id="S2.E24.m1.2.2.1.1.2.2.2.2.3.cmml" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3"><ci id="S2.E24.m1.2.2.1.1.2.2.2.2.3.1.cmml" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.1">:</ci><apply id="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.cmml" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.2"><plus id="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.1.cmml" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.1"></plus><cn id="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.2.cmml" type="integer" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.2">2</cn><ci id="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.3.cmml" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.2.3">𝑘</ci></apply><apply id="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.cmml" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.3"><plus id="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.1.cmml" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.1"></plus><ci id="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.2.cmml" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.2">𝑇</ci><cn id="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.3.cmml" type="integer" xref="S2.E24.m1.2.2.1.1.2.2.2.2.3.3.3">1</cn></apply></apply></apply></apply></apply><apply id="S2.E24.m1.2.2.1.1c.cmml" xref="S2.E24.m1.2.2.1"><eq id="S2.E24.m1.2.2.1.1.7.cmml" xref="S2.E24.m1.2.2.1.1.7"></eq><share href="https://arxiv.org/html/2412.19437v1#S2.E24.m1.2.2.1.1.2.cmml" id="S2.E24.m1.2.2.1.1d.cmml" xref="S2.E24.m1.2.2.1"></share><apply id="S2.E24.m1.2.2.1.1.3.cmml" xref="S2.E24.m1.2.2.1.1.3"><minus id="S2.E24.m1.2.2.1.1.3.2.cmml" xref="S2.E24.m1.2.2.1.1.3"></minus><apply id="S2.E24.m1.2.2.1.1.3.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1"><times id="S2.E24.m1.2.2.1.1.3.1.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.2"></times><apply id="S2.E24.m1.2.2.1.1.3.1.3.cmml" xref="S2.E24.m1.2.2.1.1.3.1.3"><divide id="S2.E24.m1.2.2.1.1.3.1.3.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.3"></divide><cn id="S2.E24.m1.2.2.1.1.3.1.3.2.cmml" type="integer" xref="S2.E24.m1.2.2.1.1.3.1.3.2">1</cn><ci id="S2.E24.m1.2.2.1.1.3.1.3.3.cmml" xref="S2.E24.m1.2.2.1.1.3.1.3.3">𝑇</ci></apply><apply id="S2.E24.m1.2.2.1.1.3.1.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1"><apply id="S2.E24.m1.2.2.1.1.3.1.1.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2"><csymbol cd="ambiguous" id="S2.E24.m1.2.2.1.1.3.1.1.2.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2">superscript</csymbol><apply id="S2.E24.m1.2.2.1.1.3.1.1.2.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2"><csymbol cd="ambiguous" id="S2.E24.m1.2.2.1.1.3.1.1.2.2.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2">subscript</csymbol><sum id="S2.E24.m1.2.2.1.1.3.1.1.2.2.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.2"></sum><apply id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3"><eq id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.1"></eq><ci id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.2">𝑖</ci><apply id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3"><plus id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.1"></plus><cn id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.2.cmml" type="integer" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.2">2</cn><ci id="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.3.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2.2.3.3.3">𝑘</ci></apply></apply></apply><apply id="S2.E24.m1.2.2.1.1.3.1.1.2.3.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2.3"><plus id="S2.E24.m1.2.2.1.1.3.1.1.2.3.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2.3.1"></plus><ci id="S2.E24.m1.2.2.1.1.3.1.1.2.3.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.2.3.2">𝑇</ci><cn id="S2.E24.m1.2.2.1.1.3.1.1.2.3.3.cmml" type="integer" xref="S2.E24.m1.2.2.1.1.3.1.1.2.3.3">1</cn></apply></apply><apply id="S2.E24.m1.2.2.1.1.3.1.1.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1"><times id="S2.E24.m1.2.2.1.1.3.1.1.1.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.2"></times><apply id="S2.E24.m1.2.2.1.1.3.1.1.1.3.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3"><log id="S2.E24.m1.2.2.1.1.3.1.1.1.3.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.1"></log><apply id="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.2"><csymbol cd="ambiguous" id="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.2">superscript</csymbol><apply id="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.2"><csymbol cd="ambiguous" id="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.2.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.2">subscript</csymbol><ci id="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.2.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.2.2">𝑃</ci><ci id="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.2.3.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.2.3">𝑖</ci></apply><ci id="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.3.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.3.2.3">𝑘</ci></apply></apply><apply id="S2.E24.m1.2.2.1.1.3.1.1.1.1.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.1"><csymbol cd="latexml" id="S2.E24.m1.2.2.1.1.3.1.1.1.1.2.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.2">delimited-[]</csymbol><apply id="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1.1.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1.2.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1.2">𝑡</ci><ci id="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1.3.cmml" xref="S2.E24.m1.2.2.1.1.3.1.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E24.m1.2c">\mathcal{L}_{\text{MTP}}^{k}=\operatorname{CrossEntropy}(P_{2+k:T+1}^{k},t_{2+%
k:T+1})=-\frac{1}{T}\sum_{i=2+k}^{T+1}\log P_{i}^{k}[t_{i}],</annotation><annotation encoding="application/x-llamapun" id="S2.E24.m1.2d">caligraphic_L start_POSTSUBSCRIPT MTP end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT = roman_CrossEntropy ( italic_P start_POSTSUBSCRIPT 2 + italic_k : italic_T + 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT , italic_t start_POSTSUBSCRIPT 2 + italic_k : italic_T + 1 end_POSTSUBSCRIPT ) = - divide start_ARG 1 end_ARG start_ARG italic_T end_ARG ∑ start_POSTSUBSCRIPT italic_i = 2 + italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T + 1 end_POSTSUPERSCRIPT roman_log italic_P start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT [ italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ] ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(24)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS2.SSS0.Px2.p1.9">where <math alttext="T" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px2.p1.2.m1.1"><semantics id="S2.SS2.SSS0.Px2.p1.2.m1.1a"><mi id="S2.SS2.SSS0.Px2.p1.2.m1.1.1" xref="S2.SS2.SSS0.Px2.p1.2.m1.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px2.p1.2.m1.1b"><ci id="S2.SS2.SSS0.Px2.p1.2.m1.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.2.m1.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px2.p1.2.m1.1c">T</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px2.p1.2.m1.1d">italic_T</annotation></semantics></math> denotes the input sequence length, <math alttext="t_{i}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px2.p1.3.m2.1"><semantics id="S2.SS2.SSS0.Px2.p1.3.m2.1a"><msub id="S2.SS2.SSS0.Px2.p1.3.m2.1.1" xref="S2.SS2.SSS0.Px2.p1.3.m2.1.1.cmml"><mi id="S2.SS2.SSS0.Px2.p1.3.m2.1.1.2" xref="S2.SS2.SSS0.Px2.p1.3.m2.1.1.2.cmml">t</mi><mi id="S2.SS2.SSS0.Px2.p1.3.m2.1.1.3" xref="S2.SS2.SSS0.Px2.p1.3.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px2.p1.3.m2.1b"><apply id="S2.SS2.SSS0.Px2.p1.3.m2.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.3.m2.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px2.p1.3.m2.1.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.3.m2.1.1">subscript</csymbol><ci id="S2.SS2.SSS0.Px2.p1.3.m2.1.1.2.cmml" xref="S2.SS2.SSS0.Px2.p1.3.m2.1.1.2">𝑡</ci><ci id="S2.SS2.SSS0.Px2.p1.3.m2.1.1.3.cmml" xref="S2.SS2.SSS0.Px2.p1.3.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px2.p1.3.m2.1c">t_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px2.p1.3.m2.1d">italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> denotes the ground-truth token at the <math alttext="i" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px2.p1.4.m3.1"><semantics id="S2.SS2.SSS0.Px2.p1.4.m3.1a"><mi id="S2.SS2.SSS0.Px2.p1.4.m3.1.1" xref="S2.SS2.SSS0.Px2.p1.4.m3.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px2.p1.4.m3.1b"><ci id="S2.SS2.SSS0.Px2.p1.4.m3.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.4.m3.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px2.p1.4.m3.1c">i</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px2.p1.4.m3.1d">italic_i</annotation></semantics></math>-th position, and <math alttext="P_{i}^{k}[t_{i}]" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px2.p1.5.m4.1"><semantics id="S2.SS2.SSS0.Px2.p1.5.m4.1a"><mrow id="S2.SS2.SSS0.Px2.p1.5.m4.1.1" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.cmml"><msubsup id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.cmml"><mi id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.2.2" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.2.2.cmml">P</mi><mi id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.2.3" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.2.3.cmml">i</mi><mi id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.3" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.3.cmml">k</mi></msubsup><mo id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.2" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.2.cmml">⁢</mo><mrow id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.2.cmml"><mo id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.2" stretchy="false" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.2.1.cmml">[</mo><msub id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1.cmml"><mi id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1.2" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1.2.cmml">t</mi><mi id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1.3" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.3" stretchy="false" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.2.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px2.p1.5.m4.1b"><apply id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1"><times id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.2.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.2"></times><apply id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.1.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3">superscript</csymbol><apply id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.2.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.2.1.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3">subscript</csymbol><ci id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.2.2.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.2.2">𝑃</ci><ci id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.2.3.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.2.3">𝑖</ci></apply><ci id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.3.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.3.3">𝑘</ci></apply><apply id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.2.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1"><csymbol cd="latexml" id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.2.1.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.2">delimited-[]</csymbol><apply id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1">subscript</csymbol><ci id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1.2.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1.2">𝑡</ci><ci id="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1.3.cmml" xref="S2.SS2.SSS0.Px2.p1.5.m4.1.1.1.1.1.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px2.p1.5.m4.1c">P_{i}^{k}[t_{i}]</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px2.p1.5.m4.1d">italic_P start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT [ italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ]</annotation></semantics></math> denotes the corresponding prediction probability of <math alttext="t_{i}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px2.p1.6.m5.1"><semantics id="S2.SS2.SSS0.Px2.p1.6.m5.1a"><msub id="S2.SS2.SSS0.Px2.p1.6.m5.1.1" xref="S2.SS2.SSS0.Px2.p1.6.m5.1.1.cmml"><mi id="S2.SS2.SSS0.Px2.p1.6.m5.1.1.2" xref="S2.SS2.SSS0.Px2.p1.6.m5.1.1.2.cmml">t</mi><mi id="S2.SS2.SSS0.Px2.p1.6.m5.1.1.3" xref="S2.SS2.SSS0.Px2.p1.6.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px2.p1.6.m5.1b"><apply id="S2.SS2.SSS0.Px2.p1.6.m5.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.6.m5.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px2.p1.6.m5.1.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.6.m5.1.1">subscript</csymbol><ci id="S2.SS2.SSS0.Px2.p1.6.m5.1.1.2.cmml" xref="S2.SS2.SSS0.Px2.p1.6.m5.1.1.2">𝑡</ci><ci id="S2.SS2.SSS0.Px2.p1.6.m5.1.1.3.cmml" xref="S2.SS2.SSS0.Px2.p1.6.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px2.p1.6.m5.1c">t_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px2.p1.6.m5.1d">italic_t start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, given by the <math alttext="k" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px2.p1.7.m6.1"><semantics id="S2.SS2.SSS0.Px2.p1.7.m6.1a"><mi id="S2.SS2.SSS0.Px2.p1.7.m6.1.1" xref="S2.SS2.SSS0.Px2.p1.7.m6.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px2.p1.7.m6.1b"><ci id="S2.SS2.SSS0.Px2.p1.7.m6.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.7.m6.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px2.p1.7.m6.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px2.p1.7.m6.1d">italic_k</annotation></semantics></math>-th MTP module.
Finally, we compute the average of the MTP losses across all depths and multiply it by a weighting factor <math alttext="\lambda" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px2.p1.8.m7.1"><semantics id="S2.SS2.SSS0.Px2.p1.8.m7.1a"><mi id="S2.SS2.SSS0.Px2.p1.8.m7.1.1" xref="S2.SS2.SSS0.Px2.p1.8.m7.1.1.cmml">λ</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px2.p1.8.m7.1b"><ci id="S2.SS2.SSS0.Px2.p1.8.m7.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.8.m7.1.1">𝜆</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px2.p1.8.m7.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px2.p1.8.m7.1d">italic_λ</annotation></semantics></math> to obtain the overall MTP loss <math alttext="\mathcal{L}_{\text{MTP}}" class="ltx_Math" display="inline" id="S2.SS2.SSS0.Px2.p1.9.m8.1"><semantics id="S2.SS2.SSS0.Px2.p1.9.m8.1a"><msub id="S2.SS2.SSS0.Px2.p1.9.m8.1.1" xref="S2.SS2.SSS0.Px2.p1.9.m8.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS2.SSS0.Px2.p1.9.m8.1.1.2" xref="S2.SS2.SSS0.Px2.p1.9.m8.1.1.2.cmml">ℒ</mi><mtext id="S2.SS2.SSS0.Px2.p1.9.m8.1.1.3" xref="S2.SS2.SSS0.Px2.p1.9.m8.1.1.3a.cmml">MTP</mtext></msub><annotation-xml encoding="MathML-Content" id="S2.SS2.SSS0.Px2.p1.9.m8.1b"><apply id="S2.SS2.SSS0.Px2.p1.9.m8.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.9.m8.1.1"><csymbol cd="ambiguous" id="S2.SS2.SSS0.Px2.p1.9.m8.1.1.1.cmml" xref="S2.SS2.SSS0.Px2.p1.9.m8.1.1">subscript</csymbol><ci id="S2.SS2.SSS0.Px2.p1.9.m8.1.1.2.cmml" xref="S2.SS2.SSS0.Px2.p1.9.m8.1.1.2">ℒ</ci><ci id="S2.SS2.SSS0.Px2.p1.9.m8.1.1.3a.cmml" xref="S2.SS2.SSS0.Px2.p1.9.m8.1.1.3"><mtext id="S2.SS2.SSS0.Px2.p1.9.m8.1.1.3.cmml" mathsize="70%" xref="S2.SS2.SSS0.Px2.p1.9.m8.1.1.3">MTP</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.SSS0.Px2.p1.9.m8.1c">\mathcal{L}_{\text{MTP}}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.SSS0.Px2.p1.9.m8.1d">caligraphic_L start_POSTSUBSCRIPT MTP end_POSTSUBSCRIPT</annotation></semantics></math>, which serves as an additional training objective for DeepSeek-V3:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E25">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{\text{MTP}}=\frac{\lambda}{D}\sum_{k=1}^{D}\mathcal{L}_{\text{MTP%
}}^{k}." class="ltx_Math" display="block" id="S2.E25.m1.1"><semantics id="S2.E25.m1.1a"><mrow id="S2.E25.m1.1.1.1" xref="S2.E25.m1.1.1.1.1.cmml"><mrow id="S2.E25.m1.1.1.1.1" xref="S2.E25.m1.1.1.1.1.cmml"><msub id="S2.E25.m1.1.1.1.1.2" xref="S2.E25.m1.1.1.1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.E25.m1.1.1.1.1.2.2" xref="S2.E25.m1.1.1.1.1.2.2.cmml">ℒ</mi><mtext id="S2.E25.m1.1.1.1.1.2.3" xref="S2.E25.m1.1.1.1.1.2.3a.cmml">MTP</mtext></msub><mo id="S2.E25.m1.1.1.1.1.1" xref="S2.E25.m1.1.1.1.1.1.cmml">=</mo><mrow id="S2.E25.m1.1.1.1.1.3" xref="S2.E25.m1.1.1.1.1.3.cmml"><mfrac id="S2.E25.m1.1.1.1.1.3.2" xref="S2.E25.m1.1.1.1.1.3.2.cmml"><mi id="S2.E25.m1.1.1.1.1.3.2.2" xref="S2.E25.m1.1.1.1.1.3.2.2.cmml">λ</mi><mi id="S2.E25.m1.1.1.1.1.3.2.3" xref="S2.E25.m1.1.1.1.1.3.2.3.cmml">D</mi></mfrac><mo id="S2.E25.m1.1.1.1.1.3.1" xref="S2.E25.m1.1.1.1.1.3.1.cmml">⁢</mo><mrow id="S2.E25.m1.1.1.1.1.3.3" xref="S2.E25.m1.1.1.1.1.3.3.cmml"><munderover id="S2.E25.m1.1.1.1.1.3.3.1" xref="S2.E25.m1.1.1.1.1.3.3.1.cmml"><mo id="S2.E25.m1.1.1.1.1.3.3.1.2.2" movablelimits="false" xref="S2.E25.m1.1.1.1.1.3.3.1.2.2.cmml">∑</mo><mrow id="S2.E25.m1.1.1.1.1.3.3.1.2.3" xref="S2.E25.m1.1.1.1.1.3.3.1.2.3.cmml"><mi id="S2.E25.m1.1.1.1.1.3.3.1.2.3.2" xref="S2.E25.m1.1.1.1.1.3.3.1.2.3.2.cmml">k</mi><mo id="S2.E25.m1.1.1.1.1.3.3.1.2.3.1" xref="S2.E25.m1.1.1.1.1.3.3.1.2.3.1.cmml">=</mo><mn id="S2.E25.m1.1.1.1.1.3.3.1.2.3.3" xref="S2.E25.m1.1.1.1.1.3.3.1.2.3.3.cmml">1</mn></mrow><mi id="S2.E25.m1.1.1.1.1.3.3.1.3" xref="S2.E25.m1.1.1.1.1.3.3.1.3.cmml">D</mi></munderover><msubsup id="S2.E25.m1.1.1.1.1.3.3.2" xref="S2.E25.m1.1.1.1.1.3.3.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.E25.m1.1.1.1.1.3.3.2.2.2" xref="S2.E25.m1.1.1.1.1.3.3.2.2.2.cmml">ℒ</mi><mtext id="S2.E25.m1.1.1.1.1.3.3.2.2.3" xref="S2.E25.m1.1.1.1.1.3.3.2.2.3a.cmml">MTP</mtext><mi id="S2.E25.m1.1.1.1.1.3.3.2.3" xref="S2.E25.m1.1.1.1.1.3.3.2.3.cmml">k</mi></msubsup></mrow></mrow></mrow><mo id="S2.E25.m1.1.1.1.2" lspace="0em" xref="S2.E25.m1.1.1.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E25.m1.1b"><apply id="S2.E25.m1.1.1.1.1.cmml" xref="S2.E25.m1.1.1.1"><eq id="S2.E25.m1.1.1.1.1.1.cmml" xref="S2.E25.m1.1.1.1.1.1"></eq><apply id="S2.E25.m1.1.1.1.1.2.cmml" xref="S2.E25.m1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E25.m1.1.1.1.1.2.1.cmml" xref="S2.E25.m1.1.1.1.1.2">subscript</csymbol><ci id="S2.E25.m1.1.1.1.1.2.2.cmml" xref="S2.E25.m1.1.1.1.1.2.2">ℒ</ci><ci id="S2.E25.m1.1.1.1.1.2.3a.cmml" xref="S2.E25.m1.1.1.1.1.2.3"><mtext id="S2.E25.m1.1.1.1.1.2.3.cmml" mathsize="70%" xref="S2.E25.m1.1.1.1.1.2.3">MTP</mtext></ci></apply><apply id="S2.E25.m1.1.1.1.1.3.cmml" xref="S2.E25.m1.1.1.1.1.3"><times id="S2.E25.m1.1.1.1.1.3.1.cmml" xref="S2.E25.m1.1.1.1.1.3.1"></times><apply id="S2.E25.m1.1.1.1.1.3.2.cmml" xref="S2.E25.m1.1.1.1.1.3.2"><divide id="S2.E25.m1.1.1.1.1.3.2.1.cmml" xref="S2.E25.m1.1.1.1.1.3.2"></divide><ci id="S2.E25.m1.1.1.1.1.3.2.2.cmml" xref="S2.E25.m1.1.1.1.1.3.2.2">𝜆</ci><ci id="S2.E25.m1.1.1.1.1.3.2.3.cmml" xref="S2.E25.m1.1.1.1.1.3.2.3">𝐷</ci></apply><apply id="S2.E25.m1.1.1.1.1.3.3.cmml" xref="S2.E25.m1.1.1.1.1.3.3"><apply id="S2.E25.m1.1.1.1.1.3.3.1.cmml" xref="S2.E25.m1.1.1.1.1.3.3.1"><csymbol cd="ambiguous" id="S2.E25.m1.1.1.1.1.3.3.1.1.cmml" xref="S2.E25.m1.1.1.1.1.3.3.1">superscript</csymbol><apply id="S2.E25.m1.1.1.1.1.3.3.1.2.cmml" xref="S2.E25.m1.1.1.1.1.3.3.1"><csymbol cd="ambiguous" id="S2.E25.m1.1.1.1.1.3.3.1.2.1.cmml" xref="S2.E25.m1.1.1.1.1.3.3.1">subscript</csymbol><sum id="S2.E25.m1.1.1.1.1.3.3.1.2.2.cmml" xref="S2.E25.m1.1.1.1.1.3.3.1.2.2"></sum><apply id="S2.E25.m1.1.1.1.1.3.3.1.2.3.cmml" xref="S2.E25.m1.1.1.1.1.3.3.1.2.3"><eq id="S2.E25.m1.1.1.1.1.3.3.1.2.3.1.cmml" xref="S2.E25.m1.1.1.1.1.3.3.1.2.3.1"></eq><ci id="S2.E25.m1.1.1.1.1.3.3.1.2.3.2.cmml" xref="S2.E25.m1.1.1.1.1.3.3.1.2.3.2">𝑘</ci><cn id="S2.E25.m1.1.1.1.1.3.3.1.2.3.3.cmml" type="integer" xref="S2.E25.m1.1.1.1.1.3.3.1.2.3.3">1</cn></apply></apply><ci id="S2.E25.m1.1.1.1.1.3.3.1.3.cmml" xref="S2.E25.m1.1.1.1.1.3.3.1.3">𝐷</ci></apply><apply id="S2.E25.m1.1.1.1.1.3.3.2.cmml" xref="S2.E25.m1.1.1.1.1.3.3.2"><csymbol cd="ambiguous" id="S2.E25.m1.1.1.1.1.3.3.2.1.cmml" xref="S2.E25.m1.1.1.1.1.3.3.2">superscript</csymbol><apply id="S2.E25.m1.1.1.1.1.3.3.2.2.cmml" xref="S2.E25.m1.1.1.1.1.3.3.2"><csymbol cd="ambiguous" id="S2.E25.m1.1.1.1.1.3.3.2.2.1.cmml" xref="S2.E25.m1.1.1.1.1.3.3.2">subscript</csymbol><ci id="S2.E25.m1.1.1.1.1.3.3.2.2.2.cmml" xref="S2.E25.m1.1.1.1.1.3.3.2.2.2">ℒ</ci><ci id="S2.E25.m1.1.1.1.1.3.3.2.2.3a.cmml" xref="S2.E25.m1.1.1.1.1.3.3.2.2.3"><mtext id="S2.E25.m1.1.1.1.1.3.3.2.2.3.cmml" mathsize="70%" xref="S2.E25.m1.1.1.1.1.3.3.2.2.3">MTP</mtext></ci></apply><ci id="S2.E25.m1.1.1.1.1.3.3.2.3.cmml" xref="S2.E25.m1.1.1.1.1.3.3.2.3">𝑘</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E25.m1.1c">\mathcal{L}_{\text{MTP}}=\frac{\lambda}{D}\sum_{k=1}^{D}\mathcal{L}_{\text{MTP%
}}^{k}.</annotation><annotation encoding="application/x-llamapun" id="S2.E25.m1.1d">caligraphic_L start_POSTSUBSCRIPT MTP end_POSTSUBSCRIPT = divide start_ARG italic_λ end_ARG start_ARG italic_D end_ARG ∑ start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_D end_POSTSUPERSCRIPT caligraphic_L start_POSTSUBSCRIPT MTP end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_k end_POSTSUPERSCRIPT .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(25)</span></td>
</tr></tbody>
</table>
</div>
</section>
<section class="ltx_paragraph" id="S2.SS2.SSS0.Px3">
<h5 class="ltx_title ltx_title_paragraph">MTP in Inference.</h5>
<div class="ltx_para" id="S2.SS2.SSS0.Px3.p1">
<p class="ltx_p" id="S2.SS2.SSS0.Px3.p1.1">Our MTP strategy mainly aims to improve the performance of the main model, so during inference, we can directly discard the MTP modules and the main model can function independently and normally.
Additionally, we can also repurpose these MTP modules for speculative decoding to further improve the generation latency.</p>
</div>
</section>
</section>
</section>
<section class="ltx_section" id="S3" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Infrastructures</h2>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Compute Clusters</h3>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.1">DeepSeek-V3 is trained on a cluster equipped with 2048 NVIDIA H800 GPUs.
Each node in the H800 cluster contains 8 GPUs connected by NVLink and NVSwitch within nodes.
Across different nodes, InfiniBand (IB) interconnects are utilized to facilitate communications.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>Training Framework</h3>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.1">The training of DeepSeek-V3 is supported by the HAI-LLM framework, an efficient and lightweight training framework crafted by our engineers from the ground up.
On the whole, DeepSeek-V3 applies 16-way Pipeline Parallelism (PP) <cite class="ltx_cite ltx_citemacro_citep">(Qi et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib70" title="">2023a</a>)</cite>, 64-way Expert Parallelism (EP) <cite class="ltx_cite ltx_citemacro_citep">(Lepikhin et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib45" title="">2021</a>)</cite> spanning 8 nodes, and ZeRO-1 Data Parallelism (DP) <cite class="ltx_cite ltx_citemacro_citep">(Rajbhandari et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib75" title="">2020</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.1">In order to facilitate efficient training of DeepSeek-V3, we implement meticulous engineering optimizations.
Firstly, we design the DualPipe algorithm for efficient pipeline parallelism.
Compared with existing PP methods, DualPipe has fewer pipeline bubbles.
More importantly, it overlaps the computation and communication phases across forward and backward processes, thereby addressing the challenge of heavy communication overhead introduced by cross-node expert parallelism.
Secondly, we develop efficient cross-node all-to-all communication kernels to fully utilize IB and NVLink bandwidths and conserve Streaming Multiprocessors (SMs) dedicated to communication.
Finally, we meticulously optimize the memory footprint during training, thereby enabling us to train DeepSeek-V3 without using costly Tensor Parallelism (TP).</p>
</div>
<section class="ltx_subsubsection" id="S3.SS2.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.2.1 </span>DualPipe and Computation-Communication Overlap</h4>
<figure class="ltx_figure" id="S3.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="78" id="S3.F4.g1" src="x4.png" width="747"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4: </span>
Overlapping strategy for a pair of individual forward and backward chunks (the boundaries of the transformer blocks are not aligned).
Orange denotes forward, green denotes "backward for input", blue denotes "backward for weights", purple denotes PP communication, and red denotes barriers.
Both all-to-all and PP communication can be fully hidden.
</figcaption>
</figure>
<div class="ltx_para" id="S3.SS2.SSS1.p1">
<p class="ltx_p" id="S3.SS2.SSS1.p1.1">For DeepSeek-V3, the communication overhead introduced by cross-node expert parallelism results in an inefficient computation-to-communication ratio of approximately 1:1.
To tackle this challenge, we design an innovative pipeline parallelism algorithm called DualPipe, which not only accelerates model training by effectively overlapping forward and backward computation-communication phases, but also reduces the pipeline bubbles.</p>
</div>
<div class="ltx_para" id="S3.SS2.SSS1.p2">
<p class="ltx_p" id="S3.SS2.SSS1.p2.1">The key idea of DualPipe is to overlap the computation and communication within a pair of individual forward and backward chunks.
To be specific, we divide each chunk into four components: <span class="ltx_text ltx_font_typewriter" id="S3.SS2.SSS1.p2.1.1">attention</span>, <span class="ltx_text ltx_font_typewriter" id="S3.SS2.SSS1.p2.1.2">all-to-all dispatch</span>, <span class="ltx_text ltx_font_typewriter" id="S3.SS2.SSS1.p2.1.3">MLP</span>, and <span class="ltx_text ltx_font_typewriter" id="S3.SS2.SSS1.p2.1.4">all-to-all combine</span>.
Specially, for a backward chunk, both <span class="ltx_text ltx_font_typewriter" id="S3.SS2.SSS1.p2.1.5">attention</span> and <span class="ltx_text ltx_font_typewriter" id="S3.SS2.SSS1.p2.1.6">MLP</span> are further split into two parts, <span class="ltx_text ltx_font_typewriter" id="S3.SS2.SSS1.p2.1.7">backward for input</span> and <span class="ltx_text ltx_font_typewriter" id="S3.SS2.SSS1.p2.1.8">backward for weights</span>, like in ZeroBubble <cite class="ltx_cite ltx_citemacro_citep">(Qi et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib71" title="">2023b</a>)</cite>.
In addition, we have a <span class="ltx_text ltx_font_typewriter" id="S3.SS2.SSS1.p2.1.9">PP communication</span> component.
As illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.F4" title="Figure 4 ‣ 3.2.1 DualPipe and Computation-Communication Overlap ‣ 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">4</span></a>, for a pair of forward and backward chunks, we rearrange these components and manually adjust the ratio of GPU SMs dedicated to communication versus computation.
In this overlapping strategy, we can ensure that both all-to-all and PP communication can be fully hidden during execution.
Given the efficient overlapping strategy, the full DualPipe scheduling is illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.F5" title="Figure 5 ‣ 3.2.1 DualPipe and Computation-Communication Overlap ‣ 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">5</span></a>.
It employs a bidirectional pipeline scheduling, which feeds micro-batches from both ends of the pipeline simultaneously and a significant portion of communications can be fully overlapped.
This overlap also ensures that, as the model further scales up, as long as we maintain a constant computation-to-communication ratio, we can still employ fine-grained experts across nodes while achieving a near-zero all-to-all communication overhead.</p>
</div>
<figure class="ltx_figure" id="S3.F5"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="131" id="S3.F5.g1" src="x5.png" width="822"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 5: </span>
Example DualPipe scheduling for 8 PP ranks and 20 micro-batches in two directions.
The micro-batches in the reverse direction are symmetric to those in the forward direction, so we omit their batch ID for illustration simplicity.
Two cells enclosed by a shared black border have mutually overlapped computation and communication.
</figcaption>
</figure>
<div class="ltx_para" id="S3.SS2.SSS1.p3">
<p class="ltx_p" id="S3.SS2.SSS1.p3.1">In addition, even in more general scenarios without a heavy communication burden, DualPipe still exhibits efficiency advantages.
In Table <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.T2" title="Table 2 ‣ 3.2.1 DualPipe and Computation-Communication Overlap ‣ 3.2 Training Framework ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">2</span></a>, we summarize the pipeline bubbles and memory usage across different PP methods.
As shown in the table, compared with ZB1P <cite class="ltx_cite ltx_citemacro_citep">(Qi et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib71" title="">2023b</a>)</cite> and 1F1B <cite class="ltx_cite ltx_citemacro_citep">(Harlap et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib31" title="">2018</a>)</cite>, DualPipe significantly reduces the pipeline bubbles while only increasing the peak activation memory by <math alttext="\frac{1}{PP}" class="ltx_Math" display="inline" id="S3.SS2.SSS1.p3.1.m1.1"><semantics id="S3.SS2.SSS1.p3.1.m1.1a"><mfrac id="S3.SS2.SSS1.p3.1.m1.1.1" xref="S3.SS2.SSS1.p3.1.m1.1.1.cmml"><mn id="S3.SS2.SSS1.p3.1.m1.1.1.2" xref="S3.SS2.SSS1.p3.1.m1.1.1.2.cmml">1</mn><mrow id="S3.SS2.SSS1.p3.1.m1.1.1.3" xref="S3.SS2.SSS1.p3.1.m1.1.1.3.cmml"><mi id="S3.SS2.SSS1.p3.1.m1.1.1.3.2" xref="S3.SS2.SSS1.p3.1.m1.1.1.3.2.cmml">P</mi><mo id="S3.SS2.SSS1.p3.1.m1.1.1.3.1" xref="S3.SS2.SSS1.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.SSS1.p3.1.m1.1.1.3.3" xref="S3.SS2.SSS1.p3.1.m1.1.1.3.3.cmml">P</mi></mrow></mfrac><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS1.p3.1.m1.1b"><apply id="S3.SS2.SSS1.p3.1.m1.1.1.cmml" xref="S3.SS2.SSS1.p3.1.m1.1.1"><divide id="S3.SS2.SSS1.p3.1.m1.1.1.1.cmml" xref="S3.SS2.SSS1.p3.1.m1.1.1"></divide><cn id="S3.SS2.SSS1.p3.1.m1.1.1.2.cmml" type="integer" xref="S3.SS2.SSS1.p3.1.m1.1.1.2">1</cn><apply id="S3.SS2.SSS1.p3.1.m1.1.1.3.cmml" xref="S3.SS2.SSS1.p3.1.m1.1.1.3"><times id="S3.SS2.SSS1.p3.1.m1.1.1.3.1.cmml" xref="S3.SS2.SSS1.p3.1.m1.1.1.3.1"></times><ci id="S3.SS2.SSS1.p3.1.m1.1.1.3.2.cmml" xref="S3.SS2.SSS1.p3.1.m1.1.1.3.2">𝑃</ci><ci id="S3.SS2.SSS1.p3.1.m1.1.1.3.3.cmml" xref="S3.SS2.SSS1.p3.1.m1.1.1.3.3">𝑃</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS1.p3.1.m1.1c">\frac{1}{PP}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS1.p3.1.m1.1d">divide start_ARG 1 end_ARG start_ARG italic_P italic_P end_ARG</annotation></semantics></math> times.
Although DualPipe requires keeping two copies of the model parameters, this does not significantly increase the memory consumption since we use a large EP size during training.
Compared with Chimera <cite class="ltx_cite ltx_citemacro_citep">(Li and Hoefler, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib48" title="">2021</a>)</cite>, DualPipe only requires that the pipeline stages and micro-batches be divisible by 2, without requiring micro-batches to be divisible by pipeline stages.
In addition, for DualPipe, neither the bubbles nor activation memory will increase as the number of micro-batches grows.</p>
</div>
<figure class="ltx_table" id="S3.T2">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S3.T2.9">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S3.T2.9.10.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S3.T2.9.10.1.1" style="padding-left:15.0pt;padding-right:15.0pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.9.10.1.1.1">Method</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S3.T2.9.10.1.2" style="padding-left:15.0pt;padding-right:15.0pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.9.10.1.2.1">Bubble</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S3.T2.9.10.1.3" style="padding-left:15.0pt;padding-right:15.0pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.9.10.1.3.1">Parameter</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S3.T2.9.10.1.4" style="padding-left:15.0pt;padding-right:15.0pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.9.10.1.4.1">Activation</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S3.T2.3.3">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S3.T2.3.3.4" style="padding-left:15.0pt;padding-right:15.0pt;">1F1B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.1.1.1" style="padding-left:15.0pt;padding-right:15.0pt;"><math alttext="(PP-1)(F+B)" class="ltx_Math" display="inline" id="S3.T2.1.1.1.m1.2"><semantics id="S3.T2.1.1.1.m1.2a"><mrow id="S3.T2.1.1.1.m1.2.2" xref="S3.T2.1.1.1.m1.2.2.cmml"><mrow id="S3.T2.1.1.1.m1.1.1.1.1" xref="S3.T2.1.1.1.m1.1.1.1.1.1.cmml"><mo id="S3.T2.1.1.1.m1.1.1.1.1.2" stretchy="false" xref="S3.T2.1.1.1.m1.1.1.1.1.1.cmml">(</mo><mrow id="S3.T2.1.1.1.m1.1.1.1.1.1" xref="S3.T2.1.1.1.m1.1.1.1.1.1.cmml"><mrow id="S3.T2.1.1.1.m1.1.1.1.1.1.2" xref="S3.T2.1.1.1.m1.1.1.1.1.1.2.cmml"><mi id="S3.T2.1.1.1.m1.1.1.1.1.1.2.2" xref="S3.T2.1.1.1.m1.1.1.1.1.1.2.2.cmml">P</mi><mo id="S3.T2.1.1.1.m1.1.1.1.1.1.2.1" xref="S3.T2.1.1.1.m1.1.1.1.1.1.2.1.cmml">⁢</mo><mi id="S3.T2.1.1.1.m1.1.1.1.1.1.2.3" xref="S3.T2.1.1.1.m1.1.1.1.1.1.2.3.cmml">P</mi></mrow><mo id="S3.T2.1.1.1.m1.1.1.1.1.1.1" xref="S3.T2.1.1.1.m1.1.1.1.1.1.1.cmml">−</mo><mn id="S3.T2.1.1.1.m1.1.1.1.1.1.3" xref="S3.T2.1.1.1.m1.1.1.1.1.1.3.cmml">1</mn></mrow><mo id="S3.T2.1.1.1.m1.1.1.1.1.3" stretchy="false" xref="S3.T2.1.1.1.m1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.T2.1.1.1.m1.2.2.3" xref="S3.T2.1.1.1.m1.2.2.3.cmml">⁢</mo><mrow id="S3.T2.1.1.1.m1.2.2.2.1" xref="S3.T2.1.1.1.m1.2.2.2.1.1.cmml"><mo id="S3.T2.1.1.1.m1.2.2.2.1.2" stretchy="false" xref="S3.T2.1.1.1.m1.2.2.2.1.1.cmml">(</mo><mrow id="S3.T2.1.1.1.m1.2.2.2.1.1" xref="S3.T2.1.1.1.m1.2.2.2.1.1.cmml"><mi id="S3.T2.1.1.1.m1.2.2.2.1.1.2" xref="S3.T2.1.1.1.m1.2.2.2.1.1.2.cmml">F</mi><mo id="S3.T2.1.1.1.m1.2.2.2.1.1.1" xref="S3.T2.1.1.1.m1.2.2.2.1.1.1.cmml">+</mo><mi id="S3.T2.1.1.1.m1.2.2.2.1.1.3" xref="S3.T2.1.1.1.m1.2.2.2.1.1.3.cmml">B</mi></mrow><mo id="S3.T2.1.1.1.m1.2.2.2.1.3" stretchy="false" xref="S3.T2.1.1.1.m1.2.2.2.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.1.1.1.m1.2b"><apply id="S3.T2.1.1.1.m1.2.2.cmml" xref="S3.T2.1.1.1.m1.2.2"><times id="S3.T2.1.1.1.m1.2.2.3.cmml" xref="S3.T2.1.1.1.m1.2.2.3"></times><apply id="S3.T2.1.1.1.m1.1.1.1.1.1.cmml" xref="S3.T2.1.1.1.m1.1.1.1.1"><minus id="S3.T2.1.1.1.m1.1.1.1.1.1.1.cmml" xref="S3.T2.1.1.1.m1.1.1.1.1.1.1"></minus><apply id="S3.T2.1.1.1.m1.1.1.1.1.1.2.cmml" xref="S3.T2.1.1.1.m1.1.1.1.1.1.2"><times id="S3.T2.1.1.1.m1.1.1.1.1.1.2.1.cmml" xref="S3.T2.1.1.1.m1.1.1.1.1.1.2.1"></times><ci id="S3.T2.1.1.1.m1.1.1.1.1.1.2.2.cmml" xref="S3.T2.1.1.1.m1.1.1.1.1.1.2.2">𝑃</ci><ci id="S3.T2.1.1.1.m1.1.1.1.1.1.2.3.cmml" xref="S3.T2.1.1.1.m1.1.1.1.1.1.2.3">𝑃</ci></apply><cn id="S3.T2.1.1.1.m1.1.1.1.1.1.3.cmml" type="integer" xref="S3.T2.1.1.1.m1.1.1.1.1.1.3">1</cn></apply><apply id="S3.T2.1.1.1.m1.2.2.2.1.1.cmml" xref="S3.T2.1.1.1.m1.2.2.2.1"><plus id="S3.T2.1.1.1.m1.2.2.2.1.1.1.cmml" xref="S3.T2.1.1.1.m1.2.2.2.1.1.1"></plus><ci id="S3.T2.1.1.1.m1.2.2.2.1.1.2.cmml" xref="S3.T2.1.1.1.m1.2.2.2.1.1.2">𝐹</ci><ci id="S3.T2.1.1.1.m1.2.2.2.1.1.3.cmml" xref="S3.T2.1.1.1.m1.2.2.2.1.1.3">𝐵</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.1.1.1.m1.2c">(PP-1)(F+B)</annotation><annotation encoding="application/x-llamapun" id="S3.T2.1.1.1.m1.2d">( italic_P italic_P - 1 ) ( italic_F + italic_B )</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.2.2.2" style="padding-left:15.0pt;padding-right:15.0pt;"><math alttext="1\times" class="ltx_math_unparsed" display="inline" id="S3.T2.2.2.2.m1.1"><semantics id="S3.T2.2.2.2.m1.1a"><mrow id="S3.T2.2.2.2.m1.1b"><mn id="S3.T2.2.2.2.m1.1.1">1</mn><mo id="S3.T2.2.2.2.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S3.T2.2.2.2.m1.1c">1\times</annotation><annotation encoding="application/x-llamapun" id="S3.T2.2.2.2.m1.1d">1 ×</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.3.3.3" style="padding-left:15.0pt;padding-right:15.0pt;"><math alttext="PP" class="ltx_Math" display="inline" id="S3.T2.3.3.3.m1.1"><semantics id="S3.T2.3.3.3.m1.1a"><mrow id="S3.T2.3.3.3.m1.1.1" xref="S3.T2.3.3.3.m1.1.1.cmml"><mi id="S3.T2.3.3.3.m1.1.1.2" xref="S3.T2.3.3.3.m1.1.1.2.cmml">P</mi><mo id="S3.T2.3.3.3.m1.1.1.1" xref="S3.T2.3.3.3.m1.1.1.1.cmml">⁢</mo><mi id="S3.T2.3.3.3.m1.1.1.3" xref="S3.T2.3.3.3.m1.1.1.3.cmml">P</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.3.3.3.m1.1b"><apply id="S3.T2.3.3.3.m1.1.1.cmml" xref="S3.T2.3.3.3.m1.1.1"><times id="S3.T2.3.3.3.m1.1.1.1.cmml" xref="S3.T2.3.3.3.m1.1.1.1"></times><ci id="S3.T2.3.3.3.m1.1.1.2.cmml" xref="S3.T2.3.3.3.m1.1.1.2">𝑃</ci><ci id="S3.T2.3.3.3.m1.1.1.3.cmml" xref="S3.T2.3.3.3.m1.1.1.3">𝑃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.3.3.3.m1.1c">PP</annotation><annotation encoding="application/x-llamapun" id="S3.T2.3.3.3.m1.1d">italic_P italic_P</annotation></semantics></math></td>
</tr>
<tr class="ltx_tr" id="S3.T2.6.6">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T2.6.6.4" style="padding-left:15.0pt;padding-right:15.0pt;">ZB1P</th>
<td class="ltx_td ltx_align_center" id="S3.T2.4.4.1" style="padding-left:15.0pt;padding-right:15.0pt;"><math alttext="(PP-1)(F+B-2W)" class="ltx_Math" display="inline" id="S3.T2.4.4.1.m1.2"><semantics id="S3.T2.4.4.1.m1.2a"><mrow id="S3.T2.4.4.1.m1.2.2" xref="S3.T2.4.4.1.m1.2.2.cmml"><mrow id="S3.T2.4.4.1.m1.1.1.1.1" xref="S3.T2.4.4.1.m1.1.1.1.1.1.cmml"><mo id="S3.T2.4.4.1.m1.1.1.1.1.2" stretchy="false" xref="S3.T2.4.4.1.m1.1.1.1.1.1.cmml">(</mo><mrow id="S3.T2.4.4.1.m1.1.1.1.1.1" xref="S3.T2.4.4.1.m1.1.1.1.1.1.cmml"><mrow id="S3.T2.4.4.1.m1.1.1.1.1.1.2" xref="S3.T2.4.4.1.m1.1.1.1.1.1.2.cmml"><mi id="S3.T2.4.4.1.m1.1.1.1.1.1.2.2" xref="S3.T2.4.4.1.m1.1.1.1.1.1.2.2.cmml">P</mi><mo id="S3.T2.4.4.1.m1.1.1.1.1.1.2.1" xref="S3.T2.4.4.1.m1.1.1.1.1.1.2.1.cmml">⁢</mo><mi id="S3.T2.4.4.1.m1.1.1.1.1.1.2.3" xref="S3.T2.4.4.1.m1.1.1.1.1.1.2.3.cmml">P</mi></mrow><mo id="S3.T2.4.4.1.m1.1.1.1.1.1.1" xref="S3.T2.4.4.1.m1.1.1.1.1.1.1.cmml">−</mo><mn id="S3.T2.4.4.1.m1.1.1.1.1.1.3" xref="S3.T2.4.4.1.m1.1.1.1.1.1.3.cmml">1</mn></mrow><mo id="S3.T2.4.4.1.m1.1.1.1.1.3" stretchy="false" xref="S3.T2.4.4.1.m1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.T2.4.4.1.m1.2.2.3" xref="S3.T2.4.4.1.m1.2.2.3.cmml">⁢</mo><mrow id="S3.T2.4.4.1.m1.2.2.2.1" xref="S3.T2.4.4.1.m1.2.2.2.1.1.cmml"><mo id="S3.T2.4.4.1.m1.2.2.2.1.2" stretchy="false" xref="S3.T2.4.4.1.m1.2.2.2.1.1.cmml">(</mo><mrow id="S3.T2.4.4.1.m1.2.2.2.1.1" xref="S3.T2.4.4.1.m1.2.2.2.1.1.cmml"><mrow id="S3.T2.4.4.1.m1.2.2.2.1.1.2" xref="S3.T2.4.4.1.m1.2.2.2.1.1.2.cmml"><mi id="S3.T2.4.4.1.m1.2.2.2.1.1.2.2" xref="S3.T2.4.4.1.m1.2.2.2.1.1.2.2.cmml">F</mi><mo id="S3.T2.4.4.1.m1.2.2.2.1.1.2.1" xref="S3.T2.4.4.1.m1.2.2.2.1.1.2.1.cmml">+</mo><mi id="S3.T2.4.4.1.m1.2.2.2.1.1.2.3" xref="S3.T2.4.4.1.m1.2.2.2.1.1.2.3.cmml">B</mi></mrow><mo id="S3.T2.4.4.1.m1.2.2.2.1.1.1" xref="S3.T2.4.4.1.m1.2.2.2.1.1.1.cmml">−</mo><mrow id="S3.T2.4.4.1.m1.2.2.2.1.1.3" xref="S3.T2.4.4.1.m1.2.2.2.1.1.3.cmml"><mn id="S3.T2.4.4.1.m1.2.2.2.1.1.3.2" xref="S3.T2.4.4.1.m1.2.2.2.1.1.3.2.cmml">2</mn><mo id="S3.T2.4.4.1.m1.2.2.2.1.1.3.1" xref="S3.T2.4.4.1.m1.2.2.2.1.1.3.1.cmml">⁢</mo><mi id="S3.T2.4.4.1.m1.2.2.2.1.1.3.3" xref="S3.T2.4.4.1.m1.2.2.2.1.1.3.3.cmml">W</mi></mrow></mrow><mo id="S3.T2.4.4.1.m1.2.2.2.1.3" stretchy="false" xref="S3.T2.4.4.1.m1.2.2.2.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.4.4.1.m1.2b"><apply id="S3.T2.4.4.1.m1.2.2.cmml" xref="S3.T2.4.4.1.m1.2.2"><times id="S3.T2.4.4.1.m1.2.2.3.cmml" xref="S3.T2.4.4.1.m1.2.2.3"></times><apply id="S3.T2.4.4.1.m1.1.1.1.1.1.cmml" xref="S3.T2.4.4.1.m1.1.1.1.1"><minus id="S3.T2.4.4.1.m1.1.1.1.1.1.1.cmml" xref="S3.T2.4.4.1.m1.1.1.1.1.1.1"></minus><apply id="S3.T2.4.4.1.m1.1.1.1.1.1.2.cmml" xref="S3.T2.4.4.1.m1.1.1.1.1.1.2"><times id="S3.T2.4.4.1.m1.1.1.1.1.1.2.1.cmml" xref="S3.T2.4.4.1.m1.1.1.1.1.1.2.1"></times><ci id="S3.T2.4.4.1.m1.1.1.1.1.1.2.2.cmml" xref="S3.T2.4.4.1.m1.1.1.1.1.1.2.2">𝑃</ci><ci id="S3.T2.4.4.1.m1.1.1.1.1.1.2.3.cmml" xref="S3.T2.4.4.1.m1.1.1.1.1.1.2.3">𝑃</ci></apply><cn id="S3.T2.4.4.1.m1.1.1.1.1.1.3.cmml" type="integer" xref="S3.T2.4.4.1.m1.1.1.1.1.1.3">1</cn></apply><apply id="S3.T2.4.4.1.m1.2.2.2.1.1.cmml" xref="S3.T2.4.4.1.m1.2.2.2.1"><minus id="S3.T2.4.4.1.m1.2.2.2.1.1.1.cmml" xref="S3.T2.4.4.1.m1.2.2.2.1.1.1"></minus><apply id="S3.T2.4.4.1.m1.2.2.2.1.1.2.cmml" xref="S3.T2.4.4.1.m1.2.2.2.1.1.2"><plus id="S3.T2.4.4.1.m1.2.2.2.1.1.2.1.cmml" xref="S3.T2.4.4.1.m1.2.2.2.1.1.2.1"></plus><ci id="S3.T2.4.4.1.m1.2.2.2.1.1.2.2.cmml" xref="S3.T2.4.4.1.m1.2.2.2.1.1.2.2">𝐹</ci><ci id="S3.T2.4.4.1.m1.2.2.2.1.1.2.3.cmml" xref="S3.T2.4.4.1.m1.2.2.2.1.1.2.3">𝐵</ci></apply><apply id="S3.T2.4.4.1.m1.2.2.2.1.1.3.cmml" xref="S3.T2.4.4.1.m1.2.2.2.1.1.3"><times id="S3.T2.4.4.1.m1.2.2.2.1.1.3.1.cmml" xref="S3.T2.4.4.1.m1.2.2.2.1.1.3.1"></times><cn id="S3.T2.4.4.1.m1.2.2.2.1.1.3.2.cmml" type="integer" xref="S3.T2.4.4.1.m1.2.2.2.1.1.3.2">2</cn><ci id="S3.T2.4.4.1.m1.2.2.2.1.1.3.3.cmml" xref="S3.T2.4.4.1.m1.2.2.2.1.1.3.3">𝑊</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.4.4.1.m1.2c">(PP-1)(F+B-2W)</annotation><annotation encoding="application/x-llamapun" id="S3.T2.4.4.1.m1.2d">( italic_P italic_P - 1 ) ( italic_F + italic_B - 2 italic_W )</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T2.5.5.2" style="padding-left:15.0pt;padding-right:15.0pt;"><math alttext="1\times" class="ltx_math_unparsed" display="inline" id="S3.T2.5.5.2.m1.1"><semantics id="S3.T2.5.5.2.m1.1a"><mrow id="S3.T2.5.5.2.m1.1b"><mn id="S3.T2.5.5.2.m1.1.1">1</mn><mo id="S3.T2.5.5.2.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S3.T2.5.5.2.m1.1c">1\times</annotation><annotation encoding="application/x-llamapun" id="S3.T2.5.5.2.m1.1d">1 ×</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T2.6.6.3" style="padding-left:15.0pt;padding-right:15.0pt;"><math alttext="PP" class="ltx_Math" display="inline" id="S3.T2.6.6.3.m1.1"><semantics id="S3.T2.6.6.3.m1.1a"><mrow id="S3.T2.6.6.3.m1.1.1" xref="S3.T2.6.6.3.m1.1.1.cmml"><mi id="S3.T2.6.6.3.m1.1.1.2" xref="S3.T2.6.6.3.m1.1.1.2.cmml">P</mi><mo id="S3.T2.6.6.3.m1.1.1.1" xref="S3.T2.6.6.3.m1.1.1.1.cmml">⁢</mo><mi id="S3.T2.6.6.3.m1.1.1.3" xref="S3.T2.6.6.3.m1.1.1.3.cmml">P</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.6.6.3.m1.1b"><apply id="S3.T2.6.6.3.m1.1.1.cmml" xref="S3.T2.6.6.3.m1.1.1"><times id="S3.T2.6.6.3.m1.1.1.1.cmml" xref="S3.T2.6.6.3.m1.1.1.1"></times><ci id="S3.T2.6.6.3.m1.1.1.2.cmml" xref="S3.T2.6.6.3.m1.1.1.2">𝑃</ci><ci id="S3.T2.6.6.3.m1.1.1.3.cmml" xref="S3.T2.6.6.3.m1.1.1.3">𝑃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.6.6.3.m1.1c">PP</annotation><annotation encoding="application/x-llamapun" id="S3.T2.6.6.3.m1.1d">italic_P italic_P</annotation></semantics></math></td>
</tr>
<tr class="ltx_tr" id="S3.T2.9.9">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb" id="S3.T2.9.9.4" style="padding-left:15.0pt;padding-right:15.0pt;">DualPipe (Ours)</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T2.7.7.1" style="padding-left:15.0pt;padding-right:15.0pt;"><math alttext="(\frac{PP}{2}-1)(F\&amp;B+B-3W)" class="ltx_Math" display="inline" id="S3.T2.7.7.1.m1.2"><semantics id="S3.T2.7.7.1.m1.2a"><mrow id="S3.T2.7.7.1.m1.2.2" xref="S3.T2.7.7.1.m1.2.2.cmml"><mrow id="S3.T2.7.7.1.m1.1.1.1.1" xref="S3.T2.7.7.1.m1.1.1.1.1.1.cmml"><mo id="S3.T2.7.7.1.m1.1.1.1.1.2" stretchy="false" xref="S3.T2.7.7.1.m1.1.1.1.1.1.cmml">(</mo><mrow id="S3.T2.7.7.1.m1.1.1.1.1.1" xref="S3.T2.7.7.1.m1.1.1.1.1.1.cmml"><mfrac id="S3.T2.7.7.1.m1.1.1.1.1.1.2" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2.cmml"><mrow id="S3.T2.7.7.1.m1.1.1.1.1.1.2.2" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.cmml"><mi id="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.2" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.2.cmml">P</mi><mo id="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.1" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.1.cmml">⁢</mo><mi id="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.3" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.3.cmml">P</mi></mrow><mn id="S3.T2.7.7.1.m1.1.1.1.1.1.2.3" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2.3.cmml">2</mn></mfrac><mo id="S3.T2.7.7.1.m1.1.1.1.1.1.1" xref="S3.T2.7.7.1.m1.1.1.1.1.1.1.cmml">−</mo><mn id="S3.T2.7.7.1.m1.1.1.1.1.1.3" xref="S3.T2.7.7.1.m1.1.1.1.1.1.3.cmml">1</mn></mrow><mo id="S3.T2.7.7.1.m1.1.1.1.1.3" stretchy="false" xref="S3.T2.7.7.1.m1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.T2.7.7.1.m1.2.2.3" xref="S3.T2.7.7.1.m1.2.2.3.cmml">⁢</mo><mrow id="S3.T2.7.7.1.m1.2.2.2.1" xref="S3.T2.7.7.1.m1.2.2.2.1.1.cmml"><mo id="S3.T2.7.7.1.m1.2.2.2.1.2" stretchy="false" xref="S3.T2.7.7.1.m1.2.2.2.1.1.cmml">(</mo><mrow id="S3.T2.7.7.1.m1.2.2.2.1.1" xref="S3.T2.7.7.1.m1.2.2.2.1.1.cmml"><mrow id="S3.T2.7.7.1.m1.2.2.2.1.1.2" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.cmml"><mrow id="S3.T2.7.7.1.m1.2.2.2.1.1.2.2" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.cmml"><mi id="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.2" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.2.cmml">F</mi><mo id="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.1" lspace="0.222em" rspace="0.222em" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.1.cmml">&amp;</mo><mi id="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.3" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.3.cmml">B</mi></mrow><mo id="S3.T2.7.7.1.m1.2.2.2.1.1.2.1" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.1.cmml">+</mo><mi id="S3.T2.7.7.1.m1.2.2.2.1.1.2.3" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.3.cmml">B</mi></mrow><mo id="S3.T2.7.7.1.m1.2.2.2.1.1.1" xref="S3.T2.7.7.1.m1.2.2.2.1.1.1.cmml">−</mo><mrow id="S3.T2.7.7.1.m1.2.2.2.1.1.3" xref="S3.T2.7.7.1.m1.2.2.2.1.1.3.cmml"><mn id="S3.T2.7.7.1.m1.2.2.2.1.1.3.2" xref="S3.T2.7.7.1.m1.2.2.2.1.1.3.2.cmml">3</mn><mo id="S3.T2.7.7.1.m1.2.2.2.1.1.3.1" xref="S3.T2.7.7.1.m1.2.2.2.1.1.3.1.cmml">⁢</mo><mi id="S3.T2.7.7.1.m1.2.2.2.1.1.3.3" xref="S3.T2.7.7.1.m1.2.2.2.1.1.3.3.cmml">W</mi></mrow></mrow><mo id="S3.T2.7.7.1.m1.2.2.2.1.3" stretchy="false" xref="S3.T2.7.7.1.m1.2.2.2.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.7.7.1.m1.2b"><apply id="S3.T2.7.7.1.m1.2.2.cmml" xref="S3.T2.7.7.1.m1.2.2"><times id="S3.T2.7.7.1.m1.2.2.3.cmml" xref="S3.T2.7.7.1.m1.2.2.3"></times><apply id="S3.T2.7.7.1.m1.1.1.1.1.1.cmml" xref="S3.T2.7.7.1.m1.1.1.1.1"><minus id="S3.T2.7.7.1.m1.1.1.1.1.1.1.cmml" xref="S3.T2.7.7.1.m1.1.1.1.1.1.1"></minus><apply id="S3.T2.7.7.1.m1.1.1.1.1.1.2.cmml" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2"><divide id="S3.T2.7.7.1.m1.1.1.1.1.1.2.1.cmml" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2"></divide><apply id="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.cmml" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2.2"><times id="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.1.cmml" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.1"></times><ci id="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.2.cmml" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.2">𝑃</ci><ci id="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.3.cmml" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2.2.3">𝑃</ci></apply><cn id="S3.T2.7.7.1.m1.1.1.1.1.1.2.3.cmml" type="integer" xref="S3.T2.7.7.1.m1.1.1.1.1.1.2.3">2</cn></apply><cn id="S3.T2.7.7.1.m1.1.1.1.1.1.3.cmml" type="integer" xref="S3.T2.7.7.1.m1.1.1.1.1.1.3">1</cn></apply><apply id="S3.T2.7.7.1.m1.2.2.2.1.1.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1"><minus id="S3.T2.7.7.1.m1.2.2.2.1.1.1.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1.1.1"></minus><apply id="S3.T2.7.7.1.m1.2.2.2.1.1.2.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2"><plus id="S3.T2.7.7.1.m1.2.2.2.1.1.2.1.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.1"></plus><apply id="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.2"><and id="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.1.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.1"></and><ci id="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.2.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.2">𝐹</ci><ci id="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.3.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.2.3">𝐵</ci></apply><ci id="S3.T2.7.7.1.m1.2.2.2.1.1.2.3.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1.1.2.3">𝐵</ci></apply><apply id="S3.T2.7.7.1.m1.2.2.2.1.1.3.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1.1.3"><times id="S3.T2.7.7.1.m1.2.2.2.1.1.3.1.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1.1.3.1"></times><cn id="S3.T2.7.7.1.m1.2.2.2.1.1.3.2.cmml" type="integer" xref="S3.T2.7.7.1.m1.2.2.2.1.1.3.2">3</cn><ci id="S3.T2.7.7.1.m1.2.2.2.1.1.3.3.cmml" xref="S3.T2.7.7.1.m1.2.2.2.1.1.3.3">𝑊</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.7.7.1.m1.2c">(\frac{PP}{2}-1)(F\&amp;B+B-3W)</annotation><annotation encoding="application/x-llamapun" id="S3.T2.7.7.1.m1.2d">( divide start_ARG italic_P italic_P end_ARG start_ARG 2 end_ARG - 1 ) ( italic_F &amp; italic_B + italic_B - 3 italic_W )</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T2.8.8.2" style="padding-left:15.0pt;padding-right:15.0pt;"><math alttext="2\times" class="ltx_math_unparsed" display="inline" id="S3.T2.8.8.2.m1.1"><semantics id="S3.T2.8.8.2.m1.1a"><mrow id="S3.T2.8.8.2.m1.1b"><mn id="S3.T2.8.8.2.m1.1.1">2</mn><mo id="S3.T2.8.8.2.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S3.T2.8.8.2.m1.1c">2\times</annotation><annotation encoding="application/x-llamapun" id="S3.T2.8.8.2.m1.1d">2 ×</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S3.T2.9.9.3" style="padding-left:15.0pt;padding-right:15.0pt;"><math alttext="PP+1" class="ltx_Math" display="inline" id="S3.T2.9.9.3.m1.1"><semantics id="S3.T2.9.9.3.m1.1a"><mrow id="S3.T2.9.9.3.m1.1.1" xref="S3.T2.9.9.3.m1.1.1.cmml"><mrow id="S3.T2.9.9.3.m1.1.1.2" xref="S3.T2.9.9.3.m1.1.1.2.cmml"><mi id="S3.T2.9.9.3.m1.1.1.2.2" xref="S3.T2.9.9.3.m1.1.1.2.2.cmml">P</mi><mo id="S3.T2.9.9.3.m1.1.1.2.1" xref="S3.T2.9.9.3.m1.1.1.2.1.cmml">⁢</mo><mi id="S3.T2.9.9.3.m1.1.1.2.3" xref="S3.T2.9.9.3.m1.1.1.2.3.cmml">P</mi></mrow><mo id="S3.T2.9.9.3.m1.1.1.1" xref="S3.T2.9.9.3.m1.1.1.1.cmml">+</mo><mn id="S3.T2.9.9.3.m1.1.1.3" xref="S3.T2.9.9.3.m1.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.9.9.3.m1.1b"><apply id="S3.T2.9.9.3.m1.1.1.cmml" xref="S3.T2.9.9.3.m1.1.1"><plus id="S3.T2.9.9.3.m1.1.1.1.cmml" xref="S3.T2.9.9.3.m1.1.1.1"></plus><apply id="S3.T2.9.9.3.m1.1.1.2.cmml" xref="S3.T2.9.9.3.m1.1.1.2"><times id="S3.T2.9.9.3.m1.1.1.2.1.cmml" xref="S3.T2.9.9.3.m1.1.1.2.1"></times><ci id="S3.T2.9.9.3.m1.1.1.2.2.cmml" xref="S3.T2.9.9.3.m1.1.1.2.2">𝑃</ci><ci id="S3.T2.9.9.3.m1.1.1.2.3.cmml" xref="S3.T2.9.9.3.m1.1.1.2.3">𝑃</ci></apply><cn id="S3.T2.9.9.3.m1.1.1.3.cmml" type="integer" xref="S3.T2.9.9.3.m1.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.9.9.3.m1.1c">PP+1</annotation><annotation encoding="application/x-llamapun" id="S3.T2.9.9.3.m1.1d">italic_P italic_P + 1</annotation></semantics></math></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 2: </span>
Comparison of pipeline bubbles and memory usage across different pipeline parallel methods. <math alttext="F" class="ltx_Math" display="inline" id="S3.T2.14.m1.1"><semantics id="S3.T2.14.m1.1b"><mi id="S3.T2.14.m1.1.1" xref="S3.T2.14.m1.1.1.cmml">F</mi><annotation-xml encoding="MathML-Content" id="S3.T2.14.m1.1c"><ci id="S3.T2.14.m1.1.1.cmml" xref="S3.T2.14.m1.1.1">𝐹</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.14.m1.1d">F</annotation><annotation encoding="application/x-llamapun" id="S3.T2.14.m1.1e">italic_F</annotation></semantics></math> denotes the execution time of a forward chunk, <math alttext="B" class="ltx_Math" display="inline" id="S3.T2.15.m2.1"><semantics id="S3.T2.15.m2.1b"><mi id="S3.T2.15.m2.1.1" xref="S3.T2.15.m2.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S3.T2.15.m2.1c"><ci id="S3.T2.15.m2.1.1.cmml" xref="S3.T2.15.m2.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.15.m2.1d">B</annotation><annotation encoding="application/x-llamapun" id="S3.T2.15.m2.1e">italic_B</annotation></semantics></math> denotes the execution time of a full backward chunk, <math alttext="W" class="ltx_Math" display="inline" id="S3.T2.16.m3.1"><semantics id="S3.T2.16.m3.1b"><mi id="S3.T2.16.m3.1.1" xref="S3.T2.16.m3.1.1.cmml">W</mi><annotation-xml encoding="MathML-Content" id="S3.T2.16.m3.1c"><ci id="S3.T2.16.m3.1.1.cmml" xref="S3.T2.16.m3.1.1">𝑊</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.16.m3.1d">W</annotation><annotation encoding="application/x-llamapun" id="S3.T2.16.m3.1e">italic_W</annotation></semantics></math> denotes the execution time of a "backward for weights" chunk, and <math alttext="F\&amp;B" class="ltx_Math" display="inline" id="S3.T2.17.m4.1"><semantics id="S3.T2.17.m4.1b"><mrow id="S3.T2.17.m4.1.1" xref="S3.T2.17.m4.1.1.cmml"><mi id="S3.T2.17.m4.1.1.2" xref="S3.T2.17.m4.1.1.2.cmml">F</mi><mo id="S3.T2.17.m4.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.T2.17.m4.1.1.1.cmml">&amp;</mo><mi id="S3.T2.17.m4.1.1.3" xref="S3.T2.17.m4.1.1.3.cmml">B</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.17.m4.1c"><apply id="S3.T2.17.m4.1.1.cmml" xref="S3.T2.17.m4.1.1"><and id="S3.T2.17.m4.1.1.1.cmml" xref="S3.T2.17.m4.1.1.1"></and><ci id="S3.T2.17.m4.1.1.2.cmml" xref="S3.T2.17.m4.1.1.2">𝐹</ci><ci id="S3.T2.17.m4.1.1.3.cmml" xref="S3.T2.17.m4.1.1.3">𝐵</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.17.m4.1d">F\&amp;B</annotation><annotation encoding="application/x-llamapun" id="S3.T2.17.m4.1e">italic_F &amp; italic_B</annotation></semantics></math> denotes the execution time of two mutually overlapped forward and backward chunks.
</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S3.SS2.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.2.2 </span>Efficient Implementation of Cross-Node All-to-All Communication</h4>
<div class="ltx_para" id="S3.SS2.SSS2.p1">
<p class="ltx_p" id="S3.SS2.SSS2.p1.1">In order to ensure sufficient computational performance for DualPipe, we customize efficient cross-node all-to-all communication kernels (including dispatching and combining) to conserve the number of SMs dedicated to communication.
The implementation of the kernels is co-designed with the MoE gating algorithm and the network topology of our cluster.
To be specific, in our cluster, cross-node GPUs are fully interconnected with IB, and intra-node communications are handled via NVLink.
NVLink offers a bandwidth of 160 GB/s, roughly 3.2 times that of IB (50 GB/s).
To effectively leverage the different bandwidths of IB and NVLink, we limit each token to be dispatched to at most 4 nodes, thereby reducing IB traffic.
For each token, when its routing decision is made, it will first be transmitted via IB to the GPUs with the same in-node index on its target nodes.
Once it reaches the target nodes, we will endeavor to ensure that it is instantaneously forwarded via NVLink to specific GPUs that host their target experts, without being blocked by subsequently arriving tokens.
In this way, communications via IB and NVLink are fully overlapped, and each token can efficiently select an average of 3.2 experts per node without incurring additional overhead from NVLink.
This implies that, although DeepSeek-V3 selects only 8 routed experts in practice, it can scale up this number to a maximum of 13 experts (4 nodes <math alttext="\times" class="ltx_Math" display="inline" id="S3.SS2.SSS2.p1.1.m1.1"><semantics id="S3.SS2.SSS2.p1.1.m1.1a"><mo id="S3.SS2.SSS2.p1.1.m1.1.1" xref="S3.SS2.SSS2.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.SS2.SSS2.p1.1.m1.1b"><times id="S3.SS2.SSS2.p1.1.m1.1.1.cmml" xref="S3.SS2.SSS2.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.SSS2.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.SSS2.p1.1.m1.1d">×</annotation></semantics></math> 3.2 experts/node) while preserving the same communication cost.
Overall, under such a communication strategy, only 20 SMs are sufficient to fully utilize the bandwidths of IB and NVLink.</p>
</div>
<div class="ltx_para" id="S3.SS2.SSS2.p2">
<p class="ltx_p" id="S3.SS2.SSS2.p2.1">In detail, we employ the warp specialization technique <cite class="ltx_cite ltx_citemacro_citep">(Bauer et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib7" title="">2014</a>)</cite> and partition 20 SMs into 10 communication channels.
During the dispatching process, (1) IB sending, (2) IB-to-NVLink forwarding, and (3) NVLink receiving are handled by respective warps.
The number of warps allocated to each communication task is dynamically adjusted according to the actual workload across all SMs.
Similarly, during the combining process, (1) NVLink sending, (2) NVLink-to-IB forwarding and accumulation, and (3) IB receiving and accumulation are also handled by dynamically adjusted warps.
In addition, both dispatching and combining kernels overlap with the computation stream, so we also consider their impact on other SM computation kernels.
Specifically, we employ customized PTX (Parallel Thread Execution) instructions and auto-tune the communication chunk size, which significantly reduces the use of the L2 cache and the interference to other SMs.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S3.SS2.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.2.3 </span>Extremely Memory Saving with Minimal Overhead</h4>
<div class="ltx_para" id="S3.SS2.SSS3.p1">
<p class="ltx_p" id="S3.SS2.SSS3.p1.1">In order to reduce the memory footprint during training, we employ the following techniques.</p>
</div>
<section class="ltx_paragraph" id="S3.SS2.SSS3.Px1">
<h5 class="ltx_title ltx_title_paragraph">Recomputation of RMSNorm and MLA Up-Projection.</h5>
<div class="ltx_para" id="S3.SS2.SSS3.Px1.p1">
<p class="ltx_p" id="S3.SS2.SSS3.Px1.p1.1">We recompute all RMSNorm operations and MLA up-projections during back-propagation, thereby eliminating the need to persistently store their output activations.
With a minor overhead, this strategy significantly reduces memory requirements for storing activations.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS2.SSS3.Px2">
<h5 class="ltx_title ltx_title_paragraph">Exponential Moving Average in CPU.</h5>
<div class="ltx_para" id="S3.SS2.SSS3.Px2.p1">
<p class="ltx_p" id="S3.SS2.SSS3.Px2.p1.1">During training, we preserve the Exponential Moving Average (EMA) of the model parameters for early estimation of the model performance after learning rate decay.
The EMA parameters are stored in CPU memory and are updated asynchronously after each training step.
This method allows us to maintain EMA parameters without incurring additional memory or time overhead.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS2.SSS3.Px3">
<h5 class="ltx_title ltx_title_paragraph">Shared Embedding and Output Head for Multi-Token Prediction.</h5>
<div class="ltx_para" id="S3.SS2.SSS3.Px3.p1">
<p class="ltx_p" id="S3.SS2.SSS3.Px3.p1.1">With the DualPipe strategy, we deploy the shallowest layers (including the embedding layer) and deepest layers (including the output head) of the model on the same PP rank.
This arrangement enables the physical sharing of parameters and gradients, of the shared embedding and output head, between the MTP module and the main model.
This physical sharing mechanism further enhances our memory efficiency.</p>
</div>
</section>
</section>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3 </span>FP8 Training</h3>
<figure class="ltx_figure" id="S3.F6"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="237" id="S3.F6.g1" src="x6.png" width="822"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 6: </span>
The overall mixed precision framework with FP8 data format. For clarification, only the <span class="ltx_text ltx_font_typewriter" id="S3.F6.2.1">Linear</span> operator is illustrated.
</figcaption>
</figure>
<div class="ltx_para" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.2">Inspired by recent advances in low-precision training <cite class="ltx_cite ltx_citemacro_citep">(Peng et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib69" title="">2023b</a>; Dettmers et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib17" title="">2022</a>; Noune et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib60" title="">2022</a>)</cite>, we propose a fine-grained mixed precision framework utilizing the FP8 data format for training DeepSeek-V3.
While low-precision training holds great promise, it is often limited by the presence of outliers in activations, weights, and gradients <cite class="ltx_cite ltx_citemacro_citep">(Sun et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib86" title="">2024</a>; <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib32" title="">He et al., </a>; Fishman et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib22" title="">2024</a>)</cite>.
Although significant progress has been made in inference quantization <cite class="ltx_cite ltx_citemacro_citep">(Xiao et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib100" title="">2023</a>; Frantar et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib23" title="">2022</a>)</cite>, there are relatively few studies demonstrating successful application of low-precision techniques in large-scale language model pre-training <cite class="ltx_cite ltx_citemacro_citep">(Fishman et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib22" title="">2024</a>)</cite>.
To address this challenge and effectively extend the dynamic range of the FP8 format, we introduce a fine-grained quantization strategy: tile-wise grouping with <math alttext="1\times N_{c}" class="ltx_Math" display="inline" id="S3.SS3.p1.1.m1.1"><semantics id="S3.SS3.p1.1.m1.1a"><mrow id="S3.SS3.p1.1.m1.1.1" xref="S3.SS3.p1.1.m1.1.1.cmml"><mn id="S3.SS3.p1.1.m1.1.1.2" xref="S3.SS3.p1.1.m1.1.1.2.cmml">1</mn><mo id="S3.SS3.p1.1.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p1.1.m1.1.1.1.cmml">×</mo><msub id="S3.SS3.p1.1.m1.1.1.3" xref="S3.SS3.p1.1.m1.1.1.3.cmml"><mi id="S3.SS3.p1.1.m1.1.1.3.2" xref="S3.SS3.p1.1.m1.1.1.3.2.cmml">N</mi><mi id="S3.SS3.p1.1.m1.1.1.3.3" xref="S3.SS3.p1.1.m1.1.1.3.3.cmml">c</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.1.m1.1b"><apply id="S3.SS3.p1.1.m1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1"><times id="S3.SS3.p1.1.m1.1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1.1"></times><cn id="S3.SS3.p1.1.m1.1.1.2.cmml" type="integer" xref="S3.SS3.p1.1.m1.1.1.2">1</cn><apply id="S3.SS3.p1.1.m1.1.1.3.cmml" xref="S3.SS3.p1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p1.1.m1.1.1.3.1.cmml" xref="S3.SS3.p1.1.m1.1.1.3">subscript</csymbol><ci id="S3.SS3.p1.1.m1.1.1.3.2.cmml" xref="S3.SS3.p1.1.m1.1.1.3.2">𝑁</ci><ci id="S3.SS3.p1.1.m1.1.1.3.3.cmml" xref="S3.SS3.p1.1.m1.1.1.3.3">𝑐</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.1.m1.1c">1\times N_{c}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.1.m1.1d">1 × italic_N start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT</annotation></semantics></math> elements or block-wise grouping with <math alttext="N_{c}\times N_{c}" class="ltx_Math" display="inline" id="S3.SS3.p1.2.m2.1"><semantics id="S3.SS3.p1.2.m2.1a"><mrow id="S3.SS3.p1.2.m2.1.1" xref="S3.SS3.p1.2.m2.1.1.cmml"><msub id="S3.SS3.p1.2.m2.1.1.2" xref="S3.SS3.p1.2.m2.1.1.2.cmml"><mi id="S3.SS3.p1.2.m2.1.1.2.2" xref="S3.SS3.p1.2.m2.1.1.2.2.cmml">N</mi><mi id="S3.SS3.p1.2.m2.1.1.2.3" xref="S3.SS3.p1.2.m2.1.1.2.3.cmml">c</mi></msub><mo id="S3.SS3.p1.2.m2.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS3.p1.2.m2.1.1.1.cmml">×</mo><msub id="S3.SS3.p1.2.m2.1.1.3" xref="S3.SS3.p1.2.m2.1.1.3.cmml"><mi id="S3.SS3.p1.2.m2.1.1.3.2" xref="S3.SS3.p1.2.m2.1.1.3.2.cmml">N</mi><mi id="S3.SS3.p1.2.m2.1.1.3.3" xref="S3.SS3.p1.2.m2.1.1.3.3.cmml">c</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.2.m2.1b"><apply id="S3.SS3.p1.2.m2.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1"><times id="S3.SS3.p1.2.m2.1.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1.1"></times><apply id="S3.SS3.p1.2.m2.1.1.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.2.1.cmml" xref="S3.SS3.p1.2.m2.1.1.2">subscript</csymbol><ci id="S3.SS3.p1.2.m2.1.1.2.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2.2">𝑁</ci><ci id="S3.SS3.p1.2.m2.1.1.2.3.cmml" xref="S3.SS3.p1.2.m2.1.1.2.3">𝑐</ci></apply><apply id="S3.SS3.p1.2.m2.1.1.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.3.1.cmml" xref="S3.SS3.p1.2.m2.1.1.3">subscript</csymbol><ci id="S3.SS3.p1.2.m2.1.1.3.2.cmml" xref="S3.SS3.p1.2.m2.1.1.3.2">𝑁</ci><ci id="S3.SS3.p1.2.m2.1.1.3.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3.3">𝑐</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.2.m2.1c">N_{c}\times N_{c}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.2.m2.1d">italic_N start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT × italic_N start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT</annotation></semantics></math> elements.
The associated dequantization overhead is largely mitigated under our increased-precision accumulation process, a critical aspect for achieving accurate FP8 General Matrix Multiplication (GEMM).
Moreover, to further reduce memory and communication overhead in MoE training, we cache and dispatch activations in FP8, while storing low-precision optimizer states in BF16.
We validate the proposed FP8 mixed precision framework on two model scales similar to DeepSeek-V2-Lite and DeepSeek-V2, training for approximately 1 trillion tokens (see more details in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A2.SS1" title="B.1 FP8 v.s. BF16 Training ‣ Appendix B Ablation Studies for Low-Precision Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">B.1</span></a>).
Notably, compared with the BF16 baseline, the relative loss error of our FP8-training model remains consistently below 0.25%, a level well within the acceptable range of training randomness.</p>
</div>
<section class="ltx_subsubsection" id="S3.SS3.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.3.1 </span>Mixed Precision Framework</h4>
<div class="ltx_para" id="S3.SS3.SSS1.p1">
<p class="ltx_p" id="S3.SS3.SSS1.p1.1">Building upon widely adopted techniques in low-precision training <cite class="ltx_cite ltx_citemacro_citep">(Kalamkar et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib40" title="">2019</a>; Narang et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib59" title="">2017</a>)</cite>, we propose a mixed precision framework for FP8 training.
In this framework, most compute-density operations are conducted in FP8, while a few key operations are strategically maintained in their original data formats to balance training efficiency and numerical stability.
The overall framework is illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.F6" title="Figure 6 ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">6</span></a>.</p>
</div>
<div class="ltx_para" id="S3.SS3.SSS1.p2">
<p class="ltx_p" id="S3.SS3.SSS1.p2.1">Firstly, in order to accelerate model training, the majority of core computation kernels, i.e., GEMM operations, are implemented in FP8 precision.
These GEMM operations accept FP8 tensors as inputs and produce outputs in BF16 or FP32.
As depicted in Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.F6" title="Figure 6 ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">6</span></a>, all three GEMMs associated with the <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS1.p2.1.1">Linear</span> operator, namely <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS1.p2.1.2">Fprop</span> (forward pass), <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS1.p2.1.3">Dgrad</span> (activation backward pass), and <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS1.p2.1.4">Wgrad</span> (weight backward pass), are executed in FP8.
This design theoretically doubles the computational speed compared with the original BF16 method.
Additionally, the FP8 <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS1.p2.1.5">Wgrad</span> GEMM allows activations to be stored in FP8 for use in the backward pass.
This significantly reduces memory consumption.</p>
</div>
<div class="ltx_para" id="S3.SS3.SSS1.p3">
<p class="ltx_p" id="S3.SS3.SSS1.p3.1">Despite the efficiency advantage of the FP8 format, certain operators still require a higher precision due to their sensitivity to low-precision computations.
Besides, some low-cost operators can also utilize a higher precision with a negligible overhead to the overall training cost.
For this reason, after careful investigations, we maintain the original precision (e.g., BF16 or FP32) for the following components: the embedding module, the output head, MoE gating modules, normalization operators, and attention operators.
These targeted retentions of high precision ensure stable training dynamics for DeepSeek-V3.
To further guarantee numerical stability, we store the master weights, weight gradients, and optimizer states in higher precision.
While these high-precision components incur some memory overheads, their impact can be minimized through efficient sharding across multiple DP ranks in our distributed training system.</p>
</div>
<figure class="ltx_figure" id="S3.F7"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="400" id="S3.F7.g1" src="x7.png" width="788"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 7: </span>
(a) We propose a fine-grained quantization method to mitigate quantization errors caused by feature outliers; for illustration simplicity, only <span class="ltx_text ltx_font_typewriter" id="S3.F7.4.1">Fprop</span> is illustrated.
(b) In conjunction with our quantization strategy, we improve the FP8 GEMM precision by promoting to CUDA Cores at an interval of <math alttext="N_{C}=128" class="ltx_Math" display="inline" id="S3.F7.2.m1.1"><semantics id="S3.F7.2.m1.1b"><mrow id="S3.F7.2.m1.1.1" xref="S3.F7.2.m1.1.1.cmml"><msub id="S3.F7.2.m1.1.1.2" xref="S3.F7.2.m1.1.1.2.cmml"><mi id="S3.F7.2.m1.1.1.2.2" xref="S3.F7.2.m1.1.1.2.2.cmml">N</mi><mi id="S3.F7.2.m1.1.1.2.3" xref="S3.F7.2.m1.1.1.2.3.cmml">C</mi></msub><mo id="S3.F7.2.m1.1.1.1" xref="S3.F7.2.m1.1.1.1.cmml">=</mo><mn id="S3.F7.2.m1.1.1.3" xref="S3.F7.2.m1.1.1.3.cmml">128</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.F7.2.m1.1c"><apply id="S3.F7.2.m1.1.1.cmml" xref="S3.F7.2.m1.1.1"><eq id="S3.F7.2.m1.1.1.1.cmml" xref="S3.F7.2.m1.1.1.1"></eq><apply id="S3.F7.2.m1.1.1.2.cmml" xref="S3.F7.2.m1.1.1.2"><csymbol cd="ambiguous" id="S3.F7.2.m1.1.1.2.1.cmml" xref="S3.F7.2.m1.1.1.2">subscript</csymbol><ci id="S3.F7.2.m1.1.1.2.2.cmml" xref="S3.F7.2.m1.1.1.2.2">𝑁</ci><ci id="S3.F7.2.m1.1.1.2.3.cmml" xref="S3.F7.2.m1.1.1.2.3">𝐶</ci></apply><cn id="S3.F7.2.m1.1.1.3.cmml" type="integer" xref="S3.F7.2.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F7.2.m1.1d">N_{C}=128</annotation><annotation encoding="application/x-llamapun" id="S3.F7.2.m1.1e">italic_N start_POSTSUBSCRIPT italic_C end_POSTSUBSCRIPT = 128</annotation></semantics></math> elements MMA for the high-precision accumulation.
</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S3.SS3.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.3.2 </span>Improved Precision from Quantization and Multiplication</h4>
<div class="ltx_para" id="S3.SS3.SSS2.p1">
<p class="ltx_p" id="S3.SS3.SSS2.p1.1">Based on our mixed precision FP8 framework, we introduce several strategies to enhance low-precision training accuracy, focusing on both the quantization method and the multiplication process.</p>
</div>
<section class="ltx_paragraph" id="S3.SS3.SSS2.Px1">
<h5 class="ltx_title ltx_title_paragraph">Fine-Grained Quantization.</h5>
<div class="ltx_para" id="S3.SS3.SSS2.Px1.p1">
<p class="ltx_p" id="S3.SS3.SSS2.Px1.p1.1">In low-precision training frameworks, overflows and underflows are common challenges due to the limited dynamic range of the FP8 format, which is constrained by its reduced exponent bits.
As a standard practice, the input distribution is aligned to the representable range of the FP8 format by scaling the maximum absolute value of the input tensor to the maximum representable value of FP8 <cite class="ltx_cite ltx_citemacro_citep">(Narang et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib59" title="">2017</a>)</cite>.
This method makes low-precision training highly sensitive to activation outliers, which can heavily degrade quantization accuracy.
To solve this, we propose a fine-grained quantization method that applies scaling at a more granular level.
As illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.F7" title="Figure 7 ‣ 3.3.1 Mixed Precision Framework ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">7</span></a> (a), (1) for activations, we group and scale elements on a <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px1.p1.1.1">1x128</span> tile basis (i.e., per token per 128 channels); and (2) for weights, we group and scale elements on a <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px1.p1.1.2">128x128</span> block basis (i.e., per 128 input channels per 128 output channels).
This approach ensures that the quantization process can better accommodate outliers by adapting the scale according to smaller groups of elements.
In Appendix <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A2.SS2" title="B.2 Discussion About Block-Wise Quantization ‣ Appendix B Ablation Studies for Low-Precision Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">B.2</span></a>, we further discuss the training instability when we group and scale activations on a block basis in the same way as weights quantization.</p>
</div>
<div class="ltx_para" id="S3.SS3.SSS2.Px1.p2">
<p class="ltx_p" id="S3.SS3.SSS2.Px1.p2.1">One key modification in our method is the introduction of per-group scaling factors along the inner dimension of GEMM operations.
This functionality is not directly supported in the standard FP8 GEMM.
However, combined with our precise FP32 accumulation strategy, it can be efficiently implemented.</p>
</div>
<div class="ltx_para" id="S3.SS3.SSS2.Px1.p3">
<p class="ltx_p" id="S3.SS3.SSS2.Px1.p3.1">Notably, our fine-grained quantization strategy is highly consistent with the idea of microscaling formats <cite class="ltx_cite ltx_citemacro_citep">(Rouhani et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib78" title="">2023b</a>)</cite>, while the Tensor Cores of NVIDIA next-generation GPUs (Blackwell series) have announced the support for microscaling formats with smaller quantization granularity <cite class="ltx_cite ltx_citemacro_citep">(NVIDIA, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib62" title="">2024a</a>)</cite>.
We hope our design can serve as a reference for future work to keep pace with the latest GPU architectures.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS3.SSS2.Px2">
<h5 class="ltx_title ltx_title_paragraph">Increasing Accumulation Precision.</h5>
<div class="ltx_para" id="S3.SS3.SSS2.Px2.p1">
<p class="ltx_p" id="S3.SS3.SSS2.Px2.p1.1">Low-precision GEMM operations often suffer from underflow issues, and their accuracy largely depends on high-precision accumulation, which is commonly performed in an FP32 precision <cite class="ltx_cite ltx_citemacro_citep">(Kalamkar et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib40" title="">2019</a>; Narang et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib59" title="">2017</a>)</cite>.
However, we observe that the accumulation precision of FP8 GEMM on NVIDIA H800 GPUs is limited to retaining around 14 bits, which is significantly lower than FP32 accumulation precision.
This problem will become more pronounced when the inner dimension <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px2.p1.1.1">K</span> is large <cite class="ltx_cite ltx_citemacro_citep">(Wortsman et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib96" title="">2023</a>)</cite>, a typical scenario in large-scale model training where the batch size and model width are increased.
Taking GEMM operations of two random matrices with <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px2.p1.1.2">K</span> = 4096 for example, in our preliminary test, the limited accumulation precision in Tensor Cores results in a maximum relative error of nearly 2%.
Despite these problems, the limited accumulation precision is still the default option in a few FP8 frameworks <cite class="ltx_cite ltx_citemacro_citep">(NVIDIA, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib63" title="">2024b</a>)</cite>, severely constraining the training accuracy.</p>
</div>
<div class="ltx_para" id="S3.SS3.SSS2.Px2.p2">
<p class="ltx_p" id="S3.SS3.SSS2.Px2.p2.1">In order to address this issue, we adopt the strategy of promotion to CUDA Cores for higher precision <cite class="ltx_cite ltx_citemacro_citep">(Thakkar et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib89" title="">2023</a>)</cite>.
The process is illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.F7" title="Figure 7 ‣ 3.3.1 Mixed Precision Framework ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">7</span></a> (b).
To be specific, during MMA (Matrix Multiply-Accumulate) execution on Tensor Cores, intermediate results are accumulated using the limited bit width.
Once an interval of <math alttext="N_{C}" class="ltx_Math" display="inline" id="S3.SS3.SSS2.Px2.p2.1.m1.1"><semantics id="S3.SS3.SSS2.Px2.p2.1.m1.1a"><msub id="S3.SS3.SSS2.Px2.p2.1.m1.1.1" xref="S3.SS3.SSS2.Px2.p2.1.m1.1.1.cmml"><mi id="S3.SS3.SSS2.Px2.p2.1.m1.1.1.2" xref="S3.SS3.SSS2.Px2.p2.1.m1.1.1.2.cmml">N</mi><mi id="S3.SS3.SSS2.Px2.p2.1.m1.1.1.3" xref="S3.SS3.SSS2.Px2.p2.1.m1.1.1.3.cmml">C</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS2.Px2.p2.1.m1.1b"><apply id="S3.SS3.SSS2.Px2.p2.1.m1.1.1.cmml" xref="S3.SS3.SSS2.Px2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS2.Px2.p2.1.m1.1.1.1.cmml" xref="S3.SS3.SSS2.Px2.p2.1.m1.1.1">subscript</csymbol><ci id="S3.SS3.SSS2.Px2.p2.1.m1.1.1.2.cmml" xref="S3.SS3.SSS2.Px2.p2.1.m1.1.1.2">𝑁</ci><ci id="S3.SS3.SSS2.Px2.p2.1.m1.1.1.3.cmml" xref="S3.SS3.SSS2.Px2.p2.1.m1.1.1.3">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS2.Px2.p2.1.m1.1c">N_{C}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS2.Px2.p2.1.m1.1d">italic_N start_POSTSUBSCRIPT italic_C end_POSTSUBSCRIPT</annotation></semantics></math> is reached, these partial results will be copied to FP32 registers on CUDA Cores, where full-precision FP32 accumulation is performed.
As mentioned before, our fine-grained quantization applies per-group scaling factors along the inner dimension <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px2.p2.1.1">K</span>.
These scaling factors can be efficiently multiplied on the CUDA Cores as the dequantization process with minimal additional computational cost.</p>
</div>
<div class="ltx_para" id="S3.SS3.SSS2.Px2.p3">
<p class="ltx_p" id="S3.SS3.SSS2.Px2.p3.1">It is worth noting that this modification reduces the WGMMA (Warpgroup-level Matrix Multiply-Accumulate) instruction issue rate for a single warpgroup. However, on the H800 architecture, it is typical for two WGMMA to persist concurrently: while one warpgroup performs the promotion operation, the other is able to execute the MMA operation. This design enables overlapping of the two operations, maintaining high utilization of Tensor Cores.
Based on our experiments, setting <math alttext="N_{C}=128" class="ltx_Math" display="inline" id="S3.SS3.SSS2.Px2.p3.1.m1.1"><semantics id="S3.SS3.SSS2.Px2.p3.1.m1.1a"><mrow id="S3.SS3.SSS2.Px2.p3.1.m1.1.1" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.cmml"><msub id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2.cmml"><mi id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2.2" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2.2.cmml">N</mi><mi id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2.3" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2.3.cmml">C</mi></msub><mo id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.1" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.1.cmml">=</mo><mn id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.3" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.3.cmml">128</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS2.Px2.p3.1.m1.1b"><apply id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.cmml" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1"><eq id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.1.cmml" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.1"></eq><apply id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2.cmml" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2.1.cmml" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2">subscript</csymbol><ci id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2.2.cmml" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2.2">𝑁</ci><ci id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2.3.cmml" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.2.3">𝐶</ci></apply><cn id="S3.SS3.SSS2.Px2.p3.1.m1.1.1.3.cmml" type="integer" xref="S3.SS3.SSS2.Px2.p3.1.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS2.Px2.p3.1.m1.1c">N_{C}=128</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS2.Px2.p3.1.m1.1d">italic_N start_POSTSUBSCRIPT italic_C end_POSTSUBSCRIPT = 128</annotation></semantics></math> elements, equivalent to 4 WGMMAs, represents the minimal accumulation interval that can significantly improve precision without introducing substantial overhead.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS3.SSS2.Px3">
<h5 class="ltx_title ltx_title_paragraph">Mantissa over Exponents.</h5>
<div class="ltx_para" id="S3.SS3.SSS2.Px3.p1">
<p class="ltx_p" id="S3.SS3.SSS2.Px3.p1.1">In contrast to the hybrid FP8 format adopted by prior work <cite class="ltx_cite ltx_citemacro_citep">(NVIDIA, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib63" title="">2024b</a>; Peng et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib69" title="">2023b</a>; Sun et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib87" title="">2019b</a>)</cite>, which uses <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px3.p1.1.1">E4M3</span> (4-bit exponent and 3-bit mantissa) in <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px3.p1.1.2">Fprop</span> and <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px3.p1.1.3">E5M2</span> (5-bit exponent and 2-bit mantissa) in <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px3.p1.1.4">Dgrad</span> and <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px3.p1.1.5">Wgrad</span>, we adopt the <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px3.p1.1.6">E4M3</span> format on all tensors for higher precision.
We attribute the feasibility of this approach to our fine-grained quantization strategy, i.e., tile and block-wise scaling.
By operating on smaller element groups, our methodology effectively shares exponent bits among these grouped elements, mitigating the impact of the limited dynamic range.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS3.SSS2.Px4">
<h5 class="ltx_title ltx_title_paragraph">Online Quantization.</h5>
<div class="ltx_para" id="S3.SS3.SSS2.Px4.p1">
<p class="ltx_p" id="S3.SS3.SSS2.Px4.p1.1">Delayed quantization is employed in tensor-wise quantization frameworks <cite class="ltx_cite ltx_citemacro_citep">(NVIDIA, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib63" title="">2024b</a>; Peng et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib69" title="">2023b</a>)</cite>, which maintains a history of the maximum absolute values across prior iterations to infer the current value.
In order to ensure accurate scales and simplify the framework, we calculate the maximum absolute value online for each <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px4.p1.1.1">1x128</span> activation tile or <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS2.Px4.p1.1.2">128x128</span> weight block.
Based on it, we derive the scaling factor and then quantize the activation or weight online into the FP8 format.</p>
</div>
</section>
</section>
<section class="ltx_subsubsection" id="S3.SS3.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.3.3 </span>Low-Precision Storage and Communication</h4>
<div class="ltx_para" id="S3.SS3.SSS3.p1">
<p class="ltx_p" id="S3.SS3.SSS3.p1.1">In conjunction with our FP8 training framework, we further reduce the memory consumption and communication overhead by compressing cached activations and optimizer states into lower-precision formats.</p>
</div>
<section class="ltx_paragraph" id="S3.SS3.SSS3.Px1">
<h5 class="ltx_title ltx_title_paragraph">Low-Precision Optimizer States.</h5>
<div class="ltx_para" id="S3.SS3.SSS3.Px1.p1">
<p class="ltx_p" id="S3.SS3.SSS3.Px1.p1.1">We adopt the BF16 data format instead of FP32 to track the first and second moments in the AdamW <cite class="ltx_cite ltx_citemacro_citep">(Loshchilov and Hutter, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib53" title="">2017</a>)</cite> optimizer, without incurring observable performance degradation.
However, the master weights (stored by the optimizer) and gradients (used for batch size accumulation) are still retained in FP32 to ensure numerical stability throughout training.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS3.SSS3.Px2">
<h5 class="ltx_title ltx_title_paragraph">Low-Precision Activation.</h5>
<div class="ltx_para" id="S3.SS3.SSS3.Px2.p1">
<p class="ltx_p" id="S3.SS3.SSS3.Px2.p1.1">As illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.F6" title="Figure 6 ‣ 3.3 FP8 Training ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">6</span></a>, the <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS3.Px2.p1.1.1">Wgrad</span> operation is performed in FP8.
To reduce the memory consumption, it is a natural choice to cache activations in FP8 format for the backward pass of the <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS3.Px2.p1.1.2">Linear</span> operator.
However, special considerations are taken on several operators for low-cost high-precision training:</p>
<blockquote class="ltx_quote" id="S3.SS3.SSS3.Px2.p1.2">
<p class="ltx_p" id="S3.SS3.SSS3.Px2.p1.2.1"><span class="ltx_text ltx_font_bold" id="S3.SS3.SSS3.Px2.p1.2.1.1">(1) Inputs of the <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS3.Px2.p1.2.1.1.1">Linear</span> after the attention operator.</span> These activations are also used in the backward pass of the attention operator, which makes it sensitive to precision. We adopt a customized <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS3.Px2.p1.2.1.2">E5M6</span> data format exclusively for these activations. Additionally, these activations will be converted from an <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS3.Px2.p1.2.1.3">1x128</span> quantization tile to an <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS3.Px2.p1.2.1.4">128x1</span> tile in the backward pass. To avoid introducing extra quantization error, all the scaling factors are round scaled, i.e., integral power of 2.</p>
<p class="ltx_p" id="S3.SS3.SSS3.Px2.p1.2.2"><span class="ltx_text ltx_font_bold" id="S3.SS3.SSS3.Px2.p1.2.2.1">(2) Inputs of the SwiGLU operator in MoE.</span> To further reduce the memory cost, we cache the inputs of the SwiGLU operator and recompute its output in the backward pass. These activations are also stored in FP8 with our fine-grained quantization method, striking a balance between memory efficiency and computational accuracy.</p>
</blockquote>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS3.SSS3.Px3">
<h5 class="ltx_title ltx_title_paragraph">Low-Precision Communication.</h5>
<div class="ltx_para" id="S3.SS3.SSS3.Px3.p1">
<p class="ltx_p" id="S3.SS3.SSS3.Px3.p1.1">Communication bandwidth is a critical bottleneck in the training of MoE models.
To alleviate this challenge, we quantize the activation before MoE up-projections into FP8 and then apply <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS3.Px3.p1.1.1">dispatch</span> components, which is compatible with FP8 <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS3.Px3.p1.1.2">Fprop</span> in MoE up-projections. Like the inputs of the <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS3.Px3.p1.1.3">Linear</span> after the attention operator, scaling factors for this activation are integral power of 2.
A similar strategy is applied to the activation gradient before MoE down-projections.
For both the forward and backward <span class="ltx_text ltx_font_typewriter" id="S3.SS3.SSS3.Px3.p1.1.4">combine</span> components, we retain them in BF16 to preserve training precision in critical parts of the training pipeline.</p>
</div>
</section>
</section>
</section>
<section class="ltx_subsection" id="S3.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.4 </span>Inference and Deployment</h3>
<div class="ltx_para" id="S3.SS4.p1">
<p class="ltx_p" id="S3.SS4.p1.1">We deploy DeepSeek-V3 on the H800 cluster, where GPUs within each node are interconnected using NVLink, and all GPUs across the cluster are fully interconnected via IB.
To simultaneously ensure both the Service-Level Objective (SLO) for online services and high throughput, we employ the following deployment strategy that separates the <span class="ltx_text ltx_font_italic" id="S3.SS4.p1.1.1">prefilling</span> and <span class="ltx_text ltx_font_italic" id="S3.SS4.p1.1.2">decoding</span> stages.</p>
</div>
<section class="ltx_subsubsection" id="S3.SS4.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.4.1 </span>Prefilling</h4>
<div class="ltx_para" id="S3.SS4.SSS1.p1">
<p class="ltx_p" id="S3.SS4.SSS1.p1.1">The minimum deployment unit of the prefilling stage consists of 4 nodes with 32 GPUs.
The <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS1.p1.1.1">attention</span> part employs 4-way Tensor Parallelism (TP4) with Sequence Parallelism (SP), combined with 8-way Data Parallelism (DP8).
Its small TP size of 4 limits the overhead of TP communication.
For the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS1.p1.1.2">MoE</span> part, we use 32-way Expert Parallelism (EP32), which ensures that each expert processes a sufficiently large batch size, thereby enhancing computational efficiency.
For the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS1.p1.1.3">MoE</span> all-to-all communication, we use the same method as in training: first transferring tokens across nodes via IB, and then forwarding among the intra-node GPUs via NVLink.
In particular, we use 1-way Tensor Parallelism for the dense MLPs in shallow layers to save TP communication.</p>
</div>
<div class="ltx_para" id="S3.SS4.SSS1.p2">
<p class="ltx_p" id="S3.SS4.SSS1.p2.1">To achieve load balancing among different experts in the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS1.p2.1.1">MoE</span> part, we need to ensure that each GPU processes approximately the same number of tokens.
To this end, we introduce a deployment strategy of <span class="ltx_text ltx_font_italic" id="S3.SS4.SSS1.p2.1.2">redundant experts</span>, which duplicates high-load experts and deploys them redundantly.
The high-load experts are detected based on statistics collected during the online deployment and are adjusted periodically (e.g., every 10 minutes).
After determining the set of redundant experts, we carefully rearrange experts among GPUs within a node based on the observed loads, striving to balance the load across GPUs as much as possible without increasing the cross-node all-to-all communication overhead.
For the deployment of DeepSeek-V3, we set 32 redundant experts for the prefilling stage.
For each GPU, besides the original 8 experts it hosts, it will also host one additional redundant expert.</p>
</div>
<div class="ltx_para" id="S3.SS4.SSS1.p3">
<p class="ltx_p" id="S3.SS4.SSS1.p3.1">Furthermore, in the prefilling stage, to improve the throughput and hide the overhead of all-to-all and TP communication, we simultaneously process two micro-batches with similar computational workloads, overlapping the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS1.p3.1.1">attention</span> and <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS1.p3.1.2">MoE</span> of one micro-batch with the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS1.p3.1.3">dispatch</span> and <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS1.p3.1.4">combine</span> of another.</p>
</div>
<div class="ltx_para" id="S3.SS4.SSS1.p4">
<p class="ltx_p" id="S3.SS4.SSS1.p4.1">Finally, we are exploring a <span class="ltx_text ltx_font_italic" id="S3.SS4.SSS1.p4.1.1">dynamic redundancy</span> strategy for experts, where each GPU hosts more experts (e.g., 16 experts), but only 9 will be activated during each inference step.
Before the all-to-all operation at each layer begins, we compute the globally optimal routing scheme on the fly.
Given the substantial computation involved in the prefilling stage, the overhead of computing this routing scheme is almost negligible.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S3.SS4.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.4.2 </span>Decoding</h4>
<div class="ltx_para" id="S3.SS4.SSS2.p1">
<p class="ltx_p" id="S3.SS4.SSS2.p1.1">During decoding, we treat the shared expert as a routed one.
From this perspective, each token will select 9 experts during routing, where the shared expert is regarded as a heavy-load one that will always be selected.
The minimum deployment unit of the decoding stage consists of 40 nodes with 320 GPUs.
The <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p1.1.1">attention</span> part employs TP4 with SP, combined with DP80, while the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p1.1.2">MoE</span> part uses EP320.
For the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p1.1.3">MoE</span> part, each GPU hosts only one expert, and 64 GPUs are responsible for hosting redundant experts and shared experts.
All-to-all communication of the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p1.1.4">dispatch</span> and <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p1.1.5">combine</span> parts is performed via direct point-to-point transfers over IB to achieve low latency.
Additionally, we leverage the IBGDA <cite class="ltx_cite ltx_citemacro_citep">(NVIDIA, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib61" title="">2022</a>)</cite> technology to further minimize latency and enhance communication efficiency.</p>
</div>
<div class="ltx_para" id="S3.SS4.SSS2.p2">
<p class="ltx_p" id="S3.SS4.SSS2.p2.1">Similar to prefilling, we periodically determine the set of redundant experts in a certain interval, based on the statistical expert load from our online service.
However, we do not need to rearrange experts since each GPU only hosts one expert.
We are also exploring the <span class="ltx_text ltx_font_italic" id="S3.SS4.SSS2.p2.1.1">dynamic redundancy</span> strategy for decoding.
However, this requires more careful optimization of the algorithm that computes the globally optimal routing scheme and the fusion with the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p2.1.2">dispatch</span> kernel to reduce overhead.</p>
</div>
<div class="ltx_para" id="S3.SS4.SSS2.p3">
<p class="ltx_p" id="S3.SS4.SSS2.p3.1">Additionally, to enhance throughput and hide the overhead of all-to-all communication, we are also exploring processing two micro-batches with similar computational workloads simultaneously in the decoding stage.
Unlike prefilling, <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p3.1.1">attention</span> consumes a larger portion of time in the decoding stage. Therefore, we overlap the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p3.1.2">attention</span> of one micro-batch with the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p3.1.3">dispatch+MoE+combine</span> of another.
In the decoding stage, the batch size per expert is relatively small (usually within 256 tokens), and the bottleneck is memory access rather than computation.
Since the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p3.1.4">MoE</span> part only needs to load the parameters of one expert, the memory access overhead is minimal, so using fewer SMs will not significantly affect the overall performance.
Therefore, to avoid impacting the computation speed of the <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p3.1.5">attention</span> part, we can allocate only a small portion of SMs to <span class="ltx_text ltx_font_typewriter" id="S3.SS4.SSS2.p3.1.6">dispatch+MoE+combine</span>.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S3.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.5 </span>Suggestions on Hardware Design</h3>
<div class="ltx_para" id="S3.SS5.p1">
<p class="ltx_p" id="S3.SS5.p1.1">Based on our implementation of the all-to-all communication and FP8 training scheme, we propose the following suggestions on chip design to AI hardware vendors.</p>
</div>
<section class="ltx_subsubsection" id="S3.SS5.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.5.1 </span>Communication Hardware</h4>
<div class="ltx_para" id="S3.SS5.SSS1.p1">
<p class="ltx_p" id="S3.SS5.SSS1.p1.1">In DeepSeek-V3, we implement the overlap between computation and communication to hide the communication latency during computation.
This significantly reduces the dependency on communication bandwidth compared to serial computation and communication.
However, the current communication implementation relies on expensive SMs (e.g., we allocate 20 out of the 132 SMs available in the H800 GPU for this purpose), which will limit the computational throughput.
Moreover, using SMs for communication results in significant inefficiencies, as tensor cores remain entirely -utilized.</p>
</div>
<div class="ltx_para" id="S3.SS5.SSS1.p2">
<p class="ltx_p" id="S3.SS5.SSS1.p2.1">Currently, the SMs primarily perform the following tasks for all-to-all communication:</p>
<ul class="ltx_itemize" id="S3.I1">
<li class="ltx_item" id="S3.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I1.i1.p1">
<p class="ltx_p" id="S3.I1.i1.p1.1"><span class="ltx_text ltx_font_bold" id="S3.I1.i1.p1.1.1">Forwarding data</span> between the IB (InfiniBand) and NVLink domain while aggregating IB traffic destined for multiple GPUs within the same node from a single GPU.</p>
</div>
</li>
<li class="ltx_item" id="S3.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I1.i2.p1">
<p class="ltx_p" id="S3.I1.i2.p1.1"><span class="ltx_text ltx_font_bold" id="S3.I1.i2.p1.1.1">Transporting data</span> between RDMA buffers (registered GPU memory regions) and input/output buffers.</p>
</div>
</li>
<li class="ltx_item" id="S3.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I1.i3.p1">
<p class="ltx_p" id="S3.I1.i3.p1.1"><span class="ltx_text ltx_font_bold" id="S3.I1.i3.p1.1.1">Executing <span class="ltx_text ltx_font_typewriter" id="S3.I1.i3.p1.1.1.1">reduce</span> operations</span> for <span class="ltx_text ltx_font_typewriter" id="S3.I1.i3.p1.1.2">all-to-all</span> <span class="ltx_text ltx_font_typewriter" id="S3.I1.i3.p1.1.3">combine</span>.</p>
</div>
</li>
<li class="ltx_item" id="S3.I1.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I1.i4.p1">
<p class="ltx_p" id="S3.I1.i4.p1.1"><span class="ltx_text ltx_font_bold" id="S3.I1.i4.p1.1.1">Managing fine-grained memory layout</span> during chunked data transferring to multiple experts across the IB and NVLink domain.</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para" id="S3.SS5.SSS1.p3">
<p class="ltx_p" id="S3.SS5.SSS1.p3.1">We aspire to see future vendors developing hardware that offloads these communication tasks from the valuable computation unit SM, serving as a GPU co-processor or a network co-processor like NVIDIA SHARP <cite class="ltx_cite ltx_citemacro_cite">Graham et al. (<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib28" title="">2016</a>)</cite>.
Furthermore, to reduce application programming complexity, we aim for this hardware to unify the IB (scale-out) and NVLink (scale-up) networks from the perspective of the computation units.
With this unified interface, computation units can easily accomplish operations such as <span class="ltx_text ltx_font_typewriter" id="S3.SS5.SSS1.p3.1.1">read</span>, <span class="ltx_text ltx_font_typewriter" id="S3.SS5.SSS1.p3.1.2">write</span>, <span class="ltx_text ltx_font_typewriter" id="S3.SS5.SSS1.p3.1.3">multicast</span>, and <span class="ltx_text ltx_font_typewriter" id="S3.SS5.SSS1.p3.1.4">reduce</span> across the entire IB-NVLink-unified domain via submitting communication requests based on simple primitives.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S3.SS5.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">3.5.2 </span>Compute Hardware</h4>
<section class="ltx_paragraph" id="S3.SS5.SSS2.Px1">
<h5 class="ltx_title ltx_title_paragraph">Higher FP8 GEMM Accumulation Precision in Tensor Cores.</h5>
<div class="ltx_para" id="S3.SS5.SSS2.Px1.p1">
<p class="ltx_p" id="S3.SS5.SSS2.Px1.p1.1">In the current Tensor Core implementation of the NVIDIA Hopper architecture, FP8 GEMM (General Matrix Multiply) employs fixed-point accumulation, aligning the mantissa products by right-shifting based on the maximum exponent before addition.
Our experiments reveal that it only uses the highest 14 bits of each mantissa product after sign-fill right shifting, and truncates bits exceeding this range.
However, for example, to achieve precise FP32 results from the accumulation of 32 FP8<math alttext="\times" class="ltx_Math" display="inline" id="S3.SS5.SSS2.Px1.p1.1.m1.1"><semantics id="S3.SS5.SSS2.Px1.p1.1.m1.1a"><mo id="S3.SS5.SSS2.Px1.p1.1.m1.1.1" xref="S3.SS5.SSS2.Px1.p1.1.m1.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.SS5.SSS2.Px1.p1.1.m1.1b"><times id="S3.SS5.SSS2.Px1.p1.1.m1.1.1.cmml" xref="S3.SS5.SSS2.Px1.p1.1.m1.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.SS5.SSS2.Px1.p1.1.m1.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S3.SS5.SSS2.Px1.p1.1.m1.1d">×</annotation></semantics></math>FP8 multiplications, at least 34-bit precision is required.
Thus, we recommend that future chip designs increase accumulation precision in Tensor Cores to support full-precision accumulation, or select an appropriate accumulation bit-width according to the accuracy requirements of training and inference algorithms.
This approach ensures that errors remain within acceptable bounds while maintaining computational efficiency.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS5.SSS2.Px2">
<h5 class="ltx_title ltx_title_paragraph">Support for Tile- and Block-Wise Quantization.</h5>
<div class="ltx_para" id="S3.SS5.SSS2.Px2.p1">
<p class="ltx_p" id="S3.SS5.SSS2.Px2.p1.1">Current GPUs only support per-tensor quantization, lacking the native support for fine-grained quantization like our tile- and block-wise quantization.
In the current implementation, when the <math alttext="N_{C}" class="ltx_Math" display="inline" id="S3.SS5.SSS2.Px2.p1.1.m1.1"><semantics id="S3.SS5.SSS2.Px2.p1.1.m1.1a"><msub id="S3.SS5.SSS2.Px2.p1.1.m1.1.1" xref="S3.SS5.SSS2.Px2.p1.1.m1.1.1.cmml"><mi id="S3.SS5.SSS2.Px2.p1.1.m1.1.1.2" xref="S3.SS5.SSS2.Px2.p1.1.m1.1.1.2.cmml">N</mi><mi id="S3.SS5.SSS2.Px2.p1.1.m1.1.1.3" xref="S3.SS5.SSS2.Px2.p1.1.m1.1.1.3.cmml">C</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS5.SSS2.Px2.p1.1.m1.1b"><apply id="S3.SS5.SSS2.Px2.p1.1.m1.1.1.cmml" xref="S3.SS5.SSS2.Px2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS5.SSS2.Px2.p1.1.m1.1.1.1.cmml" xref="S3.SS5.SSS2.Px2.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS5.SSS2.Px2.p1.1.m1.1.1.2.cmml" xref="S3.SS5.SSS2.Px2.p1.1.m1.1.1.2">𝑁</ci><ci id="S3.SS5.SSS2.Px2.p1.1.m1.1.1.3.cmml" xref="S3.SS5.SSS2.Px2.p1.1.m1.1.1.3">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS5.SSS2.Px2.p1.1.m1.1c">N_{C}</annotation><annotation encoding="application/x-llamapun" id="S3.SS5.SSS2.Px2.p1.1.m1.1d">italic_N start_POSTSUBSCRIPT italic_C end_POSTSUBSCRIPT</annotation></semantics></math> interval is reached, the partial results will be copied from Tensor Cores to CUDA cores, multiplied by the scaling factors, and added to FP32 registers on CUDA cores.
Although the dequantization overhead is significantly mitigated combined with our precise FP32 accumulation strategy, the frequent data movements between Tensor Cores and CUDA cores still limit the computational efficiency.
Therefore, we recommend future chips to support fine-grained quantization by enabling Tensor Cores to receive scaling factors and implement MMA with group scaling.
In this way, the whole partial sum accumulation and dequantization can be completed directly inside Tensor Cores until the final result is produced, avoiding frequent data movements.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS5.SSS2.Px3">
<h5 class="ltx_title ltx_title_paragraph">Support for Online Quantization.</h5>
<div class="ltx_para" id="S3.SS5.SSS2.Px3.p1">
<p class="ltx_p" id="S3.SS5.SSS2.Px3.p1.1">The current implementations struggle to effectively support online quantization, despite its effectiveness demonstrated in our research.
In the existing process, we need to read 128 BF16 activation values (the output of the previous computation) from HBM (High Bandwidth Memory) for quantization, and the quantized FP8 values are then written back to HBM, only to be read again for MMA.
To address this inefficiency, we recommend that future chips integrate FP8 cast and TMA (Tensor Memory Accelerator) access into a single fused operation, so quantization can be completed during the transfer of activations from global memory to shared memory, avoiding frequent memory reads and writes.
We also recommend supporting a warp-level cast instruction for speedup, which further facilitates the better fusion of layer normalization and FP8 cast.
Alternatively, a near-memory computing approach can be adopted, where compute logic is placed near the HBM.
In this case, BF16 elements can be cast to FP8 directly as they are read from HBM into the GPU, reducing off-chip memory access by roughly 50%.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS5.SSS2.Px4">
<h5 class="ltx_title ltx_title_paragraph">Support for Transposed GEMM Operations.</h5>
<div class="ltx_para" id="S3.SS5.SSS2.Px4.p1">
<p class="ltx_p" id="S3.SS5.SSS2.Px4.p1.1">The current architecture makes it cumbersome to fuse matrix transposition with GEMM operations.
In our workflow, activations during the forward pass are quantized into <span class="ltx_text ltx_font_typewriter" id="S3.SS5.SSS2.Px4.p1.1.1">1x128</span> FP8 tiles and stored.
During the backward pass, the matrix needs to be read out, dequantized, transposed, re-quantized into <span class="ltx_text ltx_font_typewriter" id="S3.SS5.SSS2.Px4.p1.1.2">128x1</span> tiles, and stored in HBM.
To reduce memory operations, we recommend future chips to enable direct transposed reads of matrices from shared memory before MMA operation, for those precisions required in both training and inference. Combined with the fusion of FP8 format conversion and TMA access, this enhancement will significantly streamline the quantization workflow.</p>
</div>
</section>
</section>
</section>
</section>
<section class="ltx_section" id="S4" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Pre-Training</h2>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Data Construction</h3>
<div class="ltx_para" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.1">Compared with DeepSeek-V2, we optimize the pre-training corpus by enhancing the ratio of mathematical and programming samples, while expanding multilingual coverage beyond English and Chinese.
Also, our data processing pipeline is refined to minimize redundancy while maintaining corpus diversity.
Inspired by <cite class="ltx_cite ltx_citemacro_citet">Ding et al. (<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib18" title="">2024</a>)</cite>, we implement the document packing method for data integrity but do not incorporate cross-sample attention masking during training.
Finally, the training corpus for DeepSeek-V3 consists of 14.8T high-quality and diverse tokens in our tokenizer.</p>
</div>
<div class="ltx_para" id="S4.SS1.p2">
<p class="ltx_p" id="S4.SS1.p2.1">In the training process of DeepSeekCoder-V2 <cite class="ltx_cite ltx_citemacro_citep">(DeepSeek-AI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib14" title="">2024a</a>)</cite>, we observe that the Fill-in-Middle (FIM) strategy does not compromise the next-token prediction capability while enabling the model to accurately predict middle text based on contextual cues.
In alignment with DeepSeekCoder-V2, we also incorporate the FIM strategy in the pre-training of DeepSeek-V3.
To be specific, we employ the Prefix-Suffix-Middle (PSM) framework to structure data as follows:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A3.EGx7">
<tbody id="S4.Ex1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\texttt{&lt;|fim\_begin|&gt;}f_{\text{pre}}\texttt{&lt;|fim\_hole|&gt;}f_{%
\text{suf}}\texttt{&lt;|fim\_end|&gt;}f_{\text{middle}}\texttt{&lt;|eos\_token|&gt;}." class="ltx_Math" display="inline" id="S4.Ex1.m1.1"><semantics id="S4.Ex1.m1.1a"><mrow id="S4.Ex1.m1.1.1.1" xref="S4.Ex1.m1.1.1.1.1.cmml"><mrow id="S4.Ex1.m1.1.1.1.1" xref="S4.Ex1.m1.1.1.1.1.cmml"><mtext class="ltx_mathvariant_monospace" id="S4.Ex1.m1.1.1.1.1.2" xref="S4.Ex1.m1.1.1.1.1.2a.cmml">&lt;|fim_begin|&gt;</mtext><mo id="S4.Ex1.m1.1.1.1.1.1" xref="S4.Ex1.m1.1.1.1.1.1.cmml">⁢</mo><msub id="S4.Ex1.m1.1.1.1.1.3" xref="S4.Ex1.m1.1.1.1.1.3.cmml"><mi id="S4.Ex1.m1.1.1.1.1.3.2" xref="S4.Ex1.m1.1.1.1.1.3.2.cmml">f</mi><mtext id="S4.Ex1.m1.1.1.1.1.3.3" xref="S4.Ex1.m1.1.1.1.1.3.3a.cmml">pre</mtext></msub><mo id="S4.Ex1.m1.1.1.1.1.1a" xref="S4.Ex1.m1.1.1.1.1.1.cmml">⁢</mo><mtext class="ltx_mathvariant_monospace" id="S4.Ex1.m1.1.1.1.1.4" xref="S4.Ex1.m1.1.1.1.1.4a.cmml">&lt;|fim_hole|&gt;</mtext><mo id="S4.Ex1.m1.1.1.1.1.1b" xref="S4.Ex1.m1.1.1.1.1.1.cmml">⁢</mo><msub id="S4.Ex1.m1.1.1.1.1.5" xref="S4.Ex1.m1.1.1.1.1.5.cmml"><mi id="S4.Ex1.m1.1.1.1.1.5.2" xref="S4.Ex1.m1.1.1.1.1.5.2.cmml">f</mi><mtext id="S4.Ex1.m1.1.1.1.1.5.3" xref="S4.Ex1.m1.1.1.1.1.5.3a.cmml">suf</mtext></msub><mo id="S4.Ex1.m1.1.1.1.1.1c" xref="S4.Ex1.m1.1.1.1.1.1.cmml">⁢</mo><mtext class="ltx_mathvariant_monospace" id="S4.Ex1.m1.1.1.1.1.6" xref="S4.Ex1.m1.1.1.1.1.6a.cmml">&lt;|fim_end|&gt;</mtext><mo id="S4.Ex1.m1.1.1.1.1.1d" xref="S4.Ex1.m1.1.1.1.1.1.cmml">⁢</mo><msub id="S4.Ex1.m1.1.1.1.1.7" xref="S4.Ex1.m1.1.1.1.1.7.cmml"><mi id="S4.Ex1.m1.1.1.1.1.7.2" xref="S4.Ex1.m1.1.1.1.1.7.2.cmml">f</mi><mtext id="S4.Ex1.m1.1.1.1.1.7.3" xref="S4.Ex1.m1.1.1.1.1.7.3a.cmml">middle</mtext></msub><mo id="S4.Ex1.m1.1.1.1.1.1e" xref="S4.Ex1.m1.1.1.1.1.1.cmml">⁢</mo><mtext class="ltx_mathvariant_monospace" id="S4.Ex1.m1.1.1.1.1.8" xref="S4.Ex1.m1.1.1.1.1.8a.cmml">&lt;|eos_token|&gt;</mtext></mrow><mo id="S4.Ex1.m1.1.1.1.2" lspace="0em" xref="S4.Ex1.m1.1.1.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.Ex1.m1.1b"><apply id="S4.Ex1.m1.1.1.1.1.cmml" xref="S4.Ex1.m1.1.1.1"><times id="S4.Ex1.m1.1.1.1.1.1.cmml" xref="S4.Ex1.m1.1.1.1.1.1"></times><ci id="S4.Ex1.m1.1.1.1.1.2a.cmml" xref="S4.Ex1.m1.1.1.1.1.2"><mtext class="ltx_mathvariant_monospace" id="S4.Ex1.m1.1.1.1.1.2.cmml" xref="S4.Ex1.m1.1.1.1.1.2">&lt;|fim_begin|&gt;</mtext></ci><apply id="S4.Ex1.m1.1.1.1.1.3.cmml" xref="S4.Ex1.m1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.Ex1.m1.1.1.1.1.3.1.cmml" xref="S4.Ex1.m1.1.1.1.1.3">subscript</csymbol><ci id="S4.Ex1.m1.1.1.1.1.3.2.cmml" xref="S4.Ex1.m1.1.1.1.1.3.2">𝑓</ci><ci id="S4.Ex1.m1.1.1.1.1.3.3a.cmml" xref="S4.Ex1.m1.1.1.1.1.3.3"><mtext id="S4.Ex1.m1.1.1.1.1.3.3.cmml" mathsize="70%" xref="S4.Ex1.m1.1.1.1.1.3.3">pre</mtext></ci></apply><ci id="S4.Ex1.m1.1.1.1.1.4a.cmml" xref="S4.Ex1.m1.1.1.1.1.4"><mtext class="ltx_mathvariant_monospace" id="S4.Ex1.m1.1.1.1.1.4.cmml" xref="S4.Ex1.m1.1.1.1.1.4">&lt;|fim_hole|&gt;</mtext></ci><apply id="S4.Ex1.m1.1.1.1.1.5.cmml" xref="S4.Ex1.m1.1.1.1.1.5"><csymbol cd="ambiguous" id="S4.Ex1.m1.1.1.1.1.5.1.cmml" xref="S4.Ex1.m1.1.1.1.1.5">subscript</csymbol><ci id="S4.Ex1.m1.1.1.1.1.5.2.cmml" xref="S4.Ex1.m1.1.1.1.1.5.2">𝑓</ci><ci id="S4.Ex1.m1.1.1.1.1.5.3a.cmml" xref="S4.Ex1.m1.1.1.1.1.5.3"><mtext id="S4.Ex1.m1.1.1.1.1.5.3.cmml" mathsize="70%" xref="S4.Ex1.m1.1.1.1.1.5.3">suf</mtext></ci></apply><ci id="S4.Ex1.m1.1.1.1.1.6a.cmml" xref="S4.Ex1.m1.1.1.1.1.6"><mtext class="ltx_mathvariant_monospace" id="S4.Ex1.m1.1.1.1.1.6.cmml" xref="S4.Ex1.m1.1.1.1.1.6">&lt;|fim_end|&gt;</mtext></ci><apply id="S4.Ex1.m1.1.1.1.1.7.cmml" xref="S4.Ex1.m1.1.1.1.1.7"><csymbol cd="ambiguous" id="S4.Ex1.m1.1.1.1.1.7.1.cmml" xref="S4.Ex1.m1.1.1.1.1.7">subscript</csymbol><ci id="S4.Ex1.m1.1.1.1.1.7.2.cmml" xref="S4.Ex1.m1.1.1.1.1.7.2">𝑓</ci><ci id="S4.Ex1.m1.1.1.1.1.7.3a.cmml" xref="S4.Ex1.m1.1.1.1.1.7.3"><mtext id="S4.Ex1.m1.1.1.1.1.7.3.cmml" mathsize="70%" xref="S4.Ex1.m1.1.1.1.1.7.3">middle</mtext></ci></apply><ci id="S4.Ex1.m1.1.1.1.1.8a.cmml" xref="S4.Ex1.m1.1.1.1.1.8"><mtext class="ltx_mathvariant_monospace" id="S4.Ex1.m1.1.1.1.1.8.cmml" xref="S4.Ex1.m1.1.1.1.1.8">&lt;|eos_token|&gt;</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.Ex1.m1.1c">\displaystyle\texttt{&lt;|fim\_begin|&gt;}f_{\text{pre}}\texttt{&lt;|fim\_hole|&gt;}f_{%
\text{suf}}\texttt{&lt;|fim\_end|&gt;}f_{\text{middle}}\texttt{&lt;|eos\_token|&gt;}.</annotation><annotation encoding="application/x-llamapun" id="S4.Ex1.m1.1d">&lt;|fim_begin|&gt; italic_f start_POSTSUBSCRIPT pre end_POSTSUBSCRIPT &lt;|fim_hole|&gt; italic_f start_POSTSUBSCRIPT suf end_POSTSUBSCRIPT &lt;|fim_end|&gt; italic_f start_POSTSUBSCRIPT middle end_POSTSUBSCRIPT &lt;|eos_token|&gt; .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS1.p2.2">This structure is applied at the document level as a part of the pre-packing process.
The FIM strategy is applied at a rate of 0.1, consistent with the PSM framework.</p>
</div>
<div class="ltx_para" id="S4.SS1.p3">
<p class="ltx_p" id="S4.SS1.p3.1">The tokenizer for DeepSeek-V3 employs Byte-level BPE <cite class="ltx_cite ltx_citemacro_citep">(Shibata et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib83" title="">1999</a>)</cite> with an extended vocabulary of 128K tokens.
The pretokenizer and training data for our tokenizer are modified to optimize multilingual compression efficiency.
In addition, compared with DeepSeek-V2, the new pretokenizer introduces tokens that combine punctuations and line breaks.
However, this trick may introduce the token boundary bias <cite class="ltx_cite ltx_citemacro_citep">(Lundberg, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib54" title="">2023</a>)</cite> when the model processes multi-line prompts without terminal line breaks, particularly for few-shot evaluation prompts.
To address this issue, we randomly split a certain proportion of such combined tokens during training, which exposes the model to a wider array of special cases and mitigates this bias.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Hyper-Parameters</h3>
<section class="ltx_paragraph" id="S4.SS2.SSS0.Px1">
<h5 class="ltx_title ltx_title_paragraph">Model Hyper-Parameters.</h5>
<div class="ltx_para" id="S4.SS2.SSS0.Px1.p1">
<p class="ltx_p" id="S4.SS2.SSS0.Px1.p1.6">We set the number of Transformer layers to 61 and the hidden dimension to 7168.
All learnable parameters are randomly initialized with a standard deviation of 0.006.
In MLA, we set the number of attention heads <math alttext="n_{h}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px1.p1.1.m1.1"><semantics id="S4.SS2.SSS0.Px1.p1.1.m1.1a"><msub id="S4.SS2.SSS0.Px1.p1.1.m1.1.1" xref="S4.SS2.SSS0.Px1.p1.1.m1.1.1.cmml"><mi id="S4.SS2.SSS0.Px1.p1.1.m1.1.1.2" xref="S4.SS2.SSS0.Px1.p1.1.m1.1.1.2.cmml">n</mi><mi id="S4.SS2.SSS0.Px1.p1.1.m1.1.1.3" xref="S4.SS2.SSS0.Px1.p1.1.m1.1.1.3.cmml">h</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px1.p1.1.m1.1b"><apply id="S4.SS2.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S4.SS2.SSS0.Px1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px1.p1.1.m1.1.1.1.cmml" xref="S4.SS2.SSS0.Px1.p1.1.m1.1.1">subscript</csymbol><ci id="S4.SS2.SSS0.Px1.p1.1.m1.1.1.2.cmml" xref="S4.SS2.SSS0.Px1.p1.1.m1.1.1.2">𝑛</ci><ci id="S4.SS2.SSS0.Px1.p1.1.m1.1.1.3.cmml" xref="S4.SS2.SSS0.Px1.p1.1.m1.1.1.3">ℎ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px1.p1.1.m1.1c">n_{h}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px1.p1.1.m1.1d">italic_n start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT</annotation></semantics></math> to 128 and the per-head dimension <math alttext="d_{h}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px1.p1.2.m2.1"><semantics id="S4.SS2.SSS0.Px1.p1.2.m2.1a"><msub id="S4.SS2.SSS0.Px1.p1.2.m2.1.1" xref="S4.SS2.SSS0.Px1.p1.2.m2.1.1.cmml"><mi id="S4.SS2.SSS0.Px1.p1.2.m2.1.1.2" xref="S4.SS2.SSS0.Px1.p1.2.m2.1.1.2.cmml">d</mi><mi id="S4.SS2.SSS0.Px1.p1.2.m2.1.1.3" xref="S4.SS2.SSS0.Px1.p1.2.m2.1.1.3.cmml">h</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px1.p1.2.m2.1b"><apply id="S4.SS2.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S4.SS2.SSS0.Px1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px1.p1.2.m2.1.1.1.cmml" xref="S4.SS2.SSS0.Px1.p1.2.m2.1.1">subscript</csymbol><ci id="S4.SS2.SSS0.Px1.p1.2.m2.1.1.2.cmml" xref="S4.SS2.SSS0.Px1.p1.2.m2.1.1.2">𝑑</ci><ci id="S4.SS2.SSS0.Px1.p1.2.m2.1.1.3.cmml" xref="S4.SS2.SSS0.Px1.p1.2.m2.1.1.3">ℎ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px1.p1.2.m2.1c">d_{h}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px1.p1.2.m2.1d">italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT</annotation></semantics></math> to 128.
The KV compression dimension <math alttext="d_{c}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px1.p1.3.m3.1"><semantics id="S4.SS2.SSS0.Px1.p1.3.m3.1a"><msub id="S4.SS2.SSS0.Px1.p1.3.m3.1.1" xref="S4.SS2.SSS0.Px1.p1.3.m3.1.1.cmml"><mi id="S4.SS2.SSS0.Px1.p1.3.m3.1.1.2" xref="S4.SS2.SSS0.Px1.p1.3.m3.1.1.2.cmml">d</mi><mi id="S4.SS2.SSS0.Px1.p1.3.m3.1.1.3" xref="S4.SS2.SSS0.Px1.p1.3.m3.1.1.3.cmml">c</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px1.p1.3.m3.1b"><apply id="S4.SS2.SSS0.Px1.p1.3.m3.1.1.cmml" xref="S4.SS2.SSS0.Px1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px1.p1.3.m3.1.1.1.cmml" xref="S4.SS2.SSS0.Px1.p1.3.m3.1.1">subscript</csymbol><ci id="S4.SS2.SSS0.Px1.p1.3.m3.1.1.2.cmml" xref="S4.SS2.SSS0.Px1.p1.3.m3.1.1.2">𝑑</ci><ci id="S4.SS2.SSS0.Px1.p1.3.m3.1.1.3.cmml" xref="S4.SS2.SSS0.Px1.p1.3.m3.1.1.3">𝑐</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px1.p1.3.m3.1c">d_{c}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px1.p1.3.m3.1d">italic_d start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT</annotation></semantics></math> is set to 512, and the query compression dimension <math alttext="d_{c}^{\prime}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px1.p1.4.m4.1"><semantics id="S4.SS2.SSS0.Px1.p1.4.m4.1a"><msubsup id="S4.SS2.SSS0.Px1.p1.4.m4.1.1" xref="S4.SS2.SSS0.Px1.p1.4.m4.1.1.cmml"><mi id="S4.SS2.SSS0.Px1.p1.4.m4.1.1.2.2" xref="S4.SS2.SSS0.Px1.p1.4.m4.1.1.2.2.cmml">d</mi><mi id="S4.SS2.SSS0.Px1.p1.4.m4.1.1.2.3" xref="S4.SS2.SSS0.Px1.p1.4.m4.1.1.2.3.cmml">c</mi><mo id="S4.SS2.SSS0.Px1.p1.4.m4.1.1.3" xref="S4.SS2.SSS0.Px1.p1.4.m4.1.1.3.cmml">′</mo></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px1.p1.4.m4.1b"><apply id="S4.SS2.SSS0.Px1.p1.4.m4.1.1.cmml" xref="S4.SS2.SSS0.Px1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px1.p1.4.m4.1.1.1.cmml" xref="S4.SS2.SSS0.Px1.p1.4.m4.1.1">superscript</csymbol><apply id="S4.SS2.SSS0.Px1.p1.4.m4.1.1.2.cmml" xref="S4.SS2.SSS0.Px1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px1.p1.4.m4.1.1.2.1.cmml" xref="S4.SS2.SSS0.Px1.p1.4.m4.1.1">subscript</csymbol><ci id="S4.SS2.SSS0.Px1.p1.4.m4.1.1.2.2.cmml" xref="S4.SS2.SSS0.Px1.p1.4.m4.1.1.2.2">𝑑</ci><ci id="S4.SS2.SSS0.Px1.p1.4.m4.1.1.2.3.cmml" xref="S4.SS2.SSS0.Px1.p1.4.m4.1.1.2.3">𝑐</ci></apply><ci id="S4.SS2.SSS0.Px1.p1.4.m4.1.1.3.cmml" xref="S4.SS2.SSS0.Px1.p1.4.m4.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px1.p1.4.m4.1c">d_{c}^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px1.p1.4.m4.1d">italic_d start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> is set to 1536.
For the decoupled queries and key, we set the per-head dimension <math alttext="d_{h}^{R}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px1.p1.5.m5.1"><semantics id="S4.SS2.SSS0.Px1.p1.5.m5.1a"><msubsup id="S4.SS2.SSS0.Px1.p1.5.m5.1.1" xref="S4.SS2.SSS0.Px1.p1.5.m5.1.1.cmml"><mi id="S4.SS2.SSS0.Px1.p1.5.m5.1.1.2.2" xref="S4.SS2.SSS0.Px1.p1.5.m5.1.1.2.2.cmml">d</mi><mi id="S4.SS2.SSS0.Px1.p1.5.m5.1.1.2.3" xref="S4.SS2.SSS0.Px1.p1.5.m5.1.1.2.3.cmml">h</mi><mi id="S4.SS2.SSS0.Px1.p1.5.m5.1.1.3" xref="S4.SS2.SSS0.Px1.p1.5.m5.1.1.3.cmml">R</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px1.p1.5.m5.1b"><apply id="S4.SS2.SSS0.Px1.p1.5.m5.1.1.cmml" xref="S4.SS2.SSS0.Px1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px1.p1.5.m5.1.1.1.cmml" xref="S4.SS2.SSS0.Px1.p1.5.m5.1.1">superscript</csymbol><apply id="S4.SS2.SSS0.Px1.p1.5.m5.1.1.2.cmml" xref="S4.SS2.SSS0.Px1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px1.p1.5.m5.1.1.2.1.cmml" xref="S4.SS2.SSS0.Px1.p1.5.m5.1.1">subscript</csymbol><ci id="S4.SS2.SSS0.Px1.p1.5.m5.1.1.2.2.cmml" xref="S4.SS2.SSS0.Px1.p1.5.m5.1.1.2.2">𝑑</ci><ci id="S4.SS2.SSS0.Px1.p1.5.m5.1.1.2.3.cmml" xref="S4.SS2.SSS0.Px1.p1.5.m5.1.1.2.3">ℎ</ci></apply><ci id="S4.SS2.SSS0.Px1.p1.5.m5.1.1.3.cmml" xref="S4.SS2.SSS0.Px1.p1.5.m5.1.1.3">𝑅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px1.p1.5.m5.1c">d_{h}^{R}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px1.p1.5.m5.1d">italic_d start_POSTSUBSCRIPT italic_h end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT</annotation></semantics></math> to 64.
We substitute all FFNs except for the first three layers with MoE layers.
Each MoE layer consists of 1 shared expert and 256 routed experts, where the intermediate hidden dimension of each expert is 2048.
Among the routed experts, 8 experts will be activated for each token, and each token will be ensured to be sent to at most 4 nodes.
The multi-token prediction depth <math alttext="D" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px1.p1.6.m6.1"><semantics id="S4.SS2.SSS0.Px1.p1.6.m6.1a"><mi id="S4.SS2.SSS0.Px1.p1.6.m6.1.1" xref="S4.SS2.SSS0.Px1.p1.6.m6.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px1.p1.6.m6.1b"><ci id="S4.SS2.SSS0.Px1.p1.6.m6.1.1.cmml" xref="S4.SS2.SSS0.Px1.p1.6.m6.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px1.p1.6.m6.1c">D</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px1.p1.6.m6.1d">italic_D</annotation></semantics></math> is set to 1, i.e., besides the exact next token, each token will predict one additional token.
As DeepSeek-V2, DeepSeek-V3 also employs additional RMSNorm layers after the compressed latent vectors, and multiplies additional scaling factors at the width bottlenecks.
Under this configuration, DeepSeek-V3 comprises 671B total parameters, of which 37B are activated for each token.</p>
</div>
</section>
<section class="ltx_paragraph" id="S4.SS2.SSS0.Px2">
<h5 class="ltx_title ltx_title_paragraph">Training Hyper-Parameters.</h5>
<div class="ltx_para" id="S4.SS2.SSS0.Px2.p1">
<p class="ltx_p" id="S4.SS2.SSS0.Px2.p1.12">We employ the AdamW optimizer <cite class="ltx_cite ltx_citemacro_citep">(Loshchilov and Hutter, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib53" title="">2017</a>)</cite> with hyper-parameters set to <math alttext="\beta_{1}=0.9" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.1.m1.1"><semantics id="S4.SS2.SSS0.Px2.p1.1.m1.1a"><mrow id="S4.SS2.SSS0.Px2.p1.1.m1.1.1" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.cmml"><msub id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.cmml"><mi id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.2" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.2.cmml">β</mi><mn id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.3" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.3.cmml">1</mn></msub><mo id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1.cmml">=</mo><mn id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3.cmml">0.9</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.1.m1.1b"><apply id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1"><eq id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.1"></eq><apply id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.1.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2">subscript</csymbol><ci id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.2.cmml" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.2">𝛽</ci><cn id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.3.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.2.3">1</cn></apply><cn id="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3.cmml" type="float" xref="S4.SS2.SSS0.Px2.p1.1.m1.1.1.3">0.9</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.1.m1.1c">\beta_{1}=0.9</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.1.m1.1d">italic_β start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT = 0.9</annotation></semantics></math>, <math alttext="\beta_{2}=0.95" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.2.m2.1"><semantics id="S4.SS2.SSS0.Px2.p1.2.m2.1a"><mrow id="S4.SS2.SSS0.Px2.p1.2.m2.1.1" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.cmml"><msub id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2.cmml"><mi id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2.2" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2.2.cmml">β</mi><mn id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2.3" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2.3.cmml">2</mn></msub><mo id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.1" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.1.cmml">=</mo><mn id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.3" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.3.cmml">0.95</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.2.m2.1b"><apply id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1"><eq id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.1"></eq><apply id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2.cmml" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2.1.cmml" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2">subscript</csymbol><ci id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2.2.cmml" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2.2">𝛽</ci><cn id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2.3.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.2.3">2</cn></apply><cn id="S4.SS2.SSS0.Px2.p1.2.m2.1.1.3.cmml" type="float" xref="S4.SS2.SSS0.Px2.p1.2.m2.1.1.3">0.95</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.2.m2.1c">\beta_{2}=0.95</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.2.m2.1d">italic_β start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT = 0.95</annotation></semantics></math>, and <math alttext="\mathrm{weight\_decay}=0.1" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.3.m3.1"><semantics id="S4.SS2.SSS0.Px2.p1.3.m3.1a"><mrow id="S4.SS2.SSS0.Px2.p1.3.m3.1.1" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.cmml"><mrow id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.cmml"><mi id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.2" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.2.cmml">weight</mi><mo id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.1" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.3" mathvariant="normal" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.3.cmml">_</mi><mo id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.1a" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.1.cmml">⁢</mo><mi id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.4" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.4.cmml">decay</mi></mrow><mo id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.1" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.1.cmml">=</mo><mn id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.3" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.3.cmml">0.1</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.3.m3.1b"><apply id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1"><eq id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.1"></eq><apply id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.cmml" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2"><times id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.1.cmml" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.1"></times><ci id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.2.cmml" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.2">weight</ci><ci id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.3.cmml" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.3">_</ci><ci id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.4.cmml" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.2.4">decay</ci></apply><cn id="S4.SS2.SSS0.Px2.p1.3.m3.1.1.3.cmml" type="float" xref="S4.SS2.SSS0.Px2.p1.3.m3.1.1.3">0.1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.3.m3.1c">\mathrm{weight\_decay}=0.1</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.3.m3.1d">roman_weight _ roman_decay = 0.1</annotation></semantics></math>.
We set the maximum sequence length to 4K during pre-training, and pre-train DeepSeek-V3 on 14.8T tokens.
As for the learning rate scheduling, we first linearly increase it from 0 to <math alttext="2.2\times 10^{-4}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.4.m4.1"><semantics id="S4.SS2.SSS0.Px2.p1.4.m4.1a"><mrow id="S4.SS2.SSS0.Px2.p1.4.m4.1.1" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.cmml"><mn id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.2" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.2.cmml">2.2</mn><mo id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.1.cmml">×</mo><msup id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.cmml"><mn id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.2" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.2.cmml">10</mn><mrow id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3.cmml"><mo id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3a" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3.cmml">−</mo><mn id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3.2" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3.2.cmml">4</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.4.m4.1b"><apply id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1"><times id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.1"></times><cn id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.2.cmml" type="float" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.2">2.2</cn><apply id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.cmml" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.1.cmml" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3">superscript</csymbol><cn id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.2.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.2">10</cn><apply id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3.cmml" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3"><minus id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3.1.cmml" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3"></minus><cn id="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3.2.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.4.m4.1.1.3.3.2">4</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.4.m4.1c">2.2\times 10^{-4}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.4.m4.1d">2.2 × 10 start_POSTSUPERSCRIPT - 4 end_POSTSUPERSCRIPT</annotation></semantics></math> during the first 2K steps.
Then, we keep a constant learning rate of <math alttext="2.2\times 10^{-4}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.5.m5.1"><semantics id="S4.SS2.SSS0.Px2.p1.5.m5.1a"><mrow id="S4.SS2.SSS0.Px2.p1.5.m5.1.1" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.cmml"><mn id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.2" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.2.cmml">2.2</mn><mo id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.1.cmml">×</mo><msup id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.cmml"><mn id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.2" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.2.cmml">10</mn><mrow id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3.cmml"><mo id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3a" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3.cmml">−</mo><mn id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3.2" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3.2.cmml">4</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.5.m5.1b"><apply id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1"><times id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.1"></times><cn id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.2.cmml" type="float" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.2">2.2</cn><apply id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.cmml" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.1.cmml" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3">superscript</csymbol><cn id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.2.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.2">10</cn><apply id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3.cmml" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3"><minus id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3.1.cmml" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3"></minus><cn id="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3.2.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.5.m5.1.1.3.3.2">4</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.5.m5.1c">2.2\times 10^{-4}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.5.m5.1d">2.2 × 10 start_POSTSUPERSCRIPT - 4 end_POSTSUPERSCRIPT</annotation></semantics></math> until the model consumes 10T training tokens.
Subsequently, we gradually decay the learning rate to <math alttext="2.2\times 10^{-5}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.6.m6.1"><semantics id="S4.SS2.SSS0.Px2.p1.6.m6.1a"><mrow id="S4.SS2.SSS0.Px2.p1.6.m6.1.1" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.cmml"><mn id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.2" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.2.cmml">2.2</mn><mo id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.1.cmml">×</mo><msup id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.cmml"><mn id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.2" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.2.cmml">10</mn><mrow id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3.cmml"><mo id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3a" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3.cmml">−</mo><mn id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3.2" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3.2.cmml">5</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.6.m6.1b"><apply id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1"><times id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.1"></times><cn id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.2.cmml" type="float" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.2">2.2</cn><apply id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.cmml" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.1.cmml" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3">superscript</csymbol><cn id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.2.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.2">10</cn><apply id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3.cmml" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3"><minus id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3.1.cmml" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3"></minus><cn id="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3.2.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.6.m6.1.1.3.3.2">5</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.6.m6.1c">2.2\times 10^{-5}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.6.m6.1d">2.2 × 10 start_POSTSUPERSCRIPT - 5 end_POSTSUPERSCRIPT</annotation></semantics></math> in 4.3T tokens, following a cosine decay curve.
During the training of the final 500B tokens, we keep a constant learning rate of <math alttext="2.2\times 10^{-5}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.7.m7.1"><semantics id="S4.SS2.SSS0.Px2.p1.7.m7.1a"><mrow id="S4.SS2.SSS0.Px2.p1.7.m7.1.1" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.cmml"><mn id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.2" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.2.cmml">2.2</mn><mo id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.1.cmml">×</mo><msup id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.cmml"><mn id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.2" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.2.cmml">10</mn><mrow id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3.cmml"><mo id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3a" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3.cmml">−</mo><mn id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3.2" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3.2.cmml">5</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.7.m7.1b"><apply id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1"><times id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.1"></times><cn id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.2.cmml" type="float" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.2">2.2</cn><apply id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.cmml" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.1.cmml" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3">superscript</csymbol><cn id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.2.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.2">10</cn><apply id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3.cmml" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3"><minus id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3.1.cmml" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3"></minus><cn id="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3.2.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.7.m7.1.1.3.3.2">5</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.7.m7.1c">2.2\times 10^{-5}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.7.m7.1d">2.2 × 10 start_POSTSUPERSCRIPT - 5 end_POSTSUPERSCRIPT</annotation></semantics></math> in the first 333B tokens, and switch to another constant learning rate of <math alttext="7.3\times 10^{-6}" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.8.m8.1"><semantics id="S4.SS2.SSS0.Px2.p1.8.m8.1a"><mrow id="S4.SS2.SSS0.Px2.p1.8.m8.1.1" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.cmml"><mn id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.2" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.2.cmml">7.3</mn><mo id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.1.cmml">×</mo><msup id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.cmml"><mn id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.2" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.2.cmml">10</mn><mrow id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3.cmml"><mo id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3a" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3.cmml">−</mo><mn id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3.2" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3.2.cmml">6</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.8.m8.1b"><apply id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1"><times id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.1"></times><cn id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.2.cmml" type="float" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.2">7.3</cn><apply id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.cmml" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3"><csymbol cd="ambiguous" id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.1.cmml" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3">superscript</csymbol><cn id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.2.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.2">10</cn><apply id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3.cmml" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3"><minus id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3.1.cmml" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3"></minus><cn id="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3.2.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.8.m8.1.1.3.3.2">6</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.8.m8.1c">7.3\times 10^{-6}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.8.m8.1d">7.3 × 10 start_POSTSUPERSCRIPT - 6 end_POSTSUPERSCRIPT</annotation></semantics></math> in the remaining 167B tokens.
The gradient clipping norm is set to 1.0.
We employ a batch size scheduling strategy, where the batch size is gradually increased from 3072 to 15360 in the training of the first 469B tokens, and then keeps 15360 in the remaining training.
We leverage pipeline parallelism to deploy different layers of a model on different GPUs, and for each layer, the routed experts will be uniformly deployed on 64 GPUs belonging to 8 nodes.
As for the node-limited routing, each token will be sent to at most 4 nodes (i.e., <math alttext="M=4" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.9.m9.1"><semantics id="S4.SS2.SSS0.Px2.p1.9.m9.1a"><mrow id="S4.SS2.SSS0.Px2.p1.9.m9.1.1" xref="S4.SS2.SSS0.Px2.p1.9.m9.1.1.cmml"><mi id="S4.SS2.SSS0.Px2.p1.9.m9.1.1.2" xref="S4.SS2.SSS0.Px2.p1.9.m9.1.1.2.cmml">M</mi><mo id="S4.SS2.SSS0.Px2.p1.9.m9.1.1.1" xref="S4.SS2.SSS0.Px2.p1.9.m9.1.1.1.cmml">=</mo><mn id="S4.SS2.SSS0.Px2.p1.9.m9.1.1.3" xref="S4.SS2.SSS0.Px2.p1.9.m9.1.1.3.cmml">4</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.9.m9.1b"><apply id="S4.SS2.SSS0.Px2.p1.9.m9.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.9.m9.1.1"><eq id="S4.SS2.SSS0.Px2.p1.9.m9.1.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.9.m9.1.1.1"></eq><ci id="S4.SS2.SSS0.Px2.p1.9.m9.1.1.2.cmml" xref="S4.SS2.SSS0.Px2.p1.9.m9.1.1.2">𝑀</ci><cn id="S4.SS2.SSS0.Px2.p1.9.m9.1.1.3.cmml" type="integer" xref="S4.SS2.SSS0.Px2.p1.9.m9.1.1.3">4</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.9.m9.1c">M=4</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.9.m9.1d">italic_M = 4</annotation></semantics></math>).
For auxiliary-loss-free load balancing, we set the bias update speed <math alttext="\gamma" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.10.m10.1"><semantics id="S4.SS2.SSS0.Px2.p1.10.m10.1a"><mi id="S4.SS2.SSS0.Px2.p1.10.m10.1.1" xref="S4.SS2.SSS0.Px2.p1.10.m10.1.1.cmml">γ</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.10.m10.1b"><ci id="S4.SS2.SSS0.Px2.p1.10.m10.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.10.m10.1.1">𝛾</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.10.m10.1c">\gamma</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.10.m10.1d">italic_γ</annotation></semantics></math> to 0.001 for the first 14.3T tokens, and to 0.0 for the remaining 500B tokens.
For the balance loss, we set <math alttext="\alpha" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.11.m11.1"><semantics id="S4.SS2.SSS0.Px2.p1.11.m11.1a"><mi id="S4.SS2.SSS0.Px2.p1.11.m11.1.1" xref="S4.SS2.SSS0.Px2.p1.11.m11.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.11.m11.1b"><ci id="S4.SS2.SSS0.Px2.p1.11.m11.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.11.m11.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.11.m11.1c">\alpha</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.11.m11.1d">italic_α</annotation></semantics></math> to 0.0001, just to avoid extreme imbalance within any single sequence.
The MTP loss weight <math alttext="\lambda" class="ltx_Math" display="inline" id="S4.SS2.SSS0.Px2.p1.12.m12.1"><semantics id="S4.SS2.SSS0.Px2.p1.12.m12.1a"><mi id="S4.SS2.SSS0.Px2.p1.12.m12.1.1" xref="S4.SS2.SSS0.Px2.p1.12.m12.1.1.cmml">λ</mi><annotation-xml encoding="MathML-Content" id="S4.SS2.SSS0.Px2.p1.12.m12.1b"><ci id="S4.SS2.SSS0.Px2.p1.12.m12.1.1.cmml" xref="S4.SS2.SSS0.Px2.p1.12.m12.1.1">𝜆</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.SSS0.Px2.p1.12.m12.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS0.Px2.p1.12.m12.1d">italic_λ</annotation></semantics></math> is set to 0.3 for the first 10T tokens, and to 0.1 for the remaining 4.8T tokens.</p>
</div>
<figure class="ltx_figure" id="S4.F8"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="425" id="S4.F8.g1" src="x8.png" width="814"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 8: </span>
Evaluation results on the ”Needle In A Haystack” (NIAH) tests.
DeepSeek-V3 performs well across all context window lengths up to 128K.
</figcaption>
</figure>
</section>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3 </span>Long Context Extension</h3>
<div class="ltx_para" id="S4.SS3.p1">
<p class="ltx_p" id="S4.SS3.p1.6">We adopt a similar approach to DeepSeek-V2 <cite class="ltx_cite ltx_citemacro_citep">(DeepSeek-AI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib16" title="">2024c</a>)</cite> to enable long context capabilities in DeepSeek-V3.
After the pre-training stage, we apply YaRN <cite class="ltx_cite ltx_citemacro_citep">(Peng et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib68" title="">2023a</a>)</cite> for context extension and perform two additional training phases, each comprising 1000 steps, to progressively expand the context window from 4K to 32K and then to 128K.
The YaRN configuration is consistent with that used in DeepSeek-V2, being applied exclusively to the decoupled shared key <math alttext="\mathbf{k}^{R}_{t}" class="ltx_Math" display="inline" id="S4.SS3.p1.1.m1.1"><semantics id="S4.SS3.p1.1.m1.1a"><msubsup id="S4.SS3.p1.1.m1.1.1" xref="S4.SS3.p1.1.m1.1.1.cmml"><mi id="S4.SS3.p1.1.m1.1.1.2.2" xref="S4.SS3.p1.1.m1.1.1.2.2.cmml">𝐤</mi><mi id="S4.SS3.p1.1.m1.1.1.3" xref="S4.SS3.p1.1.m1.1.1.3.cmml">t</mi><mi id="S4.SS3.p1.1.m1.1.1.2.3" xref="S4.SS3.p1.1.m1.1.1.2.3.cmml">R</mi></msubsup><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.1.m1.1b"><apply id="S4.SS3.p1.1.m1.1.1.cmml" xref="S4.SS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS3.p1.1.m1.1.1.1.cmml" xref="S4.SS3.p1.1.m1.1.1">subscript</csymbol><apply id="S4.SS3.p1.1.m1.1.1.2.cmml" xref="S4.SS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS3.p1.1.m1.1.1.2.1.cmml" xref="S4.SS3.p1.1.m1.1.1">superscript</csymbol><ci id="S4.SS3.p1.1.m1.1.1.2.2.cmml" xref="S4.SS3.p1.1.m1.1.1.2.2">𝐤</ci><ci id="S4.SS3.p1.1.m1.1.1.2.3.cmml" xref="S4.SS3.p1.1.m1.1.1.2.3">𝑅</ci></apply><ci id="S4.SS3.p1.1.m1.1.1.3.cmml" xref="S4.SS3.p1.1.m1.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.1.m1.1c">\mathbf{k}^{R}_{t}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.1.m1.1d">bold_k start_POSTSUPERSCRIPT italic_R end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math>.
The hyper-parameters remain identical across both phases, with the scale <math alttext="s=40" class="ltx_Math" display="inline" id="S4.SS3.p1.2.m2.1"><semantics id="S4.SS3.p1.2.m2.1a"><mrow id="S4.SS3.p1.2.m2.1.1" xref="S4.SS3.p1.2.m2.1.1.cmml"><mi id="S4.SS3.p1.2.m2.1.1.2" xref="S4.SS3.p1.2.m2.1.1.2.cmml">s</mi><mo id="S4.SS3.p1.2.m2.1.1.1" xref="S4.SS3.p1.2.m2.1.1.1.cmml">=</mo><mn id="S4.SS3.p1.2.m2.1.1.3" xref="S4.SS3.p1.2.m2.1.1.3.cmml">40</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.2.m2.1b"><apply id="S4.SS3.p1.2.m2.1.1.cmml" xref="S4.SS3.p1.2.m2.1.1"><eq id="S4.SS3.p1.2.m2.1.1.1.cmml" xref="S4.SS3.p1.2.m2.1.1.1"></eq><ci id="S4.SS3.p1.2.m2.1.1.2.cmml" xref="S4.SS3.p1.2.m2.1.1.2">𝑠</ci><cn id="S4.SS3.p1.2.m2.1.1.3.cmml" type="integer" xref="S4.SS3.p1.2.m2.1.1.3">40</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.2.m2.1c">s=40</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.2.m2.1d">italic_s = 40</annotation></semantics></math>, <math alttext="\alpha=1" class="ltx_Math" display="inline" id="S4.SS3.p1.3.m3.1"><semantics id="S4.SS3.p1.3.m3.1a"><mrow id="S4.SS3.p1.3.m3.1.1" xref="S4.SS3.p1.3.m3.1.1.cmml"><mi id="S4.SS3.p1.3.m3.1.1.2" xref="S4.SS3.p1.3.m3.1.1.2.cmml">α</mi><mo id="S4.SS3.p1.3.m3.1.1.1" xref="S4.SS3.p1.3.m3.1.1.1.cmml">=</mo><mn id="S4.SS3.p1.3.m3.1.1.3" xref="S4.SS3.p1.3.m3.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.3.m3.1b"><apply id="S4.SS3.p1.3.m3.1.1.cmml" xref="S4.SS3.p1.3.m3.1.1"><eq id="S4.SS3.p1.3.m3.1.1.1.cmml" xref="S4.SS3.p1.3.m3.1.1.1"></eq><ci id="S4.SS3.p1.3.m3.1.1.2.cmml" xref="S4.SS3.p1.3.m3.1.1.2">𝛼</ci><cn id="S4.SS3.p1.3.m3.1.1.3.cmml" type="integer" xref="S4.SS3.p1.3.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.3.m3.1c">\alpha=1</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.3.m3.1d">italic_α = 1</annotation></semantics></math>, <math alttext="\beta=32" class="ltx_Math" display="inline" id="S4.SS3.p1.4.m4.1"><semantics id="S4.SS3.p1.4.m4.1a"><mrow id="S4.SS3.p1.4.m4.1.1" xref="S4.SS3.p1.4.m4.1.1.cmml"><mi id="S4.SS3.p1.4.m4.1.1.2" xref="S4.SS3.p1.4.m4.1.1.2.cmml">β</mi><mo id="S4.SS3.p1.4.m4.1.1.1" xref="S4.SS3.p1.4.m4.1.1.1.cmml">=</mo><mn id="S4.SS3.p1.4.m4.1.1.3" xref="S4.SS3.p1.4.m4.1.1.3.cmml">32</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.4.m4.1b"><apply id="S4.SS3.p1.4.m4.1.1.cmml" xref="S4.SS3.p1.4.m4.1.1"><eq id="S4.SS3.p1.4.m4.1.1.1.cmml" xref="S4.SS3.p1.4.m4.1.1.1"></eq><ci id="S4.SS3.p1.4.m4.1.1.2.cmml" xref="S4.SS3.p1.4.m4.1.1.2">𝛽</ci><cn id="S4.SS3.p1.4.m4.1.1.3.cmml" type="integer" xref="S4.SS3.p1.4.m4.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.4.m4.1c">\beta=32</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.4.m4.1d">italic_β = 32</annotation></semantics></math>, and the scaling factor <math alttext="\sqrt{t}=0.1\ln{s}+1" class="ltx_Math" display="inline" id="S4.SS3.p1.5.m5.1"><semantics id="S4.SS3.p1.5.m5.1a"><mrow id="S4.SS3.p1.5.m5.1.1" xref="S4.SS3.p1.5.m5.1.1.cmml"><msqrt id="S4.SS3.p1.5.m5.1.1.2" xref="S4.SS3.p1.5.m5.1.1.2.cmml"><mi id="S4.SS3.p1.5.m5.1.1.2.2" xref="S4.SS3.p1.5.m5.1.1.2.2.cmml">t</mi></msqrt><mo id="S4.SS3.p1.5.m5.1.1.1" xref="S4.SS3.p1.5.m5.1.1.1.cmml">=</mo><mrow id="S4.SS3.p1.5.m5.1.1.3" xref="S4.SS3.p1.5.m5.1.1.3.cmml"><mrow id="S4.SS3.p1.5.m5.1.1.3.2" xref="S4.SS3.p1.5.m5.1.1.3.2.cmml"><mn id="S4.SS3.p1.5.m5.1.1.3.2.2" xref="S4.SS3.p1.5.m5.1.1.3.2.2.cmml">0.1</mn><mo id="S4.SS3.p1.5.m5.1.1.3.2.1" lspace="0.167em" xref="S4.SS3.p1.5.m5.1.1.3.2.1.cmml">⁢</mo><mrow id="S4.SS3.p1.5.m5.1.1.3.2.3" xref="S4.SS3.p1.5.m5.1.1.3.2.3.cmml"><mi id="S4.SS3.p1.5.m5.1.1.3.2.3.1" xref="S4.SS3.p1.5.m5.1.1.3.2.3.1.cmml">ln</mi><mo id="S4.SS3.p1.5.m5.1.1.3.2.3a" lspace="0.167em" xref="S4.SS3.p1.5.m5.1.1.3.2.3.cmml">⁡</mo><mi id="S4.SS3.p1.5.m5.1.1.3.2.3.2" xref="S4.SS3.p1.5.m5.1.1.3.2.3.2.cmml">s</mi></mrow></mrow><mo id="S4.SS3.p1.5.m5.1.1.3.1" xref="S4.SS3.p1.5.m5.1.1.3.1.cmml">+</mo><mn id="S4.SS3.p1.5.m5.1.1.3.3" xref="S4.SS3.p1.5.m5.1.1.3.3.cmml">1</mn></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.5.m5.1b"><apply id="S4.SS3.p1.5.m5.1.1.cmml" xref="S4.SS3.p1.5.m5.1.1"><eq id="S4.SS3.p1.5.m5.1.1.1.cmml" xref="S4.SS3.p1.5.m5.1.1.1"></eq><apply id="S4.SS3.p1.5.m5.1.1.2.cmml" xref="S4.SS3.p1.5.m5.1.1.2"><root id="S4.SS3.p1.5.m5.1.1.2a.cmml" xref="S4.SS3.p1.5.m5.1.1.2"></root><ci id="S4.SS3.p1.5.m5.1.1.2.2.cmml" xref="S4.SS3.p1.5.m5.1.1.2.2">𝑡</ci></apply><apply id="S4.SS3.p1.5.m5.1.1.3.cmml" xref="S4.SS3.p1.5.m5.1.1.3"><plus id="S4.SS3.p1.5.m5.1.1.3.1.cmml" xref="S4.SS3.p1.5.m5.1.1.3.1"></plus><apply id="S4.SS3.p1.5.m5.1.1.3.2.cmml" xref="S4.SS3.p1.5.m5.1.1.3.2"><times id="S4.SS3.p1.5.m5.1.1.3.2.1.cmml" xref="S4.SS3.p1.5.m5.1.1.3.2.1"></times><cn id="S4.SS3.p1.5.m5.1.1.3.2.2.cmml" type="float" xref="S4.SS3.p1.5.m5.1.1.3.2.2">0.1</cn><apply id="S4.SS3.p1.5.m5.1.1.3.2.3.cmml" xref="S4.SS3.p1.5.m5.1.1.3.2.3"><ln id="S4.SS3.p1.5.m5.1.1.3.2.3.1.cmml" xref="S4.SS3.p1.5.m5.1.1.3.2.3.1"></ln><ci id="S4.SS3.p1.5.m5.1.1.3.2.3.2.cmml" xref="S4.SS3.p1.5.m5.1.1.3.2.3.2">𝑠</ci></apply></apply><cn id="S4.SS3.p1.5.m5.1.1.3.3.cmml" type="integer" xref="S4.SS3.p1.5.m5.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.5.m5.1c">\sqrt{t}=0.1\ln{s}+1</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.5.m5.1d">square-root start_ARG italic_t end_ARG = 0.1 roman_ln italic_s + 1</annotation></semantics></math>.
In the first phase, the sequence length is set to 32K, and the batch size is 1920.
During the second phase, the sequence length is increased to 128K, and the batch size is reduced to 480.
The learning rate for both phases is set to <math alttext="7.3\times 10^{-6}" class="ltx_Math" display="inline" id="S4.SS3.p1.6.m6.1"><semantics id="S4.SS3.p1.6.m6.1a"><mrow id="S4.SS3.p1.6.m6.1.1" xref="S4.SS3.p1.6.m6.1.1.cmml"><mn id="S4.SS3.p1.6.m6.1.1.2" xref="S4.SS3.p1.6.m6.1.1.2.cmml">7.3</mn><mo id="S4.SS3.p1.6.m6.1.1.1" lspace="0.222em" rspace="0.222em" xref="S4.SS3.p1.6.m6.1.1.1.cmml">×</mo><msup id="S4.SS3.p1.6.m6.1.1.3" xref="S4.SS3.p1.6.m6.1.1.3.cmml"><mn id="S4.SS3.p1.6.m6.1.1.3.2" xref="S4.SS3.p1.6.m6.1.1.3.2.cmml">10</mn><mrow id="S4.SS3.p1.6.m6.1.1.3.3" xref="S4.SS3.p1.6.m6.1.1.3.3.cmml"><mo id="S4.SS3.p1.6.m6.1.1.3.3a" xref="S4.SS3.p1.6.m6.1.1.3.3.cmml">−</mo><mn id="S4.SS3.p1.6.m6.1.1.3.3.2" xref="S4.SS3.p1.6.m6.1.1.3.3.2.cmml">6</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.p1.6.m6.1b"><apply id="S4.SS3.p1.6.m6.1.1.cmml" xref="S4.SS3.p1.6.m6.1.1"><times id="S4.SS3.p1.6.m6.1.1.1.cmml" xref="S4.SS3.p1.6.m6.1.1.1"></times><cn id="S4.SS3.p1.6.m6.1.1.2.cmml" type="float" xref="S4.SS3.p1.6.m6.1.1.2">7.3</cn><apply id="S4.SS3.p1.6.m6.1.1.3.cmml" xref="S4.SS3.p1.6.m6.1.1.3"><csymbol cd="ambiguous" id="S4.SS3.p1.6.m6.1.1.3.1.cmml" xref="S4.SS3.p1.6.m6.1.1.3">superscript</csymbol><cn id="S4.SS3.p1.6.m6.1.1.3.2.cmml" type="integer" xref="S4.SS3.p1.6.m6.1.1.3.2">10</cn><apply id="S4.SS3.p1.6.m6.1.1.3.3.cmml" xref="S4.SS3.p1.6.m6.1.1.3.3"><minus id="S4.SS3.p1.6.m6.1.1.3.3.1.cmml" xref="S4.SS3.p1.6.m6.1.1.3.3"></minus><cn id="S4.SS3.p1.6.m6.1.1.3.3.2.cmml" type="integer" xref="S4.SS3.p1.6.m6.1.1.3.3.2">6</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.p1.6.m6.1c">7.3\times 10^{-6}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.p1.6.m6.1d">7.3 × 10 start_POSTSUPERSCRIPT - 6 end_POSTSUPERSCRIPT</annotation></semantics></math>, matching the final learning rate from the pre-training stage.</p>
</div>
<div class="ltx_para" id="S4.SS3.p2">
<p class="ltx_p" id="S4.SS3.p2.1">Through this two-phase extension training, DeepSeek-V3 is capable of handling inputs up to 128K in length while maintaining strong performance.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.F8" title="Figure 8 ‣ Training Hyper-Parameters. ‣ 4.2 Hyper-Parameters ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">8</span></a> illustrates that DeepSeek-V3, following supervised fine-tuning, achieves notable performance on the "Needle In A Haystack" (NIAH) test, demonstrating consistent robustness across context window lengths up to 128K.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.4 </span>Evaluations</h3>
<section class="ltx_subsubsection" id="S4.SS4.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.4.1 </span>Evaluation Benchmarks</h4>
<div class="ltx_para" id="S4.SS4.SSS1.p1">
<p class="ltx_p" id="S4.SS4.SSS1.p1.1">The base model of DeepSeek-V3 is pretrained on a multilingual corpus with English and Chinese constituting the majority, so we evaluate its performance on a series of benchmarks primarily in English and Chinese, as well as on a multilingual benchmark.
Our evaluation is based on our internal evaluation framework integrated in our HAI-LLM framework.
Considered benchmarks are categorized and listed as follows, where <span class="ltx_text ltx_framed ltx_framed_underline" id="S4.SS4.SSS1.p1.1.1">underlined</span> benchmarks are in Chinese and <span class="ltx_text ltx_ulem_uuline" id="S4.SS4.SSS1.p1.1.2">double-underlined</span> benchmarks are multilingual ones:</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p2">
<p class="ltx_p" id="S4.SS4.SSS1.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p2.1.1">Multi-subject multiple-choice</span> datasets include MMLU <cite class="ltx_cite ltx_citemacro_citep">(Hendrycks et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib34" title="">2020</a>)</cite>, MMLU-Redux <cite class="ltx_cite ltx_citemacro_citep">(Gema et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib25" title="">2024</a>)</cite>, MMLU-Pro <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib94" title="">2024b</a>)</cite>, <span class="ltx_text ltx_ulem_uuline" id="S4.SS4.SSS1.p2.1.2">MMMLU</span> <cite class="ltx_cite ltx_citemacro_citep">(OpenAI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib65" title="">2024b</a>)</cite>, <span class="ltx_text ltx_framed ltx_framed_underline" id="S4.SS4.SSS1.p2.1.3">C-Eval</span> <cite class="ltx_cite ltx_citemacro_citep">(Huang et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib36" title="">2023</a>)</cite>, and <span class="ltx_text ltx_framed ltx_framed_underline" id="S4.SS4.SSS1.p2.1.4">CMMLU</span> <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib47" title="">2023</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p3">
<p class="ltx_p" id="S4.SS4.SSS1.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p3.1.1">Language understanding and reasoning</span> datasets include HellaSwag <cite class="ltx_cite ltx_citemacro_citep">(Zellers et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib102" title="">2019</a>)</cite>, PIQA <cite class="ltx_cite ltx_citemacro_citep">(Bisk et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib8" title="">2020</a>)</cite>, ARC <cite class="ltx_cite ltx_citemacro_citep">(Clark et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib10" title="">2018</a>)</cite>, and BigBench Hard (BBH) <cite class="ltx_cite ltx_citemacro_citep">(Suzgun et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib88" title="">2022</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p4">
<p class="ltx_p" id="S4.SS4.SSS1.p4.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p4.1.1">Closed-book question answering</span> datasets include TriviaQA <cite class="ltx_cite ltx_citemacro_citep">(Joshi et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib39" title="">2017</a>)</cite> and NaturalQuestions <cite class="ltx_cite ltx_citemacro_citep">(Kwiatkowski et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib42" title="">2019</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p5">
<p class="ltx_p" id="S4.SS4.SSS1.p5.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p5.1.1">Reading comprehension</span> datasets include RACE <cite class="ltx_cite ltx_citemacro_cite">Lai et al. (<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib43" title="">2017</a>)</cite>, DROP <cite class="ltx_cite ltx_citemacro_citep">(Dua et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib19" title="">2019</a>)</cite>, <span class="ltx_text ltx_framed ltx_framed_underline" id="S4.SS4.SSS1.p5.1.2">C3</span> <cite class="ltx_cite ltx_citemacro_citep">(Sun et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib85" title="">2019a</a>)</cite>, and <span class="ltx_text ltx_framed ltx_framed_underline" id="S4.SS4.SSS1.p5.1.3">CMRC</span> <cite class="ltx_cite ltx_citemacro_citep">(Cui et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib12" title="">2019</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p6">
<p class="ltx_p" id="S4.SS4.SSS1.p6.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p6.1.1">Reference disambiguation</span> datasets include <span class="ltx_text ltx_framed ltx_framed_underline" id="S4.SS4.SSS1.p6.1.2">CLUEWSC</span> <cite class="ltx_cite ltx_citemacro_citep">(Xu et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib101" title="">2020</a>)</cite> and WinoGrande <cite class="ltx_cite ltx_citemacro_cite">Sakaguchi et al. (<a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib79" title="">2019</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p7">
<p class="ltx_p" id="S4.SS4.SSS1.p7.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p7.1.1">Language modeling</span> datasets include Pile <cite class="ltx_cite ltx_citemacro_citep">(Gao et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib24" title="">2020</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p8">
<p class="ltx_p" id="S4.SS4.SSS1.p8.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p8.1.1">Chinese understanding and culture</span> datasets include <span class="ltx_text ltx_framed ltx_framed_underline" id="S4.SS4.SSS1.p8.1.2">CCPM</span> <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib50" title="">2021</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p9">
<p class="ltx_p" id="S4.SS4.SSS1.p9.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p9.1.1">Math</span> datasets include GSM8K <cite class="ltx_cite ltx_citemacro_citep">(Cobbe et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib11" title="">2021</a>)</cite>, MATH <cite class="ltx_cite ltx_citemacro_citep">(Hendrycks et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib35" title="">2021</a>)</cite>, MGSM <cite class="ltx_cite ltx_citemacro_citep">(Shi et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib82" title="">2023</a>)</cite>, and <span class="ltx_text ltx_framed ltx_framed_underline" id="S4.SS4.SSS1.p9.1.2">CMath</span> <cite class="ltx_cite ltx_citemacro_citep">(Wei et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib95" title="">2023</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p10">
<p class="ltx_p" id="S4.SS4.SSS1.p10.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p10.1.1">Code</span> datasets include HumanEval <cite class="ltx_cite ltx_citemacro_citep">(Chen et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib9" title="">2021</a>)</cite>, LiveCodeBench-Base (0801-1101) <cite class="ltx_cite ltx_citemacro_citep">(Jain et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib37" title="">2024</a>)</cite>, MBPP <cite class="ltx_cite ltx_citemacro_citep">(Austin et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib4" title="">2021</a>)</cite>, and CRUXEval <cite class="ltx_cite ltx_citemacro_citep">(Gu et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib29" title="">2024</a>)</cite>.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p11">
<p class="ltx_p" id="S4.SS4.SSS1.p11.1"><span class="ltx_text ltx_font_bold" id="S4.SS4.SSS1.p11.1.1">Standardized exams</span> include <span class="ltx_text ltx_framed ltx_framed_underline" id="S4.SS4.SSS1.p11.1.2">AGIEval</span> <cite class="ltx_cite ltx_citemacro_citep">(Zhong et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib103" title="">2023</a>)</cite>.
Note that AGIEval includes both English and Chinese subsets.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS1.p12">
<p class="ltx_p" id="S4.SS4.SSS1.p12.1">Following our previous work <cite class="ltx_cite ltx_citemacro_citep">(DeepSeek-AI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib15" title="">2024b</a>, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib16" title="">c</a>)</cite>, we adopt perplexity-based evaluation for datasets including HellaSwag, PIQA, WinoGrande, RACE-Middle, RACE-High, MMLU, MMLU-Redux, MMLU-Pro, MMMLU, ARC-Easy, ARC-Challenge, C-Eval, CMMLU, C3, and CCPM, and adopt generation-based evaluation for TriviaQA, NaturalQuestions, DROP, MATH, GSM8K, MGSM, HumanEval, MBPP, LiveCodeBench-Base, CRUXEval, BBH, AGIEval, CLUEWSC, CMRC, and CMath.
In addition, we perform language-modeling-based evaluation for Pile-test and use Bits-Per-Byte (BPB) as the metric to guarantee fair comparison among models using different tokenizers.</p>
</div>
<figure class="ltx_table" id="S4.T3">
<table class="ltx_tabular ltx_align_middle" id="S4.T3.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T3.1.1.1">
<td class="ltx_td ltx_border_tt" id="S4.T3.1.1.1.1" style="padding-left:4.5pt;padding-right:4.5pt;"></td>
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T3.1.1.1.2" rowspan="2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.1.1.2.1" style="font-size:80%;">Benchmark <span class="ltx_text ltx_align_center" id="S4.T3.1.1.1.2.1.1" style="font-size:63%;">(Metric)</span></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T3.1.1.1.3" rowspan="2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.1.1.3.1" style="font-size:80%;"># Shots</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T3.1.1.1.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.1.1.4.1" style="font-size:80%;">DeepSeek-V2</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.1.1.1.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.1.1.5.1" style="font-size:80%;">Qwen2.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T3.1.1.1.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.1.1.6.1" style="font-size:80%;">LLaMA-3.1</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_tt" id="S4.T3.1.1.1.7" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.1.1.7.1" style="font-size:80%;">DeepSeek-V3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.2.2">
<td class="ltx_td" id="S4.T3.1.2.2.1" style="padding-left:4.5pt;padding-right:4.5pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.2.2.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.2.2.2.1" style="font-size:80%;">Base</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.2.2.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.2.2.3.1" style="font-size:80%;">72B Base</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.2.2.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.2.2.4.1" style="font-size:80%;">405B Base</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.2.2.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.2.2.5.1" style="font-size:80%;">Base</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.3.3">
<td class="ltx_td ltx_border_t" id="S4.T3.1.3.3.1" style="padding-left:4.5pt;padding-right:4.5pt;"></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.1.3.3.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.3.3.2.1" style="font-size:80%;">Architecture</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.3.3.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.3.3.3.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.3.3.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.3.3.4.1" style="font-size:80%;">MoE</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.3.3.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.3.3.5.1" style="font-size:80%;">Dense</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.3.3.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.3.3.6.1" style="font-size:80%;">Dense</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T3.1.3.3.7" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.3.3.7.1" style="font-size:80%;">MoE</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.4.4">
<td class="ltx_td" id="S4.T3.1.4.4.1" style="padding-left:4.5pt;padding-right:4.5pt;"></td>
<td class="ltx_td ltx_align_left" id="S4.T3.1.4.4.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.4.4.2.1" style="font-size:80%;"># Activated Params</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.4.4.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.4.4.3.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.4.4.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.4.4.4.1" style="font-size:80%;">21B</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.4.4.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.4.4.5.1" style="font-size:80%;">72B</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.4.4.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.4.4.6.1" style="font-size:80%;">405B</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.4.4.7" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.4.4.7.1" style="font-size:80%;">37B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.5.5">
<td class="ltx_td" id="S4.T3.1.5.5.1" style="padding-left:4.5pt;padding-right:4.5pt;"></td>
<td class="ltx_td ltx_align_left" id="S4.T3.1.5.5.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.5.5.2.1" style="font-size:80%;"># Total Params</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.5.5.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.5.5.3.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.5.5.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.5.5.4.1" style="font-size:80%;">236B</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.5.5.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.5.5.5.1" style="font-size:80%;">72B</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.5.5.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.5.5.6.1" style="font-size:80%;">405B</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.5.5.7" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.5.5.7.1" style="font-size:80%;">671B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.6.6">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.6.6.1" rowspan="16" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.6.6.1.1" style="font-size:80%;">English</span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.1.6.6.2" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.6.6.2.1" style="font-size:80%;">Pile-test </span><span class="ltx_text" id="S4.T3.1.6.6.2.2" style="font-size:50%;">(BPB)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.6.6.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.6.6.3.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.6.6.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.6.6.4.1" style="font-size:80%;">0.606</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.6.6.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.6.6.5.1" style="font-size:80%;">0.638</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.6.6.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.6.6.6.1" style="font-size:80%;">0.542</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T3.1.6.6.7" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.6.6.7.1" style="font-size:80%;">0.548</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.7.7">
<td class="ltx_td ltx_align_left" id="S4.T3.1.7.7.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.7.7.1.1" style="font-size:80%;">BBH </span><span class="ltx_text" id="S4.T3.1.7.7.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.7.7.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.7.7.2.1" style="font-size:80%;">3-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.7.7.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.7.7.3.1" style="font-size:80%;">78.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.7.7.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.7.7.4.1" style="font-size:80%;">79.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.7.7.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.7.7.5.1" style="font-size:80%;">82.9</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.7.7.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.7.7.6.1" style="font-size:80%;">87.5</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.8.8">
<td class="ltx_td ltx_align_left" id="S4.T3.1.8.8.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.8.8.1.1" style="font-size:80%;">MMLU </span><span class="ltx_text" id="S4.T3.1.8.8.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.8.8.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.8.8.2.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.8.8.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.8.8.3.1" style="font-size:80%;">78.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.8.8.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.8.8.4.1" style="font-size:80%;">85.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.8.8.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.8.8.5.1" style="font-size:80%;">84.4</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.8.8.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.8.8.6.1" style="font-size:80%;">87.1</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.9.9">
<td class="ltx_td ltx_align_left" id="S4.T3.1.9.9.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.9.9.1.1" style="font-size:80%;">MMLU-Redux </span><span class="ltx_text" id="S4.T3.1.9.9.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.9.9.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.9.9.2.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.9.9.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.9.9.3.1" style="font-size:80%;">75.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.9.9.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.9.9.4.1" style="font-size:80%;">83.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.9.9.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.9.9.5.1" style="font-size:80%;">81.3</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.9.9.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.9.9.6.1" style="font-size:80%;">86.2</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.10.10">
<td class="ltx_td ltx_align_left" id="S4.T3.1.10.10.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.10.10.1.1" style="font-size:80%;">MMLU-Pro </span><span class="ltx_text" id="S4.T3.1.10.10.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.10.10.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.10.10.2.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.10.10.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.10.10.3.1" style="font-size:80%;">51.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.10.10.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.10.10.4.1" style="font-size:80%;">58.3</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.10.10.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.10.10.5.1" style="font-size:80%;">52.8</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.10.10.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.10.10.6.1" style="font-size:80%;">64.4</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.11.11">
<td class="ltx_td ltx_align_left" id="S4.T3.1.11.11.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.11.11.1.1" style="font-size:80%;">DROP </span><span class="ltx_text" id="S4.T3.1.11.11.1.2" style="font-size:50%;">(F1)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.11.11.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.11.11.2.1" style="font-size:80%;">3-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.11.11.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.11.11.3.1" style="font-size:80%;">80.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.11.11.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.11.11.4.1" style="font-size:80%;">80.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.11.11.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.11.11.5.1" style="font-size:80%;">86.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.11.11.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.11.11.6.1" style="font-size:80%;">89.0</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.12.12">
<td class="ltx_td ltx_align_left" id="S4.T3.1.12.12.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.12.12.1.1" style="font-size:80%;">ARC-Easy </span><span class="ltx_text" id="S4.T3.1.12.12.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.12.12.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.12.12.2.1" style="font-size:80%;">25-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.12.12.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.12.12.3.1" style="font-size:80%;">97.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.12.12.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.12.12.4.1" style="font-size:80%;">98.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.12.12.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.12.12.5.1" style="font-size:80%;">98.4</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.12.12.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.12.12.6.1" style="font-size:80%;">98.9</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.13.13">
<td class="ltx_td ltx_align_left" id="S4.T3.1.13.13.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.13.13.1.1" style="font-size:80%;">ARC-Challenge </span><span class="ltx_text" id="S4.T3.1.13.13.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.13.13.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.13.13.2.1" style="font-size:80%;">25-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.13.13.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.13.13.3.1" style="font-size:80%;">92.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.13.13.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.13.13.4.1" style="font-size:80%;">94.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.13.13.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.13.13.5.1" style="font-size:80%;">95.3</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.13.13.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.13.13.6.1" style="font-size:80%;">95.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.14.14">
<td class="ltx_td ltx_align_left" id="S4.T3.1.14.14.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.14.14.1.1" style="font-size:80%;">HellaSwag </span><span class="ltx_text" id="S4.T3.1.14.14.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.14.14.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.14.14.2.1" style="font-size:80%;">10-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.14.14.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.14.14.3.1" style="font-size:80%;">87.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.14.14.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.14.14.4.1" style="font-size:80%;">84.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.14.14.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.14.14.5.1" style="font-size:80%;">89.2</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.14.14.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.14.14.6.1" style="font-size:80%;">88.9</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.15.15">
<td class="ltx_td ltx_align_left" id="S4.T3.1.15.15.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.15.15.1.1" style="font-size:80%;">PIQA </span><span class="ltx_text" id="S4.T3.1.15.15.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.15.15.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.15.15.2.1" style="font-size:80%;">0-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.15.15.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.15.15.3.1" style="font-size:80%;">83.9</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.15.15.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.15.15.4.1" style="font-size:80%;">82.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.15.15.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.15.15.5.1" style="font-size:80%;">85.9</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.15.15.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.15.15.6.1" style="font-size:80%;">84.7</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.16.16">
<td class="ltx_td ltx_align_left" id="S4.T3.1.16.16.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.16.16.1.1" style="font-size:80%;">WinoGrande </span><span class="ltx_text" id="S4.T3.1.16.16.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.16.16.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.16.16.2.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.16.16.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.16.16.3.1" style="font-size:80%;">86.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.16.16.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.16.16.4.1" style="font-size:80%;">82.3</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.16.16.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.16.16.5.1" style="font-size:80%;">85.2</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.16.16.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.16.16.6.1" style="font-size:80%;">84.9</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.17.17">
<td class="ltx_td ltx_align_left" id="S4.T3.1.17.17.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.17.17.1.1" style="font-size:80%;">RACE-Middle </span><span class="ltx_text" id="S4.T3.1.17.17.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.17.17.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.17.17.2.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.17.17.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.17.17.3.1" style="font-size:80%;">73.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.17.17.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.17.17.4.1" style="font-size:80%;">68.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.17.17.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.17.17.5.1" style="font-size:80%;">74.2</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.17.17.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.17.17.6.1" style="font-size:80%;">67.1</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.18.18">
<td class="ltx_td ltx_align_left" id="S4.T3.1.18.18.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.18.18.1.1" style="font-size:80%;">RACE-High </span><span class="ltx_text" id="S4.T3.1.18.18.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.18.18.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.18.18.2.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.18.18.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.18.18.3.1" style="font-size:80%;">52.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.18.18.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.18.18.4.1" style="font-size:80%;">50.3</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.18.18.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.18.18.5.1" style="font-size:80%;">56.8</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.18.18.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.18.18.6.1" style="font-size:80%;">51.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.19.19">
<td class="ltx_td ltx_align_left" id="S4.T3.1.19.19.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.19.19.1.1" style="font-size:80%;">TriviaQA </span><span class="ltx_text" id="S4.T3.1.19.19.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.19.19.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.19.19.2.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.19.19.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.19.19.3.1" style="font-size:80%;">80.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.19.19.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.19.19.4.1" style="font-size:80%;">71.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.19.19.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.19.19.5.1" style="font-size:80%;">82.7</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.19.19.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.19.19.6.1" style="font-size:80%;">82.9</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.20.20">
<td class="ltx_td ltx_align_left" id="S4.T3.1.20.20.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.20.20.1.1" style="font-size:80%;">NaturalQuestions </span><span class="ltx_text" id="S4.T3.1.20.20.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.20.20.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.20.20.2.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.20.20.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.20.20.3.1" style="font-size:80%;">38.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.20.20.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.20.20.4.1" style="font-size:80%;">33.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.20.20.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.20.20.5.1" style="font-size:80%;">41.5</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.20.20.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.20.20.6.1" style="font-size:80%;">40.0</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.21.21">
<td class="ltx_td ltx_align_left" id="S4.T3.1.21.21.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.21.21.1.1" style="font-size:80%;">AGIEval </span><span class="ltx_text" id="S4.T3.1.21.21.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.21.21.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.21.21.2.1" style="font-size:80%;">0-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.21.21.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.21.21.3.1" style="font-size:80%;">57.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.21.21.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.21.21.4.1" style="font-size:80%;">75.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.21.21.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.21.21.5.1" style="font-size:80%;">60.6</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.21.21.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.21.21.6.1" style="font-size:80%;">79.6</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.22.22">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.22.22.1" rowspan="4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.22.22.1.1" style="font-size:80%;">Code</span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.1.22.22.2" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.22.22.2.1" style="font-size:80%;">HumanEval </span><span class="ltx_text" id="S4.T3.1.22.22.2.2" style="font-size:50%;">(Pass@1)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.22.22.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.22.22.3.1" style="font-size:80%;">0-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.22.22.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.22.22.4.1" style="font-size:80%;">43.3</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.22.22.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.22.22.5.1" style="font-size:80%;">53.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.22.22.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.22.22.6.1" style="font-size:80%;">54.9</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T3.1.22.22.7" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.22.22.7.1" style="font-size:80%;">65.2</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.23.23">
<td class="ltx_td ltx_align_left" id="S4.T3.1.23.23.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.23.23.1.1" style="font-size:80%;">MBPP </span><span class="ltx_text" id="S4.T3.1.23.23.1.2" style="font-size:50%;">(Pass@1)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.23.23.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.23.23.2.1" style="font-size:80%;">3-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.23.23.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.23.23.3.1" style="font-size:80%;">65.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.23.23.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.23.23.4.1" style="font-size:80%;">72.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.23.23.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.23.23.5.1" style="font-size:80%;">68.4</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.23.23.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.23.23.6.1" style="font-size:80%;">75.4</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.24.24">
<td class="ltx_td ltx_align_left" id="S4.T3.1.24.24.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.24.24.1.1" style="font-size:80%;">LiveCodeBench-Base </span><span class="ltx_text" id="S4.T3.1.24.24.1.2" style="font-size:50%;">(Pass@1)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.24.24.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.24.24.2.1" style="font-size:80%;">3-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.24.24.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.24.24.3.1" style="font-size:80%;">11.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.24.24.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.24.24.4.1" style="font-size:80%;">12.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.24.24.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.24.24.5.1" style="font-size:80%;">15.5</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.24.24.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.24.24.6.1" style="font-size:80%;">19.4</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.25.25">
<td class="ltx_td ltx_align_left" id="S4.T3.1.25.25.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.25.25.1.1" style="font-size:80%;">CRUXEval-I </span><span class="ltx_text" id="S4.T3.1.25.25.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.25.25.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.25.25.2.1" style="font-size:80%;">2-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.25.25.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.25.25.3.1" style="font-size:80%;">52.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.25.25.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.25.25.4.1" style="font-size:80%;">59.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.25.25.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.25.25.5.1" style="font-size:80%;">58.5</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.25.25.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.25.25.6.1" style="font-size:80%;">67.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.26.26">
<td class="ltx_td" id="S4.T3.1.26.26.1" style="padding-left:4.5pt;padding-right:4.5pt;"></td>
<td class="ltx_td ltx_align_left" id="S4.T3.1.26.26.2" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.26.26.2.1" style="font-size:80%;">CRUXEval-O </span><span class="ltx_text" id="S4.T3.1.26.26.2.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.26.26.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.26.26.3.1" style="font-size:80%;">2-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.26.26.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.26.26.4.1" style="font-size:80%;">49.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.26.26.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.26.26.5.1" style="font-size:80%;">59.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.26.26.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.26.26.6.1" style="font-size:80%;">59.9</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.26.26.7" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.26.26.7.1" style="font-size:80%;">69.8</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.27.27">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.27.27.1" rowspan="3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.27.27.1.1" style="font-size:80%;">Math</span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.1.27.27.2" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.27.27.2.1" style="font-size:80%;">GSM8K </span><span class="ltx_text" id="S4.T3.1.27.27.2.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.27.27.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.27.27.3.1" style="font-size:80%;">8-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.27.27.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.27.27.4.1" style="font-size:80%;">81.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.27.27.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.27.27.5.1" style="font-size:80%;">88.3</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.27.27.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.27.27.6.1" style="font-size:80%;">83.5</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T3.1.27.27.7" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.27.27.7.1" style="font-size:80%;">89.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.28.28">
<td class="ltx_td ltx_align_left" id="S4.T3.1.28.28.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.28.28.1.1" style="font-size:80%;">MATH </span><span class="ltx_text" id="S4.T3.1.28.28.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.28.28.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.28.28.2.1" style="font-size:80%;">4-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.28.28.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.28.28.3.1" style="font-size:80%;">43.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.28.28.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.28.28.4.1" style="font-size:80%;">54.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.28.28.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.28.28.5.1" style="font-size:80%;">49.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.28.28.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.28.28.6.1" style="font-size:80%;">61.6</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.29.29">
<td class="ltx_td ltx_align_left" id="S4.T3.1.29.29.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.29.29.1.1" style="font-size:80%;">MGSM </span><span class="ltx_text" id="S4.T3.1.29.29.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.29.29.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.29.29.2.1" style="font-size:80%;">8-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.29.29.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.29.29.3.1" style="font-size:80%;">63.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.29.29.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.29.29.4.1" style="font-size:80%;">76.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.29.29.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.29.29.5.1" style="font-size:80%;">69.9</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.29.29.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.29.29.6.1" style="font-size:80%;">79.8</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.30.30">
<td class="ltx_td" id="S4.T3.1.30.30.1" style="padding-left:4.5pt;padding-right:4.5pt;"></td>
<td class="ltx_td ltx_align_left" id="S4.T3.1.30.30.2" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.30.30.2.1" style="font-size:80%;">CMath </span><span class="ltx_text" id="S4.T3.1.30.30.2.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.30.30.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.30.30.3.1" style="font-size:80%;">3-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.30.30.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.30.30.4.1" style="font-size:80%;">78.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.30.30.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.30.30.5.1" style="font-size:80%;">84.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.30.30.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.30.30.6.1" style="font-size:80%;">77.3</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.30.30.7" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.30.30.7.1" style="font-size:80%;">90.7</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.31.31">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.31.31.1" rowspan="6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.31.31.1.1" style="font-size:80%;">Chinese</span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.1.31.31.2" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.31.31.2.1" style="font-size:80%;">CLUEWSC </span><span class="ltx_text" id="S4.T3.1.31.31.2.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.31.31.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.31.31.3.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.31.31.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.31.31.4.1" style="font-size:80%;">82.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.31.31.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.31.31.5.1" style="font-size:80%;">82.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.1.31.31.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.31.31.6.1" style="font-size:80%;">83.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T3.1.31.31.7" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.31.31.7.1" style="font-size:80%;">82.7</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.32.32">
<td class="ltx_td ltx_align_left" id="S4.T3.1.32.32.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.32.32.1.1" style="font-size:80%;">C-Eval </span><span class="ltx_text" id="S4.T3.1.32.32.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.32.32.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.32.32.2.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.32.32.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.32.32.3.1" style="font-size:80%;">81.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.32.32.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.32.32.4.1" style="font-size:80%;">89.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.32.32.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.32.32.5.1" style="font-size:80%;">72.5</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.32.32.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.32.32.6.1" style="font-size:80%;">90.1</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.33.33">
<td class="ltx_td ltx_align_left" id="S4.T3.1.33.33.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.33.33.1.1" style="font-size:80%;">CMMLU </span><span class="ltx_text" id="S4.T3.1.33.33.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.33.33.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.33.33.2.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.33.33.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.33.33.3.1" style="font-size:80%;">84.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.33.33.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.33.33.4.1" style="font-size:80%;">89.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.33.33.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.33.33.5.1" style="font-size:80%;">73.7</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.33.33.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.33.33.6.1" style="font-size:80%;">88.8</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.34.34">
<td class="ltx_td ltx_align_left" id="S4.T3.1.34.34.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.34.34.1.1" style="font-size:80%;">CMRC </span><span class="ltx_text" id="S4.T3.1.34.34.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.34.34.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.34.34.2.1" style="font-size:80%;">1-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.34.34.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.34.34.3.1" style="font-size:80%;">77.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.34.34.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.34.34.4.1" style="font-size:80%;">75.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.34.34.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.34.34.5.1" style="font-size:80%;">76.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.34.34.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.34.34.6.1" style="font-size:80%;">76.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.35.35">
<td class="ltx_td ltx_align_left" id="S4.T3.1.35.35.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.35.35.1.1" style="font-size:80%;">C3 </span><span class="ltx_text" id="S4.T3.1.35.35.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.35.35.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.35.35.2.1" style="font-size:80%;">0-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.35.35.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.35.35.3.1" style="font-size:80%;">77.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.35.35.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.35.35.4.1" style="font-size:80%;">76.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.35.35.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.35.35.5.1" style="font-size:80%;">79.7</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.35.35.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.35.35.6.1" style="font-size:80%;">78.6</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.36.36">
<td class="ltx_td ltx_align_left" id="S4.T3.1.36.36.1" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.36.36.1.1" style="font-size:80%;">CCPM </span><span class="ltx_text" id="S4.T3.1.36.36.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.36.36.2" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.36.36.2.1" style="font-size:80%;">0-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.36.36.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.36.36.3.1" style="font-size:80%;">93.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.36.36.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.36.36.4.1" style="font-size:80%;">88.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.1.36.36.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.36.36.5.1" style="font-size:80%;">78.6</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.36.36.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.36.36.6.1" style="font-size:80%;">92.0</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.37.37">
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T3.1.37.37.1" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.37.37.1.1" style="font-size:80%;">Multilingual</span></td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T3.1.37.37.2" style="padding-left:4.5pt;padding-right:4.5pt;">
<span class="ltx_text" id="S4.T3.1.37.37.2.1" style="font-size:80%;">MMMLU-non-English </span><span class="ltx_text" id="S4.T3.1.37.37.2.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="S4.T3.1.37.37.3" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.37.37.3.1" style="font-size:80%;">5-shot</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="S4.T3.1.37.37.4" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.37.37.4.1" style="font-size:80%;">64.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="S4.T3.1.37.37.5" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.37.37.5.1" style="font-size:80%;">74.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r ltx_border_t" id="S4.T3.1.37.37.6" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text" id="S4.T3.1.37.37.6.1" style="font-size:80%;">73.8</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_t" id="S4.T3.1.37.37.7" style="padding-left:4.5pt;padding-right:4.5pt;"><span class="ltx_text ltx_font_bold" id="S4.T3.1.37.37.7.1" style="font-size:80%;">79.4</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption" style="font-size:80%;"><span class="ltx_tag ltx_tag_table">Table 3: </span>
Comparison among DeepSeek-V3-Base and other representative open-source base models.
All models are evaluated in our internal framework and share the same evaluation setting.
Scores with a gap not exceeding 0.3 are considered to be at the same level.
DeepSeek-V3-Base achieves the best performance on most benchmarks, especially on math and code tasks.
</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S4.SS4.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.4.2 </span>Evaluation Results</h4>
<div class="ltx_para" id="S4.SS4.SSS2.p1">
<p class="ltx_p" id="S4.SS4.SSS2.p1.1">In Table <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.T3" title="Table 3 ‣ 4.4.1 Evaluation Benchmarks ‣ 4.4 Evaluations ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">3</span></a>, we compare the base model of DeepSeek-V3 with the state-of-the-art open-source base models, including DeepSeek-V2-Base <cite class="ltx_cite ltx_citemacro_citep">(DeepSeek-AI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib16" title="">2024c</a>)</cite> (our previous release), Qwen2.5 72B Base <cite class="ltx_cite ltx_citemacro_citep">(Qwen, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib74" title="">2024b</a>)</cite>, and LLaMA-3.1 405B Base <cite class="ltx_cite ltx_citemacro_citep">(AI@Meta, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib2" title="">2024b</a>)</cite>.
We evaluate all these models with our internal evaluation framework, and ensure that they share the same evaluation setting.
Note that due to the changes in our evaluation framework over the past months, the performance of DeepSeek-V2-Base exhibits a slight difference from our previously reported results.
Overall, DeepSeek-V3-Base comprehensively outperforms DeepSeek-V2-Base and Qwen2.5 72B Base, and surpasses LLaMA-3.1 405B Base in the majority of benchmarks, essentially becoming the strongest open-source model.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS2.p2">
<p class="ltx_p" id="S4.SS4.SSS2.p2.1">From a more detailed perspective, we compare DeepSeek-V3-Base with the other open-source base models individually.
(1)
Compared with DeepSeek-V2-Base, due to the improvements in our model architecture, the scale-up of the model size and training tokens, and the enhancement of data quality, DeepSeek-V3-Base achieves significantly better performance as expected.
(2)
Compared with Qwen2.5 72B Base, the state-of-the-art Chinese open-source model, with only half of the activated parameters, DeepSeek-V3-Base also demonstrates remarkable advantages, especially on English, multilingual, code, and math benchmarks.
As for Chinese benchmarks, except for CMMLU, a Chinese multi-subject multiple-choice task, DeepSeek-V3-Base also shows better performance than Qwen2.5 72B.
(3)
Compared with LLaMA-3.1 405B Base, the largest open-source model with 11 times the activated parameters, DeepSeek-V3-Base also exhibits much better performance on multilingual, code, and math benchmarks.
As for English and Chinese language benchmarks, DeepSeek-V3-Base shows competitive or better performance, and is especially good on BBH, MMLU-series, DROP, C-Eval, CMMLU, and CCPM.</p>
</div>
<div class="ltx_para" id="S4.SS4.SSS2.p3">
<p class="ltx_p" id="S4.SS4.SSS2.p3.1">Due to our efficient architectures and comprehensive engineering optimizations, DeepSeek-V3 achieves extremely high training efficiency.
Under our training framework and infrastructures, training DeepSeek-V3 on each trillion tokens requires only 180K H800 GPU hours, which is much cheaper than training 72B or 405B dense models.</p>
</div>
<figure class="ltx_table" id="S4.T4">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S4.T4.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T4.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="S4.T4.1.1.1.1" rowspan="2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.1.1.1.1" style="font-size:80%;">Benchmark (Metric)</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_tt" id="S4.T4.1.1.1.2" rowspan="2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.1.1.2.1" style="font-size:80%;"># Shots</span></th>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T4.1.1.1.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.1.1.3.1" style="font-size:80%;">Small MoE</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T4.1.1.1.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.1.1.4.1" style="font-size:80%;">Small MoE</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T4.1.1.1.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.1.1.5.1" style="font-size:80%;">Large MoE</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_tt" id="S4.T4.1.1.1.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.1.1.6.1" style="font-size:80%;">Large MoE</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.2.2">
<td class="ltx_td ltx_align_center" id="S4.T4.1.2.2.1" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.2.2.1.1" style="font-size:80%;">Baseline</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.1.2.2.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.2.2.2.1" style="font-size:80%;">w/ MTP</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.2.2.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.2.2.3.1" style="font-size:80%;">Baseline</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.2.2.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.2.2.4.1" style="font-size:80%;">w/ MTP</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T4.1.3.3.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.3.3.1.1" style="font-size:80%;"># Activated Params </span><span class="ltx_text" id="S4.T4.1.3.3.1.2" style="font-size:50%;">(Inference)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S4.T4.1.3.3.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.3.3.2.1" style="font-size:80%;">-</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.3.3.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.3.3.3.1" style="font-size:80%;">2.4B</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.1.3.3.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.3.3.4.1" style="font-size:80%;">2.4B</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.3.3.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.3.3.5.1" style="font-size:80%;">20.9B</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.1.3.3.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.3.3.6.1" style="font-size:80%;">20.9B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.4.4.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.4.4.1.1" style="font-size:80%;"># Total Params </span><span class="ltx_text" id="S4.T4.1.4.4.1.2" style="font-size:50%;">(Inference)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T4.1.4.4.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.4.4.2.1" style="font-size:80%;">-</span></th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.4.4.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.4.4.3.1" style="font-size:80%;">15.7B</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.1.4.4.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.4.4.4.1" style="font-size:80%;">15.7B</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.4.4.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.4.4.5.1" style="font-size:80%;">228.7B</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.4.4.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.4.4.6.1" style="font-size:80%;">228.7B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.5.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.5.5.1" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.5.5.1.1" style="font-size:80%;"># Training Tokens</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T4.1.5.5.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.5.5.2.1" style="font-size:80%;">-</span></th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.5.5.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.5.5.3.1" style="font-size:80%;">1.33T</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.1.5.5.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.5.5.4.1" style="font-size:80%;">1.33T</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.5.5.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.5.5.5.1" style="font-size:80%;">540B</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.5.5.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.5.5.6.1" style="font-size:80%;">540B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.6.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T4.1.6.6.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.6.6.1.1" style="font-size:80%;">Pile-test </span><span class="ltx_text" id="S4.T4.1.6.6.1.2" style="font-size:50%;">(BPB)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S4.T4.1.6.6.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.6.6.2.1" style="font-size:80%;">-</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.6.6.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.6.6.3.1" style="font-size:80%;">0.729</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T4.1.6.6.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.6.6.4.1" style="font-size:80%;">0.729</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.6.6.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.6.6.5.1" style="font-size:80%;">0.658</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.1.6.6.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.6.6.6.1" style="font-size:80%;">0.657</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.7.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.7.7.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.7.7.1.1" style="font-size:80%;">BBH </span><span class="ltx_text" id="S4.T4.1.7.7.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T4.1.7.7.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.7.7.2.1" style="font-size:80%;">3-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.7.7.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.7.7.3.1" style="font-size:80%;">39.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.1.7.7.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.7.7.4.1" style="font-size:80%;">41.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.7.7.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.7.7.5.1" style="font-size:80%;">70.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.7.7.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.7.7.6.1" style="font-size:80%;">70.7</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.8.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.8.8.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.8.8.1.1" style="font-size:80%;">MMLU </span><span class="ltx_text" id="S4.T4.1.8.8.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T4.1.8.8.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.8.8.2.1" style="font-size:80%;">5-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.8.8.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.8.8.3.1" style="font-size:80%;">50.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.1.8.8.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.8.8.4.1" style="font-size:80%;">53.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.8.8.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.8.8.5.1" style="font-size:80%;">67.5</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.8.8.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.8.8.6.1" style="font-size:80%;">66.6</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.9.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.9.9.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.9.9.1.1" style="font-size:80%;">DROP </span><span class="ltx_text" id="S4.T4.1.9.9.1.2" style="font-size:50%;">(F1)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T4.1.9.9.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.9.9.2.1" style="font-size:80%;">1-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.9.9.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.9.9.3.1" style="font-size:80%;">39.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.1.9.9.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.9.9.4.1" style="font-size:80%;">41.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.9.9.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.9.9.5.1" style="font-size:80%;">68.5</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.9.9.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.9.9.6.1" style="font-size:80%;">70.6</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.10.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.10.10.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.10.10.1.1" style="font-size:80%;">TriviaQA </span><span class="ltx_text" id="S4.T4.1.10.10.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T4.1.10.10.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.10.10.2.1" style="font-size:80%;">5-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.10.10.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.10.10.3.1" style="font-size:80%;">56.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.1.10.10.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.10.10.4.1" style="font-size:80%;">57.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.10.10.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.10.10.5.1" style="font-size:80%;">67.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.10.10.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.10.10.6.1" style="font-size:80%;">67.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.11.11">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.11.11.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.11.11.1.1" style="font-size:80%;">NaturalQuestions </span><span class="ltx_text" id="S4.T4.1.11.11.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T4.1.11.11.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.11.11.2.1" style="font-size:80%;">5-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.11.11.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.11.11.3.1" style="font-size:80%;">22.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.1.11.11.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.11.11.4.1" style="font-size:80%;">22.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.11.11.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.11.11.5.1" style="font-size:80%;">27.2</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.11.11.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.11.11.6.1" style="font-size:80%;">28.5</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.12.12">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.12.12.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.12.12.1.1" style="font-size:80%;">HumanEval </span><span class="ltx_text" id="S4.T4.1.12.12.1.2" style="font-size:50%;">(Pass@1)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T4.1.12.12.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.12.12.2.1" style="font-size:80%;">0-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.12.12.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.12.12.3.1" style="font-size:80%;">20.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.1.12.12.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.12.12.4.1" style="font-size:80%;">26.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.12.12.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.12.12.5.1" style="font-size:80%;">44.5</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.12.12.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.12.12.6.1" style="font-size:80%;">53.7</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.13.13">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.13.13.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.13.13.1.1" style="font-size:80%;">MBPP </span><span class="ltx_text" id="S4.T4.1.13.13.1.2" style="font-size:50%;">(Pass@1)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T4.1.13.13.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.13.13.2.1" style="font-size:80%;">3-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.13.13.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.13.13.3.1" style="font-size:80%;">35.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.1.13.13.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.13.13.4.1" style="font-size:80%;">36.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.13.13.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.13.13.5.1" style="font-size:80%;">61.6</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.13.13.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.13.13.6.1" style="font-size:80%;">62.2</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.14.14">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.14.14.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.14.14.1.1" style="font-size:80%;">GSM8K </span><span class="ltx_text" id="S4.T4.1.14.14.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T4.1.14.14.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.14.14.2.1" style="font-size:80%;">8-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.14.14.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.14.14.3.1" style="font-size:80%;">25.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T4.1.14.14.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.14.14.4.1" style="font-size:80%;">31.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.14.14.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.14.14.5.1" style="font-size:80%;">72.3</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.14.14.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.14.14.6.1" style="font-size:80%;">74.0</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.15.15">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S4.T4.1.15.15.1" style="padding-left:8.0pt;padding-right:8.0pt;">
<span class="ltx_text" id="S4.T4.1.15.15.1.1" style="font-size:80%;">MATH </span><span class="ltx_text" id="S4.T4.1.15.15.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="S4.T4.1.15.15.2" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.15.15.2.1" style="font-size:80%;">4-shot</span></th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.15.15.3" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.15.15.3.1" style="font-size:80%;">10.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S4.T4.1.15.15.4" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.15.15.4.1" style="font-size:80%;">12.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.15.15.5" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text" id="S4.T4.1.15.15.5.1" style="font-size:80%;">38.6</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S4.T4.1.15.15.6" style="padding-left:8.0pt;padding-right:8.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T4.1.15.15.6.1" style="font-size:80%;">39.8</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption" style="font-size:80%;"><span class="ltx_tag ltx_tag_table">Table 4: </span>
Ablation results for the MTP strategy.
The MTP strategy consistently enhances the model performance on most of the evaluation benchmarks.
</figcaption>
</figure>
</section>
</section>
<section class="ltx_subsection" id="S4.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.5 </span>Discussion</h3>
<section class="ltx_subsubsection" id="S4.SS5.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.5.1 </span>Ablation Studies for Multi-Token Prediction</h4>
<div class="ltx_para" id="S4.SS5.SSS1.p1">
<p class="ltx_p" id="S4.SS5.SSS1.p1.1">In Table <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.T4" title="Table 4 ‣ 4.4.2 Evaluation Results ‣ 4.4 Evaluations ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">4</span></a>, we show the ablation results for the MTP strategy.
To be specific, we validate the MTP strategy on top of two baseline models across different scales.
At the small scale, we train a baseline MoE model comprising 15.7B total parameters on 1.33T tokens.
At the large scale, we train a baseline MoE model comprising 228.7B total parameters on 540B tokens.
On top of them, keeping the training data and the other architectures the same, we append a 1-depth MTP module onto them and train two models with the MTP strategy for comparison.
Note that during inference, we directly discard the MTP module, so the inference costs of the compared models are exactly the same.
From the table, we can observe that the MTP strategy consistently enhances the model performance on most of the evaluation benchmarks.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS5.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.5.2 </span>Ablation Studies for the Auxiliary-Loss-Free Balancing Strategy</h4>
<div class="ltx_para" id="S4.SS5.SSS2.p1">
<p class="ltx_p" id="S4.SS5.SSS2.p1.1">In Table <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.T5" title="Table 5 ‣ 4.5.2 Ablation Studies for the Auxiliary-Loss-Free Balancing Strategy ‣ 4.5 Discussion ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">5</span></a>, we show the ablation results for the auxiliary-loss-free balancing strategy.
We validate this strategy on top of two baseline models across different scales.
At the small scale, we train a baseline MoE model comprising 15.7B total parameters on 1.33T tokens.
At the large scale, we train a baseline MoE model comprising 228.7B total parameters on 578B tokens.
Both of the baseline models purely use auxiliary losses to encourage load balance, and use the sigmoid gating function with top-K affinity normalization.
Their hyper-parameters to control the strength of auxiliary losses are the same as DeepSeek-V2-Lite and DeepSeek-V2, respectively.
On top of these two baseline models, keeping the training data and the other architectures the same, we remove all auxiliary losses and introduce the auxiliary-loss-free balancing strategy for comparison.
From the table, we can observe that the auxiliary-loss-free strategy consistently achieves better model performance on most of the evaluation benchmarks.</p>
</div>
<figure class="ltx_table" id="S4.T5">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S4.T5.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T5.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="S4.T5.1.1.1.1" rowspan="2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.1.1.1.1" style="font-size:80%;">Benchmark (Metric)</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_tt" id="S4.T5.1.1.1.2" rowspan="2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.1.1.2.1" style="font-size:80%;"># Shots</span></th>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.1.1.1.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.1.1.3.1" style="font-size:80%;">Small MoE</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T5.1.1.1.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.1.1.4.1" style="font-size:80%;">Small MoE</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.1.1.1.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.1.1.5.1" style="font-size:80%;">Large MoE</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_tt" id="S4.T5.1.1.1.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.1.1.6.1" style="font-size:80%;">Large MoE</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.2.2">
<td class="ltx_td ltx_align_center" id="S4.T5.1.2.2.1" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.2.2.1.1" style="font-size:80%;">Aux-Loss-Based</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T5.1.2.2.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.2.2.2.1" style="font-size:80%;">Aux-Loss-Free</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.2.2.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.2.2.3.1" style="font-size:80%;">Aux-Loss-Based</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.1.2.2.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.2.2.4.1" style="font-size:80%;">Aux-Loss-Free</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T5.1.3.3.1" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.3.3.1.1" style="font-size:80%;"># Activated Params</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S4.T5.1.3.3.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.3.3.2.1" style="font-size:80%;">-</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.3.3.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.3.3.3.1" style="font-size:80%;">2.4B</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.1.3.3.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.3.3.4.1" style="font-size:80%;">2.4B</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.3.3.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.3.3.5.1" style="font-size:80%;">20.9B</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T5.1.3.3.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.3.3.6.1" style="font-size:80%;">20.9B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.1.4.4.1" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.4.4.1.1" style="font-size:80%;"># Total Params</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T5.1.4.4.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.4.4.2.1" style="font-size:80%;">-</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.1.4.4.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.4.4.3.1" style="font-size:80%;">15.7B</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T5.1.4.4.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.4.4.4.1" style="font-size:80%;">15.7B</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.4.4.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.4.4.5.1" style="font-size:80%;">228.7B</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.1.4.4.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.4.4.6.1" style="font-size:80%;">228.7B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.5.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.1.5.5.1" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.5.5.1.1" style="font-size:80%;"># Training Tokens</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T5.1.5.5.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.5.5.2.1" style="font-size:80%;">-</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.1.5.5.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.5.5.3.1" style="font-size:80%;">1.33T</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T5.1.5.5.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.5.5.4.1" style="font-size:80%;">1.33T</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.5.5.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.5.5.5.1" style="font-size:80%;">578B</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.1.5.5.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.5.5.6.1" style="font-size:80%;">578B</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.6.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T5.1.6.6.1" style="padding-left:4.0pt;padding-right:4.0pt;">
<span class="ltx_text" id="S4.T5.1.6.6.1.1" style="font-size:80%;">Pile-test </span><span class="ltx_text" id="S4.T5.1.6.6.1.2" style="font-size:50%;">(BPB)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S4.T5.1.6.6.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.6.6.2.1" style="font-size:80%;">-</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.6.6.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.6.6.3.1" style="font-size:80%;">0.727</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T5.1.6.6.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.6.6.4.1" style="font-size:80%;">0.724</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.1.6.6.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.6.6.5.1" style="font-size:80%;">0.656</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T5.1.6.6.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.6.6.6.1" style="font-size:80%;">0.652</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.7.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.1.7.7.1" style="padding-left:4.0pt;padding-right:4.0pt;">
<span class="ltx_text" id="S4.T5.1.7.7.1.1" style="font-size:80%;">BBH </span><span class="ltx_text" id="S4.T5.1.7.7.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T5.1.7.7.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.7.7.2.1" style="font-size:80%;">3-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.1.7.7.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.7.7.3.1" style="font-size:80%;">37.3</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T5.1.7.7.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.7.7.4.1" style="font-size:80%;">39.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.7.7.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.7.7.5.1" style="font-size:80%;">66.7</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.1.7.7.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.7.7.6.1" style="font-size:80%;">67.9</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.8.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.1.8.8.1" style="padding-left:4.0pt;padding-right:4.0pt;">
<span class="ltx_text" id="S4.T5.1.8.8.1.1" style="font-size:80%;">MMLU </span><span class="ltx_text" id="S4.T5.1.8.8.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T5.1.8.8.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.8.8.2.1" style="font-size:80%;">5-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.1.8.8.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.8.8.3.1" style="font-size:80%;">51.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T5.1.8.8.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.8.8.4.1" style="font-size:80%;">51.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.8.8.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.8.8.5.1" style="font-size:80%;">68.3</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.1.8.8.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.8.8.6.1" style="font-size:80%;">67.2</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.9.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.1.9.9.1" style="padding-left:4.0pt;padding-right:4.0pt;">
<span class="ltx_text" id="S4.T5.1.9.9.1.1" style="font-size:80%;">DROP </span><span class="ltx_text" id="S4.T5.1.9.9.1.2" style="font-size:50%;">(F1)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T5.1.9.9.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.9.9.2.1" style="font-size:80%;">1-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.1.9.9.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.9.9.3.1" style="font-size:80%;">38.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T5.1.9.9.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.9.9.4.1" style="font-size:80%;">39.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.9.9.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.9.9.5.1" style="font-size:80%;">67.1</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.1.9.9.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.9.9.6.1" style="font-size:80%;">67.1</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.10.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.1.10.10.1" style="padding-left:4.0pt;padding-right:4.0pt;">
<span class="ltx_text" id="S4.T5.1.10.10.1.1" style="font-size:80%;">TriviaQA </span><span class="ltx_text" id="S4.T5.1.10.10.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T5.1.10.10.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.10.10.2.1" style="font-size:80%;">5-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.1.10.10.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.10.10.3.1" style="font-size:80%;">58.3</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T5.1.10.10.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.10.10.4.1" style="font-size:80%;">58.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.10.10.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.10.10.5.1" style="font-size:80%;">66.7</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.1.10.10.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.10.10.6.1" style="font-size:80%;">67.7</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.11.11">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.1.11.11.1" style="padding-left:4.0pt;padding-right:4.0pt;">
<span class="ltx_text" id="S4.T5.1.11.11.1.1" style="font-size:80%;">NaturalQuestions </span><span class="ltx_text" id="S4.T5.1.11.11.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T5.1.11.11.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.11.11.2.1" style="font-size:80%;">5-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.1.11.11.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.11.11.3.1" style="font-size:80%;">23.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T5.1.11.11.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.11.11.4.1" style="font-size:80%;">23.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.11.11.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.11.11.5.1" style="font-size:80%;">27.1</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.1.11.11.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.11.11.6.1" style="font-size:80%;">28.1</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.12.12">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.1.12.12.1" style="padding-left:4.0pt;padding-right:4.0pt;">
<span class="ltx_text" id="S4.T5.1.12.12.1.1" style="font-size:80%;">HumanEval </span><span class="ltx_text" id="S4.T5.1.12.12.1.2" style="font-size:50%;">(Pass@1)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T5.1.12.12.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.12.12.2.1" style="font-size:80%;">0-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.1.12.12.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.12.12.3.1" style="font-size:80%;">22.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T5.1.12.12.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.12.12.4.1" style="font-size:80%;">22.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.12.12.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.12.12.5.1" style="font-size:80%;">40.2</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.1.12.12.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.12.12.6.1" style="font-size:80%;">46.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.13.13">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.1.13.13.1" style="padding-left:4.0pt;padding-right:4.0pt;">
<span class="ltx_text" id="S4.T5.1.13.13.1.1" style="font-size:80%;">MBPP </span><span class="ltx_text" id="S4.T5.1.13.13.1.2" style="font-size:50%;">(Pass@1)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T5.1.13.13.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.13.13.2.1" style="font-size:80%;">3-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.1.13.13.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.13.13.3.1" style="font-size:80%;">36.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T5.1.13.13.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.13.13.4.1" style="font-size:80%;">35.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.13.13.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.13.13.5.1" style="font-size:80%;">59.2</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.1.13.13.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.13.13.6.1" style="font-size:80%;">61.2</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.14.14">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.1.14.14.1" style="padding-left:4.0pt;padding-right:4.0pt;">
<span class="ltx_text" id="S4.T5.1.14.14.1.1" style="font-size:80%;">GSM8K </span><span class="ltx_text" id="S4.T5.1.14.14.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S4.T5.1.14.14.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.14.14.2.1" style="font-size:80%;">8-shot</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.1.14.14.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.14.14.3.1" style="font-size:80%;">27.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T5.1.14.14.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.14.14.4.1" style="font-size:80%;">29.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.1.14.14.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.14.14.5.1" style="font-size:80%;">70.7</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.1.14.14.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.14.14.6.1" style="font-size:80%;">74.5</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.1.15.15">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S4.T5.1.15.15.1" style="padding-left:4.0pt;padding-right:4.0pt;">
<span class="ltx_text" id="S4.T5.1.15.15.1.1" style="font-size:80%;">MATH </span><span class="ltx_text" id="S4.T5.1.15.15.1.2" style="font-size:50%;">(EM)</span>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="S4.T5.1.15.15.2" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.15.15.2.1" style="font-size:80%;">4-shot</span></th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.1.15.15.3" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.15.15.3.1" style="font-size:80%;">10.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S4.T5.1.15.15.4" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.15.15.4.1" style="font-size:80%;">11.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.1.15.15.5" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text" id="S4.T5.1.15.15.5.1" style="font-size:80%;">37.2</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S4.T5.1.15.15.6" style="padding-left:4.0pt;padding-right:4.0pt;"><span class="ltx_text ltx_font_bold" id="S4.T5.1.15.15.6.1" style="font-size:80%;">39.6</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption" style="font-size:80%;"><span class="ltx_tag ltx_tag_table">Table 5: </span>
Ablation results for the auxiliary-loss-free balancing strategy.
Compared with the purely auxiliary-loss-based method, the auxiliary-loss-free strategy consistently achieves better model performance on most of the evaluation benchmarks.
</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S4.SS5.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.5.3 </span>Batch-Wise Load Balance VS. Sequence-Wise Load Balance</h4>
<div class="ltx_para" id="S4.SS5.SSS3.p1">
<p class="ltx_p" id="S4.SS5.SSS3.p1.1">The key distinction between auxiliary-loss-free balancing and sequence-wise auxiliary loss lies in their balancing scope: batch-wise versus sequence-wise.
Compared with the sequence-wise auxiliary loss, batch-wise balancing imposes a more flexible constraint, as it does not enforce in-domain balance on each sequence.
This flexibility allows experts to better specialize in different domains.
To validate this, we record and analyze the expert load of a 16B auxiliary-loss-based baseline and a 16B auxiliary-loss-free model on different domains in the Pile test set.
As illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S4.F9" title="Figure 9 ‣ 4.5.3 Batch-Wise Load Balance VS. Sequence-Wise Load Balance ‣ 4.5 Discussion ‣ 4 Pre-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">9</span></a>, we observe that the auxiliary-loss-free model demonstrates greater expert specialization patterns as expected.</p>
</div>
<div class="ltx_para" id="S4.SS5.SSS3.p2">
<p class="ltx_p" id="S4.SS5.SSS3.p2.1">To further investigate the correlation between this flexibility and the advantage in model performance, we additionally design and validate a batch-wise auxiliary loss that encourages load balance on each training batch instead of on each sequence.
The experimental results show that, when achieving a similar level of batch-wise load balance, the batch-wise auxiliary loss can also achieve similar model performance to the auxiliary-loss-free method.
To be specific, in our experiments with 1B MoE models, the validation losses are: 2.258 (using a sequence-wise auxiliary loss), 2.253 (using the auxiliary-loss-free method), and 2.253 (using a batch-wise auxiliary loss).
We also observe similar results on 3B MoE models: the model using a sequence-wise auxiliary loss achieves a validation loss of 2.085, and the models using the auxiliary-loss-free method or a batch-wise auxiliary loss achieve the same validation loss of 2.080.</p>
</div>
<div class="ltx_para" id="S4.SS5.SSS3.p3">
<p class="ltx_p" id="S4.SS5.SSS3.p3.1">In addition, although the batch-wise load balancing methods show consistent performance advantages, they also face two potential challenges in efficiency:
(1) load imbalance within certain sequences or small batches, and
(2) domain-shift-induced load imbalance during inference.
The first challenge is naturally addressed by our training framework that uses large-scale expert parallelism and data parallelism, which guarantees a large size of each micro-batch.
For the second challenge, we also design and implement an efficient inference framework with redundant expert deployment, as described in Section <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S3.SS4" title="3.4 Inference and Deployment ‣ 3 Infrastructures ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">3.4</span></a>, to overcome it.</p>
</div>
<figure class="ltx_figure" id="S4.F9"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="404" id="S4.F9.g1" src="x9.png" width="822"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 9: </span>
Expert load of auxiliary-loss-free and auxiliary-loss-based models on three domains in the Pile test set.
The auxiliary-loss-free model shows greater expert specialization patterns than the auxiliary-loss-based one.
The relative expert load denotes the ratio between the actual expert load and the theoretically balanced expert load.
Due to space constraints, we only present the results of two layers as an example, with the results of all layers provided in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A3" title="Appendix C Expert Specialization Patterns of the 16B Aux-Loss-Based and Aux-Loss-Free Models ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">C</span></a>.
</figcaption>
</figure>
</section>
</section>
</section>
<section class="ltx_section" id="S5" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Post-Training</h2>
<section class="ltx_subsection" id="S5.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1 </span>Supervised Fine-Tuning</h3>
<div class="ltx_para" id="S5.SS1.p1">
<p class="ltx_p" id="S5.SS1.p1.1">We curate our instruction-tuning datasets to include 1.5M instances spanning multiple domains, with each domain employing distinct data creation methods tailored to its specific requirements.</p>
</div>
<section class="ltx_paragraph" id="S5.SS1.SSS0.Px1">
<h5 class="ltx_title ltx_title_paragraph">Reasoning Data.</h5>
<div class="ltx_para" id="S5.SS1.SSS0.Px1.p1">
<p class="ltx_p" id="S5.SS1.SSS0.Px1.p1.1">For reasoning-related datasets, including those focused on mathematics, code competition problems, and logic puzzles, we generate the data by leveraging an internal DeepSeek-R1 model.
Specifically, while the R1-generated data demonstrates strong accuracy, it suffers from issues such as overthinking, poor formatting, and excessive length.
Our objective is to balance the high accuracy of R1-generated reasoning data and the clarity and conciseness of regularly formatted reasoning data.</p>
</div>
<div class="ltx_para" id="S5.SS1.SSS0.Px1.p2">
<p class="ltx_p" id="S5.SS1.SSS0.Px1.p2.1">To establish our methodology, we begin by developing an expert model tailored to a specific domain, such as code, mathematics, or general reasoning, using a combined Supervised Fine-Tuning (SFT) and Reinforcement Learning (RL) training pipeline.
This expert model serves as a data generator for the final model.
The training process involves generating two distinct types of SFT samples for each instance: the first couples the problem with its original response in the format of &lt;problem, original response&gt;, while the second incorporates a system prompt alongside the problem and the R1 response in the format of &lt;system prompt, problem, R1 response&gt;.</p>
</div>
<div class="ltx_para" id="S5.SS1.SSS0.Px1.p3">
<p class="ltx_p" id="S5.SS1.SSS0.Px1.p3.1">The system prompt is meticulously designed to include instructions that guide the model toward producing responses enriched with mechanisms for reflection and verification.
During the RL phase, the model leverages high-temperature sampling to generate responses that integrate patterns from both the R1-generated and original data, even in the absence of explicit system prompts.
After hundreds of RL steps, the intermediate RL model learns to incorporate R1 patterns, thereby enhancing overall performance strategically.</p>
</div>
<div class="ltx_para" id="S5.SS1.SSS0.Px1.p4">
<p class="ltx_p" id="S5.SS1.SSS0.Px1.p4.1">Upon completing the RL training phase, we implement rejection sampling to curate high-quality SFT data for the final model, where the expert models are used as data generation sources.
This method ensures that the final training data retains the strengths of DeepSeek-R1 while producing responses that are concise and effective.</p>
</div>
</section>
<section class="ltx_paragraph" id="S5.SS1.SSS0.Px2">
<h5 class="ltx_title ltx_title_paragraph">Non-Reasoning Data.</h5>
<div class="ltx_para" id="S5.SS1.SSS0.Px2.p1">
<p class="ltx_p" id="S5.SS1.SSS0.Px2.p1.1">For non-reasoning data, such as creative writing, role-play, and simple question answering, we utilize DeepSeek-V2.5 to generate responses and enlist human annotators to verify the accuracy and correctness of the data.</p>
</div>
</section>
<section class="ltx_paragraph" id="S5.SS1.SSS0.Px3">
<h5 class="ltx_title ltx_title_paragraph">SFT Settings.</h5>
<div class="ltx_para" id="S5.SS1.SSS0.Px3.p1">
<p class="ltx_p" id="S5.SS1.SSS0.Px3.p1.2">We fine-tune DeepSeek-V3-Base for two epochs using the SFT dataset, using the cosine decay learning rate scheduling that starts at <math alttext="5\times 10^{-6}" class="ltx_Math" display="inline" id="S5.SS1.SSS0.Px3.p1.1.m1.1"><semantics id="S5.SS1.SSS0.Px3.p1.1.m1.1a"><mrow id="S5.SS1.SSS0.Px3.p1.1.m1.1.1" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.cmml"><mn id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.2" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.2.cmml">5</mn><mo id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.1.cmml">×</mo><msup id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.cmml"><mn id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.2" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.2.cmml">10</mn><mrow id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3.cmml"><mo id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3a" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3.cmml">−</mo><mn id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3.2" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3.2.cmml">6</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.SSS0.Px3.p1.1.m1.1b"><apply id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.cmml" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1"><times id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.1.cmml" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.1"></times><cn id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.2.cmml" type="integer" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.2">5</cn><apply id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.cmml" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.1.cmml" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3">superscript</csymbol><cn id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.2.cmml" type="integer" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.2">10</cn><apply id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3.cmml" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3"><minus id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3.1.cmml" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3"></minus><cn id="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3.2.cmml" type="integer" xref="S5.SS1.SSS0.Px3.p1.1.m1.1.1.3.3.2">6</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.SSS0.Px3.p1.1.m1.1c">5\times 10^{-6}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.SSS0.Px3.p1.1.m1.1d">5 × 10 start_POSTSUPERSCRIPT - 6 end_POSTSUPERSCRIPT</annotation></semantics></math> and gradually decreases to <math alttext="1\times 10^{-6}" class="ltx_Math" display="inline" id="S5.SS1.SSS0.Px3.p1.2.m2.1"><semantics id="S5.SS1.SSS0.Px3.p1.2.m2.1a"><mrow id="S5.SS1.SSS0.Px3.p1.2.m2.1.1" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.cmml"><mn id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.2" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.2.cmml">1</mn><mo id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.1" lspace="0.222em" rspace="0.222em" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.1.cmml">×</mo><msup id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.cmml"><mn id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.2" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.2.cmml">10</mn><mrow id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3.cmml"><mo id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3a" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3.cmml">−</mo><mn id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3.2" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3.2.cmml">6</mn></mrow></msup></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.SSS0.Px3.p1.2.m2.1b"><apply id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.cmml" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1"><times id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.1.cmml" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.1"></times><cn id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.2.cmml" type="integer" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.2">1</cn><apply id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.cmml" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.1.cmml" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3">superscript</csymbol><cn id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.2.cmml" type="integer" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.2">10</cn><apply id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3.cmml" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3"><minus id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3.1.cmml" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3"></minus><cn id="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3.2.cmml" type="integer" xref="S5.SS1.SSS0.Px3.p1.2.m2.1.1.3.3.2">6</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.SSS0.Px3.p1.2.m2.1c">1\times 10^{-6}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.SSS0.Px3.p1.2.m2.1d">1 × 10 start_POSTSUPERSCRIPT - 6 end_POSTSUPERSCRIPT</annotation></semantics></math>.
During training, each single sequence is packed from multiple samples.
However, we adopt a sample masking strategy to ensure that these examples remain isolated and mutually invisible.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S5.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2 </span>Reinforcement Learning</h3>
<section class="ltx_subsubsection" id="S5.SS2.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.2.1 </span>Reward Model</h4>
<div class="ltx_para" id="S5.SS2.SSS1.p1">
<p class="ltx_p" id="S5.SS2.SSS1.p1.1">We employ a rule-based Reward Model (RM) and a model-based RM in our RL process.</p>
</div>
<section class="ltx_paragraph" id="S5.SS2.SSS1.Px1">
<h5 class="ltx_title ltx_title_paragraph">Rule-Based RM.</h5>
<div class="ltx_para" id="S5.SS2.SSS1.Px1.p1">
<p class="ltx_p" id="S5.SS2.SSS1.Px1.p1.1">For questions that can be validated using specific rules, we adopt a rule-based reward system to determine the feedback.
For instance, certain math problems have deterministic results, and we require the model to provide the final answer within a designated format (e.g., in a box), allowing us to apply rules to verify the correctness.
Similarly, for LeetCode problems, we can utilize a compiler to generate feedback based on test cases.
By leveraging rule-based validation wherever possible, we ensure a higher level of reliability, as this approach is resistant to manipulation or exploitation.</p>
</div>
</section>
<section class="ltx_paragraph" id="S5.SS2.SSS1.Px2">
<h5 class="ltx_title ltx_title_paragraph">Model-Based RM.</h5>
<div class="ltx_para" id="S5.SS2.SSS1.Px2.p1">
<p class="ltx_p" id="S5.SS2.SSS1.Px2.p1.1">For questions with free-form ground-truth answers, we rely on the reward model to determine whether the response matches the expected ground-truth.
Conversely, for questions without a definitive ground-truth, such as those involving creative writing, the reward model is tasked with providing feedback based on the question and the corresponding answer as inputs.
The reward model is trained from the DeepSeek-V3 SFT checkpoints.
To enhance its reliability, we construct preference data that not only provides the final reward but also includes the chain-of-thought leading to the reward.
This approach helps mitigate the risk of reward hacking in specific tasks.</p>
</div>
</section>
</section>
<section class="ltx_subsubsection" id="S5.SS2.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.2.2 </span>Group Relative Policy Optimization</h4>
<div class="ltx_para" id="S5.SS2.SSS2.p1">
<p class="ltx_p" id="S5.SS2.SSS2.p1.4">Similar to DeepSeek-V2 <cite class="ltx_cite ltx_citemacro_citep">(DeepSeek-AI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib16" title="">2024c</a>)</cite>, we adopt Group Relative Policy Optimization (GRPO) <cite class="ltx_cite ltx_citemacro_citep">(Shao et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib80" title="">2024</a>)</cite>, which foregoes the critic model that is typically with the same size as the policy model, and estimates the baseline from group scores instead.
Specifically, for each question <math alttext="q" class="ltx_Math" display="inline" id="S5.SS2.SSS2.p1.1.m1.1"><semantics id="S5.SS2.SSS2.p1.1.m1.1a"><mi id="S5.SS2.SSS2.p1.1.m1.1.1" xref="S5.SS2.SSS2.p1.1.m1.1.1.cmml">q</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS2.p1.1.m1.1b"><ci id="S5.SS2.SSS2.p1.1.m1.1.1.cmml" xref="S5.SS2.SSS2.p1.1.m1.1.1">𝑞</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS2.p1.1.m1.1c">q</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS2.p1.1.m1.1d">italic_q</annotation></semantics></math>, GRPO samples a group of outputs <math alttext="\{o_{1},o_{2},\cdots,o_{G}\}" class="ltx_Math" display="inline" id="S5.SS2.SSS2.p1.2.m2.4"><semantics id="S5.SS2.SSS2.p1.2.m2.4a"><mrow id="S5.SS2.SSS2.p1.2.m2.4.4.3" xref="S5.SS2.SSS2.p1.2.m2.4.4.4.cmml"><mo id="S5.SS2.SSS2.p1.2.m2.4.4.3.4" stretchy="false" xref="S5.SS2.SSS2.p1.2.m2.4.4.4.cmml">{</mo><msub id="S5.SS2.SSS2.p1.2.m2.2.2.1.1" xref="S5.SS2.SSS2.p1.2.m2.2.2.1.1.cmml"><mi id="S5.SS2.SSS2.p1.2.m2.2.2.1.1.2" xref="S5.SS2.SSS2.p1.2.m2.2.2.1.1.2.cmml">o</mi><mn id="S5.SS2.SSS2.p1.2.m2.2.2.1.1.3" xref="S5.SS2.SSS2.p1.2.m2.2.2.1.1.3.cmml">1</mn></msub><mo id="S5.SS2.SSS2.p1.2.m2.4.4.3.5" xref="S5.SS2.SSS2.p1.2.m2.4.4.4.cmml">,</mo><msub id="S5.SS2.SSS2.p1.2.m2.3.3.2.2" xref="S5.SS2.SSS2.p1.2.m2.3.3.2.2.cmml"><mi id="S5.SS2.SSS2.p1.2.m2.3.3.2.2.2" xref="S5.SS2.SSS2.p1.2.m2.3.3.2.2.2.cmml">o</mi><mn id="S5.SS2.SSS2.p1.2.m2.3.3.2.2.3" xref="S5.SS2.SSS2.p1.2.m2.3.3.2.2.3.cmml">2</mn></msub><mo id="S5.SS2.SSS2.p1.2.m2.4.4.3.6" xref="S5.SS2.SSS2.p1.2.m2.4.4.4.cmml">,</mo><mi id="S5.SS2.SSS2.p1.2.m2.1.1" mathvariant="normal" xref="S5.SS2.SSS2.p1.2.m2.1.1.cmml">⋯</mi><mo id="S5.SS2.SSS2.p1.2.m2.4.4.3.7" xref="S5.SS2.SSS2.p1.2.m2.4.4.4.cmml">,</mo><msub id="S5.SS2.SSS2.p1.2.m2.4.4.3.3" xref="S5.SS2.SSS2.p1.2.m2.4.4.3.3.cmml"><mi id="S5.SS2.SSS2.p1.2.m2.4.4.3.3.2" xref="S5.SS2.SSS2.p1.2.m2.4.4.3.3.2.cmml">o</mi><mi id="S5.SS2.SSS2.p1.2.m2.4.4.3.3.3" xref="S5.SS2.SSS2.p1.2.m2.4.4.3.3.3.cmml">G</mi></msub><mo id="S5.SS2.SSS2.p1.2.m2.4.4.3.8" stretchy="false" xref="S5.SS2.SSS2.p1.2.m2.4.4.4.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS2.p1.2.m2.4b"><set id="S5.SS2.SSS2.p1.2.m2.4.4.4.cmml" xref="S5.SS2.SSS2.p1.2.m2.4.4.3"><apply id="S5.SS2.SSS2.p1.2.m2.2.2.1.1.cmml" xref="S5.SS2.SSS2.p1.2.m2.2.2.1.1"><csymbol cd="ambiguous" id="S5.SS2.SSS2.p1.2.m2.2.2.1.1.1.cmml" xref="S5.SS2.SSS2.p1.2.m2.2.2.1.1">subscript</csymbol><ci id="S5.SS2.SSS2.p1.2.m2.2.2.1.1.2.cmml" xref="S5.SS2.SSS2.p1.2.m2.2.2.1.1.2">𝑜</ci><cn id="S5.SS2.SSS2.p1.2.m2.2.2.1.1.3.cmml" type="integer" xref="S5.SS2.SSS2.p1.2.m2.2.2.1.1.3">1</cn></apply><apply id="S5.SS2.SSS2.p1.2.m2.3.3.2.2.cmml" xref="S5.SS2.SSS2.p1.2.m2.3.3.2.2"><csymbol cd="ambiguous" id="S5.SS2.SSS2.p1.2.m2.3.3.2.2.1.cmml" xref="S5.SS2.SSS2.p1.2.m2.3.3.2.2">subscript</csymbol><ci id="S5.SS2.SSS2.p1.2.m2.3.3.2.2.2.cmml" xref="S5.SS2.SSS2.p1.2.m2.3.3.2.2.2">𝑜</ci><cn id="S5.SS2.SSS2.p1.2.m2.3.3.2.2.3.cmml" type="integer" xref="S5.SS2.SSS2.p1.2.m2.3.3.2.2.3">2</cn></apply><ci id="S5.SS2.SSS2.p1.2.m2.1.1.cmml" xref="S5.SS2.SSS2.p1.2.m2.1.1">⋯</ci><apply id="S5.SS2.SSS2.p1.2.m2.4.4.3.3.cmml" xref="S5.SS2.SSS2.p1.2.m2.4.4.3.3"><csymbol cd="ambiguous" id="S5.SS2.SSS2.p1.2.m2.4.4.3.3.1.cmml" xref="S5.SS2.SSS2.p1.2.m2.4.4.3.3">subscript</csymbol><ci id="S5.SS2.SSS2.p1.2.m2.4.4.3.3.2.cmml" xref="S5.SS2.SSS2.p1.2.m2.4.4.3.3.2">𝑜</ci><ci id="S5.SS2.SSS2.p1.2.m2.4.4.3.3.3.cmml" xref="S5.SS2.SSS2.p1.2.m2.4.4.3.3.3">𝐺</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS2.p1.2.m2.4c">\{o_{1},o_{2},\cdots,o_{G}\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS2.p1.2.m2.4d">{ italic_o start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_o start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , ⋯ , italic_o start_POSTSUBSCRIPT italic_G end_POSTSUBSCRIPT }</annotation></semantics></math> from the old policy model <math alttext="\pi_{\theta_{old}}" class="ltx_Math" display="inline" id="S5.SS2.SSS2.p1.3.m3.1"><semantics id="S5.SS2.SSS2.p1.3.m3.1a"><msub id="S5.SS2.SSS2.p1.3.m3.1.1" xref="S5.SS2.SSS2.p1.3.m3.1.1.cmml"><mi id="S5.SS2.SSS2.p1.3.m3.1.1.2" xref="S5.SS2.SSS2.p1.3.m3.1.1.2.cmml">π</mi><msub id="S5.SS2.SSS2.p1.3.m3.1.1.3" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.cmml"><mi id="S5.SS2.SSS2.p1.3.m3.1.1.3.2" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.2.cmml">θ</mi><mrow id="S5.SS2.SSS2.p1.3.m3.1.1.3.3" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.3.cmml"><mi id="S5.SS2.SSS2.p1.3.m3.1.1.3.3.2" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.3.2.cmml">o</mi><mo id="S5.SS2.SSS2.p1.3.m3.1.1.3.3.1" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.3.1.cmml">⁢</mo><mi id="S5.SS2.SSS2.p1.3.m3.1.1.3.3.3" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.3.3.cmml">l</mi><mo id="S5.SS2.SSS2.p1.3.m3.1.1.3.3.1a" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.3.1.cmml">⁢</mo><mi id="S5.SS2.SSS2.p1.3.m3.1.1.3.3.4" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.3.4.cmml">d</mi></mrow></msub></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS2.p1.3.m3.1b"><apply id="S5.SS2.SSS2.p1.3.m3.1.1.cmml" xref="S5.SS2.SSS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS2.SSS2.p1.3.m3.1.1.1.cmml" xref="S5.SS2.SSS2.p1.3.m3.1.1">subscript</csymbol><ci id="S5.SS2.SSS2.p1.3.m3.1.1.2.cmml" xref="S5.SS2.SSS2.p1.3.m3.1.1.2">𝜋</ci><apply id="S5.SS2.SSS2.p1.3.m3.1.1.3.cmml" xref="S5.SS2.SSS2.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="S5.SS2.SSS2.p1.3.m3.1.1.3.1.cmml" xref="S5.SS2.SSS2.p1.3.m3.1.1.3">subscript</csymbol><ci id="S5.SS2.SSS2.p1.3.m3.1.1.3.2.cmml" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.2">𝜃</ci><apply id="S5.SS2.SSS2.p1.3.m3.1.1.3.3.cmml" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.3"><times id="S5.SS2.SSS2.p1.3.m3.1.1.3.3.1.cmml" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.3.1"></times><ci id="S5.SS2.SSS2.p1.3.m3.1.1.3.3.2.cmml" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.3.2">𝑜</ci><ci id="S5.SS2.SSS2.p1.3.m3.1.1.3.3.3.cmml" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.3.3">𝑙</ci><ci id="S5.SS2.SSS2.p1.3.m3.1.1.3.3.4.cmml" xref="S5.SS2.SSS2.p1.3.m3.1.1.3.3.4">𝑑</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS2.p1.3.m3.1c">\pi_{\theta_{old}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS2.p1.3.m3.1d">italic_π start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_o italic_l italic_d end_POSTSUBSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math> and then optimizes the policy model <math alttext="\pi_{\theta}" class="ltx_Math" display="inline" id="S5.SS2.SSS2.p1.4.m4.1"><semantics id="S5.SS2.SSS2.p1.4.m4.1a"><msub id="S5.SS2.SSS2.p1.4.m4.1.1" xref="S5.SS2.SSS2.p1.4.m4.1.1.cmml"><mi id="S5.SS2.SSS2.p1.4.m4.1.1.2" xref="S5.SS2.SSS2.p1.4.m4.1.1.2.cmml">π</mi><mi id="S5.SS2.SSS2.p1.4.m4.1.1.3" xref="S5.SS2.SSS2.p1.4.m4.1.1.3.cmml">θ</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS2.p1.4.m4.1b"><apply id="S5.SS2.SSS2.p1.4.m4.1.1.cmml" xref="S5.SS2.SSS2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS2.SSS2.p1.4.m4.1.1.1.cmml" xref="S5.SS2.SSS2.p1.4.m4.1.1">subscript</csymbol><ci id="S5.SS2.SSS2.p1.4.m4.1.1.2.cmml" xref="S5.SS2.SSS2.p1.4.m4.1.1.2">𝜋</ci><ci id="S5.SS2.SSS2.p1.4.m4.1.1.3.cmml" xref="S5.SS2.SSS2.p1.4.m4.1.1.3">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS2.p1.4.m4.1c">\pi_{\theta}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS2.p1.4.m4.1d">italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT</annotation></semantics></math> by maximizing the following objective:</p>
<table class="ltx_equation ltx_eqn_table" id="S5.E26">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\begin{split}\mathcal{J}_{GRPO}(\theta)&amp;=\mathbb{E}{[q\sim P(Q),\{o_{i}\}_{i=1%
}^{G}\sim\pi_{\theta_{old}}(O|q)]}\\
&amp;\frac{1}{G}\sum_{i=1}^{G}\left(\min\left(\frac{\pi_{\theta}(o_{i}|q)}{\pi_{%
\theta_{old}}(o_{i}|q)}A_{i},\text{clip}\left(\frac{\pi_{\theta}(o_{i}|q)}{\pi%
_{\theta_{old}}(o_{i}|q)},1-\varepsilon,1+\varepsilon\right)A_{i}\right)-\beta%
\mathbb{D}_{KL}\left(\pi_{\theta}||\pi_{ref}\right)\right),\end{split}" class="ltx_math_unparsed" display="block" id="S5.E26.m1.71"><semantics id="S5.E26.m1.71a"><mtable columnspacing="0pt" displaystyle="true" id="S5.E26.m1.71.71.1" rowspacing="0pt"><mtr id="S5.E26.m1.71.71.1a"><mtd class="ltx_align_right" columnalign="right" id="S5.E26.m1.71.71.1b"><mrow id="S5.E26.m1.5.5.5.5.5"><msub id="S5.E26.m1.5.5.5.5.5.7"><mi class="ltx_font_mathcaligraphic" id="S5.E26.m1.1.1.1.1.1.1">𝒥</mi><mrow id="S5.E26.m1.2.2.2.2.2.2.1"><mi id="S5.E26.m1.2.2.2.2.2.2.1.2">G</mi><mo id="S5.E26.m1.2.2.2.2.2.2.1.1">⁢</mo><mi id="S5.E26.m1.2.2.2.2.2.2.1.3">R</mi><mo id="S5.E26.m1.2.2.2.2.2.2.1.1a">⁢</mo><mi id="S5.E26.m1.2.2.2.2.2.2.1.4">P</mi><mo id="S5.E26.m1.2.2.2.2.2.2.1.1b">⁢</mo><mi id="S5.E26.m1.2.2.2.2.2.2.1.5">O</mi></mrow></msub><mo id="S5.E26.m1.5.5.5.5.5.6">⁢</mo><mrow id="S5.E26.m1.5.5.5.5.5.8"><mo id="S5.E26.m1.3.3.3.3.3.3" stretchy="false">(</mo><mi id="S5.E26.m1.4.4.4.4.4.4">θ</mi><mo id="S5.E26.m1.5.5.5.5.5.5" stretchy="false">)</mo></mrow></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S5.E26.m1.71.71.1c"><mrow id="S5.E26.m1.71.71.1.71.31.26"><mi id="S5.E26.m1.71.71.1.71.31.26.27"></mi><mo id="S5.E26.m1.6.6.6.6.1.1">=</mo><mrow id="S5.E26.m1.71.71.1.71.31.26.26"><mi id="S5.E26.m1.7.7.7.7.2.2">𝔼</mi><mo id="S5.E26.m1.71.71.1.71.31.26.26.2">⁢</mo><mrow id="S5.E26.m1.71.71.1.71.31.26.26.1.1"><mo id="S5.E26.m1.8.8.8.8.3.3" stretchy="false">[</mo><mrow id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1"><mrow id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.1.1"><mi id="S5.E26.m1.9.9.9.9.4.4">q</mi><mo id="S5.E26.m1.10.10.10.10.5.5">∼</mo><mrow id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.1.1.1"><mi id="S5.E26.m1.11.11.11.11.6.6">P</mi><mo id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.1.1.1.1">⁢</mo><mrow id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.1.1.1.2"><mo id="S5.E26.m1.12.12.12.12.7.7" stretchy="false">(</mo><mi id="S5.E26.m1.13.13.13.13.8.8">Q</mi><mo id="S5.E26.m1.14.14.14.14.9.9" stretchy="false">)</mo></mrow></mrow></mrow><mo id="S5.E26.m1.15.15.15.15.10.10">,</mo><mrow id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.2.2"><msubsup id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.2.2.1"><mrow id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.2.2.1.1.1.1"><mo id="S5.E26.m1.16.16.16.16.11.11" stretchy="false">{</mo><msub id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.2.2.1.1.1.1.1"><mi id="S5.E26.m1.17.17.17.17.12.12">o</mi><mi id="S5.E26.m1.18.18.18.18.13.13.1">i</mi></msub><mo id="S5.E26.m1.19.19.19.19.14.14" stretchy="false">}</mo></mrow><mrow id="S5.E26.m1.20.20.20.20.15.15.1"><mi id="S5.E26.m1.20.20.20.20.15.15.1.2">i</mi><mo id="S5.E26.m1.20.20.20.20.15.15.1.1">=</mo><mn id="S5.E26.m1.20.20.20.20.15.15.1.3">1</mn></mrow><mi id="S5.E26.m1.21.21.21.21.16.16.1">G</mi></msubsup><mo id="S5.E26.m1.22.22.22.22.17.17">∼</mo><mrow id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.2.2.2"><msub id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.2.2.2.3"><mi id="S5.E26.m1.23.23.23.23.18.18">π</mi><msub id="S5.E26.m1.24.24.24.24.19.19.1"><mi id="S5.E26.m1.24.24.24.24.19.19.1.2">θ</mi><mrow id="S5.E26.m1.24.24.24.24.19.19.1.3"><mi id="S5.E26.m1.24.24.24.24.19.19.1.3.2">o</mi><mo id="S5.E26.m1.24.24.24.24.19.19.1.3.1">⁢</mo><mi id="S5.E26.m1.24.24.24.24.19.19.1.3.3">l</mi><mo id="S5.E26.m1.24.24.24.24.19.19.1.3.1a">⁢</mo><mi id="S5.E26.m1.24.24.24.24.19.19.1.3.4">d</mi></mrow></msub></msub><mo id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.2.2.2.2">⁢</mo><mrow id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.2.2.2.1.1"><mo id="S5.E26.m1.25.25.25.25.20.20" stretchy="false">(</mo><mrow id="S5.E26.m1.71.71.1.71.31.26.26.1.1.1.2.2.2.1.1.1"><mi id="S5.E26.m1.26.26.26.26.21.21">O</mi><mo fence="false" id="S5.E26.m1.27.27.27.27.22.22">|</mo><mi id="S5.E26.m1.28.28.28.28.23.23">q</mi></mrow><mo id="S5.E26.m1.29.29.29.29.24.24" stretchy="false">)</mo></mrow></mrow></mrow></mrow><mo id="S5.E26.m1.30.30.30.30.25.25" stretchy="false">]</mo></mrow></mrow></mrow></mtd></mtr><mtr id="S5.E26.m1.71.71.1d"><mtd id="S5.E26.m1.71.71.1e"></mtd><mtd class="ltx_align_left" columnalign="left" id="S5.E26.m1.71.71.1f"><mrow id="S5.E26.m1.70.70.70.40.40"><mfrac id="S5.E26.m1.31.31.31.1.1.1"><mn id="S5.E26.m1.31.31.31.1.1.1.2">1</mn><mi id="S5.E26.m1.31.31.31.1.1.1.3">G</mi></mfrac><munderover id="S5.E26.m1.70.70.70.40.40.41"><mo id="S5.E26.m1.32.32.32.2.2.2" movablelimits="false" rspace="0em">∑</mo><mrow id="S5.E26.m1.33.33.33.3.3.3.1"><mi id="S5.E26.m1.33.33.33.3.3.3.1.2">i</mi><mo id="S5.E26.m1.33.33.33.3.3.3.1.1">=</mo><mn id="S5.E26.m1.33.33.33.3.3.3.1.3">1</mn></mrow><mi id="S5.E26.m1.34.34.34.4.4.4.1">G</mi></munderover><mrow id="S5.E26.m1.70.70.70.40.40.42"><mo id="S5.E26.m1.35.35.35.5.5.5">(</mo><mi id="S5.E26.m1.36.36.36.6.6.6">min</mi><mrow id="S5.E26.m1.70.70.70.40.40.42.1"><mo id="S5.E26.m1.37.37.37.7.7.7">(</mo><mfrac id="S5.E26.m1.38.38.38.8.8.8"><mrow id="S5.E26.m1.38.38.38.8.8.8.1"><msub id="S5.E26.m1.38.38.38.8.8.8.1.3"><mi id="S5.E26.m1.38.38.38.8.8.8.1.3.2">π</mi><mi id="S5.E26.m1.38.38.38.8.8.8.1.3.3">θ</mi></msub><mo id="S5.E26.m1.38.38.38.8.8.8.1.2">⁢</mo><mrow id="S5.E26.m1.38.38.38.8.8.8.1.1.1"><mo id="S5.E26.m1.38.38.38.8.8.8.1.1.1.2" stretchy="false">(</mo><mrow id="S5.E26.m1.38.38.38.8.8.8.1.1.1.1"><msub id="S5.E26.m1.38.38.38.8.8.8.1.1.1.1.2"><mi id="S5.E26.m1.38.38.38.8.8.8.1.1.1.1.2.2">o</mi><mi id="S5.E26.m1.38.38.38.8.8.8.1.1.1.1.2.3">i</mi></msub><mo fence="false" id="S5.E26.m1.38.38.38.8.8.8.1.1.1.1.1">|</mo><mi id="S5.E26.m1.38.38.38.8.8.8.1.1.1.1.3">q</mi></mrow><mo id="S5.E26.m1.38.38.38.8.8.8.1.1.1.3" stretchy="false">)</mo></mrow></mrow><mrow id="S5.E26.m1.38.38.38.8.8.8.2"><msub id="S5.E26.m1.38.38.38.8.8.8.2.3"><mi id="S5.E26.m1.38.38.38.8.8.8.2.3.2">π</mi><msub id="S5.E26.m1.38.38.38.8.8.8.2.3.3"><mi id="S5.E26.m1.38.38.38.8.8.8.2.3.3.2">θ</mi><mrow id="S5.E26.m1.38.38.38.8.8.8.2.3.3.3"><mi id="S5.E26.m1.38.38.38.8.8.8.2.3.3.3.2">o</mi><mo id="S5.E26.m1.38.38.38.8.8.8.2.3.3.3.1">⁢</mo><mi id="S5.E26.m1.38.38.38.8.8.8.2.3.3.3.3">l</mi><mo id="S5.E26.m1.38.38.38.8.8.8.2.3.3.3.1a">⁢</mo><mi id="S5.E26.m1.38.38.38.8.8.8.2.3.3.3.4">d</mi></mrow></msub></msub><mo id="S5.E26.m1.38.38.38.8.8.8.2.2">⁢</mo><mrow id="S5.E26.m1.38.38.38.8.8.8.2.1.1"><mo id="S5.E26.m1.38.38.38.8.8.8.2.1.1.2" stretchy="false">(</mo><mrow id="S5.E26.m1.38.38.38.8.8.8.2.1.1.1"><msub id="S5.E26.m1.38.38.38.8.8.8.2.1.1.1.2"><mi id="S5.E26.m1.38.38.38.8.8.8.2.1.1.1.2.2">o</mi><mi id="S5.E26.m1.38.38.38.8.8.8.2.1.1.1.2.3">i</mi></msub><mo fence="false" id="S5.E26.m1.38.38.38.8.8.8.2.1.1.1.1">|</mo><mi id="S5.E26.m1.38.38.38.8.8.8.2.1.1.1.3">q</mi></mrow><mo id="S5.E26.m1.38.38.38.8.8.8.2.1.1.3" stretchy="false">)</mo></mrow></mrow></mfrac><msub id="S5.E26.m1.70.70.70.40.40.42.1.1"><mi id="S5.E26.m1.39.39.39.9.9.9">A</mi><mi id="S5.E26.m1.40.40.40.10.10.10.1">i</mi></msub><mo id="S5.E26.m1.41.41.41.11.11.11">,</mo><mtext id="S5.E26.m1.42.42.42.12.12.12">clip</mtext><mrow id="S5.E26.m1.70.70.70.40.40.42.1.2"><mo id="S5.E26.m1.43.43.43.13.13.13">(</mo><mfrac id="S5.E26.m1.44.44.44.14.14.14"><mrow id="S5.E26.m1.44.44.44.14.14.14.1"><msub id="S5.E26.m1.44.44.44.14.14.14.1.3"><mi id="S5.E26.m1.44.44.44.14.14.14.1.3.2">π</mi><mi id="S5.E26.m1.44.44.44.14.14.14.1.3.3">θ</mi></msub><mo id="S5.E26.m1.44.44.44.14.14.14.1.2">⁢</mo><mrow id="S5.E26.m1.44.44.44.14.14.14.1.1.1"><mo id="S5.E26.m1.44.44.44.14.14.14.1.1.1.2" stretchy="false">(</mo><mrow id="S5.E26.m1.44.44.44.14.14.14.1.1.1.1"><msub id="S5.E26.m1.44.44.44.14.14.14.1.1.1.1.2"><mi id="S5.E26.m1.44.44.44.14.14.14.1.1.1.1.2.2">o</mi><mi id="S5.E26.m1.44.44.44.14.14.14.1.1.1.1.2.3">i</mi></msub><mo fence="false" id="S5.E26.m1.44.44.44.14.14.14.1.1.1.1.1">|</mo><mi id="S5.E26.m1.44.44.44.14.14.14.1.1.1.1.3">q</mi></mrow><mo id="S5.E26.m1.44.44.44.14.14.14.1.1.1.3" stretchy="false">)</mo></mrow></mrow><mrow id="S5.E26.m1.44.44.44.14.14.14.2"><msub id="S5.E26.m1.44.44.44.14.14.14.2.3"><mi id="S5.E26.m1.44.44.44.14.14.14.2.3.2">π</mi><msub id="S5.E26.m1.44.44.44.14.14.14.2.3.3"><mi id="S5.E26.m1.44.44.44.14.14.14.2.3.3.2">θ</mi><mrow id="S5.E26.m1.44.44.44.14.14.14.2.3.3.3"><mi id="S5.E26.m1.44.44.44.14.14.14.2.3.3.3.2">o</mi><mo id="S5.E26.m1.44.44.44.14.14.14.2.3.3.3.1">⁢</mo><mi id="S5.E26.m1.44.44.44.14.14.14.2.3.3.3.3">l</mi><mo id="S5.E26.m1.44.44.44.14.14.14.2.3.3.3.1a">⁢</mo><mi id="S5.E26.m1.44.44.44.14.14.14.2.3.3.3.4">d</mi></mrow></msub></msub><mo id="S5.E26.m1.44.44.44.14.14.14.2.2">⁢</mo><mrow id="S5.E26.m1.44.44.44.14.14.14.2.1.1"><mo id="S5.E26.m1.44.44.44.14.14.14.2.1.1.2" stretchy="false">(</mo><mrow id="S5.E26.m1.44.44.44.14.14.14.2.1.1.1"><msub id="S5.E26.m1.44.44.44.14.14.14.2.1.1.1.2"><mi id="S5.E26.m1.44.44.44.14.14.14.2.1.1.1.2.2">o</mi><mi id="S5.E26.m1.44.44.44.14.14.14.2.1.1.1.2.3">i</mi></msub><mo fence="false" id="S5.E26.m1.44.44.44.14.14.14.2.1.1.1.1">|</mo><mi id="S5.E26.m1.44.44.44.14.14.14.2.1.1.1.3">q</mi></mrow><mo id="S5.E26.m1.44.44.44.14.14.14.2.1.1.3" stretchy="false">)</mo></mrow></mrow></mfrac><mo id="S5.E26.m1.45.45.45.15.15.15">,</mo><mn id="S5.E26.m1.46.46.46.16.16.16">1</mn><mo id="S5.E26.m1.47.47.47.17.17.17">−</mo><mi id="S5.E26.m1.48.48.48.18.18.18">ε</mi><mo id="S5.E26.m1.49.49.49.19.19.19">,</mo><mn id="S5.E26.m1.50.50.50.20.20.20">1</mn><mo id="S5.E26.m1.51.51.51.21.21.21">+</mo><mi id="S5.E26.m1.52.52.52.22.22.22">ε</mi><mo id="S5.E26.m1.53.53.53.23.23.23">)</mo></mrow><msub id="S5.E26.m1.70.70.70.40.40.42.1.3"><mi id="S5.E26.m1.54.54.54.24.24.24">A</mi><mi id="S5.E26.m1.55.55.55.25.25.25.1">i</mi></msub><mo id="S5.E26.m1.56.56.56.26.26.26">)</mo></mrow><mo id="S5.E26.m1.57.57.57.27.27.27">−</mo><mi id="S5.E26.m1.58.58.58.28.28.28">β</mi><msub id="S5.E26.m1.70.70.70.40.40.42.2"><mi id="S5.E26.m1.59.59.59.29.29.29">𝔻</mi><mrow id="S5.E26.m1.60.60.60.30.30.30.1"><mi id="S5.E26.m1.60.60.60.30.30.30.1.2">K</mi><mo id="S5.E26.m1.60.60.60.30.30.30.1.1">⁢</mo><mi id="S5.E26.m1.60.60.60.30.30.30.1.3">L</mi></mrow></msub><mrow id="S5.E26.m1.70.70.70.40.40.42.3"><mo id="S5.E26.m1.61.61.61.31.31.31">(</mo><msub id="S5.E26.m1.70.70.70.40.40.42.3.1"><mi id="S5.E26.m1.62.62.62.32.32.32">π</mi><mi id="S5.E26.m1.63.63.63.33.33.33.1">θ</mi></msub><mo fence="false" id="S5.E26.m1.64.64.64.34.34.34" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="S5.E26.m1.65.65.65.35.35.35" rspace="0.167em" stretchy="false">|</mo><msub id="S5.E26.m1.70.70.70.40.40.42.3.2"><mi id="S5.E26.m1.66.66.66.36.36.36">π</mi><mrow id="S5.E26.m1.67.67.67.37.37.37.1"><mi id="S5.E26.m1.67.67.67.37.37.37.1.2">r</mi><mo id="S5.E26.m1.67.67.67.37.37.37.1.1">⁢</mo><mi id="S5.E26.m1.67.67.67.37.37.37.1.3">e</mi><mo id="S5.E26.m1.67.67.67.37.37.37.1.1a">⁢</mo><mi id="S5.E26.m1.67.67.67.37.37.37.1.4">f</mi></mrow></msub><mo id="S5.E26.m1.68.68.68.38.38.38">)</mo></mrow><mo id="S5.E26.m1.69.69.69.39.39.39">)</mo></mrow><mo id="S5.E26.m1.70.70.70.40.40.40">,</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex" id="S5.E26.m1.71b">\begin{split}\mathcal{J}_{GRPO}(\theta)&amp;=\mathbb{E}{[q\sim P(Q),\{o_{i}\}_{i=1%
}^{G}\sim\pi_{\theta_{old}}(O|q)]}\\
&amp;\frac{1}{G}\sum_{i=1}^{G}\left(\min\left(\frac{\pi_{\theta}(o_{i}|q)}{\pi_{%
\theta_{old}}(o_{i}|q)}A_{i},\text{clip}\left(\frac{\pi_{\theta}(o_{i}|q)}{\pi%
_{\theta_{old}}(o_{i}|q)},1-\varepsilon,1+\varepsilon\right)A_{i}\right)-\beta%
\mathbb{D}_{KL}\left(\pi_{\theta}||\pi_{ref}\right)\right),\end{split}</annotation><annotation encoding="application/x-llamapun" id="S5.E26.m1.71c">start_ROW start_CELL caligraphic_J start_POSTSUBSCRIPT italic_G italic_R italic_P italic_O end_POSTSUBSCRIPT ( italic_θ ) end_CELL start_CELL = blackboard_E [ italic_q ∼ italic_P ( italic_Q ) , { italic_o start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT } start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_G end_POSTSUPERSCRIPT ∼ italic_π start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_o italic_l italic_d end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_O | italic_q ) ] end_CELL end_ROW start_ROW start_CELL end_CELL start_CELL divide start_ARG 1 end_ARG start_ARG italic_G end_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_G end_POSTSUPERSCRIPT ( roman_min ( divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_o start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_q ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_o italic_l italic_d end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_o start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_q ) end_ARG italic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , clip ( divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_o start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_q ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT italic_θ start_POSTSUBSCRIPT italic_o italic_l italic_d end_POSTSUBSCRIPT end_POSTSUBSCRIPT ( italic_o start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_q ) end_ARG , 1 - italic_ε , 1 + italic_ε ) italic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) - italic_β blackboard_D start_POSTSUBSCRIPT italic_K italic_L end_POSTSUBSCRIPT ( italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT | | italic_π start_POSTSUBSCRIPT italic_r italic_e italic_f end_POSTSUBSCRIPT ) ) , end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(26)</span></td>
</tr></tbody>
</table>
<table class="ltx_equation ltx_eqn_table" id="S5.E27">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathbb{D}_{KL}\left(\pi_{\theta}||\pi_{ref}\right)=\frac{\pi_{ref}(o_{i}|q)}{%
\pi_{\theta}(o_{i}|q)}-\log\frac{\pi_{ref}(o_{i}|q)}{\pi_{\theta}(o_{i}|q)}-1," class="ltx_math_unparsed" display="block" id="S5.E27.m1.4"><semantics id="S5.E27.m1.4a"><mrow id="S5.E27.m1.4b"><msub id="S5.E27.m1.4.5"><mi id="S5.E27.m1.4.5.2">𝔻</mi><mrow id="S5.E27.m1.4.5.3"><mi id="S5.E27.m1.4.5.3.2">K</mi><mo id="S5.E27.m1.4.5.3.1">⁢</mo><mi id="S5.E27.m1.4.5.3.3">L</mi></mrow></msub><mrow id="S5.E27.m1.4.6"><mo id="S5.E27.m1.4.6.1">(</mo><msub id="S5.E27.m1.4.6.2"><mi id="S5.E27.m1.4.6.2.2">π</mi><mi id="S5.E27.m1.4.6.2.3">θ</mi></msub><mo fence="false" id="S5.E27.m1.4.6.3" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="S5.E27.m1.4.6.4" rspace="0.167em" stretchy="false">|</mo><msub id="S5.E27.m1.4.6.5"><mi id="S5.E27.m1.4.6.5.2">π</mi><mrow id="S5.E27.m1.4.6.5.3"><mi id="S5.E27.m1.4.6.5.3.2">r</mi><mo id="S5.E27.m1.4.6.5.3.1">⁢</mo><mi id="S5.E27.m1.4.6.5.3.3">e</mi><mo id="S5.E27.m1.4.6.5.3.1a">⁢</mo><mi id="S5.E27.m1.4.6.5.3.4">f</mi></mrow></msub><mo id="S5.E27.m1.4.6.6">)</mo></mrow><mo id="S5.E27.m1.4.7">=</mo><mfrac id="S5.E27.m1.2.2"><mrow id="S5.E27.m1.1.1.1"><msub id="S5.E27.m1.1.1.1.3"><mi id="S5.E27.m1.1.1.1.3.2">π</mi><mrow id="S5.E27.m1.1.1.1.3.3"><mi id="S5.E27.m1.1.1.1.3.3.2">r</mi><mo id="S5.E27.m1.1.1.1.3.3.1">⁢</mo><mi id="S5.E27.m1.1.1.1.3.3.3">e</mi><mo id="S5.E27.m1.1.1.1.3.3.1a">⁢</mo><mi id="S5.E27.m1.1.1.1.3.3.4">f</mi></mrow></msub><mo id="S5.E27.m1.1.1.1.2">⁢</mo><mrow id="S5.E27.m1.1.1.1.1.1"><mo id="S5.E27.m1.1.1.1.1.1.2" stretchy="false">(</mo><mrow id="S5.E27.m1.1.1.1.1.1.1"><msub id="S5.E27.m1.1.1.1.1.1.1.2"><mi id="S5.E27.m1.1.1.1.1.1.1.2.2">o</mi><mi id="S5.E27.m1.1.1.1.1.1.1.2.3">i</mi></msub><mo fence="false" id="S5.E27.m1.1.1.1.1.1.1.1">|</mo><mi id="S5.E27.m1.1.1.1.1.1.1.3">q</mi></mrow><mo id="S5.E27.m1.1.1.1.1.1.3" stretchy="false">)</mo></mrow></mrow><mrow id="S5.E27.m1.2.2.2"><msub id="S5.E27.m1.2.2.2.3"><mi id="S5.E27.m1.2.2.2.3.2">π</mi><mi id="S5.E27.m1.2.2.2.3.3">θ</mi></msub><mo id="S5.E27.m1.2.2.2.2">⁢</mo><mrow id="S5.E27.m1.2.2.2.1.1"><mo id="S5.E27.m1.2.2.2.1.1.2" stretchy="false">(</mo><mrow id="S5.E27.m1.2.2.2.1.1.1"><msub id="S5.E27.m1.2.2.2.1.1.1.2"><mi id="S5.E27.m1.2.2.2.1.1.1.2.2">o</mi><mi id="S5.E27.m1.2.2.2.1.1.1.2.3">i</mi></msub><mo fence="false" id="S5.E27.m1.2.2.2.1.1.1.1">|</mo><mi id="S5.E27.m1.2.2.2.1.1.1.3">q</mi></mrow><mo id="S5.E27.m1.2.2.2.1.1.3" stretchy="false">)</mo></mrow></mrow></mfrac><mo id="S5.E27.m1.4.8">−</mo><mi id="S5.E27.m1.4.9">log</mi><mfrac id="S5.E27.m1.4.4"><mrow id="S5.E27.m1.3.3.1"><msub id="S5.E27.m1.3.3.1.3"><mi id="S5.E27.m1.3.3.1.3.2">π</mi><mrow id="S5.E27.m1.3.3.1.3.3"><mi id="S5.E27.m1.3.3.1.3.3.2">r</mi><mo id="S5.E27.m1.3.3.1.3.3.1">⁢</mo><mi id="S5.E27.m1.3.3.1.3.3.3">e</mi><mo id="S5.E27.m1.3.3.1.3.3.1a">⁢</mo><mi id="S5.E27.m1.3.3.1.3.3.4">f</mi></mrow></msub><mo id="S5.E27.m1.3.3.1.2">⁢</mo><mrow id="S5.E27.m1.3.3.1.1.1"><mo id="S5.E27.m1.3.3.1.1.1.2" stretchy="false">(</mo><mrow id="S5.E27.m1.3.3.1.1.1.1"><msub id="S5.E27.m1.3.3.1.1.1.1.2"><mi id="S5.E27.m1.3.3.1.1.1.1.2.2">o</mi><mi id="S5.E27.m1.3.3.1.1.1.1.2.3">i</mi></msub><mo fence="false" id="S5.E27.m1.3.3.1.1.1.1.1">|</mo><mi id="S5.E27.m1.3.3.1.1.1.1.3">q</mi></mrow><mo id="S5.E27.m1.3.3.1.1.1.3" stretchy="false">)</mo></mrow></mrow><mrow id="S5.E27.m1.4.4.2"><msub id="S5.E27.m1.4.4.2.3"><mi id="S5.E27.m1.4.4.2.3.2">π</mi><mi id="S5.E27.m1.4.4.2.3.3">θ</mi></msub><mo id="S5.E27.m1.4.4.2.2">⁢</mo><mrow id="S5.E27.m1.4.4.2.1.1"><mo id="S5.E27.m1.4.4.2.1.1.2" stretchy="false">(</mo><mrow id="S5.E27.m1.4.4.2.1.1.1"><msub id="S5.E27.m1.4.4.2.1.1.1.2"><mi id="S5.E27.m1.4.4.2.1.1.1.2.2">o</mi><mi id="S5.E27.m1.4.4.2.1.1.1.2.3">i</mi></msub><mo fence="false" id="S5.E27.m1.4.4.2.1.1.1.1">|</mo><mi id="S5.E27.m1.4.4.2.1.1.1.3">q</mi></mrow><mo id="S5.E27.m1.4.4.2.1.1.3" stretchy="false">)</mo></mrow></mrow></mfrac><mo id="S5.E27.m1.4.10">−</mo><mn id="S5.E27.m1.4.11">1</mn><mo id="S5.E27.m1.4.12">,</mo></mrow><annotation encoding="application/x-tex" id="S5.E27.m1.4c">\mathbb{D}_{KL}\left(\pi_{\theta}||\pi_{ref}\right)=\frac{\pi_{ref}(o_{i}|q)}{%
\pi_{\theta}(o_{i}|q)}-\log\frac{\pi_{ref}(o_{i}|q)}{\pi_{\theta}(o_{i}|q)}-1,</annotation><annotation encoding="application/x-llamapun" id="S5.E27.m1.4d">blackboard_D start_POSTSUBSCRIPT italic_K italic_L end_POSTSUBSCRIPT ( italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT | | italic_π start_POSTSUBSCRIPT italic_r italic_e italic_f end_POSTSUBSCRIPT ) = divide start_ARG italic_π start_POSTSUBSCRIPT italic_r italic_e italic_f end_POSTSUBSCRIPT ( italic_o start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_q ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_o start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_q ) end_ARG - roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_r italic_e italic_f end_POSTSUBSCRIPT ( italic_o start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_q ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_o start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_q ) end_ARG - 1 ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(27)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S5.SS2.SSS2.p1.9">where <math alttext="\varepsilon" class="ltx_Math" display="inline" id="S5.SS2.SSS2.p1.5.m1.1"><semantics id="S5.SS2.SSS2.p1.5.m1.1a"><mi id="S5.SS2.SSS2.p1.5.m1.1.1" xref="S5.SS2.SSS2.p1.5.m1.1.1.cmml">ε</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS2.p1.5.m1.1b"><ci id="S5.SS2.SSS2.p1.5.m1.1.1.cmml" xref="S5.SS2.SSS2.p1.5.m1.1.1">𝜀</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS2.p1.5.m1.1c">\varepsilon</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS2.p1.5.m1.1d">italic_ε</annotation></semantics></math> and <math alttext="\beta" class="ltx_Math" display="inline" id="S5.SS2.SSS2.p1.6.m2.1"><semantics id="S5.SS2.SSS2.p1.6.m2.1a"><mi id="S5.SS2.SSS2.p1.6.m2.1.1" xref="S5.SS2.SSS2.p1.6.m2.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS2.p1.6.m2.1b"><ci id="S5.SS2.SSS2.p1.6.m2.1.1.cmml" xref="S5.SS2.SSS2.p1.6.m2.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS2.p1.6.m2.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS2.p1.6.m2.1d">italic_β</annotation></semantics></math> are hyper-parameters;
<math alttext="\pi_{ref}" class="ltx_Math" display="inline" id="S5.SS2.SSS2.p1.7.m3.1"><semantics id="S5.SS2.SSS2.p1.7.m3.1a"><msub id="S5.SS2.SSS2.p1.7.m3.1.1" xref="S5.SS2.SSS2.p1.7.m3.1.1.cmml"><mi id="S5.SS2.SSS2.p1.7.m3.1.1.2" xref="S5.SS2.SSS2.p1.7.m3.1.1.2.cmml">π</mi><mrow id="S5.SS2.SSS2.p1.7.m3.1.1.3" xref="S5.SS2.SSS2.p1.7.m3.1.1.3.cmml"><mi id="S5.SS2.SSS2.p1.7.m3.1.1.3.2" xref="S5.SS2.SSS2.p1.7.m3.1.1.3.2.cmml">r</mi><mo id="S5.SS2.SSS2.p1.7.m3.1.1.3.1" xref="S5.SS2.SSS2.p1.7.m3.1.1.3.1.cmml">⁢</mo><mi id="S5.SS2.SSS2.p1.7.m3.1.1.3.3" xref="S5.SS2.SSS2.p1.7.m3.1.1.3.3.cmml">e</mi><mo id="S5.SS2.SSS2.p1.7.m3.1.1.3.1a" xref="S5.SS2.SSS2.p1.7.m3.1.1.3.1.cmml">⁢</mo><mi id="S5.SS2.SSS2.p1.7.m3.1.1.3.4" xref="S5.SS2.SSS2.p1.7.m3.1.1.3.4.cmml">f</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS2.p1.7.m3.1b"><apply id="S5.SS2.SSS2.p1.7.m3.1.1.cmml" xref="S5.SS2.SSS2.p1.7.m3.1.1"><csymbol cd="ambiguous" id="S5.SS2.SSS2.p1.7.m3.1.1.1.cmml" xref="S5.SS2.SSS2.p1.7.m3.1.1">subscript</csymbol><ci id="S5.SS2.SSS2.p1.7.m3.1.1.2.cmml" xref="S5.SS2.SSS2.p1.7.m3.1.1.2">𝜋</ci><apply id="S5.SS2.SSS2.p1.7.m3.1.1.3.cmml" xref="S5.SS2.SSS2.p1.7.m3.1.1.3"><times id="S5.SS2.SSS2.p1.7.m3.1.1.3.1.cmml" xref="S5.SS2.SSS2.p1.7.m3.1.1.3.1"></times><ci id="S5.SS2.SSS2.p1.7.m3.1.1.3.2.cmml" xref="S5.SS2.SSS2.p1.7.m3.1.1.3.2">𝑟</ci><ci id="S5.SS2.SSS2.p1.7.m3.1.1.3.3.cmml" xref="S5.SS2.SSS2.p1.7.m3.1.1.3.3">𝑒</ci><ci id="S5.SS2.SSS2.p1.7.m3.1.1.3.4.cmml" xref="S5.SS2.SSS2.p1.7.m3.1.1.3.4">𝑓</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS2.p1.7.m3.1c">\pi_{ref}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS2.p1.7.m3.1d">italic_π start_POSTSUBSCRIPT italic_r italic_e italic_f end_POSTSUBSCRIPT</annotation></semantics></math> is the reference model;
and <math alttext="A_{i}" class="ltx_Math" display="inline" id="S5.SS2.SSS2.p1.8.m4.1"><semantics id="S5.SS2.SSS2.p1.8.m4.1a"><msub id="S5.SS2.SSS2.p1.8.m4.1.1" xref="S5.SS2.SSS2.p1.8.m4.1.1.cmml"><mi id="S5.SS2.SSS2.p1.8.m4.1.1.2" xref="S5.SS2.SSS2.p1.8.m4.1.1.2.cmml">A</mi><mi id="S5.SS2.SSS2.p1.8.m4.1.1.3" xref="S5.SS2.SSS2.p1.8.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS2.p1.8.m4.1b"><apply id="S5.SS2.SSS2.p1.8.m4.1.1.cmml" xref="S5.SS2.SSS2.p1.8.m4.1.1"><csymbol cd="ambiguous" id="S5.SS2.SSS2.p1.8.m4.1.1.1.cmml" xref="S5.SS2.SSS2.p1.8.m4.1.1">subscript</csymbol><ci id="S5.SS2.SSS2.p1.8.m4.1.1.2.cmml" xref="S5.SS2.SSS2.p1.8.m4.1.1.2">𝐴</ci><ci id="S5.SS2.SSS2.p1.8.m4.1.1.3.cmml" xref="S5.SS2.SSS2.p1.8.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS2.p1.8.m4.1c">A_{i}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS2.p1.8.m4.1d">italic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> is the advantage, derived from the rewards <math alttext="\{r_{1},r_{2},\ldots,r_{G}\}" class="ltx_Math" display="inline" id="S5.SS2.SSS2.p1.9.m5.4"><semantics id="S5.SS2.SSS2.p1.9.m5.4a"><mrow id="S5.SS2.SSS2.p1.9.m5.4.4.3" xref="S5.SS2.SSS2.p1.9.m5.4.4.4.cmml"><mo id="S5.SS2.SSS2.p1.9.m5.4.4.3.4" stretchy="false" xref="S5.SS2.SSS2.p1.9.m5.4.4.4.cmml">{</mo><msub id="S5.SS2.SSS2.p1.9.m5.2.2.1.1" xref="S5.SS2.SSS2.p1.9.m5.2.2.1.1.cmml"><mi id="S5.SS2.SSS2.p1.9.m5.2.2.1.1.2" xref="S5.SS2.SSS2.p1.9.m5.2.2.1.1.2.cmml">r</mi><mn id="S5.SS2.SSS2.p1.9.m5.2.2.1.1.3" xref="S5.SS2.SSS2.p1.9.m5.2.2.1.1.3.cmml">1</mn></msub><mo id="S5.SS2.SSS2.p1.9.m5.4.4.3.5" xref="S5.SS2.SSS2.p1.9.m5.4.4.4.cmml">,</mo><msub id="S5.SS2.SSS2.p1.9.m5.3.3.2.2" xref="S5.SS2.SSS2.p1.9.m5.3.3.2.2.cmml"><mi id="S5.SS2.SSS2.p1.9.m5.3.3.2.2.2" xref="S5.SS2.SSS2.p1.9.m5.3.3.2.2.2.cmml">r</mi><mn id="S5.SS2.SSS2.p1.9.m5.3.3.2.2.3" xref="S5.SS2.SSS2.p1.9.m5.3.3.2.2.3.cmml">2</mn></msub><mo id="S5.SS2.SSS2.p1.9.m5.4.4.3.6" xref="S5.SS2.SSS2.p1.9.m5.4.4.4.cmml">,</mo><mi id="S5.SS2.SSS2.p1.9.m5.1.1" mathvariant="normal" xref="S5.SS2.SSS2.p1.9.m5.1.1.cmml">…</mi><mo id="S5.SS2.SSS2.p1.9.m5.4.4.3.7" xref="S5.SS2.SSS2.p1.9.m5.4.4.4.cmml">,</mo><msub id="S5.SS2.SSS2.p1.9.m5.4.4.3.3" xref="S5.SS2.SSS2.p1.9.m5.4.4.3.3.cmml"><mi id="S5.SS2.SSS2.p1.9.m5.4.4.3.3.2" xref="S5.SS2.SSS2.p1.9.m5.4.4.3.3.2.cmml">r</mi><mi id="S5.SS2.SSS2.p1.9.m5.4.4.3.3.3" xref="S5.SS2.SSS2.p1.9.m5.4.4.3.3.3.cmml">G</mi></msub><mo id="S5.SS2.SSS2.p1.9.m5.4.4.3.8" stretchy="false" xref="S5.SS2.SSS2.p1.9.m5.4.4.4.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.SSS2.p1.9.m5.4b"><set id="S5.SS2.SSS2.p1.9.m5.4.4.4.cmml" xref="S5.SS2.SSS2.p1.9.m5.4.4.3"><apply id="S5.SS2.SSS2.p1.9.m5.2.2.1.1.cmml" xref="S5.SS2.SSS2.p1.9.m5.2.2.1.1"><csymbol cd="ambiguous" id="S5.SS2.SSS2.p1.9.m5.2.2.1.1.1.cmml" xref="S5.SS2.SSS2.p1.9.m5.2.2.1.1">subscript</csymbol><ci id="S5.SS2.SSS2.p1.9.m5.2.2.1.1.2.cmml" xref="S5.SS2.SSS2.p1.9.m5.2.2.1.1.2">𝑟</ci><cn id="S5.SS2.SSS2.p1.9.m5.2.2.1.1.3.cmml" type="integer" xref="S5.SS2.SSS2.p1.9.m5.2.2.1.1.3">1</cn></apply><apply id="S5.SS2.SSS2.p1.9.m5.3.3.2.2.cmml" xref="S5.SS2.SSS2.p1.9.m5.3.3.2.2"><csymbol cd="ambiguous" id="S5.SS2.SSS2.p1.9.m5.3.3.2.2.1.cmml" xref="S5.SS2.SSS2.p1.9.m5.3.3.2.2">subscript</csymbol><ci id="S5.SS2.SSS2.p1.9.m5.3.3.2.2.2.cmml" xref="S5.SS2.SSS2.p1.9.m5.3.3.2.2.2">𝑟</ci><cn id="S5.SS2.SSS2.p1.9.m5.3.3.2.2.3.cmml" type="integer" xref="S5.SS2.SSS2.p1.9.m5.3.3.2.2.3">2</cn></apply><ci id="S5.SS2.SSS2.p1.9.m5.1.1.cmml" xref="S5.SS2.SSS2.p1.9.m5.1.1">…</ci><apply id="S5.SS2.SSS2.p1.9.m5.4.4.3.3.cmml" xref="S5.SS2.SSS2.p1.9.m5.4.4.3.3"><csymbol cd="ambiguous" id="S5.SS2.SSS2.p1.9.m5.4.4.3.3.1.cmml" xref="S5.SS2.SSS2.p1.9.m5.4.4.3.3">subscript</csymbol><ci id="S5.SS2.SSS2.p1.9.m5.4.4.3.3.2.cmml" xref="S5.SS2.SSS2.p1.9.m5.4.4.3.3.2">𝑟</ci><ci id="S5.SS2.SSS2.p1.9.m5.4.4.3.3.3.cmml" xref="S5.SS2.SSS2.p1.9.m5.4.4.3.3.3">𝐺</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.SSS2.p1.9.m5.4c">\{r_{1},r_{2},\ldots,r_{G}\}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.SSS2.p1.9.m5.4d">{ italic_r start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_r start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , … , italic_r start_POSTSUBSCRIPT italic_G end_POSTSUBSCRIPT }</annotation></semantics></math> corresponding to the outputs within each group:</p>
<table class="ltx_equation ltx_eqn_table" id="S5.E28">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="A_{i}=\frac{r_{i}-{\operatorname{mean}(\{r_{1},r_{2},\cdots,r_{G}\})}}{{%
\operatorname{std}(\{r_{1},r_{2},\cdots,r_{G}\})}}." class="ltx_Math" display="block" id="S5.E28.m1.7"><semantics id="S5.E28.m1.7a"><mrow id="S5.E28.m1.7.7.1" xref="S5.E28.m1.7.7.1.1.cmml"><mrow id="S5.E28.m1.7.7.1.1" xref="S5.E28.m1.7.7.1.1.cmml"><msub id="S5.E28.m1.7.7.1.1.2" xref="S5.E28.m1.7.7.1.1.2.cmml"><mi id="S5.E28.m1.7.7.1.1.2.2" xref="S5.E28.m1.7.7.1.1.2.2.cmml">A</mi><mi id="S5.E28.m1.7.7.1.1.2.3" xref="S5.E28.m1.7.7.1.1.2.3.cmml">i</mi></msub><mo id="S5.E28.m1.7.7.1.1.1" xref="S5.E28.m1.7.7.1.1.1.cmml">=</mo><mfrac id="S5.E28.m1.6.6" xref="S5.E28.m1.6.6.cmml"><mrow id="S5.E28.m1.3.3.3" xref="S5.E28.m1.3.3.3.cmml"><msub id="S5.E28.m1.3.3.3.5" xref="S5.E28.m1.3.3.3.5.cmml"><mi id="S5.E28.m1.3.3.3.5.2" xref="S5.E28.m1.3.3.3.5.2.cmml">r</mi><mi id="S5.E28.m1.3.3.3.5.3" xref="S5.E28.m1.3.3.3.5.3.cmml">i</mi></msub><mo id="S5.E28.m1.3.3.3.4" xref="S5.E28.m1.3.3.3.4.cmml">−</mo><mrow id="S5.E28.m1.3.3.3.3.1" xref="S5.E28.m1.3.3.3.3.2.cmml"><mi id="S5.E28.m1.2.2.2.2" xref="S5.E28.m1.2.2.2.2.cmml">mean</mi><mo id="S5.E28.m1.3.3.3.3.1a" xref="S5.E28.m1.3.3.3.3.2.cmml">⁡</mo><mrow id="S5.E28.m1.3.3.3.3.1.1" xref="S5.E28.m1.3.3.3.3.2.cmml"><mo id="S5.E28.m1.3.3.3.3.1.1.2" stretchy="false" xref="S5.E28.m1.3.3.3.3.2.cmml">(</mo><mrow id="S5.E28.m1.3.3.3.3.1.1.1.3" xref="S5.E28.m1.3.3.3.3.1.1.1.4.cmml"><mo id="S5.E28.m1.3.3.3.3.1.1.1.3.4" stretchy="false" xref="S5.E28.m1.3.3.3.3.1.1.1.4.cmml">{</mo><msub id="S5.E28.m1.3.3.3.3.1.1.1.1.1" xref="S5.E28.m1.3.3.3.3.1.1.1.1.1.cmml"><mi id="S5.E28.m1.3.3.3.3.1.1.1.1.1.2" xref="S5.E28.m1.3.3.3.3.1.1.1.1.1.2.cmml">r</mi><mn id="S5.E28.m1.3.3.3.3.1.1.1.1.1.3" xref="S5.E28.m1.3.3.3.3.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.E28.m1.3.3.3.3.1.1.1.3.5" xref="S5.E28.m1.3.3.3.3.1.1.1.4.cmml">,</mo><msub id="S5.E28.m1.3.3.3.3.1.1.1.2.2" xref="S5.E28.m1.3.3.3.3.1.1.1.2.2.cmml"><mi id="S5.E28.m1.3.3.3.3.1.1.1.2.2.2" xref="S5.E28.m1.3.3.3.3.1.1.1.2.2.2.cmml">r</mi><mn id="S5.E28.m1.3.3.3.3.1.1.1.2.2.3" xref="S5.E28.m1.3.3.3.3.1.1.1.2.2.3.cmml">2</mn></msub><mo id="S5.E28.m1.3.3.3.3.1.1.1.3.6" xref="S5.E28.m1.3.3.3.3.1.1.1.4.cmml">,</mo><mi id="S5.E28.m1.1.1.1.1" mathvariant="normal" xref="S5.E28.m1.1.1.1.1.cmml">⋯</mi><mo id="S5.E28.m1.3.3.3.3.1.1.1.3.7" xref="S5.E28.m1.3.3.3.3.1.1.1.4.cmml">,</mo><msub id="S5.E28.m1.3.3.3.3.1.1.1.3.3" xref="S5.E28.m1.3.3.3.3.1.1.1.3.3.cmml"><mi id="S5.E28.m1.3.3.3.3.1.1.1.3.3.2" xref="S5.E28.m1.3.3.3.3.1.1.1.3.3.2.cmml">r</mi><mi id="S5.E28.m1.3.3.3.3.1.1.1.3.3.3" xref="S5.E28.m1.3.3.3.3.1.1.1.3.3.3.cmml">G</mi></msub><mo id="S5.E28.m1.3.3.3.3.1.1.1.3.8" stretchy="false" xref="S5.E28.m1.3.3.3.3.1.1.1.4.cmml">}</mo></mrow><mo id="S5.E28.m1.3.3.3.3.1.1.3" stretchy="false" xref="S5.E28.m1.3.3.3.3.2.cmml">)</mo></mrow></mrow></mrow><mrow id="S5.E28.m1.6.6.6.3" xref="S5.E28.m1.6.6.6.4.cmml"><mi id="S5.E28.m1.5.5.5.2" xref="S5.E28.m1.5.5.5.2.cmml">std</mi><mo id="S5.E28.m1.6.6.6.3a" xref="S5.E28.m1.6.6.6.4.cmml">⁡</mo><mrow id="S5.E28.m1.6.6.6.3.1" xref="S5.E28.m1.6.6.6.4.cmml"><mo id="S5.E28.m1.6.6.6.3.1.2" stretchy="false" xref="S5.E28.m1.6.6.6.4.cmml">(</mo><mrow id="S5.E28.m1.6.6.6.3.1.1.3" xref="S5.E28.m1.6.6.6.3.1.1.4.cmml"><mo id="S5.E28.m1.6.6.6.3.1.1.3.4" stretchy="false" xref="S5.E28.m1.6.6.6.3.1.1.4.cmml">{</mo><msub id="S5.E28.m1.6.6.6.3.1.1.1.1" xref="S5.E28.m1.6.6.6.3.1.1.1.1.cmml"><mi id="S5.E28.m1.6.6.6.3.1.1.1.1.2" xref="S5.E28.m1.6.6.6.3.1.1.1.1.2.cmml">r</mi><mn id="S5.E28.m1.6.6.6.3.1.1.1.1.3" xref="S5.E28.m1.6.6.6.3.1.1.1.1.3.cmml">1</mn></msub><mo id="S5.E28.m1.6.6.6.3.1.1.3.5" xref="S5.E28.m1.6.6.6.3.1.1.4.cmml">,</mo><msub id="S5.E28.m1.6.6.6.3.1.1.2.2" xref="S5.E28.m1.6.6.6.3.1.1.2.2.cmml"><mi id="S5.E28.m1.6.6.6.3.1.1.2.2.2" xref="S5.E28.m1.6.6.6.3.1.1.2.2.2.cmml">r</mi><mn id="S5.E28.m1.6.6.6.3.1.1.2.2.3" xref="S5.E28.m1.6.6.6.3.1.1.2.2.3.cmml">2</mn></msub><mo id="S5.E28.m1.6.6.6.3.1.1.3.6" xref="S5.E28.m1.6.6.6.3.1.1.4.cmml">,</mo><mi id="S5.E28.m1.4.4.4.1" mathvariant="normal" xref="S5.E28.m1.4.4.4.1.cmml">⋯</mi><mo id="S5.E28.m1.6.6.6.3.1.1.3.7" xref="S5.E28.m1.6.6.6.3.1.1.4.cmml">,</mo><msub id="S5.E28.m1.6.6.6.3.1.1.3.3" xref="S5.E28.m1.6.6.6.3.1.1.3.3.cmml"><mi id="S5.E28.m1.6.6.6.3.1.1.3.3.2" xref="S5.E28.m1.6.6.6.3.1.1.3.3.2.cmml">r</mi><mi id="S5.E28.m1.6.6.6.3.1.1.3.3.3" xref="S5.E28.m1.6.6.6.3.1.1.3.3.3.cmml">G</mi></msub><mo id="S5.E28.m1.6.6.6.3.1.1.3.8" stretchy="false" xref="S5.E28.m1.6.6.6.3.1.1.4.cmml">}</mo></mrow><mo id="S5.E28.m1.6.6.6.3.1.3" stretchy="false" xref="S5.E28.m1.6.6.6.4.cmml">)</mo></mrow></mrow></mfrac></mrow><mo id="S5.E28.m1.7.7.1.2" lspace="0em" xref="S5.E28.m1.7.7.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.E28.m1.7b"><apply id="S5.E28.m1.7.7.1.1.cmml" xref="S5.E28.m1.7.7.1"><eq id="S5.E28.m1.7.7.1.1.1.cmml" xref="S5.E28.m1.7.7.1.1.1"></eq><apply id="S5.E28.m1.7.7.1.1.2.cmml" xref="S5.E28.m1.7.7.1.1.2"><csymbol cd="ambiguous" id="S5.E28.m1.7.7.1.1.2.1.cmml" xref="S5.E28.m1.7.7.1.1.2">subscript</csymbol><ci id="S5.E28.m1.7.7.1.1.2.2.cmml" xref="S5.E28.m1.7.7.1.1.2.2">𝐴</ci><ci id="S5.E28.m1.7.7.1.1.2.3.cmml" xref="S5.E28.m1.7.7.1.1.2.3">𝑖</ci></apply><apply id="S5.E28.m1.6.6.cmml" xref="S5.E28.m1.6.6"><divide id="S5.E28.m1.6.6.7.cmml" xref="S5.E28.m1.6.6"></divide><apply id="S5.E28.m1.3.3.3.cmml" xref="S5.E28.m1.3.3.3"><minus id="S5.E28.m1.3.3.3.4.cmml" xref="S5.E28.m1.3.3.3.4"></minus><apply id="S5.E28.m1.3.3.3.5.cmml" xref="S5.E28.m1.3.3.3.5"><csymbol cd="ambiguous" id="S5.E28.m1.3.3.3.5.1.cmml" xref="S5.E28.m1.3.3.3.5">subscript</csymbol><ci id="S5.E28.m1.3.3.3.5.2.cmml" xref="S5.E28.m1.3.3.3.5.2">𝑟</ci><ci id="S5.E28.m1.3.3.3.5.3.cmml" xref="S5.E28.m1.3.3.3.5.3">𝑖</ci></apply><apply id="S5.E28.m1.3.3.3.3.2.cmml" xref="S5.E28.m1.3.3.3.3.1"><ci id="S5.E28.m1.2.2.2.2.cmml" xref="S5.E28.m1.2.2.2.2">mean</ci><set id="S5.E28.m1.3.3.3.3.1.1.1.4.cmml" xref="S5.E28.m1.3.3.3.3.1.1.1.3"><apply id="S5.E28.m1.3.3.3.3.1.1.1.1.1.cmml" xref="S5.E28.m1.3.3.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="S5.E28.m1.3.3.3.3.1.1.1.1.1.1.cmml" xref="S5.E28.m1.3.3.3.3.1.1.1.1.1">subscript</csymbol><ci id="S5.E28.m1.3.3.3.3.1.1.1.1.1.2.cmml" xref="S5.E28.m1.3.3.3.3.1.1.1.1.1.2">𝑟</ci><cn id="S5.E28.m1.3.3.3.3.1.1.1.1.1.3.cmml" type="integer" xref="S5.E28.m1.3.3.3.3.1.1.1.1.1.3">1</cn></apply><apply id="S5.E28.m1.3.3.3.3.1.1.1.2.2.cmml" xref="S5.E28.m1.3.3.3.3.1.1.1.2.2"><csymbol cd="ambiguous" id="S5.E28.m1.3.3.3.3.1.1.1.2.2.1.cmml" xref="S5.E28.m1.3.3.3.3.1.1.1.2.2">subscript</csymbol><ci id="S5.E28.m1.3.3.3.3.1.1.1.2.2.2.cmml" xref="S5.E28.m1.3.3.3.3.1.1.1.2.2.2">𝑟</ci><cn id="S5.E28.m1.3.3.3.3.1.1.1.2.2.3.cmml" type="integer" xref="S5.E28.m1.3.3.3.3.1.1.1.2.2.3">2</cn></apply><ci id="S5.E28.m1.1.1.1.1.cmml" xref="S5.E28.m1.1.1.1.1">⋯</ci><apply id="S5.E28.m1.3.3.3.3.1.1.1.3.3.cmml" xref="S5.E28.m1.3.3.3.3.1.1.1.3.3"><csymbol cd="ambiguous" id="S5.E28.m1.3.3.3.3.1.1.1.3.3.1.cmml" xref="S5.E28.m1.3.3.3.3.1.1.1.3.3">subscript</csymbol><ci id="S5.E28.m1.3.3.3.3.1.1.1.3.3.2.cmml" xref="S5.E28.m1.3.3.3.3.1.1.1.3.3.2">𝑟</ci><ci id="S5.E28.m1.3.3.3.3.1.1.1.3.3.3.cmml" xref="S5.E28.m1.3.3.3.3.1.1.1.3.3.3">𝐺</ci></apply></set></apply></apply><apply id="S5.E28.m1.6.6.6.4.cmml" xref="S5.E28.m1.6.6.6.3"><ci id="S5.E28.m1.5.5.5.2.cmml" xref="S5.E28.m1.5.5.5.2">std</ci><set id="S5.E28.m1.6.6.6.3.1.1.4.cmml" xref="S5.E28.m1.6.6.6.3.1.1.3"><apply id="S5.E28.m1.6.6.6.3.1.1.1.1.cmml" xref="S5.E28.m1.6.6.6.3.1.1.1.1"><csymbol cd="ambiguous" id="S5.E28.m1.6.6.6.3.1.1.1.1.1.cmml" xref="S5.E28.m1.6.6.6.3.1.1.1.1">subscript</csymbol><ci id="S5.E28.m1.6.6.6.3.1.1.1.1.2.cmml" xref="S5.E28.m1.6.6.6.3.1.1.1.1.2">𝑟</ci><cn id="S5.E28.m1.6.6.6.3.1.1.1.1.3.cmml" type="integer" xref="S5.E28.m1.6.6.6.3.1.1.1.1.3">1</cn></apply><apply id="S5.E28.m1.6.6.6.3.1.1.2.2.cmml" xref="S5.E28.m1.6.6.6.3.1.1.2.2"><csymbol cd="ambiguous" id="S5.E28.m1.6.6.6.3.1.1.2.2.1.cmml" xref="S5.E28.m1.6.6.6.3.1.1.2.2">subscript</csymbol><ci id="S5.E28.m1.6.6.6.3.1.1.2.2.2.cmml" xref="S5.E28.m1.6.6.6.3.1.1.2.2.2">𝑟</ci><cn id="S5.E28.m1.6.6.6.3.1.1.2.2.3.cmml" type="integer" xref="S5.E28.m1.6.6.6.3.1.1.2.2.3">2</cn></apply><ci id="S5.E28.m1.4.4.4.1.cmml" xref="S5.E28.m1.4.4.4.1">⋯</ci><apply id="S5.E28.m1.6.6.6.3.1.1.3.3.cmml" xref="S5.E28.m1.6.6.6.3.1.1.3.3"><csymbol cd="ambiguous" id="S5.E28.m1.6.6.6.3.1.1.3.3.1.cmml" xref="S5.E28.m1.6.6.6.3.1.1.3.3">subscript</csymbol><ci id="S5.E28.m1.6.6.6.3.1.1.3.3.2.cmml" xref="S5.E28.m1.6.6.6.3.1.1.3.3.2">𝑟</ci><ci id="S5.E28.m1.6.6.6.3.1.1.3.3.3.cmml" xref="S5.E28.m1.6.6.6.3.1.1.3.3.3">𝐺</ci></apply></set></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E28.m1.7c">A_{i}=\frac{r_{i}-{\operatorname{mean}(\{r_{1},r_{2},\cdots,r_{G}\})}}{{%
\operatorname{std}(\{r_{1},r_{2},\cdots,r_{G}\})}}.</annotation><annotation encoding="application/x-llamapun" id="S5.E28.m1.7d">italic_A start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = divide start_ARG italic_r start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT - roman_mean ( { italic_r start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_r start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , ⋯ , italic_r start_POSTSUBSCRIPT italic_G end_POSTSUBSCRIPT } ) end_ARG start_ARG roman_std ( { italic_r start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_r start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , ⋯ , italic_r start_POSTSUBSCRIPT italic_G end_POSTSUBSCRIPT } ) end_ARG .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(28)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="S5.SS2.SSS2.p2">
<p class="ltx_p" id="S5.SS2.SSS2.p2.1">We incorporate prompts from diverse domains, such as coding, math, writing, role-playing, and question answering, during the RL process.
This approach not only aligns the model more closely with human preferences but also enhances performance on benchmarks, especially in scenarios where available SFT data are limited.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S5.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.3 </span>Evaluations</h3>
<section class="ltx_subsubsection" id="S5.SS3.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.3.1 </span>Evaluation Settings</h4>
<section class="ltx_paragraph" id="S5.SS3.SSS1.Px1">
<h5 class="ltx_title ltx_title_paragraph">Evaluation Benchmarks.</h5>
<div class="ltx_para" id="S5.SS3.SSS1.Px1.p1">
<p class="ltx_p" id="S5.SS3.SSS1.Px1.p1.1">Apart from the benchmark we used for base model testing, we further evaluate instructed models on IFEval <cite class="ltx_cite ltx_citemacro_citep">(Zhou et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib104" title="">2023</a>)</cite>, FRAMES <cite class="ltx_cite ltx_citemacro_citep">(Krishna et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib41" title="">2024</a>)</cite>, LongBench v2 <cite class="ltx_cite ltx_citemacro_citep">(Bai et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib6" title="">2024</a>)</cite>, GPQA <cite class="ltx_cite ltx_citemacro_citep">(Rein et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib76" title="">2023</a>)</cite>, SimpleQA <cite class="ltx_cite ltx_citemacro_citep">(OpenAI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib66" title="">2024c</a>)</cite>, C-SimpleQA <cite class="ltx_cite ltx_citemacro_citep">(He et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib33" title="">2024</a>)</cite>, SWE-Bench Verified <cite class="ltx_cite ltx_citemacro_citep">(OpenAI, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib67" title="">2024d</a>)</cite>, Aider <span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aider.chat" title="">https://aider.chat</a></span></span></span>, LiveCodeBench <cite class="ltx_cite ltx_citemacro_citep">(Jain et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib37" title="">2024</a>)</cite> (questions from August 2024 to November 2024), Codeforces <span class="ltx_note ltx_role_footnote" id="footnote2"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_tag ltx_tag_note">2</span><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://codeforces.com" title="">https://codeforces.com</a></span></span></span>, Chinese National High School Mathematics Olympiad (CNMO 2024)<span class="ltx_note ltx_role_footnote" id="footnote3"><sup class="ltx_note_mark">3</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">3</sup><span class="ltx_tag ltx_tag_note">3</span><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.cms.org.cn/Home/comp/comp/cid/12.html" title="">https://www.cms.org.cn/Home/comp/comp/cid/12.html</a></span></span></span>, and American Invitational Mathematics Examination 2024 (AIME 2024) <cite class="ltx_cite ltx_citemacro_citep">(MAA, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib56" title="">2024</a>)</cite>.</p>
</div>
</section>
<section class="ltx_paragraph" id="S5.SS3.SSS1.Px2">
<h5 class="ltx_title ltx_title_paragraph">Compared Baselines.</h5>
<div class="ltx_para" id="S5.SS3.SSS1.Px2.p1">
<p class="ltx_p" id="S5.SS3.SSS1.Px2.p1.1">We conduct comprehensive evaluations of our chat model against several strong baselines, including DeepSeek-V2-0506, DeepSeek-V2.5-0905, Qwen2.5 72B Instruct, LLaMA-3.1 405B Instruct, Claude-Sonnet-3.5-1022, and GPT-4o-0513.
For the DeepSeek-V2 model series, we select the most representative variants for comparison.
For closed-source models, evaluations are performed through their respective APIs.</p>
</div>
</section>
<section class="ltx_paragraph" id="S5.SS3.SSS1.Px3">
<h5 class="ltx_title ltx_title_paragraph">Detailed Evaluation Configurations.</h5>
<div class="ltx_para" id="S5.SS3.SSS1.Px3.p1">
<p class="ltx_p" id="S5.SS3.SSS1.Px3.p1.1">For standard benchmarks including MMLU, DROP, GPQA, and SimpleQA, we adopt the evaluation prompts from the simple-evals framework<span class="ltx_note ltx_role_footnote" id="footnote4"><sup class="ltx_note_mark">4</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">4</sup><span class="ltx_tag ltx_tag_note">4</span><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/openai/simple-evals" title="">https://github.com/openai/simple-evals</a></span></span></span>.
We utilize the Zero-Eval prompt format <cite class="ltx_cite ltx_citemacro_citep">(Lin, <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib52" title="">2024</a>)</cite> for MMLU-Redux in a zero-shot setting.
For other datasets, we follow their original evaluation protocols with default prompts as provided by the dataset creators.
For code and math benchmarks, the HumanEval-Mul dataset includes 8 mainstream programming languages (Python, Java, Cpp, C#, JavaScript, TypeScript, PHP, and Bash) in total.
We use CoT and non-CoT methods to evaluate model performance on LiveCodeBench, where the data are collected from August 2024 to November 2024.
The Codeforces dataset is measured using the percentage of competitors.
SWE-Bench verified is evaluated using the agentless framework <cite class="ltx_cite ltx_citemacro_citep">(Xia et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib98" title="">2024</a>)</cite>.
We use the “diff” format to evaluate the Aider-related benchmarks.
For mathematical assessments, AIME and CNMO 2024 are evaluated with a temperature of 0.7, and the results are averaged over 16 runs, while MATH-500 employs greedy decoding.
We allow all models to output a maximum of 8192 tokens for each benchmark.</p>
</div>
<figure class="ltx_table" id="S5.T6">
<table class="ltx_tabular ltx_align_middle" id="S5.T6.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T6.1.1.1">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_border_tt" id="S5.T6.1.1.1.1" style="padding-left:1.9pt;padding-right:1.9pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r ltx_border_tt" id="S5.T6.1.1.1.2" rowspan="2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.1.1.2.1" style="font-size:80%;">Benchmark <span class="ltx_text ltx_align_center" id="S5.T6.1.1.1.2.1.1" style="font-size:63%;">(Metric)</span></span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.T6.1.1.1.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.1.1.3.1" style="font-size:80%;">DeepSeek</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_tt" id="S5.T6.1.1.1.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.1.1.4.1" style="font-size:80%;">DeepSeek</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.T6.1.1.1.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.1.1.5.1" style="font-size:80%;">Qwen2.5</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.T6.1.1.1.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.1.1.6.1" style="font-size:80%;">LLaMA-3.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.T6.1.1.1.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.1.1.7.1" style="font-size:80%;">Claude-3.5-</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_tt" id="S5.T6.1.1.1.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.1.1.8.1" style="font-size:80%;">GPT-4o</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_tt" id="S5.T6.1.1.1.9" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.1.1.9.1" style="font-size:80%;">DeepSeek</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.2.2">
<td class="ltx_td ltx_nopad_l ltx_nopad_r" id="S5.T6.1.2.2.1" style="padding-left:1.9pt;padding-right:1.9pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.2.2.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.2.2.2.1" style="font-size:80%;">V2-0506</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.2.2.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.2.2.3.1" style="font-size:80%;">V2.5-0905</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.2.2.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.2.2.4.1" style="font-size:80%;">72B-Inst.</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.2.2.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.2.2.5.1" style="font-size:80%;">405B-Inst.</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.2.2.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.2.2.6.1" style="font-size:80%;">Sonnet-1022</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.2.2.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.2.2.7.1" style="font-size:80%;">0513</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.2.2.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.2.2.8.1" style="font-size:80%;">V3</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.3.3">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_border_t" id="S5.T6.1.3.3.1" style="padding-left:1.9pt;padding-right:1.9pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r ltx_border_t" id="S5.T6.1.3.3.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.3.3.2.1" style="font-size:80%;">Architecture</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.3.3.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.3.3.3.1" style="font-size:80%;">MoE</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_t" id="S5.T6.1.3.3.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.3.3.4.1" style="font-size:80%;">MoE</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.3.3.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.3.3.5.1" style="font-size:80%;">Dense</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.3.3.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.3.3.6.1" style="font-size:80%;">Dense</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.3.3.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.3.3.7.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_t" id="S5.T6.1.3.3.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.3.3.8.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.3.3.9" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.3.3.9.1" style="font-size:80%;">MoE</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.4.4">
<td class="ltx_td ltx_nopad_l ltx_nopad_r" id="S5.T6.1.4.4.1" style="padding-left:1.9pt;padding-right:1.9pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.4.4.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.4.4.2.1" style="font-size:80%;"># Activated Params</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.4.4.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.4.4.3.1" style="font-size:80%;">21B</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.4.4.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.4.4.4.1" style="font-size:80%;">21B</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.4.4.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.4.4.5.1" style="font-size:80%;">72B</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.4.4.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.4.4.6.1" style="font-size:80%;">405B</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.4.4.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.4.4.7.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.4.4.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.4.4.8.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.4.4.9" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.4.4.9.1" style="font-size:80%;">37B</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.5.5">
<td class="ltx_td ltx_nopad_l ltx_nopad_r" id="S5.T6.1.5.5.1" style="padding-left:1.9pt;padding-right:1.9pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.5.5.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.5.5.2.1" style="font-size:80%;"># Total Params</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.5.5.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.5.5.3.1" style="font-size:80%;">236B</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.5.5.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.5.5.4.1" style="font-size:80%;">236B</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.5.5.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.5.5.5.1" style="font-size:80%;">72B</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.5.5.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.5.5.6.1" style="font-size:80%;">405B</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.5.5.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.5.5.7.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.5.5.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.5.5.8.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.5.5.9" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.5.5.9.1" style="font-size:80%;">671B</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.6.6">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.6.6.1" rowspan="8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.6.6.1.1" style="font-size:80%;">English</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r ltx_border_t" id="S5.T6.1.6.6.2" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.6.6.2.1" style="font-size:80%;">MMLU </span><span class="ltx_text" id="S5.T6.1.6.6.2.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.6.6.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.6.6.3.1" style="font-size:80%;">78.2</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_t" id="S5.T6.1.6.6.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.6.6.4.1" style="font-size:80%;">80.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.6.6.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.6.6.5.1" style="font-size:80%;">85.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.6.6.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.6.6.6.1" style="font-size:80%;">88.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.6.6.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.6.6.7.1" style="font-size:80%;">88.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_t" id="S5.T6.1.6.6.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.6.6.8.1" style="font-size:80%;">87.2</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.6.6.9" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.6.6.9.1" style="font-size:80%;">88.5</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.7.7">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.7.7.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.7.7.1.1" style="font-size:80%;">MMLU-Redux </span><span class="ltx_text" id="S5.T6.1.7.7.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.7.7.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.7.7.2.1" style="font-size:80%;">77.9</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.7.7.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.7.7.3.1" style="font-size:80%;">80.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.7.7.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.7.7.4.1" style="font-size:80%;">85.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.7.7.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.7.7.5.1" style="font-size:80%;">86.2</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.7.7.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.7.7.6.1" style="font-size:80%;">88.9</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.7.7.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.7.7.7.1" style="font-size:80%;">88.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.7.7.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.7.7.8.1" style="font-size:80%;">89.1</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.8.8">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.8.8.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.8.8.1.1" style="font-size:80%;">MMLU-Pro </span><span class="ltx_text" id="S5.T6.1.8.8.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.8.8.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.8.8.2.1" style="font-size:80%;">58.5</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.8.8.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.8.8.3.1" style="font-size:80%;">66.2</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.8.8.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.8.8.4.1" style="font-size:80%;">71.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.8.8.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.8.8.5.1" style="font-size:80%;">73.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.8.8.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.8.8.6.1" style="font-size:80%;">78.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.8.8.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.8.8.7.1" style="font-size:80%;">72.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.8.8.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.8.8.8.1" style="font-size:80%;">75.9</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.9.9">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.9.9.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.9.9.1.1" style="font-size:80%;">DROP </span><span class="ltx_text" id="S5.T6.1.9.9.1.2" style="font-size:50%;">(3-shot F1)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.9.9.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.9.9.2.1" style="font-size:80%;">83.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.9.9.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.9.9.3.1" style="font-size:80%;">87.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.9.9.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.9.9.4.1" style="font-size:80%;">76.7</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.9.9.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.9.9.5.1" style="font-size:80%;">88.7</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.9.9.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.9.9.6.1" style="font-size:80%;">88.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.9.9.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.9.9.7.1" style="font-size:80%;">83.7</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.9.9.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.9.9.8.1" style="font-size:80%;">91.</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.10.10">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.10.10.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.10.10.1.1" style="font-size:80%;">IF-Eval </span><span class="ltx_text" id="S5.T6.1.10.10.1.2" style="font-size:50%;">(Prompt Strict)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.10.10.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.10.10.2.1" style="font-size:80%;">57.7</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.10.10.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.10.10.3.1" style="font-size:80%;">80.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.10.10.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.10.10.4.1" style="font-size:80%;">84.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.10.10.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.10.10.5.1" style="font-size:80%;">86.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.10.10.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.10.10.6.1" style="font-size:80%;">86.5</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.10.10.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.10.10.7.1" style="font-size:80%;">84.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.10.10.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.10.10.8.1" style="font-size:80%;">86.1</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.11.11">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.11.11.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.11.11.1.1" style="font-size:80%;">GPQA-Diamond </span><span class="ltx_text" id="S5.T6.1.11.11.1.2" style="font-size:50%;">(Pass@1)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.11.11.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.11.11.2.1" style="font-size:80%;">35.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.11.11.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.11.11.3.1" style="font-size:80%;">41.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.11.11.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.11.11.4.1" style="font-size:80%;">49.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.11.11.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.11.11.5.1" style="font-size:80%;">51.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.11.11.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.11.11.6.1" style="font-size:80%;">65.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.11.11.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.11.11.7.1" style="font-size:80%;">49.9</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.11.11.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.11.11.8.1" style="font-size:80%;">59.1</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.12.12">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.12.12.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.12.12.1.1" style="font-size:80%;">SimpleQA </span><span class="ltx_text" id="S5.T6.1.12.12.1.2" style="font-size:50%;">(Correct)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.12.12.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.12.12.2.1" style="font-size:80%;">9.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.12.12.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.12.12.3.1" style="font-size:80%;">10.2</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.12.12.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.12.12.4.1" style="font-size:80%;">9.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.12.12.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.12.12.5.1" style="font-size:80%;">17.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.12.12.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.12.12.6.1" style="font-size:80%;">28.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.12.12.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.12.12.7.1" style="font-size:80%;">38.2</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.12.12.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.12.12.8.1" style="font-size:80%;">24.9</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.13.13">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.13.13.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.13.13.1.1" style="font-size:80%;">FRAMES </span><span class="ltx_text" id="S5.T6.1.13.13.1.2" style="font-size:50%;">(Acc.)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.13.13.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.13.13.2.1" style="font-size:80%;">66.9</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.13.13.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.13.13.3.1" style="font-size:80%;">65.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.13.13.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.13.13.4.1" style="font-size:80%;">69.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.13.13.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.13.13.5.1" style="font-size:80%;">70.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.13.13.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.13.13.6.1" style="font-size:80%;">72.5</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.13.13.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.13.13.7.1" style="font-size:80%;">80.5</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.13.13.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.13.13.8.1" style="font-size:80%;">73.3</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.14.14">
<td class="ltx_td ltx_nopad_l ltx_nopad_r" id="S5.T6.1.14.14.1" style="padding-left:1.9pt;padding-right:1.9pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.14.14.2" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.14.14.2.1" style="font-size:80%;">LongBench v2 </span><span class="ltx_text" id="S5.T6.1.14.14.2.2" style="font-size:50%;">(Acc.)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.14.14.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.14.14.3.1" style="font-size:80%;">31.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.14.14.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.14.14.4.1" style="font-size:80%;">35.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.14.14.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.14.14.5.1" style="font-size:80%;">39.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.14.14.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.14.14.6.1" style="font-size:80%;">36.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.14.14.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.14.14.7.1" style="font-size:80%;">41.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.14.14.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.14.14.8.1" style="font-size:80%;">48.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.14.14.9" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.14.14.9.1" style="font-size:80%;">48.7</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.15.15">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.15.15.1" rowspan="5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.15.15.1.1" style="font-size:80%;">Code</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r ltx_border_t" id="S5.T6.1.15.15.2" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.15.15.2.1" style="font-size:80%;">HumanEval-Mul </span><span class="ltx_text" id="S5.T6.1.15.15.2.2" style="font-size:50%;">(Pass@1)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.15.15.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.15.15.3.1" style="font-size:80%;">69.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_t" id="S5.T6.1.15.15.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.15.15.4.1" style="font-size:80%;">77.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.15.15.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.15.15.5.1" style="font-size:80%;">77.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.15.15.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.15.15.6.1" style="font-size:80%;">77.2</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.15.15.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.15.15.7.1" style="font-size:80%;">81.7</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_t" id="S5.T6.1.15.15.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.15.15.8.1" style="font-size:80%;">80.5</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.15.15.9" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.15.15.9.1" style="font-size:80%;">82.6</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.16.16">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.16.16.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.16.16.1.1" style="font-size:80%;">LiveCodeBench </span><span class="ltx_text" id="S5.T6.1.16.16.1.2" style="font-size:50%;">(Pass@1-COT)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.16.16.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.16.16.2.1" style="font-size:80%;">18.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.16.16.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.16.16.3.1" style="font-size:80%;">29.2</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.16.16.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.16.16.4.1" style="font-size:80%;">31.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.16.16.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.16.16.5.1" style="font-size:80%;">28.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.16.16.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.16.16.6.1" style="font-size:80%;">36.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.16.16.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.16.16.7.1" style="font-size:80%;">33.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.16.16.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.16.16.8.1" style="font-size:80%;">40.5</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.17.17">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.17.17.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.17.17.1.1" style="font-size:80%;">LiveCodeBench </span><span class="ltx_text" id="S5.T6.1.17.17.1.2" style="font-size:50%;">(Pass@1)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.17.17.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.17.17.2.1" style="font-size:80%;">20.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.17.17.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.17.17.3.1" style="font-size:80%;">28.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.17.17.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.17.17.4.1" style="font-size:80%;">28.7</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.17.17.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.17.17.5.1" style="font-size:80%;">30.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.17.17.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.17.17.6.1" style="font-size:80%;">32.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.17.17.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.17.17.7.1" style="font-size:80%;">34.2</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.17.17.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.17.17.8.1" style="font-size:80%;">37.6</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.18.18">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.18.18.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.18.18.1.1" style="font-size:80%;">Codeforces </span><span class="ltx_text" id="S5.T6.1.18.18.1.2" style="font-size:50%;">(Percentile)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.18.18.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.18.18.2.1" style="font-size:80%;">17.5</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.18.18.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.18.18.3.1" style="font-size:80%;">35.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.18.18.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.18.18.4.1" style="font-size:80%;">24.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.18.18.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.18.18.5.1" style="font-size:80%;">25.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.18.18.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.18.18.6.1" style="font-size:80%;">20.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.18.18.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.18.18.7.1" style="font-size:80%;">23.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.18.18.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.18.18.8.1" style="font-size:80%;">51.6</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.19.19">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.19.19.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.19.19.1.1" style="font-size:80%;">SWE Verified </span><span class="ltx_text" id="S5.T6.1.19.19.1.2" style="font-size:50%;">(Resolved)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.19.19.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.19.19.2.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.19.19.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.19.19.3.1" style="font-size:80%;">22.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.19.19.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.19.19.4.1" style="font-size:80%;">23.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.19.19.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.19.19.5.1" style="font-size:80%;">24.5</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.19.19.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.19.19.6.1" style="font-size:80%;">50.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.19.19.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.19.19.7.1" style="font-size:80%;">38.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.19.19.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.19.19.8.1" style="font-size:80%;">42.0</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.20.20">
<td class="ltx_td ltx_nopad_l ltx_nopad_r" id="S5.T6.1.20.20.1" style="padding-left:1.9pt;padding-right:1.9pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.20.20.2" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.20.20.2.1" style="font-size:80%;">Aider-Edit </span><span class="ltx_text" id="S5.T6.1.20.20.2.2" style="font-size:50%;">(Acc.)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.20.20.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.20.20.3.1" style="font-size:80%;">60.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.20.20.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.20.20.4.1" style="font-size:80%;">71.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.20.20.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.20.20.5.1" style="font-size:80%;">65.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.20.20.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.20.20.6.1" style="font-size:80%;">63.9</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.20.20.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.20.20.7.1" style="font-size:80%;">84.2</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.20.20.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.20.20.8.1" style="font-size:80%;">72.9</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.20.20.9" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.20.20.9.1" style="font-size:80%;">79.7</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.21.21">
<td class="ltx_td ltx_nopad_l ltx_nopad_r" id="S5.T6.1.21.21.1" style="padding-left:1.9pt;padding-right:1.9pt;"></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.21.21.2" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.21.21.2.1" style="font-size:80%;">Aider-Polyglot </span><span class="ltx_text" id="S5.T6.1.21.21.2.2" style="font-size:50%;">(Acc.)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.21.21.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.21.21.3.1" style="font-size:80%;">-</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.21.21.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.21.21.4.1" style="font-size:80%;">18.2</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.21.21.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.21.21.5.1" style="font-size:80%;">7.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.21.21.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.21.21.6.1" style="font-size:80%;">5.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.21.21.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.21.21.7.1" style="font-size:80%;">45.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.21.21.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.21.21.8.1" style="font-size:80%;">16.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.21.21.9" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.21.21.9.1" style="font-size:80%;">49.6</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.22.22">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.22.22.1" rowspan="3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.22.22.1.1" style="font-size:80%;">Math</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r ltx_border_t" id="S5.T6.1.22.22.2" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.22.22.2.1" style="font-size:80%;">AIME 2024 </span><span class="ltx_text" id="S5.T6.1.22.22.2.2" style="font-size:50%;">(Pass@1)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.22.22.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.22.22.3.1" style="font-size:80%;">4.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_t" id="S5.T6.1.22.22.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.22.22.4.1" style="font-size:80%;">16.7</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.22.22.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.22.22.5.1" style="font-size:80%;">23.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.22.22.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.22.22.6.1" style="font-size:80%;">23.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.22.22.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.22.22.7.1" style="font-size:80%;">16.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_t" id="S5.T6.1.22.22.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.22.22.8.1" style="font-size:80%;">9.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.22.22.9" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.22.22.9.1" style="font-size:80%;">39.2</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.23.23">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.23.23.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.23.23.1.1" style="font-size:80%;">MATH-500 </span><span class="ltx_text" id="S5.T6.1.23.23.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.23.23.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.23.23.2.1" style="font-size:80%;">56.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.23.23.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.23.23.3.1" style="font-size:80%;">74.7</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.23.23.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.23.23.4.1" style="font-size:80%;">80.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.23.23.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.23.23.5.1" style="font-size:80%;">73.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.23.23.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.23.23.6.1" style="font-size:80%;">78.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.23.23.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.23.23.7.1" style="font-size:80%;">74.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.23.23.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.23.23.8.1" style="font-size:80%;">90.2</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.24.24">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.24.24.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.24.24.1.1" style="font-size:80%;">CNMO 2024 </span><span class="ltx_text" id="S5.T6.1.24.24.1.2" style="font-size:50%;">(Pass@1)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.24.24.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.24.24.2.1" style="font-size:80%;">2.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.24.24.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.24.24.3.1" style="font-size:80%;">10.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.24.24.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.24.24.4.1" style="font-size:80%;">15.9</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.24.24.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.24.24.5.1" style="font-size:80%;">6.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.24.24.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.24.24.6.1" style="font-size:80%;">13.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.24.24.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.24.24.7.1" style="font-size:80%;">10.8</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.24.24.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.24.24.8.1" style="font-size:80%;">43.2</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.25.25">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_t" id="S5.T6.1.25.25.1" rowspan="3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.25.25.1.1" style="font-size:80%;">Chinese</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r ltx_border_t" id="S5.T6.1.25.25.2" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.25.25.2.1" style="font-size:80%;">CLUEWSC </span><span class="ltx_text" id="S5.T6.1.25.25.2.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.25.25.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.25.25.3.1" style="font-size:80%;">89.9</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_t" id="S5.T6.1.25.25.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.25.25.4.1" style="font-size:80%;">90.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.25.25.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.25.25.5.1" style="font-size:80%;">91.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.25.25.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.25.25.6.1" style="font-size:80%;">84.7</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.25.25.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.25.25.7.1" style="font-size:80%;">85.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r ltx_border_t" id="S5.T6.1.25.25.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.25.25.8.1" style="font-size:80%;">87.9</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_t" id="S5.T6.1.25.25.9" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.25.25.9.1" style="font-size:80%;">90.9</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.26.26">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_r" id="S5.T6.1.26.26.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.26.26.1.1" style="font-size:80%;">C-Eval </span><span class="ltx_text" id="S5.T6.1.26.26.1.2" style="font-size:50%;">(EM)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.26.26.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.26.26.2.1" style="font-size:80%;">78.6</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.26.26.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.26.26.3.1" style="font-size:80%;">79.5</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.26.26.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.26.26.4.1" style="font-size:80%;">86.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.26.26.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.26.26.5.1" style="font-size:80%;">61.5</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.26.26.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.26.26.6.1" style="font-size:80%;">76.7</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_r" id="S5.T6.1.26.26.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.26.26.7.1" style="font-size:80%;">76.0</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center" id="S5.T6.1.26.26.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.26.26.8.1" style="font-size:80%;">86.5</span></td>
</tr>
<tr class="ltx_tr" id="S5.T6.1.27.27">
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_left ltx_border_bb ltx_border_r" id="S5.T6.1.27.27.1" style="padding-left:1.9pt;padding-right:1.9pt;">
<span class="ltx_text" id="S5.T6.1.27.27.1.1" style="font-size:80%;">C-SimpleQA </span><span class="ltx_text" id="S5.T6.1.27.27.1.2" style="font-size:50%;">(Correct)</span>
</td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.T6.1.27.27.2" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.27.27.2.1" style="font-size:80%;">48.5</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_r" id="S5.T6.1.27.27.3" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.27.27.3.1" style="font-size:80%;">54.1</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.T6.1.27.27.4" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.27.27.4.1" style="font-size:80%;">48.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.T6.1.27.27.5" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.27.27.5.1" style="font-size:80%;">50.4</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.T6.1.27.27.6" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.27.27.6.1" style="font-size:80%;">51.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_r" id="S5.T6.1.27.27.7" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text" id="S5.T6.1.27.27.7.1" style="font-size:80%;">59.3</span></td>
<td class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.T6.1.27.27.8" style="padding-left:1.9pt;padding-right:1.9pt;"><span class="ltx_text ltx_font_bold" id="S5.T6.1.27.27.8.1" style="font-size:80%;">64.8</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption" style="font-size:80%;"><span class="ltx_tag ltx_tag_table">Table 6: </span>
Comparison between DeepSeek-V3 and other representative chat models.
All models are evaluated in a configuration that limits the output length to 8K.
Benchmarks containing fewer than 1000 samples are tested multiple times using varying temperature settings to derive robust final results.
DeepSeek-V3 stands as the best-performing open-source model, and also exhibits competitive performance against frontier closed-source models.
</figcaption>
</figure>
</section>
</section>
<section class="ltx_subsubsection" id="S5.SS3.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.3.2 </span>Standard Evaluation</h4>
<div class="ltx_para" id="S5.SS3.SSS2.p1">
<p class="ltx_p" id="S5.SS3.SSS2.p1.1">Table <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.T6" title="Table 6 ‣ Detailed Evaluation Configurations. ‣ 5.3.1 Evaluation Settings ‣ 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">6</span></a> presents the evaluation results, showcasing that DeepSeek-V3 stands as the best-performing open-source model.
Additionally, it is competitive against frontier closed-source models like GPT-4o and Claude-3.5-Sonnet.</p>
</div>
<section class="ltx_paragraph" id="S5.SS3.SSS2.Px1">
<h5 class="ltx_title ltx_title_paragraph">English Benchmarks.</h5>
<div class="ltx_para" id="S5.SS3.SSS2.Px1.p1">
<p class="ltx_p" id="S5.SS3.SSS2.Px1.p1.1">MMLU is a widely recognized benchmark designed to assess the performance of large language models, across diverse knowledge domains and tasks.
DeepSeek-V3 demonstrates competitive performance, standing on par with top-tier models such as LLaMA-3.1-405B, GPT-4o, and Claude-Sonnet 3.5, while significantly outperforming Qwen2.5 72B.
Moreover, DeepSeek-V3 excels in MMLU-Pro, a more challenging educational knowledge benchmark, where it closely trails Claude-Sonnet 3.5.
On MMLU-Redux, a refined version of MMLU with corrected labels, DeepSeek-V3 surpasses its peers.
In addition, on GPQA-Diamond, a PhD-level evaluation testbed, DeepSeek-V3 achieves remarkable results, ranking just behind Claude 3.5 Sonnet and outperforming all other competitors by a substantial margin.</p>
</div>
<div class="ltx_para" id="S5.SS3.SSS2.Px1.p2">
<p class="ltx_p" id="S5.SS3.SSS2.Px1.p2.1">In long-context understanding benchmarks such as DROP, LongBench v2, and FRAMES, DeepSeek-V3 continues to demonstrate its position as a top-tier model.
It achieves an impressive 91.6 F1 score in the 3-shot setting on DROP, outperforming all other models in this category.
On FRAMES, a benchmark requiring question-answering over 100k token contexts, DeepSeek-V3 closely trails GPT-4o while outperforming all other models by a significant margin.
This demonstrates the strong capability of DeepSeek-V3 in handling extremely long-context tasks.
The long-context capability of DeepSeek-V3 is further validated by its best-in-class performance on LongBench v2, a dataset that was released just a few weeks before the launch of DeepSeek V3.
On the factual knowledge benchmark, SimpleQA, DeepSeek-V3 falls behind GPT-4o and Claude-Sonnet, primarily due to its design focus and resource allocation.
DeepSeek-V3 assigns more training tokens to learn Chinese knowledge, leading to exceptional performance on the C-SimpleQA.
On the instruction-following benchmark, DeepSeek-V3 significantly outperforms its predecessor, DeepSeek-V2-series, highlighting its improved ability to understand and adhere to user-defined format constraints.</p>
</div>
</section>
<section class="ltx_paragraph" id="S5.SS3.SSS2.Px2">
<h5 class="ltx_title ltx_title_paragraph">Code and Math Benchmarks.</h5>
<div class="ltx_para" id="S5.SS3.SSS2.Px2.p1">
<p class="ltx_p" id="S5.SS3.SSS2.Px2.p1.1">Coding is a challenging and practical task for LLMs, encompassing engineering-focused tasks like SWE-Bench-Verified and Aider, as well as algorithmic tasks such as HumanEval and LiveCodeBench.
In engineering tasks, DeepSeek-V3 trails behind Claude-Sonnet-3.5-1022 but significantly outperforms open-source models.
The open-source DeepSeek-V3 is expected to foster advancements in coding-related engineering tasks.
By providing access to its robust capabilities, DeepSeek-V3 can drive innovation and improvement in areas such as software engineering and algorithm development, empowering developers and researchers to push the boundaries of what open-source models can achieve in coding tasks.
In algorithmic tasks, DeepSeek-V3 demonstrates superior performance, outperforming all baselines on benchmarks like HumanEval-Mul and LiveCodeBench.
This success can be attributed to its advanced knowledge distillation technique, which effectively enhances its code generation and problem-solving capabilities in algorithm-focused tasks.</p>
</div>
<div class="ltx_para" id="S5.SS3.SSS2.Px2.p2">
<p class="ltx_p" id="S5.SS3.SSS2.Px2.p2.1">On math benchmarks, DeepSeek-V3 demonstrates exceptional performance, significantly surpassing baselines and setting a new state-of-the-art for non-o1-like models.
Specifically, on AIME, MATH-500, and CNMO 2024, DeepSeek-V3 outperforms the second-best model, Qwen2.5 72B, by approximately 10% in absolute scores, which is a substantial margin for such challenging benchmarks.
This remarkable capability highlights the effectiveness of the distillation technique from DeepSeek-R1, which has been proven highly beneficial for non-o1-like models.</p>
</div>
</section>
<section class="ltx_paragraph" id="S5.SS3.SSS2.Px3">
<h5 class="ltx_title ltx_title_paragraph">Chinese Benchmarks.</h5>
<div class="ltx_para" id="S5.SS3.SSS2.Px3.p1">
<p class="ltx_p" id="S5.SS3.SSS2.Px3.p1.1">Qwen and DeepSeek are two representative model series with robust support for both Chinese and English.
On the factual benchmark Chinese SimpleQA, DeepSeek-V3 surpasses Qwen2.5-72B by 16.4 points, despite Qwen2.5 being trained on a larger corpus compromising 18T tokens, which are 20% more than the 14.8T tokens that DeepSeek-V3 is pre-trained on.</p>
</div>
<div class="ltx_para" id="S5.SS3.SSS2.Px3.p2">
<p class="ltx_p" id="S5.SS3.SSS2.Px3.p2.1">On C-Eval, a representative benchmark for Chinese educational knowledge evaluation, and CLUEWSC (Chinese Winograd Schema Challenge), DeepSeek-V3 and Qwen2.5-72B exhibit similar performance levels, indicating that both models are well-optimized for challenging Chinese-language reasoning and educational tasks.</p>
</div>
<figure class="ltx_table" id="S5.T7">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S5.T7.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S5.T7.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="S5.T7.1.1.1.1"><span class="ltx_text ltx_font_bold" id="S5.T7.1.1.1.1.1">Model</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S5.T7.1.1.1.2"><span class="ltx_text ltx_font_bold" id="S5.T7.1.1.1.2.1">Arena-Hard</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S5.T7.1.1.1.3"><span class="ltx_text ltx_font_bold" id="S5.T7.1.1.1.3.1">AlpacaEval 2.0</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T7.1.2.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T7.1.2.1.1">DeepSeek-V2.5-0905</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.1.2.1.2">76.2</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T7.1.2.1.3">50.5</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.3.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S5.T7.1.3.2.1">Qwen2.5-72B-Instruct</th>
<td class="ltx_td ltx_align_center" id="S5.T7.1.3.2.2">81.2</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.3.2.3">49.1</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.4.3">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S5.T7.1.4.3.1">LLaMA-3.1 405B</th>
<td class="ltx_td ltx_align_center" id="S5.T7.1.4.3.2">69.3</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.4.3.3">40.5</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.5.4">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S5.T7.1.5.4.1">GPT-4o-0513</th>
<td class="ltx_td ltx_align_center" id="S5.T7.1.5.4.2">80.4</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.5.4.3">51.1</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.6.5">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S5.T7.1.6.5.1">Claude-Sonnet-3.5-1022</th>
<td class="ltx_td ltx_align_center" id="S5.T7.1.6.5.2">85.2</td>
<td class="ltx_td ltx_align_center" id="S5.T7.1.6.5.3">52.0</td>
</tr>
<tr class="ltx_tr" id="S5.T7.1.7.6">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="S5.T7.1.7.6.1">DeepSeek-V3</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T7.1.7.6.2"><span class="ltx_text ltx_font_bold" id="S5.T7.1.7.6.2.1">85.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T7.1.7.6.3"><span class="ltx_text ltx_font_bold" id="S5.T7.1.7.6.3.1">70.0</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 7: </span>
English open-ended conversation evaluations.
For AlpacaEval 2.0, we use the length-controlled win rate as the metric.
</figcaption>
</figure>
</section>
</section>
<section class="ltx_subsubsection" id="S5.SS3.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.3.3 </span>Open-Ended Evaluation</h4>
<div class="ltx_para" id="S5.SS3.SSS3.p1">
<p class="ltx_p" id="S5.SS3.SSS3.p1.1">In addition to standard benchmarks, we also evaluate our models on open-ended generation tasks using LLMs as judges, with the results shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.T7" title="Table 7 ‣ Chinese Benchmarks. ‣ 5.3.2 Standard Evaluation ‣ 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">7</span></a>.
Specifically, we adhere to the original configurations of AlpacaEval 2.0 <cite class="ltx_cite ltx_citemacro_citep">(Dubois et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib20" title="">2024</a>)</cite> and Arena-Hard <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib49" title="">2024a</a>)</cite>, which leverage GPT-4-Turbo-1106 as judges for pairwise comparisons.
On Arena-Hard, DeepSeek-V3 achieves an impressive win rate of over 86% against the baseline GPT-4-0314, performing on par with top-tier models like Claude-Sonnet-3.5-1022.
This underscores the robust capabilities of DeepSeek-V3, especially in dealing with complex prompts, including coding and debugging tasks.
Furthermore, DeepSeek-V3 achieves a groundbreaking milestone as the first open-source model to surpass 85% on the Arena-Hard benchmark.
This achievement significantly bridges the performance gap between open-source and closed-source models, setting a new standard for what open-source models can accomplish in challenging domains.</p>
</div>
<div class="ltx_para" id="S5.SS3.SSS3.p2">
<p class="ltx_p" id="S5.SS3.SSS3.p2.1">Similarly, DeepSeek-V3 showcases exceptional performance on AlpacaEval 2.0, outperforming both closed-source and open-source models.
This demonstrates its outstanding proficiency in writing tasks and handling straightforward question-answering scenarios.
Notably, it surpasses DeepSeek-V2.5-0905 by a significant margin of 20%, highlighting substantial improvements in tackling simple tasks and showcasing the effectiveness of its advancements.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S5.SS3.SSS4">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.3.4 </span>DeepSeek-V3 as a Generative Reward Model</h4>
<div class="ltx_para" id="S5.SS3.SSS4.p1">
<p class="ltx_p" id="S5.SS3.SSS4.p1.1">We compare the judgment ability of DeepSeek-V3 with state-of-the-art models, namely GPT-4o and Claude-3.5.
Table <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.T8" title="Table 8 ‣ 5.3.4 DeepSeek-V3 as a Generative Reward Model ‣ 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">8</span></a> presents the performance of these models in RewardBench <cite class="ltx_cite ltx_citemacro_citep">(Lambert et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib44" title="">2024</a>)</cite>.
DeepSeek-V3 achieves performance on par with the best versions of GPT-4o-0806 and Claude-3.5-Sonnet-1022, while surpassing other versions.
Additionally, the judgment ability of DeepSeek-V3 can also be enhanced by the voting technique.
Therefore, we employ DeepSeek-V3 along with voting to offer self-feedback on open-ended questions, thereby improving the effectiveness and robustness of the alignment process.</p>
</div>
<figure class="ltx_table" id="S5.T8">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S5.T8.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T8.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_tt" id="S5.T8.1.1.1.1"><span class="ltx_text ltx_font_bold" id="S5.T8.1.1.1.1.1">Model</span></th>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T8.1.1.1.2"><span class="ltx_text ltx_font_bold" id="S5.T8.1.1.1.2.1">Chat</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T8.1.1.1.3"><span class="ltx_text ltx_font_bold" id="S5.T8.1.1.1.3.1">Chat-Hard</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T8.1.1.1.4"><span class="ltx_text ltx_font_bold" id="S5.T8.1.1.1.4.1">Safety</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T8.1.1.1.5"><span class="ltx_text ltx_font_bold" id="S5.T8.1.1.1.5.1">Reasoning</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S5.T8.1.1.1.6"><span class="ltx_text ltx_font_bold" id="S5.T8.1.1.1.6.1">Average</span></td>
</tr>
<tr class="ltx_tr" id="S5.T8.1.2.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T8.1.2.2.1">GPT-4o-0513</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.2.2.2">96.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.2.2.3">70.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.2.2.4">86.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.2.2.5">84.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.2.2.6">84.7</td>
</tr>
<tr class="ltx_tr" id="S5.T8.1.3.3">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S5.T8.1.3.3.1">GPT-4o-0806</th>
<td class="ltx_td ltx_align_center" id="S5.T8.1.3.3.2">96.1</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.3.3.3">76.1</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.3.3.4">88.1</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.3.3.5">86.6</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.3.3.6">86.7</td>
</tr>
<tr class="ltx_tr" id="S5.T8.1.4.4">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S5.T8.1.4.4.1">GPT-4o-1120</th>
<td class="ltx_td ltx_align_center" id="S5.T8.1.4.4.2">95.8</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.4.4.3">71.3</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.4.4.4">86.2</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.4.4.5">85.2</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.4.4.6">84.6</td>
</tr>
<tr class="ltx_tr" id="S5.T8.1.5.5">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T8.1.5.5.1">Claude-3.5-sonnet-0620</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.5.5.2">96.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.5.5.3">74.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.5.5.4">81.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.5.5.5">84.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.5.5.6">84.2</td>
</tr>
<tr class="ltx_tr" id="S5.T8.1.6.6">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S5.T8.1.6.6.1">Claude-3.5-sonnet-1022</th>
<td class="ltx_td ltx_align_center" id="S5.T8.1.6.6.2">96.4</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.6.6.3">79.7</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.6.6.4">91.1</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.6.6.5">87.6</td>
<td class="ltx_td ltx_align_center" id="S5.T8.1.6.6.6">88.7</td>
</tr>
<tr class="ltx_tr" id="S5.T8.1.7.7">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T8.1.7.7.1">DeepSeek-V3</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.7.7.2">96.9</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.7.7.3">79.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.7.7.4">87.0</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.7.7.5">84.3</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T8.1.7.7.6">87.0</td>
</tr>
<tr class="ltx_tr" id="S5.T8.1.8.8">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="S5.T8.1.8.8.1">DeepSeek-V3 (maj@6)</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T8.1.8.8.2">96.9</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T8.1.8.8.3">82.6</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T8.1.8.8.4">89.5</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T8.1.8.8.5">89.2</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T8.1.8.8.6">89.6</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 8: </span>Performances of GPT-4o, Claude-3.5-sonnet and DeepSeek-V3 on RewardBench.</figcaption>
</figure>
</section>
</section>
<section class="ltx_subsection" id="S5.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.4 </span>Discussion</h3>
<section class="ltx_subsubsection" id="S5.SS4.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.4.1 </span>Distillation from DeepSeek-R1</h4>
<div class="ltx_para" id="S5.SS4.SSS1.p1">
<p class="ltx_p" id="S5.SS4.SSS1.p1.1">We ablate the contribution of distillation from DeepSeek-R1 based on DeepSeek-V2.5.
The baseline is trained on short CoT data, whereas its competitor uses data generated by the expert checkpoints described above.</p>
</div>
<div class="ltx_para" id="S5.SS4.SSS1.p2">
<p class="ltx_p" id="S5.SS4.SSS1.p2.1">Table <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.T9" title="Table 9 ‣ 5.4.1 Distillation from DeepSeek-R1 ‣ 5.4 Discussion ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">9</span></a> demonstrates the effectiveness of the distillation data, showing significant improvements in both LiveCodeBench and MATH-500 benchmarks.
Our experiments reveal an interesting trade-off: the distillation leads to better performance but also substantially increases the average response length.
To maintain a balance between model accuracy and computational efficiency, we carefully selected optimal settings for DeepSeek-V3 in distillation.</p>
</div>
<div class="ltx_para" id="S5.SS4.SSS1.p3">
<p class="ltx_p" id="S5.SS4.SSS1.p3.1">Our research suggests that knowledge distillation from reasoning models presents a promising direction for post-training optimization.
While our current work focuses on distilling data from mathematics and coding domains, this approach shows potential for broader applications across various task domains.
The effectiveness demonstrated in these specific areas indicates that long-CoT distillation could be valuable for enhancing model performance in other cognitive tasks requiring complex reasoning.
Further exploration of this approach across different domains remains an important direction for future research.</p>
</div>
<figure class="ltx_table" id="S5.T9">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S5.T9.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S5.T9.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="S5.T9.1.1.1.1" rowspan="2"><span class="ltx_text ltx_font_bold" id="S5.T9.1.1.1.1.1">Model</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S5.T9.1.1.1.2"><span class="ltx_text ltx_font_bold" id="S5.T9.1.1.1.2.1">LiveCodeBench-CoT</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S5.T9.1.1.1.3"><span class="ltx_text ltx_font_bold" id="S5.T9.1.1.1.3.1">MATH-500</span></th>
</tr>
<tr class="ltx_tr" id="S5.T9.1.2.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S5.T9.1.2.2.1">Pass@1</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" id="S5.T9.1.2.2.2">Length</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S5.T9.1.2.2.3">Pass@1</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S5.T9.1.2.2.4">Length</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T9.1.3.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T9.1.3.1.1">DeepSeek-V2.5 Baseline</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T9.1.3.1.2">31.1</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S5.T9.1.3.1.3">718</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T9.1.3.1.4">74.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.T9.1.3.1.5">769</td>
</tr>
<tr class="ltx_tr" id="S5.T9.1.4.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="S5.T9.1.4.2.1">DeepSeek-V2.5 +R1 Distill</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T9.1.4.2.2">37.4</td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S5.T9.1.4.2.3">783</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T9.1.4.2.4">83.2</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.T9.1.4.2.5">1510</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 9: </span>
The contribution of distillation from DeepSeek-R1.
The evaluation settings of LiveCodeBench and MATH-500 are the same as in Table <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#S5.T6" title="Table 6 ‣ Detailed Evaluation Configurations. ‣ 5.3.1 Evaluation Settings ‣ 5.3 Evaluations ‣ 5 Post-Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">6</span></a>.
</figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S5.SS4.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.4.2 </span>Self-Rewarding</h4>
<div class="ltx_para" id="S5.SS4.SSS2.p1">
<p class="ltx_p" id="S5.SS4.SSS2.p1.1">Rewards play a pivotal role in RL, steering the optimization process.
In domains where verification through external tools is straightforward, such as some coding or mathematics scenarios, RL demonstrates exceptional efficacy.
However, in more general scenarios, constructing a feedback mechanism through hard coding is impractical.
During the development of DeepSeek-V3, for these broader contexts, we employ the constitutional AI approach <cite class="ltx_cite ltx_citemacro_citep">(Bai et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib5" title="">2022</a>)</cite>, leveraging the voting evaluation results of DeepSeek-V3 itself as a feedback source.
This method has produced notable alignment effects, significantly enhancing the performance of DeepSeek-V3 in subjective evaluations.
By integrating additional constitutional inputs, DeepSeek-V3 can optimize towards the constitutional direction.
We believe that this paradigm, which combines supplementary information with LLMs as a feedback source, is of paramount importance.
The LLM serves as a versatile processor capable of transforming unstructured information from diverse scenarios into rewards, ultimately facilitating the self-improvement of LLMs.
Beyond self-rewarding, we are also dedicated to uncovering other general and scalable rewarding methods to consistently advance the model capabilities in general scenarios.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S5.SS4.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">5.4.3 </span>Multi-Token Prediction Evaluation</h4>
<div class="ltx_para" id="S5.SS4.SSS3.p1">
<p class="ltx_p" id="S5.SS4.SSS3.p1.1">Instead of predicting just the next single token, DeepSeek-V3 predicts the next 2 tokens through the MTP technique.
Combined with the framework of speculative decoding <cite class="ltx_cite ltx_citemacro_citep">(Leviathan et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib46" title="">2023</a>; Xia et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib99" title="">2023</a>)</cite>, it can significantly accelerate the decoding speed of the model.
A natural question arises concerning the acceptance rate of the additionally predicted token.
Based on our evaluation, the acceptance rate of the second token prediction ranges between 85% and 90% across various generation topics, demonstrating consistent reliability.
This high acceptance rate enables DeepSeek-V3 to achieve a significantly improved decoding speed, delivering 1.8 times TPS (Tokens Per Second).</p>
</div>
</section>
</section>
</section>
<section class="ltx_section" id="S6" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Conclusion, Limitations, and Future Directions</h2>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">In this paper, we introduce DeepSeek-V3, a large MoE language model with 671B total parameters and 37B activated parameters, trained on 14.8T tokens.
In addition to the MLA and DeepSeekMoE architectures, it also pioneers an auxiliary-loss-free strategy for load balancing and sets a multi-token prediction training objective for stronger performance.
The training of DeepSeek-V3 is cost-effective due to the support of FP8 training and meticulous engineering optimizations.
The post-training also makes a success in distilling the reasoning capability from the DeepSeek-R1 series of models.
Comprehensive evaluations demonstrate that DeepSeek-V3 has emerged as the strongest open-source model currently available, and achieves performance comparable to leading closed-source models like GPT-4o and Claude-3.5-Sonnet.
Despite its strong performance, it also maintains economical training costs.
It requires only 2.788M H800 GPU hours for its full training, including pre-training, context length extension, and post-training.</p>
</div>
<div class="ltx_para" id="S6.p2">
<p class="ltx_p" id="S6.p2.1">While acknowledging its strong performance and cost-effectiveness, we also recognize that DeepSeek-V3 has some limitations, especially on the deployment.
Firstly, to ensure efficient inference, the recommended deployment unit for DeepSeek-V3 is relatively large, which might pose a burden for small-sized teams.
Secondly, although our deployment strategy for DeepSeek-V3 has achieved an end-to-end generation speed of more than two times that of DeepSeek-V2, there still remains potential for further enhancement.
Fortunately, these limitations are expected to be naturally addressed with the development of more advanced hardware.</p>
</div>
<div class="ltx_para" id="S6.p3">
<p class="ltx_p" id="S6.p3.1">DeepSeek consistently adheres to the route of open-source models with longtermism, aiming to steadily approach the ultimate goal of AGI (Artificial General Intelligence).
In the future, we plan to strategically invest in research across the following directions.</p>
<ul class="ltx_itemize" id="S6.I1">
<li class="ltx_item" id="S6.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S6.I1.i1.p1">
<p class="ltx_p" id="S6.I1.i1.p1.1">We will consistently study and refine our model architectures, aiming to further improve both the training and inference efficiency, striving to approach efficient support for infinite context length.
Additionally, we will try to break through the architectural limitations of Transformer, thereby pushing the boundaries of its modeling capabilities.</p>
</div>
</li>
<li class="ltx_item" id="S6.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S6.I1.i2.p1">
<p class="ltx_p" id="S6.I1.i2.p1.1">We will continuously iterate on the quantity and quality of our training data, and explore the incorporation of additional training signal sources, aiming to drive data scaling across a more comprehensive range of dimensions.</p>
</div>
</li>
<li class="ltx_item" id="S6.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S6.I1.i3.p1">
<p class="ltx_p" id="S6.I1.i3.p1.1">We will consistently explore and iterate on the deep thinking capabilities of our models, aiming to enhance their intelligence and problem-solving abilities by expanding their reasoning length and depth.</p>
</div>
</li>
<li class="ltx_item" id="S6.I1.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S6.I1.i4.p1">
<p class="ltx_p" id="S6.I1.i4.p1.1">We will explore more comprehensive and multi-dimensional model evaluation methods to prevent the tendency towards optimizing a fixed set of benchmarks during research, which may create a misleading impression of the model capabilities and affect our foundational assessment.</p>
</div>
</li>
</ul>
</div>
</section>
<section class="ltx_bibliography" id="bib" lang="en">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">AI@Meta (2024a)</span>
<span class="ltx_bibblock">
AI@Meta.

</span>
<span class="ltx_bibblock">Llama 3 model card, 2024a.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/meta-llama/llama3/blob/main/MODEL_CARD.md" title="">https://github.com/meta-llama/llama3/blob/main/MODEL_CARD.md</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">AI@Meta (2024b)</span>
<span class="ltx_bibblock">
AI@Meta.

</span>
<span class="ltx_bibblock">Llama 3.1 model card, 2024b.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/meta-llama/llama-models/blob/main/models/llama3_1/MODEL_CARD.md" title="">https://github.com/meta-llama/llama-models/blob/main/models/llama3_1/MODEL_CARD.md</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Anthropic (2024)</span>
<span class="ltx_bibblock">
Anthropic.

</span>
<span class="ltx_bibblock">Claude 3.5 sonnet, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.anthropic.com/news/claude-3-5-sonnet" title="">https://www.anthropic.com/news/claude-3-5-sonnet</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Austin et al. (2021)</span>
<span class="ltx_bibblock">
J. Austin, A. Odena, M. Nye, M. Bosma, H. Michalewski, D. Dohan, E. Jiang, C. Cai, M. Terry, Q. Le, et al.

</span>
<span class="ltx_bibblock">Program synthesis with large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">arXiv preprint arXiv:2108.07732</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bai et al. (2022)</span>
<span class="ltx_bibblock">
Y. Bai, S. Kadavath, S. Kundu, A. Askell, J. Kernion, A. Jones, A. Chen, A. Goldie, A. Mirhoseini, C. McKinnon, et al.

</span>
<span class="ltx_bibblock">Constitutional AI: Harmlessness from AI feedback.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">arXiv preprint arXiv:2212.08073</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bai et al. (2024)</span>
<span class="ltx_bibblock">
Y. Bai, S. Tu, J. Zhang, H. Peng, X. Wang, X. Lv, S. Cao, J. Xu, L. Hou, Y. Dong, J. Tang, and J. Li.

</span>
<span class="ltx_bibblock">LongBench v2: Towards deeper understanding and reasoning on realistic long-context multitasks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">arXiv preprint arXiv:2412.15204</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bauer et al. (2014)</span>
<span class="ltx_bibblock">
M. Bauer, S. Treichler, and A. Aiken.

</span>
<span class="ltx_bibblock">Singe: leveraging warp specialization for high performance on GPUs.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">Proceedings of the 19th ACM SIGPLAN Symposium on Principles and Practice of Parallel Programming</em>, PPoPP ’14, page 119–130, New York, NY, USA, 2014. Association for Computing Machinery.

</span>
<span class="ltx_bibblock">ISBN 9781450326568.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.1145/2555243.2555258" title="">10.1145/2555243.2555258</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/2555243.2555258" title="">https://doi.org/10.1145/2555243.2555258</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bisk et al. (2020)</span>
<span class="ltx_bibblock">
Y. Bisk, R. Zellers, R. L. Bras, J. Gao, and Y. Choi.

</span>
<span class="ltx_bibblock">PIQA: reasoning about physical commonsense in natural language.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">The Thirty-Fourth AAAI Conference on Artificial Intelligence, AAAI 2020, The Thirty-Second Innovative Applications of Artificial Intelligence Conference, IAAI 2020, The Tenth AAAI Symposium on Educational Advances in Artificial Intelligence, EAAI 2020, New York, NY, USA, February 7-12, 2020</em>, pages 7432–7439. AAAI Press, 2020.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.1609/aaai.v34i05.6239" title="">10.1609/aaai.v34i05.6239</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1609/aaai.v34i05.6239" title="">https://doi.org/10.1609/aaai.v34i05.6239</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al. (2021)</span>
<span class="ltx_bibblock">
M. Chen, J. Tworek, H. Jun, Q. Yuan, H. P. de Oliveira Pinto, J. Kaplan, H. Edwards, Y. Burda, N. Joseph, G. Brockman, A. Ray, R. Puri, G. Krueger, M. Petrov, H. Khlaaf, G. Sastry, P. Mishkin, B. Chan, S. Gray, N. Ryder, M. Pavlov, A. Power, L. Kaiser, M. Bavarian, C. Winter, P. Tillet, F. P. Such, D. Cummings, M. Plappert, F. Chantzis, E. Barnes, A. Herbert-Voss, W. H. Guss, A. Nichol, A. Paino, N. Tezak, J. Tang, I. Babuschkin, S. Balaji, S. Jain, W. Saunders, C. Hesse, A. N. Carr, J. Leike, J. Achiam, V. Misra, E. Morikawa, A. Radford, M. Knight, M. Brundage, M. Murati, K. Mayer, P. Welinder, B. McGrew, D. Amodei, S. McCandlish, I. Sutskever, and W. Zaremba.

</span>
<span class="ltx_bibblock">Evaluating large language models trained on code.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">CoRR</em>, abs/2107.03374, 2021.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2107.03374" title="">https://arxiv.org/abs/2107.03374</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Clark et al. (2018)</span>
<span class="ltx_bibblock">
P. Clark, I. Cowhey, O. Etzioni, T. Khot, A. Sabharwal, C. Schoenick, and O. Tafjord.

</span>
<span class="ltx_bibblock">Think you have solved question answering? try arc, the AI2 reasoning challenge.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">CoRR</em>, abs/1803.05457, 2018.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://arxiv.org/abs/1803.05457" title="">http://arxiv.org/abs/1803.05457</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cobbe et al. (2021)</span>
<span class="ltx_bibblock">
K. Cobbe, V. Kosaraju, M. Bavarian, M. Chen, H. Jun, L. Kaiser, M. Plappert, J. Tworek, J. Hilton, R. Nakano, et al.

</span>
<span class="ltx_bibblock">Training verifiers to solve math word problems.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">arXiv preprint arXiv:2110.14168</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cui et al. (2019)</span>
<span class="ltx_bibblock">
Y. Cui, T. Liu, W. Che, L. Xiao, Z. Chen, W. Ma, S. Wang, and G. Hu.

</span>
<span class="ltx_bibblock">A span-extraction dataset for Chinese machine reading comprehension.

</span>
<span class="ltx_bibblock">In K. Inui, J. Jiang, V. Ng, and X. Wan, editors, <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">Proceedings of the 2019 Conference on Empirical Methods in Natural Language Processing and the 9th International Joint Conference on Natural Language Processing (EMNLP-IJCNLP)</em>, pages 5883–5889, Hong Kong, China, Nov. 2019. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.18653/v1/D19-1600" title="">10.18653/v1/D19-1600</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/D19-1600" title="">https://aclanthology.org/D19-1600</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dai et al. (2024)</span>
<span class="ltx_bibblock">
D. Dai, C. Deng, C. Zhao, R. X. Xu, H. Gao, D. Chen, J. Li, W. Zeng, X. Yu, Y. Wu, Z. Xie, Y. K. Li, P. Huang, F. Luo, C. Ruan, Z. Sui, and W. Liang.

</span>
<span class="ltx_bibblock">Deepseekmoe: Towards ultimate expert specialization in mixture-of-experts language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">CoRR</em>, abs/2401.06066, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2401.06066" title="">https://doi.org/10.48550/arXiv.2401.06066</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">DeepSeek-AI (2024a)</span>
<span class="ltx_bibblock">
DeepSeek-AI.

</span>
<span class="ltx_bibblock">Deepseek-coder-v2: Breaking the barrier of closed-source models in code intelligence.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">CoRR</em>, abs/2406.11931, 2024a.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2406.11931" title="">https://doi.org/10.48550/arXiv.2406.11931</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">DeepSeek-AI (2024b)</span>
<span class="ltx_bibblock">
DeepSeek-AI.

</span>
<span class="ltx_bibblock">Deepseek LLM: scaling open-source language models with longtermism.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">CoRR</em>, abs/2401.02954, 2024b.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2401.02954" title="">https://doi.org/10.48550/arXiv.2401.02954</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">DeepSeek-AI (2024c)</span>
<span class="ltx_bibblock">
DeepSeek-AI.

</span>
<span class="ltx_bibblock">Deepseek-v2: A strong, economical, and efficient mixture-of-experts language model.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">CoRR</em>, abs/2405.04434, 2024c.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2405.04434" title="">https://doi.org/10.48550/arXiv.2405.04434</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dettmers et al. (2022)</span>
<span class="ltx_bibblock">
T. Dettmers, M. Lewis, Y. Belkada, and L. Zettlemoyer.

</span>
<span class="ltx_bibblock">Gpt3. int8 (): 8-bit matrix multiplication for transformers at scale.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">Advances in Neural Information Processing Systems</em>, 35:30318–30332, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ding et al. (2024)</span>
<span class="ltx_bibblock">
H. Ding, Z. Wang, G. Paolini, V. Kumar, A. Deoras, D. Roth, and S. Soatto.

</span>
<span class="ltx_bibblock">Fewer truncations improve language modeling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">arXiv preprint arXiv:2404.10830</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dua et al. (2019)</span>
<span class="ltx_bibblock">
D. Dua, Y. Wang, P. Dasigi, G. Stanovsky, S. Singh, and M. Gardner.

</span>
<span class="ltx_bibblock">DROP: A reading comprehension benchmark requiring discrete reasoning over paragraphs.

</span>
<span class="ltx_bibblock">In J. Burstein, C. Doran, and T. Solorio, editors, <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">Proceedings of the 2019 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, NAACL-HLT 2019, Minneapolis, MN, USA, June 2-7, 2019, Volume 1 (Long and Short Papers)</em>, pages 2368–2378. Association for Computational Linguistics, 2019.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.18653/V1/N19-1246" title="">10.18653/V1/N19-1246</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/n19-1246" title="">https://doi.org/10.18653/v1/n19-1246</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dubois et al. (2024)</span>
<span class="ltx_bibblock">
Y. Dubois, B. Galambosi, P. Liang, and T. B. Hashimoto.

</span>
<span class="ltx_bibblock">Length-controlled alpacaeval: A simple way to debias automatic evaluators.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">arXiv preprint arXiv:2404.04475</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fedus et al. (2021)</span>
<span class="ltx_bibblock">
W. Fedus, B. Zoph, and N. Shazeer.

</span>
<span class="ltx_bibblock">Switch transformers: Scaling to trillion parameter models with simple and efficient sparsity.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">CoRR</em>, abs/2101.03961, 2021.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2101.03961" title="">https://arxiv.org/abs/2101.03961</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fishman et al. (2024)</span>
<span class="ltx_bibblock">
M. Fishman, B. Chmiel, R. Banner, and D. Soudry.

</span>
<span class="ltx_bibblock">Scaling FP8 training to trillion-token llms.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">arXiv preprint arXiv:2409.12517</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Frantar et al. (2022)</span>
<span class="ltx_bibblock">
E. Frantar, S. Ashkboos, T. Hoefler, and D. Alistarh.

</span>
<span class="ltx_bibblock">Gptq: Accurate post-training quantization for generative pre-trained transformers.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">arXiv preprint arXiv:2210.17323</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gao et al. (2020)</span>
<span class="ltx_bibblock">
L. Gao, S. Biderman, S. Black, L. Golding, T. Hoppe, C. Foster, J. Phang, H. He, A. Thite, N. Nabeshima, et al.

</span>
<span class="ltx_bibblock">The Pile: An 800GB dataset of diverse text for language modeling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">arXiv preprint arXiv:2101.00027</em>, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gema et al. (2024)</span>
<span class="ltx_bibblock">
A. P. Gema, J. O. J. Leang, G. Hong, A. Devoto, A. C. M. Mancino, R. Saxena, X. He, Y. Zhao, X. Du, M. R. G. Madani, C. Barale, R. McHardy, J. Harris, J. Kaddour, E. van Krieken, and P. Minervini.

</span>
<span class="ltx_bibblock">Are we done with mmlu?

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">CoRR</em>, abs/2406.04127, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2406.04127" title="">https://doi.org/10.48550/arXiv.2406.04127</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gloeckle et al. (2024)</span>
<span class="ltx_bibblock">
F. Gloeckle, B. Y. Idrissi, B. Rozière, D. Lopez-Paz, and G. Synnaeve.

</span>
<span class="ltx_bibblock">Better &amp; faster large language models via multi-token prediction.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">Forty-first International Conference on Machine Learning, ICML 2024, Vienna, Austria, July 21-27, 2024</em>. OpenReview.net, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=pEWAcejiU2" title="">https://openreview.net/forum?id=pEWAcejiU2</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Google (2024)</span>
<span class="ltx_bibblock">
Google.

</span>
<span class="ltx_bibblock">Our next-generation model: Gemini 1.5, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://blog.google/technology/ai/google-gemini-next-generation-model-february-2024" title="">https://blog.google/technology/ai/google-gemini-next-generation-model-february-2024</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Graham et al. (2016)</span>
<span class="ltx_bibblock">
R. L. Graham, D. Bureddy, P. Lui, H. Rosenstock, G. Shainer, G. Bloch, D. Goldenerg, M. Dubman, S. Kotchubievsky, V. Koushnir, et al.

</span>
<span class="ltx_bibblock">Scalable hierarchical aggregation protocol (SHArP): A hardware architecture for efficient data reduction.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">2016 First International Workshop on Communication Optimizations in HPC (COMHPC)</em>, pages 1–10. IEEE, 2016.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gu et al. (2024)</span>
<span class="ltx_bibblock">
A. Gu, B. Rozière, H. Leather, A. Solar-Lezama, G. Synnaeve, and S. I. Wang.

</span>
<span class="ltx_bibblock">Cruxeval: A benchmark for code reasoning, understanding and execution, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Guo et al. (2024)</span>
<span class="ltx_bibblock">
D. Guo, Q. Zhu, D. Yang, Z. Xie, K. Dong, W. Zhang, G. Chen, X. Bi, Y. Wu, Y. K. Li, F. Luo, Y. Xiong, and W. Liang.

</span>
<span class="ltx_bibblock">Deepseek-coder: When the large language model meets programming - the rise of code intelligence.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">CoRR</em>, abs/2401.14196, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2401.14196" title="">https://doi.org/10.48550/arXiv.2401.14196</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Harlap et al. (2018)</span>
<span class="ltx_bibblock">
A. Harlap, D. Narayanan, A. Phanishayee, V. Seshadri, N. Devanur, G. Ganger, and P. Gibbons.

</span>
<span class="ltx_bibblock">Pipedream: Fast and efficient pipeline parallel dnn training, 2018.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/1806.03377" title="">https://arxiv.org/abs/1806.03377</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">(32)</span>
<span class="ltx_bibblock">
B. He, L. Noci, D. Paliotta, I. Schlag, and T. Hofmann.

</span>
<span class="ltx_bibblock">Understanding and minimising outlier features in transformer training.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">The Thirty-eighth Annual Conference on Neural Information Processing Systems</em>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">He et al. (2024)</span>
<span class="ltx_bibblock">
Y. He, S. Li, J. Liu, Y. Tan, W. Wang, H. Huang, X. Bu, H. Guo, C. Hu, B. Zheng, et al.

</span>
<span class="ltx_bibblock">Chinese simpleqa: A chinese factuality evaluation for large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib33.1.1">arXiv preprint arXiv:2411.07140</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hendrycks et al. (2020)</span>
<span class="ltx_bibblock">
D. Hendrycks, C. Burns, S. Basart, A. Zou, M. Mazeika, D. Song, and J. Steinhardt.

</span>
<span class="ltx_bibblock">Measuring massive multitask language understanding.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">arXiv preprint arXiv:2009.03300</em>, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hendrycks et al. (2021)</span>
<span class="ltx_bibblock">
D. Hendrycks, C. Burns, S. Kadavath, A. Arora, S. Basart, E. Tang, D. Song, and J. Steinhardt.

</span>
<span class="ltx_bibblock">Measuring mathematical problem solving with the math dataset.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">arXiv preprint arXiv:2103.03874</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Huang et al. (2023)</span>
<span class="ltx_bibblock">
Y. Huang, Y. Bai, Z. Zhu, J. Zhang, J. Zhang, T. Su, J. Liu, C. Lv, Y. Zhang, J. Lei, et al.

</span>
<span class="ltx_bibblock">C-Eval: A multi-level multi-discipline chinese evaluation suite for foundation models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib36.1.1">arXiv preprint arXiv:2305.08322</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jain et al. (2024)</span>
<span class="ltx_bibblock">
N. Jain, K. Han, A. Gu, W. Li, F. Yan, T. Zhang, S. Wang, A. Solar-Lezama, K. Sen, and I. Stoica.

</span>
<span class="ltx_bibblock">Livecodebench: Holistic and contamination free evaluation of large language models for code.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib37.1.1">CoRR</em>, abs/2403.07974, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2403.07974" title="">https://doi.org/10.48550/arXiv.2403.07974</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang et al. (2023)</span>
<span class="ltx_bibblock">
A. Q. Jiang, A. Sablayrolles, A. Mensch, C. Bamford, D. S. Chaplot, D. d. l. Casas, F. Bressand, G. Lengyel, G. Lample, L. Saulnier, et al.

</span>
<span class="ltx_bibblock">Mistral 7b.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib38.1.1">arXiv preprint arXiv:2310.06825</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Joshi et al. (2017)</span>
<span class="ltx_bibblock">
M. Joshi, E. Choi, D. Weld, and L. Zettlemoyer.

</span>
<span class="ltx_bibblock">TriviaQA: A large scale distantly supervised challenge dataset for reading comprehension.

</span>
<span class="ltx_bibblock">In R. Barzilay and M.-Y. Kan, editors, <em class="ltx_emph ltx_font_italic" id="bib.bib39.1.1">Proceedings of the 55th Annual Meeting of the Association for Computational Linguistics (Volume 1: Long Papers)</em>, pages 1601–1611, Vancouver, Canada, July 2017. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.18653/v1/P17-1147" title="">10.18653/v1/P17-1147</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/P17-1147" title="">https://aclanthology.org/P17-1147</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kalamkar et al. (2019)</span>
<span class="ltx_bibblock">
D. Kalamkar, D. Mudigere, N. Mellempudi, D. Das, K. Banerjee, S. Avancha, D. T. Vooturi, N. Jammalamadaka, J. Huang, H. Yuen, et al.

</span>
<span class="ltx_bibblock">A study of bfloat16 for deep learning training.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib40.1.1">arXiv preprint arXiv:1905.12322</em>, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Krishna et al. (2024)</span>
<span class="ltx_bibblock">
S. Krishna, K. Krishna, A. Mohananey, S. Schwarcz, A. Stambler, S. Upadhyay, and M. Faruqui.

</span>
<span class="ltx_bibblock">Fact, fetch, and reason: A unified evaluation of retrieval-augmented generation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib41.1.1">CoRR</em>, abs/2409.12941, 2024.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.48550/ARXIV.2409.12941" title="">10.48550/ARXIV.2409.12941</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2409.12941" title="">https://doi.org/10.48550/arXiv.2409.12941</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kwiatkowski et al. (2019)</span>
<span class="ltx_bibblock">
T. Kwiatkowski, J. Palomaki, O. Redfield, M. Collins, A. P. Parikh, C. Alberti, D. Epstein, I. Polosukhin, J. Devlin, K. Lee, K. Toutanova, L. Jones, M. Kelcey, M. Chang, A. M. Dai, J. Uszkoreit, Q. Le, and S. Petrov.

</span>
<span class="ltx_bibblock">Natural questions: a benchmark for question answering research.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib42.1.1">Trans. Assoc. Comput. Linguistics</em>, 7:452–466, 2019.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.1162/tacl_a_00276" title="">10.1162/tacl_a_00276</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1162/tacl_a_00276" title="">https://doi.org/10.1162/tacl_a_00276</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lai et al. (2017)</span>
<span class="ltx_bibblock">
G. Lai, Q. Xie, H. Liu, Y. Yang, and E. H. Hovy.

</span>
<span class="ltx_bibblock">RACE: large-scale reading comprehension dataset from examinations.

</span>
<span class="ltx_bibblock">In M. Palmer, R. Hwa, and S. Riedel, editors, <em class="ltx_emph ltx_font_italic" id="bib.bib43.1.1">Proceedings of the 2017 Conference on Empirical Methods in Natural Language Processing, EMNLP 2017, Copenhagen, Denmark, September 9-11, 2017</em>, pages 785–794. Association for Computational Linguistics, 2017.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.18653/V1/D17-1082" title="">10.18653/V1/D17-1082</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/d17-1082" title="">https://doi.org/10.18653/v1/d17-1082</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lambert et al. (2024)</span>
<span class="ltx_bibblock">
N. Lambert, V. Pyatkin, J. Morrison, L. Miranda, B. Y. Lin, K. Chandu, N. Dziri, S. Kumar, T. Zick, Y. Choi, et al.

</span>
<span class="ltx_bibblock">Rewardbench: Evaluating reward models for language modeling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib44.1.1">arXiv preprint arXiv:2403.13787</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lepikhin et al. (2021)</span>
<span class="ltx_bibblock">
D. Lepikhin, H. Lee, Y. Xu, D. Chen, O. Firat, Y. Huang, M. Krikun, N. Shazeer, and Z. Chen.

</span>
<span class="ltx_bibblock">Gshard: Scaling giant models with conditional computation and automatic sharding.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib45.1.1">9th International Conference on Learning Representations, ICLR 2021</em>. OpenReview.net, 2021.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=qrwe7XHTmYb" title="">https://openreview.net/forum?id=qrwe7XHTmYb</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Leviathan et al. (2023)</span>
<span class="ltx_bibblock">
Y. Leviathan, M. Kalman, and Y. Matias.

</span>
<span class="ltx_bibblock">Fast inference from transformers via speculative decoding.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib46.1.1">International Conference on Machine Learning, ICML 2023, 23-29 July 2023, Honolulu, Hawaii, USA</em>, volume 202 of <em class="ltx_emph ltx_font_italic" id="bib.bib46.2.2">Proceedings of Machine Learning Research</em>, pages 19274–19286. PMLR, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.mlr.press/v202/leviathan23a.html" title="">https://proceedings.mlr.press/v202/leviathan23a.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2023)</span>
<span class="ltx_bibblock">
H. Li, Y. Zhang, F. Koto, Y. Yang, H. Zhao, Y. Gong, N. Duan, and T. Baldwin.

</span>
<span class="ltx_bibblock">CMMLU: Measuring massive multitask language understanding in Chinese.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib47.1.1">arXiv preprint arXiv:2306.09212</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib48">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li and Hoefler (2021)</span>
<span class="ltx_bibblock">
S. Li and T. Hoefler.

</span>
<span class="ltx_bibblock">Chimera: efficiently training large-scale neural networks with bidirectional pipelines.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib48.1.1">Proceedings of the International Conference for High Performance Computing, Networking, Storage and Analysis</em>, SC ’21, page 1–14. ACM, Nov. 2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.1145/3458817.3476145" title="">10.1145/3458817.3476145</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://dx.doi.org/10.1145/3458817.3476145" title="">http://dx.doi.org/10.1145/3458817.3476145</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib49">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2024a)</span>
<span class="ltx_bibblock">
T. Li, W.-L. Chiang, E. Frick, L. Dunlap, T. Wu, B. Zhu, J. E. Gonzalez, and I. Stoica.

</span>
<span class="ltx_bibblock">From crowdsourced data to high-quality benchmarks: Arena-hard and benchbuilder pipeline.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib49.1.1">arXiv preprint arXiv:2406.11939</em>, 2024a.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib50">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2021)</span>
<span class="ltx_bibblock">
W. Li, F. Qi, M. Sun, X. Yi, and J. Zhang.

</span>
<span class="ltx_bibblock">Ccpm: A chinese classical poetry matching dataset, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib51">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2024b)</span>
<span class="ltx_bibblock">
Y. Li, F. Wei, C. Zhang, and H. Zhang.

</span>
<span class="ltx_bibblock">EAGLE: speculative sampling requires rethinking feature uncertainty.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib51.1.1">Forty-first International Conference on Machine Learning, ICML 2024, Vienna, Austria, July 21-27, 2024</em>. OpenReview.net, 2024b.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=1NdN7eXyb4" title="">https://openreview.net/forum?id=1NdN7eXyb4</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib52">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lin (2024)</span>
<span class="ltx_bibblock">
B. Y. Lin.

</span>
<span class="ltx_bibblock">ZeroEval: A Unified Framework for Evaluating Language Models, July 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/WildEval/ZeroEval" title="">https://github.com/WildEval/ZeroEval</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib53">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Loshchilov and Hutter (2017)</span>
<span class="ltx_bibblock">
I. Loshchilov and F. Hutter.

</span>
<span class="ltx_bibblock">Decoupled weight decay regularization.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib53.1.1">arXiv preprint arXiv:1711.05101</em>, 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib54">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lundberg (2023)</span>
<span class="ltx_bibblock">
S. Lundberg.

</span>
<span class="ltx_bibblock">The art of prompt design: Prompt boundaries and token healing, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://towardsdatascience.com/the-art-of-prompt-design-prompt-boundaries-and-token-healing-3b2448b0be38" title="">https://towardsdatascience.com/the-art-of-prompt-design-prompt-boundaries-and-token-healing-3b2448b0be38</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib55">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Luo et al. (2024)</span>
<span class="ltx_bibblock">
Y. Luo, Z. Zhang, R. Wu, H. Liu, Y. Jin, K. Zheng, M. Wang, Z. He, G. Hu, L. Chen, et al.

</span>
<span class="ltx_bibblock">Ascend HiFloat8 format for deep learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib55.1.1">arXiv preprint arXiv:2409.16626</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib56">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">MAA (2024)</span>
<span class="ltx_bibblock">
MAA.

</span>
<span class="ltx_bibblock">American invitational mathematics examination - aime.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib56.1.1">American Invitational Mathematics Examination - AIME 2024</em>, February 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://maa.org/math-competitions/american-invitational-mathematics-examination-aime" title="">https://maa.org/math-competitions/american-invitational-mathematics-examination-aime</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib57">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Micikevicius et al. (2022)</span>
<span class="ltx_bibblock">
P. Micikevicius, D. Stosic, N. Burgess, M. Cornea, P. Dubey, R. Grisenthwaite, S. Ha, A. Heinecke, P. Judd, J. Kamalu, et al.

</span>
<span class="ltx_bibblock">FP8 formats for deep learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib57.1.1">arXiv preprint arXiv:2209.05433</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib58">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mistral (2024)</span>
<span class="ltx_bibblock">
Mistral.

</span>
<span class="ltx_bibblock">Cheaper, better, faster, stronger: Continuing to push the frontier of ai and making it accessible to all, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://mistral.ai/news/mixtral-8x22b" title="">https://mistral.ai/news/mixtral-8x22b</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib59">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Narang et al. (2017)</span>
<span class="ltx_bibblock">
S. Narang, G. Diamos, E. Elsen, P. Micikevicius, J. Alben, D. Garcia, B. Ginsburg, M. Houston, O. Kuchaiev, G. Venkatesh, et al.

</span>
<span class="ltx_bibblock">Mixed precision training.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib59.1.1">Int. Conf. on Learning Representation</em>, 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib60">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Noune et al. (2022)</span>
<span class="ltx_bibblock">
B. Noune, P. Jones, D. Justus, D. Masters, and C. Luschi.

</span>
<span class="ltx_bibblock">8-bit numerical formats for deep neural networks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib60.1.1">arXiv preprint arXiv:2206.02915</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib61">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">NVIDIA (2022)</span>
<span class="ltx_bibblock">
NVIDIA.

</span>
<span class="ltx_bibblock">Improving network performance of HPC systems using NVIDIA Magnum IO NVSHMEM and GPUDirect Async.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://developer.nvidia.com/blog/improving-network-performance-of-hpc-systems-using-nvidia-magnum-io-nvshmem-and-gpudirect-async" title="">https://developer.nvidia.com/blog/improving-network-performance-of-hpc-systems-using-nvidia-magnum-io-nvshmem-and-gpudirect-async</a>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib62">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">NVIDIA (2024a)</span>
<span class="ltx_bibblock">
NVIDIA.

</span>
<span class="ltx_bibblock">Blackwell architecture.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.nvidia.com/en-us/data-center/technologies/blackwell-architecture/" title="">https://www.nvidia.com/en-us/data-center/technologies/blackwell-architecture/</a>, 2024a.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib63">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">NVIDIA (2024b)</span>
<span class="ltx_bibblock">
NVIDIA.

</span>
<span class="ltx_bibblock">TransformerEngine, 2024b.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/NVIDIA/TransformerEngine" title="">https://github.com/NVIDIA/TransformerEngine</a>.

</span>
<span class="ltx_bibblock">Accessed: 2024-11-19.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib64">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">OpenAI (2024a)</span>
<span class="ltx_bibblock">
OpenAI.

</span>
<span class="ltx_bibblock">Hello GPT-4o, 2024a.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openai.com/index/hello-gpt-4o/" title="">https://openai.com/index/hello-gpt-4o/</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib65">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">OpenAI (2024b)</span>
<span class="ltx_bibblock">
OpenAI.

</span>
<span class="ltx_bibblock">Multilingual massive multitask language understanding (mmmlu), 2024b.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://huggingface.co/datasets/openai/MMMLU" title="">https://huggingface.co/datasets/openai/MMMLU</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib66">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">OpenAI (2024c)</span>
<span class="ltx_bibblock">
OpenAI.

</span>
<span class="ltx_bibblock">Introducing SimpleQA, 2024c.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openai.com/index/introducing-simpleqa/" title="">https://openai.com/index/introducing-simpleqa/</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib67">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">OpenAI (2024d)</span>
<span class="ltx_bibblock">
OpenAI.

</span>
<span class="ltx_bibblock">Introducing SWE-bench verified we’re releasing a human-validated subset of swe-bench that more, 2024d.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openai.com/index/introducing-swe-bench-verified/" title="">https://openai.com/index/introducing-swe-bench-verified/</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib68">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Peng et al. (2023a)</span>
<span class="ltx_bibblock">
B. Peng, J. Quesnelle, H. Fan, and E. Shippole.

</span>
<span class="ltx_bibblock">Yarn: Efficient context window extension of large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib68.1.1">arXiv preprint arXiv:2309.00071</em>, 2023a.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib69">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Peng et al. (2023b)</span>
<span class="ltx_bibblock">
H. Peng, K. Wu, Y. Wei, G. Zhao, Y. Yang, Z. Liu, Y. Xiong, Z. Yang, B. Ni, J. Hu, et al.

</span>
<span class="ltx_bibblock">FP8-LM: Training FP8 large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib69.1.1">arXiv preprint arXiv:2310.18313</em>, 2023b.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib70">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Qi et al. (2023a)</span>
<span class="ltx_bibblock">
P. Qi, X. Wan, G. Huang, and M. Lin.

</span>
<span class="ltx_bibblock">Zero bubble pipeline parallelism.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib70.1.1">arXiv preprint arXiv:2401.10241</em>, 2023a.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib71">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Qi et al. (2023b)</span>
<span class="ltx_bibblock">
P. Qi, X. Wan, G. Huang, and M. Lin.

</span>
<span class="ltx_bibblock">Zero bubble pipeline parallelism, 2023b.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2401.10241" title="">https://arxiv.org/abs/2401.10241</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib72">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Qwen (2023)</span>
<span class="ltx_bibblock">
Qwen.

</span>
<span class="ltx_bibblock">Qwen technical report.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib72.1.1">arXiv preprint arXiv:2309.16609</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib73">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Qwen (2024a)</span>
<span class="ltx_bibblock">
Qwen.

</span>
<span class="ltx_bibblock">Introducing Qwen1.5, 2024a.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://qwenlm.github.io/blog/qwen1.5" title="">https://qwenlm.github.io/blog/qwen1.5</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib74">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Qwen (2024b)</span>
<span class="ltx_bibblock">
Qwen.

</span>
<span class="ltx_bibblock">Qwen2.5: A party of foundation models, 2024b.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://qwenlm.github.io/blog/qwen2.5" title="">https://qwenlm.github.io/blog/qwen2.5</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib75">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rajbhandari et al. (2020)</span>
<span class="ltx_bibblock">
S. Rajbhandari, J. Rasley, O. Ruwase, and Y. He.

</span>
<span class="ltx_bibblock">Zero: Memory optimizations toward training trillion parameter models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib75.1.1">SC20: International Conference for High Performance Computing, Networking, Storage and Analysis</em>, pages 1–16. IEEE, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib76">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rein et al. (2023)</span>
<span class="ltx_bibblock">
D. Rein, B. L. Hou, A. C. Stickland, J. Petty, R. Y. Pang, J. Dirani, J. Michael, and S. R. Bowman.

</span>
<span class="ltx_bibblock">GPQA: A graduate-level google-proof q&amp;a benchmark.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib76.1.1">arXiv preprint arXiv:2311.12022</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib77">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rouhani et al. (2023a)</span>
<span class="ltx_bibblock">
B. D. Rouhani, R. Zhao, A. More, M. Hall, A. Khodamoradi, S. Deng, D. Choudhary, M. Cornea, E. Dellinger, K. Denolf, et al.

</span>
<span class="ltx_bibblock">Microscaling data formats for deep learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib77.1.1">arXiv preprint arXiv:2310.10537</em>, 2023a.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib78">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rouhani et al. (2023b)</span>
<span class="ltx_bibblock">
B. D. Rouhani, R. Zhao, A. More, M. Hall, A. Khodamoradi, S. Deng, D. Choudhary, M. Cornea, E. Dellinger, K. Denolf, et al.

</span>
<span class="ltx_bibblock">Microscaling data formats for deep learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib78.1.1">arXiv preprint arXiv:2310.10537</em>, 2023b.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib79">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sakaguchi et al. (2019)</span>
<span class="ltx_bibblock">
K. Sakaguchi, R. L. Bras, C. Bhagavatula, and Y. Choi.

</span>
<span class="ltx_bibblock">Winogrande: An adversarial winograd schema challenge at scale, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib80">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shao et al. (2024)</span>
<span class="ltx_bibblock">
Z. Shao, P. Wang, Q. Zhu, R. Xu, J. Song, M. Zhang, Y. Li, Y. Wu, and D. Guo.

</span>
<span class="ltx_bibblock">Deepseekmath: Pushing the limits of mathematical reasoning in open language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib80.1.1">arXiv preprint arXiv:2402.03300</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib81">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shazeer et al. (2017)</span>
<span class="ltx_bibblock">
N. Shazeer, A. Mirhoseini, K. Maziarz, A. Davis, Q. V. Le, G. E. Hinton, and J. Dean.

</span>
<span class="ltx_bibblock">Outrageously large neural networks: The sparsely-gated mixture-of-experts layer.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib81.1.1">5th International Conference on Learning Representations, ICLR 2017</em>. OpenReview.net, 2017.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=B1ckMDqlg" title="">https://openreview.net/forum?id=B1ckMDqlg</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib82">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shi et al. (2023)</span>
<span class="ltx_bibblock">
F. Shi, M. Suzgun, M. Freitag, X. Wang, S. Srivats, S. Vosoughi, H. W. Chung, Y. Tay, S. Ruder, D. Zhou, D. Das, and J. Wei.

</span>
<span class="ltx_bibblock">Language models are multilingual chain-of-thought reasoners.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib82.1.1">The Eleventh International Conference on Learning Representations, ICLR 2023, Kigali, Rwanda, May 1-5, 2023</em>. OpenReview.net, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=fR3wGCk-IXp" title="">https://openreview.net/forum?id=fR3wGCk-IXp</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib83">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shibata et al. (1999)</span>
<span class="ltx_bibblock">
Y. Shibata, T. Kida, S. Fukamachi, M. Takeda, A. Shinohara, T. Shinohara, and S. Arikawa.

</span>
<span class="ltx_bibblock">Byte pair encoding: A text compression scheme that accelerates pattern matching.

</span>
<span class="ltx_bibblock">1999.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib84">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Su et al. (2024)</span>
<span class="ltx_bibblock">
J. Su, M. Ahmed, Y. Lu, S. Pan, W. Bo, and Y. Liu.

</span>
<span class="ltx_bibblock">Roformer: Enhanced transformer with rotary position embedding.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib84.1.1">Neurocomputing</em>, 568:127063, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib85">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sun et al. (2019a)</span>
<span class="ltx_bibblock">
K. Sun, D. Yu, D. Yu, and C. Cardie.

</span>
<span class="ltx_bibblock">Investigating prior knowledge for challenging chinese machine reading comprehension, 2019a.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib86">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sun et al. (2024)</span>
<span class="ltx_bibblock">
M. Sun, X. Chen, J. Z. Kolter, and Z. Liu.

</span>
<span class="ltx_bibblock">Massive activations in large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib86.1.1">arXiv preprint arXiv:2402.17762</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib87">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sun et al. (2019b)</span>
<span class="ltx_bibblock">
X. Sun, J. Choi, C.-Y. Chen, N. Wang, S. Venkataramani, V. V. Srinivasan, X. Cui, W. Zhang, and K. Gopalakrishnan.

</span>
<span class="ltx_bibblock">Hybrid 8-bit floating point (HFP8) training and inference for deep neural networks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib87.1.1">Advances in neural information processing systems</em>, 32, 2019b.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib88">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Suzgun et al. (2022)</span>
<span class="ltx_bibblock">
M. Suzgun, N. Scales, N. Schärli, S. Gehrmann, Y. Tay, H. W. Chung, A. Chowdhery, Q. V. Le, E. H. Chi, D. Zhou, et al.

</span>
<span class="ltx_bibblock">Challenging big-bench tasks and whether chain-of-thought can solve them.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib88.1.1">arXiv preprint arXiv:2210.09261</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib89">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Thakkar et al. (2023)</span>
<span class="ltx_bibblock">
V. Thakkar, P. Ramani, C. Cecka, A. Shivam, H. Lu, E. Yan, J. Kosaian, M. Hoemmen, H. Wu, A. Kerr, M. Nicely, D. Merrill, D. Blasig, F. Qiao, P. Majcher, P. Springer, M. Hohnerbach, J. Wang, and M. Gupta.

</span>
<span class="ltx_bibblock">CUTLASS, Jan. 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/NVIDIA/cutlass" title="">https://github.com/NVIDIA/cutlass</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib90">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Touvron et al. (2023a)</span>
<span class="ltx_bibblock">
H. Touvron, T. Lavril, G. Izacard, X. Martinet, M.-A. Lachaux, T. Lacroix, B. Rozière, N. Goyal, E. Hambro, F. Azhar, et al.

</span>
<span class="ltx_bibblock">LLaMA: Open and efficient foundation language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib90.1.1">arXiv preprint arXiv:2302.13971</em>, 2023a.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib91">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Touvron et al. (2023b)</span>
<span class="ltx_bibblock">
H. Touvron, L. Martin, K. Stone, P. Albert, A. Almahairi, Y. Babaei, N. Bashlykov, S. Batra, P. Bhargava, S. Bhosale, D. Bikel, L. Blecher, C. Canton-Ferrer, M. Chen, G. Cucurull, D. Esiobu, J. Fernandes, J. Fu, W. Fu, B. Fuller, C. Gao, V. Goswami, N. Goyal, A. Hartshorn, S. Hosseini, R. Hou, H. Inan, M. Kardas, V. Kerkez, M. Khabsa, I. Kloumann, A. Korenev, P. S. Koura, M. Lachaux, T. Lavril, J. Lee, D. Liskovich, Y. Lu, Y. Mao, X. Martinet, T. Mihaylov, P. Mishra, I. Molybog, Y. Nie, A. Poulton, J. Reizenstein, R. Rungta, K. Saladi, A. Schelten, R. Silva, E. M. Smith, R. Subramanian, X. E. Tan, B. Tang, R. Taylor, A. Williams, J. X. Kuan, P. Xu, Z. Yan, I. Zarov, Y. Zhang, A. Fan, M. Kambadur, S. Narang, A. Rodriguez, R. Stojnic, S. Edunov, and T. Scialom.

</span>
<span class="ltx_bibblock">Llama 2: Open foundation and fine-tuned chat models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib91.1.1">CoRR</em>, abs/2307.09288, 2023b.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.48550/arXiv.2307.09288" title="">10.48550/arXiv.2307.09288</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2307.09288" title="">https://doi.org/10.48550/arXiv.2307.09288</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib92">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al. (2017)</span>
<span class="ltx_bibblock">
A. Vaswani, N. Shazeer, N. Parmar, J. Uszkoreit, L. Jones, A. N. Gomez, Ł. Kaiser, and I. Polosukhin.

</span>
<span class="ltx_bibblock">Attention is all you need.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib92.1.1">Advances in neural information processing systems</em>, 30, 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib93">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2024a)</span>
<span class="ltx_bibblock">
L. Wang, H. Gao, C. Zhao, X. Sun, and D. Dai.

</span>
<span class="ltx_bibblock">Auxiliary-loss-free load balancing strategy for mixture-of-experts.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib93.1.1">CoRR</em>, abs/2408.15664, 2024a.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2408.15664" title="">https://doi.org/10.48550/arXiv.2408.15664</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib94">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2024b)</span>
<span class="ltx_bibblock">
Y. Wang, X. Ma, G. Zhang, Y. Ni, A. Chandra, S. Guo, W. Ren, A. Arulraj, X. He, Z. Jiang, T. Li, M. Ku, K. Wang, A. Zhuang, R. Fan, X. Yue, and W. Chen.

</span>
<span class="ltx_bibblock">Mmlu-pro: A more robust and challenging multi-task language understanding benchmark.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib94.1.1">CoRR</em>, abs/2406.01574, 2024b.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2406.01574" title="">https://doi.org/10.48550/arXiv.2406.01574</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib95">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wei et al. (2023)</span>
<span class="ltx_bibblock">
T. Wei, J. Luan, W. Liu, S. Dong, and B. Wang.

</span>
<span class="ltx_bibblock">Cmath: Can your language model pass chinese elementary school math test?, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib96">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wortsman et al. (2023)</span>
<span class="ltx_bibblock">
M. Wortsman, T. Dettmers, L. Zettlemoyer, A. Morcos, A. Farhadi, and L. Schmidt.

</span>
<span class="ltx_bibblock">Stable and low-precision training for large-scale vision-language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib96.1.1">Advances in Neural Information Processing Systems</em>, 36:10271–10298, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib97">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xi et al. (2023)</span>
<span class="ltx_bibblock">
H. Xi, C. Li, J. Chen, and J. Zhu.

</span>
<span class="ltx_bibblock">Training transformers with 4-bit integers.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib97.1.1">Advances in Neural Information Processing Systems</em>, 36:49146–49168, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib98">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xia et al. (2024)</span>
<span class="ltx_bibblock">
C. S. Xia, Y. Deng, S. Dunn, and L. Zhang.

</span>
<span class="ltx_bibblock">Agentless: Demystifying llm-based software engineering agents.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib98.1.1">arXiv preprint</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib99">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xia et al. (2023)</span>
<span class="ltx_bibblock">
H. Xia, T. Ge, P. Wang, S. Chen, F. Wei, and Z. Sui.

</span>
<span class="ltx_bibblock">Speculative decoding: Exploiting speculative execution for accelerating seq2seq generation.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib99.1.1">Findings of the Association for Computational Linguistics: EMNLP 2023, Singapore, December 6-10, 2023</em>, pages 3909–3925. Association for Computational Linguistics, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/2023.findings-emnlp.257" title="">https://doi.org/10.18653/v1/2023.findings-emnlp.257</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib100">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xiao et al. (2023)</span>
<span class="ltx_bibblock">
G. Xiao, J. Lin, M. Seznec, H. Wu, J. Demouth, and S. Han.

</span>
<span class="ltx_bibblock">Smoothquant: Accurate and efficient post-training quantization for large language models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib100.1.1">International Conference on Machine Learning</em>, pages 38087–38099. PMLR, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib101">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xu et al. (2020)</span>
<span class="ltx_bibblock">
L. Xu, H. Hu, X. Zhang, L. Li, C. Cao, Y. Li, Y. Xu, K. Sun, D. Yu, C. Yu, Y. Tian, Q. Dong, W. Liu, B. Shi, Y. Cui, J. Li, J. Zeng, R. Wang, W. Xie, Y. Li, Y. Patterson, Z. Tian, Y. Zhang, H. Zhou, S. Liu, Z. Zhao, Q. Zhao, C. Yue, X. Zhang, Z. Yang, K. Richardson, and Z. Lan.

</span>
<span class="ltx_bibblock">CLUE: A chinese language understanding evaluation benchmark.

</span>
<span class="ltx_bibblock">In D. Scott, N. Bel, and C. Zong, editors, <em class="ltx_emph ltx_font_italic" id="bib.bib101.1.1">Proceedings of the 28th International Conference on Computational Linguistics, COLING 2020, Barcelona, Spain (Online), December 8-13, 2020</em>, pages 4762–4772. International Committee on Computational Linguistics, 2020.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.18653/V1/2020.COLING-MAIN.419" title="">10.18653/V1/2020.COLING-MAIN.419</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/2020.coling-main.419" title="">https://doi.org/10.18653/v1/2020.coling-main.419</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib102">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zellers et al. (2019)</span>
<span class="ltx_bibblock">
R. Zellers, A. Holtzman, Y. Bisk, A. Farhadi, and Y. Choi.

</span>
<span class="ltx_bibblock">HellaSwag: Can a machine really finish your sentence?

</span>
<span class="ltx_bibblock">In A. Korhonen, D. R. Traum, and L. Màrquez, editors, <em class="ltx_emph ltx_font_italic" id="bib.bib102.1.1">Proceedings of the 57th Conference of the Association for Computational Linguistics, ACL 2019, Florence, Italy, July 28- August 2, 2019, Volume 1: Long Papers</em>, pages 4791–4800. Association for Computational Linguistics, 2019.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.18653/v1/p19-1472" title="">10.18653/v1/p19-1472</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.18653/v1/p19-1472" title="">https://doi.org/10.18653/v1/p19-1472</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib103">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhong et al. (2023)</span>
<span class="ltx_bibblock">
W. Zhong, R. Cui, Y. Guo, Y. Liang, S. Lu, Y. Wang, A. Saied, W. Chen, and N. Duan.

</span>
<span class="ltx_bibblock">AGIEval: A human-centric benchmark for evaluating foundation models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib103.1.1">CoRR</em>, abs/2304.06364, 2023.

</span>
<span class="ltx_bibblock"><a class="ltx_ref" href="https:/doi.org/10.48550/arXiv.2304.06364" title="">10.48550/arXiv.2304.06364</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2304.06364" title="">https://doi.org/10.48550/arXiv.2304.06364</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib104">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhou et al. (2023)</span>
<span class="ltx_bibblock">
J. Zhou, T. Lu, S. Mishra, S. Brahma, S. Basu, Y. Luan, D. Zhou, and L. Hou.

</span>
<span class="ltx_bibblock">Instruction-following evaluation for large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib104.1.1">arXiv preprint arXiv:2311.07911</em>, 2023.

</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<section class="ltx_appendix" id="Ax1" lang="en">
<h2 class="ltx_title ltx_title_appendix">Appendix</h2>
</section>
<section class="ltx_appendix" id="A1" lang="en">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Contributions and Acknowledgments</h2>
<div class="ltx_pagination ltx_role_start_2_columns"></div>
<div class="ltx_para ltx_noindent" id="A1.p1">
<p class="ltx_p" id="A1.p1.1"><span class="ltx_text ltx_font_bold" id="A1.p1.1.1" style="color:#000064;">Research &amp; Engineering</span>
<br class="ltx_break"/><span class="ltx_text" id="A1.p1.1.2" style="color:#000064;"> Aixin Liu 
<br class="ltx_break"/> Bing Xue 
<br class="ltx_break"/> Bingxuan Wang 
<br class="ltx_break"/> Bochao Wu 
<br class="ltx_break"/> Chengda Lu 
<br class="ltx_break"/> Chenggang Zhao 
<br class="ltx_break"/> Chengqi Deng 
<br class="ltx_break"/> Chenyu Zhang* 
<br class="ltx_break"/> Chong Ruan 
<br class="ltx_break"/> Damai Dai 
<br class="ltx_break"/> Daya Guo 
<br class="ltx_break"/> Dejian Yang 
<br class="ltx_break"/> Deli Chen 
<br class="ltx_break"/> Erhang Li 
<br class="ltx_break"/> Fangyun Lin 
<br class="ltx_break"/> Fucong Dai 
<br class="ltx_break"/> Fuli Luo* 
<br class="ltx_break"/> Guangbo Hao 
<br class="ltx_break"/> Guanting Chen 
<br class="ltx_break"/> Guowei Li 
<br class="ltx_break"/> H. Zhang 
<br class="ltx_break"/> Han Bao* 
<br class="ltx_break"/> Hanwei Xu 
<br class="ltx_break"/> Haocheng Wang* 
<br class="ltx_break"/> Haowei Zhang 
<br class="ltx_break"/> Honghui Ding 
<br class="ltx_break"/> Huajian Xin* 
<br class="ltx_break"/> Huazuo Gao 
<br class="ltx_break"/> Hui Qu 
<br class="ltx_break"/> Jianzhong Guo 
<br class="ltx_break"/> Jiashi Li 
<br class="ltx_break"/> Jiawei Wang* 
<br class="ltx_break"/> Jingchang Chen 
<br class="ltx_break"/> Jingyang Yuan 
<br class="ltx_break"/> Junjie Qiu 
<br class="ltx_break"/> Junlong Li 
<br class="ltx_break"/> Junxiao Song 
<br class="ltx_break"/> Kai Dong 
<br class="ltx_break"/> Kai Hu* 
<br class="ltx_break"/> Kaige Gao 
<br class="ltx_break"/> Kang Guan 
<br class="ltx_break"/> Kexin Huang 
<br class="ltx_break"/> Kuai Yu 
<br class="ltx_break"/> Lean Wang 
<br class="ltx_break"/> Lecong Zhang 
<br class="ltx_break"/> Liang Zhao 
<br class="ltx_break"/> Litong Wang 
<br class="ltx_break"/> Liyue Zhang 
<br class="ltx_break"/> Mingchuan Zhang 
<br class="ltx_break"/> Minghua Zhang 
<br class="ltx_break"/> Minghui Tang 
<br class="ltx_break"/> Panpan Huang 
<br class="ltx_break"/> Peiyi Wang 
<br class="ltx_break"/> Qiancheng Wang 
<br class="ltx_break"/> Qihao Zhu 
<br class="ltx_break"/> Qinyu Chen 
<br class="ltx_break"/> Qiushi Du 
<br class="ltx_break"/> Ruiqi Ge 
<br class="ltx_break"/> Ruisong Zhang 
<br class="ltx_break"/> Ruizhe Pan 
<br class="ltx_break"/> Runji Wang 
<br class="ltx_break"/> Runxin Xu 
<br class="ltx_break"/> Ruoyu Zhang 
<br class="ltx_break"/> Shanghao Lu 
<br class="ltx_break"/> Shangyan Zhou 
<br class="ltx_break"/> Shanhuang Chen 
<br class="ltx_break"/> Shengfeng Ye 
<br class="ltx_break"/> Shirong Ma 
<br class="ltx_break"/> Shiyu Wang 
<br class="ltx_break"/> Shuiping Yu 
<br class="ltx_break"/> Shunfeng Zhou 
<br class="ltx_break"/> Shuting Pan 
<br class="ltx_break"/> Tao Yun 
<br class="ltx_break"/> Tian Pei 
<br class="ltx_break"/> Wangding Zeng 
<br class="ltx_break"/> Wanjia Zhao* 
<br class="ltx_break"/> Wen Liu 
<br class="ltx_break"/> Wenfeng Liang 
<br class="ltx_break"/> Wenjun Gao 
<br class="ltx_break"/> Wenqin Yu 
<br class="ltx_break"/> Wentao Zhang 
<br class="ltx_break"/> Xiao Bi 
<br class="ltx_break"/> Xiaodong Liu 
<br class="ltx_break"/> Xiaohan Wang 
<br class="ltx_break"/> Xiaokang Chen 
<br class="ltx_break"/> Xiaokang Zhang 
<br class="ltx_break"/> Xiaotao Nie 
<br class="ltx_break"/> Xin Cheng 
<br class="ltx_break"/> Xin Liu 
<br class="ltx_break"/> Xin Xie 
<br class="ltx_break"/> Xingchao Liu 
<br class="ltx_break"/> Xingkai Yu 
<br class="ltx_break"/> Xinyu Yang 
<br class="ltx_break"/> Xinyuan Li 
<br class="ltx_break"/> Xuecheng Su 
<br class="ltx_break"/> Xuheng Lin 
<br class="ltx_break"/> Y.K. Li 
<br class="ltx_break"/> Y.Q. Wang 
<br class="ltx_break"/> Y.X. Wei 
<br class="ltx_break"/> Yang Zhang 
<br class="ltx_break"/> Yanhong Xu 
<br class="ltx_break"/> Yao Li 
<br class="ltx_break"/> Yao Zhao 
<br class="ltx_break"/> Yaofeng Sun 
<br class="ltx_break"/> Yaohui Wang 
<br class="ltx_break"/> Yi Yu 
<br class="ltx_break"/> Yichao Zhang 
<br class="ltx_break"/> Yifan Shi 
<br class="ltx_break"/> Yiliang Xiong 
<br class="ltx_break"/> Ying He 
<br class="ltx_break"/> Yishi Piao 
<br class="ltx_break"/> Yisong Wang 
<br class="ltx_break"/> Yixuan Tan 
<br class="ltx_break"/> Yiyang Ma* 
<br class="ltx_break"/> Yiyuan Liu 
<br class="ltx_break"/> Yongqiang Guo 
<br class="ltx_break"/> Yu Wu 
<br class="ltx_break"/> Yuan Ou 
<br class="ltx_break"/> Yuduan Wang 
<br class="ltx_break"/> Yue Gong 
<br class="ltx_break"/> Yuheng Zou 
<br class="ltx_break"/> Yujia He 
<br class="ltx_break"/> Yunfan Xiong 
<br class="ltx_break"/> Yuxiang Luo 
<br class="ltx_break"/> Yuxiang You 
<br class="ltx_break"/> Yuxuan Liu 
<br class="ltx_break"/> Yuyang Zhou 
<br class="ltx_break"/> Z.F. Wu 
<br class="ltx_break"/> Z.Z. Ren 
<br class="ltx_break"/> Zehui Ren 
<br class="ltx_break"/> Zhangli Sha 
<br class="ltx_break"/> Zhe Fu 
<br class="ltx_break"/> Zhean Xu 
<br class="ltx_break"/> Zhenda Xie 
<br class="ltx_break"/> Zhengyan Zhang 
<br class="ltx_break"/> Zhewen Hao 
<br class="ltx_break"/> Zhibin Gou 
<br class="ltx_break"/> Zhicheng Ma 
<br class="ltx_break"/> Zhigang Yan 
<br class="ltx_break"/> Zhihong Shao 
<br class="ltx_break"/> Zhiyu Wu 
<br class="ltx_break"/> Zhuoshu Li 
<br class="ltx_break"/> Zihui Gu 
<br class="ltx_break"/> Zijia Zhu 
<br class="ltx_break"/> Zijun Liu* 
<br class="ltx_break"/> Zilin Li 
<br class="ltx_break"/> Ziwei Xie 
<br class="ltx_break"/> Ziyang Song 
<br class="ltx_break"/> Ziyi Gao 
<br class="ltx_break"/> Zizheng Pan 
<br class="ltx_break"/></span></p>
</div>
<div class="ltx_para ltx_noindent" id="A1.p2">
<p class="ltx_p" id="A1.p2.1"><span class="ltx_text ltx_font_bold" id="A1.p2.1.1" style="color:#006400;">Data Annotation</span><span class="ltx_text" id="A1.p2.1.2" style="color:#000064;"> </span>
<br class="ltx_break"/><span class="ltx_text" id="A1.p2.1.3" style="color:#006400;"> Bei Feng 
<br class="ltx_break"/> Hui Li 
<br class="ltx_break"/> J.L. Cai 
<br class="ltx_break"/> Jiaqi Ni 
<br class="ltx_break"/> Lei Xu 
<br class="ltx_break"/> Meng Li 
<br class="ltx_break"/> Ning Tian 
<br class="ltx_break"/> R.J. Chen 
<br class="ltx_break"/> R.L. Jin 
<br class="ltx_break"/> Ruyi Chen 
<br class="ltx_break"/> S.S. Li 
<br class="ltx_break"/> Shuang Zhou 
<br class="ltx_break"/> Tianyu Sun 
<br class="ltx_break"/> X.Q. Li 
<br class="ltx_break"/> Xiangyue Jin 
<br class="ltx_break"/> Xiaojin Shen 
<br class="ltx_break"/> Xiaosha Chen 
<br class="ltx_break"/> Xiaowen Sun 
<br class="ltx_break"/> Xiaoxiang Wang 
<br class="ltx_break"/> Xinnan Song 
<br class="ltx_break"/> Xinyi Zhou 
<br class="ltx_break"/> Y.X. Zhu 
<br class="ltx_break"/> Yanhong Xu 
<br class="ltx_break"/> Yanping Huang 
<br class="ltx_break"/> Yaohui Li 
<br class="ltx_break"/> Yi Zheng 
<br class="ltx_break"/> Yuchen Zhu 
<br class="ltx_break"/> Yunxian Ma 
<br class="ltx_break"/> Zhen Huang 
<br class="ltx_break"/> Zhipeng Xu 
<br class="ltx_break"/> Zhongyu Zhang 
<br class="ltx_break"/></span></p>
</div>
<div class="ltx_para ltx_noindent" id="A1.p3">
<p class="ltx_p" id="A1.p3.1"><span class="ltx_text ltx_font_bold" id="A1.p3.1.1" style="color:#640000;">Business &amp; Compliance</span><span class="ltx_text" id="A1.p3.1.2" style="color:#006400;"> </span>
<br class="ltx_break"/><span class="ltx_text" id="A1.p3.1.3" style="color:#640000;"> Dongjie Ji 
<br class="ltx_break"/> Jian Liang 
<br class="ltx_break"/> Jin Chen 
<br class="ltx_break"/> Leyi Xia 
<br class="ltx_break"/> Miaojun Wang 
<br class="ltx_break"/> Mingming Li 
<br class="ltx_break"/> Peng Zhang 
<br class="ltx_break"/> Shaoqing Wu 
<br class="ltx_break"/> Shengfeng Ye 
<br class="ltx_break"/> T. Wang 
<br class="ltx_break"/> W.L. Xiao 
<br class="ltx_break"/> Wei An 
<br class="ltx_break"/> Xianzu Wang 
<br class="ltx_break"/> Xinxia Shan 
<br class="ltx_break"/> Ying Tang 
<br class="ltx_break"/> Yukun Zha 
<br class="ltx_break"/> Yuting Yan 
<br class="ltx_break"/> Zhen Zhang 
<br class="ltx_break"/></span></p>
</div>
<div class="ltx_pagination ltx_role_end_2_columns"></div>
<div class="ltx_para" id="A1.p4">
<p class="ltx_p" id="A1.p4.1">Within each role, authors are listed alphabetically by the first name.
Names marked with * denote individuals who have departed from our team.</p>
</div>
</section>
<section class="ltx_appendix" id="A2" lang="en">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix B </span>Ablation Studies for Low-Precision Training</h2>
<figure class="ltx_figure" id="A2.F10"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="219" id="A2.F10.g1" src="x10.png" width="788"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 10: </span>
Loss curves comparison between BF16 and FP8 training.
Results are smoothed by Exponential Moving Average (EMA) with a coefficient of 0.9.
</figcaption>
</figure>
<section class="ltx_subsection" id="A2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">B.1 </span>FP8 v.s. BF16 Training</h3>
<div class="ltx_para" id="A2.SS1.p1">
<p class="ltx_p" id="A2.SS1.p1.1">We validate our FP8 mixed precision framework with a comparison to BF16 training on top of two baseline models across different scales. At the small scale, we train a baseline MoE model comprising approximately 16B total parameters on 1.33T tokens.
At the large scale, we train a baseline MoE model comprising approximately 230B total parameters on around 0.9T tokens. We show the training curves in Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A2.F10" title="Figure 10 ‣ Appendix B Ablation Studies for Low-Precision Training ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">10</span></a> and demonstrate that the relative error remains below 0.25% with our high-precision accumulation and fine-grained quantization strategies.</p>
</div>
</section>
<section class="ltx_subsection" id="A2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">B.2 </span>Discussion About Block-Wise Quantization</h3>
<div class="ltx_para" id="A2.SS2.p1">
<p class="ltx_p" id="A2.SS2.p1.1">Although our tile-wise fine-grained quantization effectively mitigates the error introduced by feature outliers, it requires different groupings for activation quantization, i.e., <span class="ltx_text ltx_font_typewriter" id="A2.SS2.p1.1.1">1x128</span> in forward pass and <span class="ltx_text ltx_font_typewriter" id="A2.SS2.p1.1.2">128x1</span> for backward pass.
A similar process is also required for the activation gradient.
A straightforward strategy is to apply block-wise quantization per <span class="ltx_text ltx_font_typewriter" id="A2.SS2.p1.1.3">128x128</span> elements like the way we quantize the model weights.
In this way, only transposition is required for backward.
Therefore, we conduct an experiment where all tensors associated with <span class="ltx_text ltx_font_typewriter" id="A2.SS2.p1.1.4">Dgrad</span> are quantized on a block-wise basis.
The results reveal that the <span class="ltx_text ltx_font_typewriter" id="A2.SS2.p1.1.5">Dgrad</span> operation which computes the activation gradients and back-propagates to shallow layers in a chain-like manner, is highly sensitive to precision.
Specifically, block-wise quantization of activation gradients leads to model divergence on an MoE model comprising approximately 16B total parameters, trained for around 300B tokens.
We hypothesize that this sensitivity arises because activation gradients are highly imbalanced among tokens, resulting in token-correlated outliers <cite class="ltx_cite ltx_citemacro_citep">(Xi et al., <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#bib.bib97" title="">2023</a>)</cite>.
These outliers cannot be effectively managed by a block-wise quantization approach.</p>
</div>
</section>
</section>
<section class="ltx_appendix" id="A3" lang="en">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix C </span>Expert Specialization Patterns of the 16B Aux-Loss-Based and Aux-Loss-Free Models</h2>
<div class="ltx_para" id="A3.p1">
<p class="ltx_p" id="A3.p1.1">We record the expert load of the 16B auxiliary-loss-based baseline and the auxiliary-loss-free model on the Pile test set.
The auxiliary-loss-free model tends to have greater expert specialization across all layers, as demonstrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2412.19437v1#A3.F11" title="Figure 11 ‣ Appendix C Expert Specialization Patterns of the 16B Aux-Loss-Based and Aux-Loss-Free Models ‣ DeepSeek-V3 Technical Report"><span class="ltx_text ltx_ref_tag">11</span></a>.</p>
</div>
<figure class="ltx_figure" id="A3.F11.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="1152" id="A3.F11.sf1.g1" src="x11.png" width="789"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A3.F11.sf1.2.1.1" style="font-size:80%;">(a)</span> </span><span class="ltx_text" id="A3.F11.sf1.3.2" style="font-size:80%;">Layers 1-7</span></figcaption>
</figure>
<figure class="ltx_figure" id="A3.F11.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="1152" id="A3.F11.sf2.g1" src="x12.png" width="789"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A3.F11.sf2.2.1.1" style="font-size:80%;">(b)</span> </span><span class="ltx_text" id="A3.F11.sf2.3.2" style="font-size:80%;">Layers 7-13</span></figcaption>
</figure>
<figure class="ltx_figure" id="A3.F11.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="1152" id="A3.F11.sf3.g1" src="x13.png" width="789"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A3.F11.sf3.2.1.1" style="font-size:80%;">(c)</span> </span><span class="ltx_text" id="A3.F11.sf3.3.2" style="font-size:80%;">Layers 13-19</span></figcaption>
</figure>
<figure class="ltx_figure" id="A3.F11.sf4"><img alt="Refer to caption" class="ltx_graphics ltx_img_portrait" height="1152" id="A3.F11.sf4.g1" src="x14.png" width="789"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A3.F11.sf4.2.1.1" style="font-size:80%;">(d)</span> </span><span class="ltx_text" id="A3.F11.sf4.3.2" style="font-size:80%;">Layers 19-25</span></figcaption>
</figure>
<figure class="ltx_figure" id="A3.F11">
<figure class="ltx_figure" id="A3.F11.sf5"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="388" id="A3.F11.sf5.g1" src="x15.png" width="789"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="A3.F11.sf5.2.1.1" style="font-size:80%;">(e)</span> </span><span class="ltx_text" id="A3.F11.sf5.3.2" style="font-size:80%;">Layers 25-27</span></figcaption>
</figure>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 11: </span>
Expert load of auxiliary-loss-free and auxiliary-loss-based models on three domains in the Pile test set.
The auxiliary-loss-free model shows greater expert specialization patterns than the auxiliary-loss-based one.
The relative expert load denotes the ratio between the actual expert load and the theoretically balanced expert load.
</figcaption>
</figure>
<div class="ltx_pagination ltx_role_newpage"></div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Fri Dec 27 03:48:31 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
